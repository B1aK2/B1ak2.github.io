<!DOCTYPE html>












  


<html class="theme-next gemini use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">






















<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">

<link rel="stylesheet" href="/css/main.css?v=7.1.2">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.1.2">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/32x32.png?v=7.1.2">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/16x16.jpg?v=7.1.2">


  <link rel="mask-icon" href="/images/logo.svg?v=7.1.2" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '7.1.2',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: false,
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="3 变量3.12 字符串类型：string">
<meta property="og:type" content="article">
<meta property="og:title" content="go语言笔记">
<meta property="og:url" content="http://yoursite.com/2019/05/30/Go语言笔记/index.html">
<meta property="og:site_name" content="B1aK2&#39;Blog">
<meta property="og:description" content="3 变量3.12 字符串类型：string">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://s2.ax1x.com/2019/10/28/K67DOJ.md.png">
<meta property="og:image" content="https://s2.ax1x.com/2019/10/28/K6bJP0.png">
<meta property="og:image" content="https://s2.ax1x.com/2019/10/28/K6qAL4.png">
<meta property="og:image" content="https://s2.ax1x.com/2019/10/28/K6LVc8.png">
<meta property="og:image" content="https://s2.ax1x.com/2019/10/28/KcFMss.png">
<meta property="og:image" content="https://s2.ax1x.com/2019/10/28/KgZvhq.png">
<meta property="og:image" content="https://s2.ax1x.com/2019/10/28/Kg1Z6I.md.png">
<meta property="og:image" content="https://s2.ax1x.com/2019/10/28/Kg1nnP.md.png">
<meta property="og:image" content="https://s2.ax1x.com/2019/10/28/Kg1K78.md.png">
<meta property="og:image" content="https://s2.ax1x.com/2019/10/28/Kg1ltg.md.png">
<meta property="og:image" content="https://s2.ax1x.com/2019/10/28/Kg18pj.md.png">
<meta property="og:image" content="https://s2.ax1x.com/2019/10/29/K22SLq.png">
<meta property="og:image" content="https://s2.ax1x.com/2019/10/29/KfV8oQ.png">
<meta property="og:image" content="https://s2.ax1x.com/2019/10/29/KfnY7T.png">
<meta property="og:image" content="https://s2.ax1x.com/2019/10/29/KfJlI1.png">
<meta property="og:image" content="https://s2.ax1x.com/2019/10/30/KhrUk8.png">
<meta property="og:image" content="https://s2.ax1x.com/2019/10/30/Kh6MfU.png">
<meta property="og:image" content="https://s2.ax1x.com/2019/10/30/Kh636J.png">
<meta property="og:image" content="https://s2.ax1x.com/2019/11/06/MPiurR.png">
<meta property="og:image" content="https://s2.ax1x.com/2019/11/06/MP1tSA.png">
<meta property="og:image" content="https://s2.ax1x.com/2019/11/13/MGS7p8.png">
<meta property="og:updated_time" content="2019-11-19T12:10:58.198Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="go语言笔记">
<meta name="twitter:description" content="3 变量3.12 字符串类型：string">
<meta name="twitter:image" content="https://s2.ax1x.com/2019/10/28/K67DOJ.md.png">





  
  
  <link rel="canonical" href="http://yoursite.com/2019/05/30/Go语言笔记/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>go语言笔记 | B1aK2'Blog</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">B1aK2'Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    
      
    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类<span class="badge">3</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    
      
    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档<span class="badge">11</span></a>

  </li>

      
      
    </ul>
  

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/05/30/Go语言笔记/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="B1aK2">
      <meta itemprop="description" content="Wonderful Everyday Down the Rabbit-Hole">
      <meta itemprop="image" content="/images/author.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="B1aK2'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">go语言笔记

              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-05-30 16:28:45" itemprop="dateCreated datePublished" datetime="2019-05-30T16:28:45+08:00">2019-05-30</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-11-19 20:10:58" itemprop="dateModified" datetime="2019-11-19T20:10:58+08:00">2019-11-19</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/语言学习/" itemprop="url" rel="index"><span itemprop="name">语言学习</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="3-变量"><a href="#3-变量" class="headerlink" title="3 变量"></a>3 变量</h1><h2 id="3-12-字符串类型：string"><a href="#3-12-字符串类型：string" class="headerlink" title="3.12 字符串类型：string"></a>3.12 字符串类型：string</h2><a id="more"></a>
<ol>
<li><p>Go语言的字符串的字节使用UTF-8编码表示Unicode文本，这样Golang统一使用UTF-8编码，中文乱码问题不会困扰程序员</p>
</li>
<li><p>字符串一旦赋值了，字符串就不能修改了：在Go中字符串是不可变的</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> address <span class="keyword">string</span> = <span class="string">"北京长城 110 hello world"</span></span><br><span class="line">	fmt.Println(address)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 字符串一旦赋值了，字符串就不能修改了：在Go中字符串是不可变的</span></span><br><span class="line">	<span class="keyword">var</span> str = <span class="string">"hello"</span></span><br><span class="line">	str[<span class="number">0</span>] = <span class="string">'a'</span> <span class="comment">// 这里就不能去修改str的内容，即go中的字符串是不可变的。</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>字符串的两种形式<br>（1）双引号，会识别转义字符<br>（2）反应号，以字符串的原生形式输出，包括换行和特殊字符，可以实现防止攻击、输出源代码等</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	)</span><br><span class="line">	</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> address <span class="keyword">string</span> = <span class="string">"北京长城 110 hello world"</span></span><br><span class="line">	fmt.Println(address)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 字符串一旦赋值了，字符串就不能修改了：在Go中字符串是不可变的</span></span><br><span class="line">	</span><br><span class="line">	str2 := <span class="string">"abc/nabc"</span></span><br><span class="line">	fmt.Println(str2)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 使用反引号“``”示例</span></span><br><span class="line">	str3 := <span class="string">`</span></span><br><span class="line"><span class="string">package main</span></span><br><span class="line"><span class="string">import (</span></span><br><span class="line"><span class="string">	"fmt"</span></span><br><span class="line"><span class="string">	)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">	func main() &#123;</span></span><br><span class="line"><span class="string">	var address string = "北京长城 110 hello world"</span></span><br><span class="line"><span class="string">	fmt.Println(address)</span></span><br><span class="line"><span class="string">		// 字符串一旦赋值了，字符串就不能修改了：在Go中字符串是不可变的</span></span><br><span class="line"><span class="string">	var str = "hello"</span></span><br><span class="line"><span class="string">	str[0] = 'a' // 这里就不能去修改str的内容，即go中的字符串是不可变的。</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line">	fmt.Println(str3)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>字符串的拼接方式</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 字符串的拼接操作，使用加号拼接</span></span><br><span class="line">	<span class="keyword">var</span> str = <span class="string">"hello"</span> + <span class="string">"world"</span></span><br><span class="line">	str += <span class="string">" haha!"</span></span><br><span class="line"></span><br><span class="line">	fmt.Println(str)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 当一个拼接的操作很长时，怎么办，可以分行写，但加号要保留在上一行末尾</span></span><br><span class="line">	<span class="keyword">var</span> str2 = <span class="string">"hello"</span> + <span class="string">"world"</span> + <span class="string">"hello"</span> + <span class="string">"world"</span> + <span class="string">"hello"</span> + <span class="string">"world"</span> +<span class="string">"hello"</span> + <span class="string">"world"</span> + </span><br><span class="line">	<span class="string">"hello"</span> + <span class="string">"world"</span><span class="string">"hello"</span> + <span class="string">"world"</span> +</span><br><span class="line">	<span class="string">"hello"</span> + <span class="string">"world"</span></span><br><span class="line"></span><br><span class="line">	fmt.Println(str2)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="3-13-基本数据类型默认值"><a href="#3-13-基本数据类型默认值" class="headerlink" title="3.13 基本数据类型默认值"></a>3.13 基本数据类型默认值</h2><h3 id="3-13-1-基本介绍"><a href="#3-13-1-基本介绍" class="headerlink" title="3.13.1 基本介绍"></a>3.13.1 基本介绍</h3><p>&emsp;&emsp;在Go中，数据类型都有一个默认值，当程序员没有赋值时，就会保留默认值，在go中，默认值又叫零值</p>
<h3 id="3-13-2-基本类型的默认值如下"><a href="#3-13-2-基本类型的默认值如下" class="headerlink" title="3.13.2 基本类型的默认值如下"></a>3.13.2 基本类型的默认值如下</h3><ul>
<li>整型 -&gt; 0</li>
<li>浮点型 -&gt; 0</li>
<li>字符型 -&gt; “”</li>
<li>布尔型 -&gt; false</li>
</ul>
<h2 id="3-14-基本数据类型的相互转换"><a href="#3-14-基本数据类型的相互转换" class="headerlink" title="3.14 基本数据类型的相互转换"></a>3.14 基本数据类型的相互转换</h2><h3 id="3-14-1-基本介绍"><a href="#3-14-1-基本介绍" class="headerlink" title="3.14.1 基本介绍"></a>3.14.1 基本介绍</h3><p>&emsp;&emsp;Golang和Java/C不同，Go在不同类型的变量之间赋值时需要<code>显示转换</code>。也就是说Golang中数据类型不能自动转换。</p>
<h3 id="3-14-2-基本语法"><a href="#3-14-2-基本语法" class="headerlink" title="3.14.2 基本语法"></a>3.14.2 基本语法</h3><ul>
<li>表达式T(v)将值v转换为类型T</li>
<li>T：就是数据类型，比如int32，int64，float32等等</li>
<li>v：就是需要转换的变量</li>
</ul>
<h3 id="3-14-3-案例演示"><a href="#3-14-3-案例演示" class="headerlink" title="3.14.3 案例演示"></a>3.14.3 案例演示</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 演示golang中的基本数据类型的转换</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> i <span class="keyword">int32</span> = <span class="number">100</span></span><br><span class="line">	<span class="comment">// 希望i =&gt; float</span></span><br><span class="line">	<span class="keyword">var</span> n1 <span class="keyword">float32</span> = <span class="keyword">float32</span>(i)</span><br><span class="line">	<span class="keyword">var</span> n2 <span class="keyword">int8</span> = <span class="keyword">int8</span>(i)</span><br><span class="line">	<span class="keyword">var</span> n3 <span class="keyword">int64</span> = <span class="keyword">int64</span>(i) <span class="comment">// 低精度-&gt;高精度</span></span><br><span class="line"></span><br><span class="line">	fmt.Printf(<span class="string">"i = %v n1 = %v n2 = %v n3 = %v"</span>, i, n1, n2, n3)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">i = <span class="number">100</span> n1 = <span class="number">100</span> n2 = <span class="number">100</span> n3 = <span class="number">100</span></span><br></pre></td></tr></table></figure>

<h3 id="3-14-4-基本数据类型相互转换的注意事项"><a href="#3-14-4-基本数据类型相互转换的注意事项" class="headerlink" title="3.14.4 基本数据类型相互转换的注意事项"></a>3.14.4 基本数据类型相互转换的注意事项</h3><ol>
<li><p>Go中，数据类型的转换可以是从<code>表示范围小-&gt;表示范围大</code>,也可以<code>范围大-&gt;范围小</code></p>
</li>
<li><p>被转换的事变量存储的数据（即值），变量本身的数据类型并没有变化</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 演示golang中的基本数据类型的转换</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> i <span class="keyword">int32</span> = <span class="number">100</span></span><br><span class="line">	<span class="comment">// 希望i =&gt; float</span></span><br><span class="line">	<span class="keyword">var</span> n1 <span class="keyword">float32</span> = <span class="keyword">float32</span>(i)</span><br><span class="line">	<span class="keyword">var</span> n2 <span class="keyword">int8</span> = <span class="keyword">int8</span>(i)</span><br><span class="line">	<span class="keyword">var</span> n3 <span class="keyword">int64</span> = <span class="keyword">int64</span>(i) <span class="comment">// 低精度-&gt;高精度</span></span><br><span class="line"></span><br><span class="line">	fmt.Printf(<span class="string">"i = %v n1 = %v n2 = %v n3 = %v\n"</span>, i, n1, n2, n3)</span><br><span class="line">	fmt.Printf(<span class="string">"i type is %T\n"</span>, i)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>输出：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">i = <span class="number">100</span> n1 = <span class="number">100</span> n2 = <span class="number">100</span> n3 = <span class="number">100</span></span><br><span class="line">i <span class="keyword">type</span> is <span class="keyword">int32</span></span><br></pre></td></tr></table></figure>

<p>3）在转换中，比如讲int64转换成int8【-128——127】，编译时不会报错，只是转换的结果是按照溢出处理，和我们希望的结果不一样。因此在转换时，需要考虑数据范围。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 演示golang中的基本数据类型的转换</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> num1 <span class="keyword">int64</span> = <span class="number">99999</span></span><br><span class="line">	<span class="keyword">var</span> num2 <span class="keyword">int8</span> = <span class="keyword">int8</span>(num1)</span><br><span class="line">	fmt.Println(<span class="string">"num2="</span>, num2)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">num2 = <span class="number">-97</span></span><br></pre></td></tr></table></figure>

<h3 id="3-14-5-练习题"><a href="#3-14-5-练习题" class="headerlink" title="3.14.5 练习题"></a>3.14.5 练习题</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> n1 <span class="keyword">int32</span> = <span class="number">12</span></span><br><span class="line"><span class="keyword">var</span> n3 <span class="keyword">int8</span></span><br><span class="line"><span class="keyword">var</span> n4 <span class="keyword">int8</span></span><br><span class="line">n4 = <span class="keyword">int8</span>(n1) + <span class="number">127</span></span><br><span class="line">n3 = <span class="keyword">int8</span>(n1) + <span class="number">128</span></span><br></pre></td></tr></table></figure>

<p>解答：<br>n4编译能够通过，但结果会上溢<br>n3编译无法通过，编译器在编译时会检测出128已经超过了int8的数据范围</p>
<h2 id="3-15-基本数据类型和string的转换"><a href="#3-15-基本数据类型和string的转换" class="headerlink" title="3.15 基本数据类型和string的转换"></a>3.15 基本数据类型和string的转换</h2><h3 id="3-15-1-基本介绍"><a href="#3-15-1-基本介绍" class="headerlink" title="3.15.1 基本介绍"></a>3.15.1 基本介绍</h3><p>&emsp;&emsp;在程序开发中，我们经常讲基本数据类型转成string，或者将string转成基本数据类型。</p>
<h3 id="3-15-2-基本数据类型转string类型"><a href="#3-15-2-基本数据类型转string类型" class="headerlink" title="3.15.2 基本数据类型转string类型"></a>3.15.2 基本数据类型转string类型</h3><ul>
<li>方式1：<code>fmt.Sprintf(&quot;%参数&quot;, 表达式)【个人习惯这个，灵活】</code><br>函数的介绍：<br>Springf根据formate参数生成格式化字符串并返回该字符串。<br>参数需要和表达式的数据类型相匹配<br>fmt.Sprintf()会返回转换后的字符串</li>
</ul>
<p><strong>演示案例</strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> num1 <span class="keyword">int</span> = <span class="number">99</span></span><br><span class="line">	<span class="keyword">var</span> num2 <span class="keyword">float64</span> = <span class="number">23.456</span></span><br><span class="line">	<span class="keyword">var</span> b <span class="keyword">bool</span> = <span class="literal">true</span></span><br><span class="line">	<span class="keyword">var</span> mychar <span class="keyword">byte</span> = <span class="string">'h'</span></span><br><span class="line">	<span class="keyword">var</span> str <span class="keyword">string</span> <span class="comment">//空的str</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 使用第一种方式来转换 fmt.Sprintf方法</span></span><br><span class="line"></span><br><span class="line">	str = fmt.Sprintf(<span class="string">"%d"</span>, num1)</span><br><span class="line">	fmt.Printf(<span class="string">"str tyep %T str = %q\n"</span>, str, str)</span><br><span class="line"></span><br><span class="line">	str = fmt.Sprintf(<span class="string">"%f"</span>, num2)</span><br><span class="line">	fmt.Printf(<span class="string">"str tyep %T str = %q\n"</span>, str, str)</span><br><span class="line"></span><br><span class="line">	str = fmt.Sprintf(<span class="string">"%t"</span>, b)</span><br><span class="line">	fmt.Printf(<span class="string">"str tyep %T str = %q\n"</span>, str, str)</span><br><span class="line"></span><br><span class="line">	str = fmt.Sprintf(<span class="string">"%c"</span>, mychar)</span><br><span class="line">	fmt.Printf(<span class="string">"str tyep %T str = %q\n"</span>, str, str)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">str tyep <span class="keyword">string</span> str = <span class="string">"99"</span></span><br><span class="line">str tyep <span class="keyword">string</span> str = <span class="string">"23.456000"</span></span><br><span class="line">str tyep <span class="keyword">string</span> str = <span class="string">"true"</span></span><br><span class="line">str tyep <span class="keyword">string</span> str = <span class="string">"h"</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>方式2：<code>使用strconv包的函数</code><br><code>func FormatBool(b bool) string</code></p>
<p>  <code>func FormatFloat(f float64, fmt byte, prec, bitSize int) string</code></p>
<p>  <code>func FormatBool(i int64, base int) string</code></p>
<p>  <code>func FormatBool(i unint64, base int) string</code></p>
<p>  <code>func Itoa(i int) string</code></p>
</li>
</ul>
<p><strong>案例演示</strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"strconv"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> num1 <span class="keyword">int</span> = <span class="number">99</span></span><br><span class="line">	<span class="keyword">var</span> num2 <span class="keyword">float64</span> = <span class="number">23.456</span></span><br><span class="line">	<span class="keyword">var</span> b <span class="keyword">bool</span> = <span class="literal">true</span></span><br><span class="line">	<span class="keyword">var</span> str <span class="keyword">string</span> <span class="comment">//空的str</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 使用第二种方式来转换 strconv 函数</span></span><br><span class="line"></span><br><span class="line">	str = strconv.FormatInt(<span class="keyword">int64</span>(num1), <span class="number">10</span>)</span><br><span class="line">	fmt.Printf(<span class="string">"str tyep %T str = %q\n"</span>, str, str)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// strconv.FormatFloat(num64, 'f', 10, 64)</span></span><br><span class="line">	<span class="comment">// 说明：'f'：格式 10：表示小数点后保留10位 64：表示这个小数是float64</span></span><br><span class="line">	str = strconv.FormatFloat(num2, <span class="string">'f'</span>, <span class="number">10</span>, <span class="number">64</span>)</span><br><span class="line">	fmt.Printf(<span class="string">"str tyep %T str = %q\n"</span>, str, str)</span><br><span class="line"></span><br><span class="line">	str = strconv.FormatBool(b)</span><br><span class="line">	fmt.Printf(<span class="string">"str tyep %T str = %q\n"</span>, str, str)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// strconv包中有一个函数Itoa</span></span><br><span class="line">	<span class="keyword">var</span> num3 <span class="keyword">int</span> = <span class="number">4567</span></span><br><span class="line">	str = strconv.Itoa(num3)</span><br><span class="line">	fmt.Printf(<span class="string">"str tyep %T str = %q\n"</span>, str, str)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">str tyep <span class="keyword">string</span> str = <span class="string">"99"</span></span><br><span class="line">str tyep <span class="keyword">string</span> str = <span class="string">"23.4560000000"</span></span><br><span class="line">str tyep <span class="keyword">string</span> str = <span class="string">"true"</span></span><br><span class="line">str tyep <span class="keyword">string</span> str = <span class="string">"4567"</span></span><br></pre></td></tr></table></figure>

<h3 id="3-15-3-string类转换基本数据类型"><a href="#3-15-3-string类转换基本数据类型" class="headerlink" title="3.15.3 string类转换基本数据类型"></a>3.15.3 string类转换基本数据类型</h3><ul>
<li><p>使用strconv包的函数<br><code>func ParseBool(str string)(value bool, err error)</code></p>
<p>  <code>func ParseFloat(s string, bitSize int)(f float64, err error)</code></p>
<p>  <code>func ParseInt(s string, base int, bitSize int)(i int64, err error)</code></p>
<p>  <code>func ParseUint(s string, b int, bitSize int)(n uint64, err error)</code></p>
</li>
<li><p>案例演示</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"strconv"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> str <span class="keyword">string</span> = <span class="string">"true"</span></span><br><span class="line">	<span class="keyword">var</span> b <span class="keyword">bool</span></span><br><span class="line">	<span class="comment">// b, _ = strconv.ParseBool(str)</span></span><br><span class="line">	<span class="comment">// 说明</span></span><br><span class="line">	<span class="comment">// 1. strconv.ParseBool(str)函数会返回两个值（varlue bool, err error）</span></span><br><span class="line">	<span class="comment">// 2. 因为我只想获取到value bool，不想获取err所以我使用_忽略</span></span><br><span class="line">	b, _ = strconv.ParseBool(str)</span><br><span class="line">	fmt.Printf(<span class="string">"b type %T b = %v\n"</span>, b, b)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> str2 <span class="keyword">string</span> = <span class="string">"1234590"</span></span><br><span class="line">	<span class="keyword">var</span> n1 <span class="keyword">int64</span></span><br><span class="line">	<span class="keyword">var</span> n2 <span class="keyword">int</span></span><br><span class="line">	n1, _ = strconv.ParseInt(str2, <span class="number">10</span>, <span class="number">64</span>)</span><br><span class="line">	n2 = <span class="keyword">int</span>(n1)</span><br><span class="line">	fmt.Printf(<span class="string">"n1 type %T n1 = %v\n"</span>, n1, n1)</span><br><span class="line">	fmt.Printf(<span class="string">"n1 type %T n2 = %v\n"</span>, n2, n2)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> str3 <span class="keyword">string</span> = <span class="string">"123.456"</span></span><br><span class="line">	<span class="keyword">var</span> f1 <span class="keyword">float64</span></span><br><span class="line">	f1, _ = strconv.ParseFloat(str3, <span class="number">64</span>)</span><br><span class="line">	fmt.Printf(<span class="string">"f1 type %T f1 = %v\n"</span>, f1, f1)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>  输出：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">b <span class="keyword">type</span> <span class="keyword">bool</span> b = <span class="literal">true</span></span><br><span class="line">n1 <span class="keyword">type</span> <span class="keyword">int64</span> n1 = <span class="number">1234590</span></span><br><span class="line">n1 <span class="keyword">type</span> <span class="keyword">int</span> n2 = <span class="number">1234590</span></span><br><span class="line">f1 <span class="keyword">type</span> <span class="keyword">float64</span> f1 = <span class="number">123.456</span></span><br></pre></td></tr></table></figure>

<p>  说明：因为返回的事int64或者float64，如希望得到int32,float32等，需如下处理</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> num5 <span class="keyword">int</span> <span class="number">32</span></span><br><span class="line">num5 = <span class="keyword">int32</span>(num)</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="3-15-4-string转基本数据类型的注意事项"><a href="#3-15-4-string转基本数据类型的注意事项" class="headerlink" title="3.15.4 string转基本数据类型的注意事项"></a>3.15.4 string转基本数据类型的注意事项</h3><p>&emsp;&emsp;在将string类型转成基本数据类型时，要确保string类型能够转成有效的数据，比如 我们可以把“123”，转成一个整数，但不能把“hello”转成一个整数，如果这样，Golang直接将其转成0，其他类型也是一样的道理，float-&gt;0 bool-&gt;false</p>
<ul>
<li><p>案例说明</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span>(</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"strconv"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> str4 <span class="keyword">string</span> = <span class="string">"hello"</span></span><br><span class="line">	<span class="keyword">var</span> n3 <span class="keyword">int64</span></span><br><span class="line">	n3, _ = strconv.ParseInt(str4, <span class="number">10</span>, <span class="number">64</span>)</span><br><span class="line">	fmt.Printf(<span class="string">"f1 type %T f1 = %v\n"</span>, n3, n3)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>  输出：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">f1 <span class="keyword">type</span> <span class="keyword">int64</span> f1 = <span class="number">0</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="3-16-指针"><a href="#3-16-指针" class="headerlink" title="3.16 指针"></a>3.16 指针</h2><h3 id="3-16-1-基本介绍"><a href="#3-16-1-基本介绍" class="headerlink" title="3.16.1 基本介绍"></a>3.16.1 基本介绍</h3><ol>
<li><p>基本数据类型，变量存的就是值，也叫值类型</p>
</li>
<li><p>获取变量的地址，用<code>&amp;</code>，比如var num int，获取num的地址：&amp;num</p>
</li>
<li><p>指针类型，指针变量存的是一个地址，这个地址指向的空间存的才是值。<br>比如：var ptr *int = &amp;num </p>
</li>
<li><p>获取指针类似说指向的值，使用：<code>*</code><br>var ptr *int，使用<code>*ptr</code>获取p指向的值</p>
</li>
</ol>
<h2 id="3-17-值类型和引用类型"><a href="#3-17-值类型和引用类型" class="headerlink" title="3.17 值类型和引用类型"></a>3.17 值类型和引用类型</h2><h3 id="3-17-1-常见的值类型和引用类型"><a href="#3-17-1-常见的值类型和引用类型" class="headerlink" title="3.17.1 常见的值类型和引用类型"></a>3.17.1 常见的值类型和引用类型</h3><ol>
<li><p><strong>值类型：</strong>基本数据类型int系列，float系列，bool，string、数组和结构体struct</p>
</li>
<li><p><strong>引用类型：</strong>指针、slice切片、map、管道chan、interface等都是引用类型</p>
</li>
</ol>
<h3 id="3-17-2-值类型和引用类型的特点"><a href="#3-17-2-值类型和引用类型的特点" class="headerlink" title="3.17.2 值类型和引用类型的特点"></a>3.17.2 值类型和引用类型的特点</h3><ol>
<li><p><strong>值类型：</strong>变量直接存储，内存通常在<code>栈中分配</code></p>
</li>
<li><p><strong>引用类型：</strong>变量存储的事一个地址，这个的地址对应的空间才真正存储数据（值），内存通常在<code>堆上分配</code>，当没有任何变量引用这个地址时，该地址对应的数据空间就成为一个<code>垃圾</code>，由<code>GC</code>来回收。</p>
</li>
</ol>
<h2 id="3-18-标识符的命名规范"><a href="#3-18-标识符的命名规范" class="headerlink" title="3.18 标识符的命名规范"></a>3.18 标识符的命名规范</h2><h3 id="3-18-1-标识符概念"><a href="#3-18-1-标识符概念" class="headerlink" title="3.18.1 标识符概念"></a>3.18.1 标识符概念</h3><ol>
<li><p>Golang中对各种变量、方法、函数等命名时使用的字符序列成为标识符</p>
</li>
<li><p>凡是自己可以起名字的地方都叫标识符</p>
</li>
</ol>
<h3 id="3-18-2-标识符的命名规则（重要）"><a href="#3-18-2-标识符的命名规则（重要）" class="headerlink" title="3.18.2 标识符的命名规则（重要）"></a>3.18.2 标识符的命名规则（重要）</h3><ol>
<li><p>由26个英文字母大小写，0-9，_ 组成</p>
</li>
<li><p>数字不可以开头</p>
</li>
<li><p>Golang中严格区分大小写</p>
</li>
<li><p>标识符不能包含空格</p>
</li>
<li><p>下划线<code>_</code>本身在Go中是一个特殊的标识符，称为空标识符。可以代表任何其他的标识符，但是他对应的值会被忽略（比如，忽略某个返回值）。所以<code>仅能被作为占位符使用。不能作为标识符使用。</code></p>
</li>
<li><p>不能以系统保留关键字作为标识符，比如break，if等等</p>
</li>
</ol>
<h3 id="3-18-3-标识符命名注意事项"><a href="#3-18-3-标识符命名注意事项" class="headerlink" title="3.18.3 标识符命名注意事项"></a>3.18.3 标识符命名注意事项</h3><ol>
<li><p><strong>包名</strong>：保持package的命名和目录保持一致，尽量采用有意义的包名，简短、有意义、不要和标准库冲突</p>
</li>
<li><p><strong>变量名、函数名、常量名</strong>：采用驼峰命名法</p>
</li>
<li><p>如果变量名、函数名、常量名首字母大写，则可以被其他的包访问；如果首字母小写则只能在本包中使用（注：可简单的理解成，首字母大写是共有的，首字母小写是私有的）。在golang中<strong>没有</strong><code>public</code>、<code>private</code>关键字</p>
</li>
</ol>
<h3 id="3-20-常量"><a href="#3-20-常量" class="headerlink" title="3.20 常量"></a>3.20 常量</h3><ul>
<li>常量使用const修饰</li>
<li>常量在定义的时候必须初始化</li>
<li>常量不能修改</li>
<li>常量只能修饰bool、数值类型（int、float系列）、string类型</li>
<li>语法：<code>const valueName [valueType] = value</code>  <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> num <span class="keyword">int</span></span><br><span class="line">	num = <span class="number">90</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 常量在声明的时候必须赋值</span></span><br><span class="line">	<span class="keyword">const</span> tax <span class="keyword">int</span> = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 常量不能修改</span></span><br><span class="line">	<span class="comment">// tax = 10</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 常量只能修饰bool、数值类型（int、float系列）、string类型</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 几种特殊的写法</span></span><br><span class="line">	<span class="keyword">const</span> name = <span class="string">"tom"</span> <span class="comment">// ok，const自带类型推导</span></span><br><span class="line">	<span class="keyword">const</span> b = <span class="number">9</span> / <span class="number">3</span>    <span class="comment">// const b = num / 3 error</span></span><br><span class="line">	<span class="comment">// const c = getVal() error</span></span><br><span class="line"></span><br><span class="line">	fmt.Println(num, tax)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ol>
<li><p>比较简洁的写法</p>
 <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">const</span> (</span><br><span class="line">		a = <span class="number">1</span></span><br><span class="line">		b = <span class="number">2</span></span><br><span class="line">	)</span><br><span class="line">	fmt.Println(a,b)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>专业的写法</p>
 <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">const</span> (</span><br><span class="line">		<span class="comment">// 表示给a赋值为0，b在a的基础上+1，c在b的基础上+1</span></span><br><span class="line">		a = <span class="literal">iota</span></span><br><span class="line">		b</span><br><span class="line">		c</span><br><span class="line">	)</span><br><span class="line">	fmt.Println(a, b, c) <span class="comment">// 0, 1, 2</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">const</span> (</span><br><span class="line">		<span class="comment">// 表示给a赋值为0，b在a的基础上+1，c在b的基础上+1</span></span><br><span class="line">		a = <span class="literal">iota</span></span><br><span class="line">		b = <span class="literal">iota</span></span><br><span class="line">		c, d = <span class="literal">iota</span>, <span class="literal">iota</span></span><br><span class="line">	)</span><br><span class="line">	fmt.Println(a, b, c, d) <span class="comment">// 0, 1, 2, 2</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Golang中没有常量名必须字母大写的规范比如<code>TAX_RATE</code></p>
</li>
<li><p>仍然通过首字母的大小写来控制常量的访问范围</p>
</li>
</ol>
<h1 id="4-运算符"><a href="#4-运算符" class="headerlink" title="4 运算符"></a>4 运算符</h1><h2 id="4-1-运算符的基本介绍"><a href="#4-1-运算符的基本介绍" class="headerlink" title="4.1 运算符的基本介绍"></a>4.1 运算符的基本介绍</h2><ol>
<li><p>算数运算符</p>
</li>
<li><p>赋值运算符</p>
</li>
<li><p>比较运算符/关系运算符</p>
</li>
<li><p>逻辑运算符</p>
</li>
<li><p>位运算符</p>
</li>
<li><p>其他运算符</p>
</li>
</ol>
<h2 id="4-2-算数运算符"><a href="#4-2-算数运算符" class="headerlink" title="4.2 算数运算符"></a>4.2 算数运算符</h2><p>常见加减乘除、自增、自减、取余、字符串相加，不作过多介绍。</p>
<p>取余本质：<code>a mod b = a - a / b * b</code><br>eg:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-10 mod 3 </span><br><span class="line">= (-10) - (-10) / 3 * 3 </span><br><span class="line">= (-10) - (-3) * 3	// 整型之间运算结果为整型</span><br><span class="line">= -10 - (-9) </span><br><span class="line">= -1</span><br></pre></td></tr></table></figure>

<h3 id="4-2-3-算数运算符使用细节"><a href="#4-2-3-算数运算符使用细节" class="headerlink" title="4.2.3 算数运算符使用细节"></a>4.2.3 算数运算符使用细节</h3><p>在golang中<code>++</code>和<code>--</code>只能独立使用</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">a = i++		<span class="comment">// 错误，i++只能独立使用</span></span><br><span class="line">a = i--		<span class="comment">// 错误，i--只能独立使用</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> i++ &gt; <span class="number">0</span> &#123;	<span class="comment">// 错误，i++只能独立使用</span></span><br><span class="line">	pass</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">++i 		<span class="comment">// 错误，在golang中没有前++</span></span><br></pre></td></tr></table></figure>

<h2 id="4-9-运算符的优先级"><a href="#4-9-运算符的优先级" class="headerlink" title="4.9 运算符的优先级"></a>4.9 运算符的优先级</h2><h3 id="4-9-1-运算符优先级一览表"><a href="#4-9-1-运算符优先级一览表" class="headerlink" title="4.9.1 运算符优先级一览表"></a>4.9.1 运算符优先级一览表</h3><h3 id="4-9-2-总结："><a href="#4-9-2-总结：" class="headerlink" title="4.9.2 总结："></a>4.9.2 总结：</h3><ol>
<li><p>运算符有不同的优先级，所谓优先级就是表达式运算中的运算顺序。</p>
</li>
<li><p>只有单目运算符、赋值运算符是右向左运算的</p>
</li>
<li><p>大致的顺序：<br>&emsp;1:括号，++，–<br>&emsp;2:单目运算<br>&emsp;3:算数运算符<br>&emsp;4:移位运算<br>&emsp;5:关系运算符<br>&emsp;6:位运算符<br>&emsp;7:逻辑运算符<br>&emsp;8:赋值运算符<br>&emsp;9:逗号</p>
</li>
</ol>
<h2 id="4-12-位运算"><a href="#4-12-位运算" class="headerlink" title="4.12 位运算"></a>4.12 位运算</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a <span class="keyword">int</span> = <span class="number">1</span> &gt;&gt; <span class="number">2</span></span><br><span class="line"><span class="keyword">var</span> b <span class="keyword">int</span> = <span class="number">-1</span> &gt;&gt; <span class="number">2</span></span><br><span class="line"><span class="keyword">var</span> c <span class="keyword">int</span> = <span class="number">1</span> &lt;&lt; <span class="number">2</span></span><br><span class="line"><span class="keyword">var</span> d <span class="keyword">int</span> = <span class="number">-1</span> &lt;&lt; <span class="number">2</span></span><br><span class="line">求a、b、c、d的结果是多少？</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="number">0000</span> <span class="number">0001</span> -&gt; <span class="number">0000</span> <span class="number">0000</span> = <span class="number">0</span></span><br><span class="line">b = <span class="number">1111</span> <span class="number">1111</span>（补码） -&gt; <span class="number">1111</span> <span class="number">1111</span> -&gt; <span class="number">1111</span> <span class="number">1110</span> -&gt; <span class="number">1000</span> <span class="number">0001</span> = <span class="number">-1</span></span><br><span class="line">c = <span class="number">0000</span> <span class="number">0001</span> -&gt; <span class="number">0000</span> <span class="number">0100</span> = <span class="number">4</span></span><br><span class="line">d = <span class="number">1111</span> <span class="number">1111</span>（补码） -&gt; <span class="number">1111</span> <span class="number">1100</span> -&gt; <span class="number">1111</span> <span class="number">1011</span> -&gt; <span class="number">1000</span> <span class="number">0100</span> = <span class="number">-4</span></span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a <span class="keyword">int</span> = <span class="number">-2</span> ^ <span class="number">2</span></span><br><span class="line">求a等于多少？</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">-2</span> ^ <span class="number">2</span> = <span class="number">-4</span></span><br><span class="line"></span><br><span class="line">过程：</span><br><span class="line"><span class="number">-2</span>的原码：<span class="number">1000</span> <span class="number">0010</span> -&gt; 反码：<span class="number">1111</span> <span class="number">1101</span> -&gt; 补码：<span class="number">1111</span> <span class="number">1110</span></span><br><span class="line"><span class="number">2</span>的补码： <span class="number">0000</span> <span class="number">0010</span></span><br><span class="line"></span><br><span class="line"><span class="number">-2</span> ^ <span class="number">2</span>：</span><br><span class="line">	<span class="number">1111</span> <span class="number">1110</span></span><br><span class="line">	<span class="number">0000</span> <span class="number">0010</span></span><br><span class="line">	---------</span><br><span class="line">	<span class="number">1111</span> <span class="number">1100</span>（任为补码）</span><br><span class="line"><span class="number">1111</span> <span class="number">1100</span> -&gt; 反码：<span class="number">1111</span> <span class="number">1011</span> -&gt; 原码：<span class="number">1000</span> <span class="number">0100</span> -&gt; <span class="number">-4</span></span><br></pre></td></tr></table></figure>

<h3 id="4-12-2-原码、反码、补码"><a href="#4-12-2-原码、反码、补码" class="headerlink" title="4.12.2 原码、反码、补码"></a>4.12.2 原码、反码、补码</h3><ol>
<li><p>正数原码、反码、补码都一样</p>
</li>
<li><p>负数的反码为符号位不变，其他位取反</p>
</li>
<li><p>负数的补码为反码+1</p>
</li>
<li><p>0的反码、补码都是0</p>
</li>
<li><p>在计算机运行时都是以补码的方式来运算的</p>
</li>
</ol>
<h3 id="4-12-3-移位运算"><a href="#4-12-3-移位运算" class="headerlink" title="4.12.3 移位运算"></a>4.12.3 移位运算</h3><p>计算均用补码<br>右移运算：低位溢出，符号位不变，并用符号位补溢出的高位<br>左移运算：符号位不变，低位补0</p>
<h1 id="5-程序流程"><a href="#5-程序流程" class="headerlink" title="5 程序流程"></a>5 程序流程</h1><h3 id="5-3-3-单分支的细节说明"><a href="#5-3-3-单分支的细节说明" class="headerlink" title="5.3.3 单分支的细节说明"></a>5.3.3 单分支的细节说明</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// golang支持在if中，直接定义一个变量，比如下面</span></span><br><span class="line"><span class="keyword">if</span> age := <span class="number">20</span>; age &gt; <span class="number">28</span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">"你年龄大于18，要对自己的行为负责！"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-3-4-多分支的细节说明"><a href="#5-3-4-多分支的细节说明" class="headerlink" title="5.3.4 多分支的细节说明"></a>5.3.4 多分支的细节说明</h3><p>多分支最多只能有一个执行入口</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> b <span class="keyword">bool</span> = <span class="literal">true</span></span><br><span class="line"><span class="keyword">if</span> b = <span class="literal">false</span> &#123; <span class="comment">// 错误，只能是条件表达式</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-4-switch分支控制"><a href="#5-4-switch分支控制" class="headerlink" title="5.4 switch分支控制"></a>5.4 switch分支控制</h2><h3 id="5-4-1-基本的介绍"><a href="#5-4-1-基本的介绍" class="headerlink" title="5.4.1 基本的介绍"></a>5.4.1 基本的介绍</h3><ol>
<li><p>switch语句用于基于不同条件不同动作，没一个case分支都是唯一的，从上到下逐一测试，直到匹配为止。</p>
</li>
<li><p>匹配项后面也不需要添加break</p>
</li>
</ol>
<h3 id="5-4-2-基本语法"><a href="#5-4-2-基本语法" class="headerlink" title="5.4.2 基本语法"></a>5.4.2 基本语法</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">switch</span> 表达式 &#123;</span><br><span class="line">	<span class="keyword">case</span> 表达式<span class="number">1</span>, 表达式<span class="number">2</span>, ...:</span><br><span class="line">		语句块<span class="number">1</span></span><br><span class="line">	<span class="keyword">case</span> 表达式<span class="number">3</span>, 表达式<span class="number">4</span>, ...:</span><br><span class="line">	<span class="comment">// 这里可以有多个case语句</span></span><br><span class="line">		语句块<span class="number">2</span></span><br><span class="line">	<span class="keyword">default</span>:</span><br><span class="line">		语句块</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-4-3-总结"><a href="#5-4-3-总结" class="headerlink" title="5.4.3 总结"></a>5.4.3 总结</h3><ol>
<li><p>golang里case后的表达式可以有多个，使用<code>,</code>间隔</p>
</li>
<li><p>golang中的case语句块不需要写break，即每个case后默认添加了case语句块。</p>
</li>
<li><p>表达式之间的数据类型要相同</p>
</li>
<li><p>表达式中的常量要求不能重复</p>
</li>
<li><p>switch后也可以不带表达式，类似if–else分支来使用</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> age <span class="keyword">int</span> = <span class="number">10</span></span><br><span class="line"><span class="keyword">switch</span> &#123;</span><br><span class="line">	<span class="keyword">case</span> age == <span class="number">10</span>:</span><br><span class="line">		fmt.Println(<span class="string">"1.1"</span>)</span><br><span class="line">	<span class="keyword">case</span> age == <span class="number">20</span>:</span><br><span class="line">		fmt.Println(<span class="string">"1.2"</span>)</span><br><span class="line">	<span class="keyword">default</span>:</span><br><span class="line">		fmt.Println(<span class="string">"1.3"</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// case中也可以对age的范围进行判断</span></span><br><span class="line"><span class="keyword">switch</span> &#123;</span><br><span class="line">	<span class="keyword">case</span> age &gt; <span class="number">90</span>:</span><br><span class="line">		fmt.Println(<span class="string">"2.1"</span>)</span><br><span class="line">	<span class="keyword">case</span> age &gt;= <span class="number">70</span> &amp;&amp; age &lt;= <span class="number">90</span>:</span><br><span class="line">		fmt.Println(<span class="string">"2.2"</span>)</span><br><span class="line">	<span class="keyword">default</span>:</span><br><span class="line">		fmt.Println(<span class="string">"2.3"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>switch后面也可以之间声明/定义一个变量，分号结束，不推荐</p>
</li>
<li><p>switch穿透 fallthrought</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> num <span class="keyword">int</span> = <span class="number">10</span></span><br><span class="line"><span class="keyword">switch</span> num &#123;</span><br><span class="line">	<span class="keyword">case</span> <span class="number">10</span>:</span><br><span class="line">		fmt.Println(<span class="string">"1"</span>)</span><br><span class="line">		<span class="keyword">fallthrough</span> <span class="comment">// 默认只穿透一层</span></span><br><span class="line">	<span class="keyword">case</span> <span class="number">20</span>:</span><br><span class="line">		fmt.Println(<span class="string">"2"</span>)</span><br><span class="line">	<span class="keyword">default</span>:</span><br><span class="line">		fmt.Println(<span class="string">"没有匹配到"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> 输出：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="5-5-for循环"><a href="#5-5-for循环" class="headerlink" title="5.5 for循环"></a>5.5 for循环</h2><h3 id="5-字符串遍历方式"><a href="#5-字符串遍历方式" class="headerlink" title="5. 字符串遍历方式"></a>5. 字符串遍历方式</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> str <span class="keyword">string</span> = <span class="string">"hello, world"</span></span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(str); i++ &#123;</span><br><span class="line">	fmt.Println(<span class="string">"%c \n"</span>, str[i])</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 字符串遍历方式2-for-range方式 </span></span><br><span class="line">str = <span class="string">"abc~ok"</span></span><br><span class="line"><span class="keyword">for</span> index, val := <span class="keyword">range</span> str &#123;</span><br><span class="line">	fmt.Printf(<span class="string">"index = %d, val = %c \n"</span>, index, val)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-6-while和do……while的实现"><a href="#5-6-while和do……while的实现" class="headerlink" title="5.6 while和do……while的实现"></a>5.6 while和do……while的实现</h2><h3 id="5-6-1-for循环实现while的效果"><a href="#5-6-1-for循环实现while的效果" class="headerlink" title="5.6.1 for循环实现while的效果"></a>5.6.1 for循环实现while的效果</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 循环变量初始化</span></span><br><span class="line"><span class="keyword">for</span> &#123;</span><br><span class="line">	<span class="keyword">if</span> 循环条件表达式 &#123;</span><br><span class="line">		<span class="keyword">break</span> <span class="comment">// 跳出for循环</span></span><br><span class="line">	&#125;</span><br><span class="line">	循环操作（语句）</span><br><span class="line">	循环变量迭代</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-6-2-for循环实现do……while循环"><a href="#5-6-2-for循环实现do……while循环" class="headerlink" title="5.6.2 for循环实现do……while循环"></a>5.6.2 for循环实现do……while循环</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> &#123;</span><br><span class="line">	循环操作（语句）</span><br><span class="line">	循环变量迭代</span><br><span class="line">	<span class="keyword">if</span> 循环条件表达式 &#123;</span><br><span class="line">		<span class="keyword">break</span> <span class="comment">// 跳出for循环</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-8-跳转控制语句-break"><a href="#5-8-跳转控制语句-break" class="headerlink" title="5.8 跳转控制语句-break"></a>5.8 跳转控制语句-break</h2><h3 id="5-8-1-看一个具体需求，引出break"><a href="#5-8-1-看一个具体需求，引出break" class="headerlink" title="5.8.1 看一个具体需求，引出break"></a>5.8.1 看一个具体需求，引出break</h3><p>随机数的生成</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"math/rand"</span></span><br><span class="line">	)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 我们为了生成一个随机数，还需要设置一个种子</span></span><br><span class="line">	<span class="comment">// time.Now().Unix()：返回一个1970.1.1 0分0秒到现在的秒数</span></span><br><span class="line">	<span class="comment">// time.Now().UnixNano()：返回纳秒</span></span><br><span class="line">	rand.Seed(time.Now().Unix())</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 如何随机生成1-100的整数</span></span><br><span class="line">	<span class="comment">// rand.Intn(100)生成[0, 100)的整数</span></span><br><span class="line"></span><br><span class="line">	n := rand.Intn(<span class="number">100</span>) + <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-8-6-break的注意事项和使用细节"><a href="#5-8-6-break的注意事项和使用细节" class="headerlink" title="5.8.6 break的注意事项和使用细节"></a>5.8.6 break的注意事项和使用细节</h3><ol>
<li>break语句出现在多层嵌套的语句块中是，可以决定跳出到哪一层<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">lable2:</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">4</span>; i++ &#123;</span><br><span class="line">	<span class="keyword">for</span> j := <span class="number">0</span>; j &lt; <span class="number">10</span>; j++ &#123;</span><br><span class="line">		<span class="keyword">if</span> j == <span class="number">2</span> &#123;</span><br><span class="line">			<span class="keyword">break</span> lable2</span><br><span class="line">		&#125;</span><br><span class="line">		fmt.Println(<span class="string">"j="</span>, j) </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="6-函数"><a href="#6-函数" class="headerlink" title="6 函数"></a>6 函数</h2><h3 id="6-1-函数注意事项"><a href="#6-1-函数注意事项" class="headerlink" title="6.1 函数注意事项"></a>6.1 函数注意事项</h3><ol>
<li><p>公有函数或变量首字母需要大写</p>
</li>
<li><p>包名过长可以给包起别名，若这样做原包名则无法使用</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">packaga main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	haha <span class="string">".../.../.../xixi"</span></span><br><span class="line">	)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// haha即为xixi文件夹下包的别名</span></span><br><span class="line">	haha.Func1()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>相同包下不能有相同的变量名以及全局变量名</p>
</li>
<li><p>要编译成可执行文件，必须将包名声明为mian。否则只编译成库文件的话，则可自定义包名</p>
</li>
<li><p>Go语言函数不支持重载</p>
</li>
<li><p>基本数据类型和数组默认都是值传递，即进行值的拷贝，内部修改无法影响到外部的变量。</p>
</li>
<li><p>函数可作为型参进行传递</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">myFun</span><span class="params">(funvar <span class="keyword">func</span>(<span class="keyword">int</span>, <span class="keyword">int</span>)</span> <span class="title">int</span>, <span class="title">num1</span> <span class="title">int</span>, <span class="title">num2</span> <span class="title">int</span>) <span class="title">int</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> funvar(num1, num2)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>go可自定义数据类型<br>基本语法：<code>type</code>自定义数据类型名 数据类型<br>&emsp;&emsp;&emsp;&emsp;&emsp;相当于一个别名<br>案例1 ：<code>type myInt int</code><br>&emsp;&emsp;&emsp;&emsp;这时<code>myInt</code>就等价于<code>int</code>来使用<br>案例2 ：<code>type mySum func(int, int) int</code><br>&emsp;&emsp;&emsp;&emsp;这时<code>mySum</code>就等价于一个函数类型<code>func(int, int) int</code></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 给int取了别名，在go中myInt和int虽然都是int类型</span></span><br><span class="line">	<span class="comment">// 但是go认为myInt和int是两个类型</span></span><br><span class="line">	<span class="keyword">type</span> myInt <span class="keyword">int</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> num1 myInt</span><br><span class="line">	<span class="keyword">var</span> num2 <span class="keyword">int</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// num1和num2类型不同，相互赋值需强制转换</span></span><br><span class="line">	num1 = <span class="number">40</span></span><br><span class="line">	num2 = <span class="keyword">int</span>(num1)</span><br><span class="line"></span><br><span class="line">	fmt.Println(num1, num2)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 这时myFun就是这个类型func(int, int) int</span></span><br><span class="line">	<span class="keyword">type</span> myFunType <span class="function"><span class="keyword">func</span><span class="params">(<span class="keyword">int</span>, <span class="keyword">int</span>)</span> <span class="title">int</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">&#125;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>支持对函数返回值命名</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getSumAndSub</span><span class="params">(n1 <span class="keyword">int</span>, n2 <span class="keyword">int</span>)</span> <span class="params">(sum <span class="keyword">int</span>, sub <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">	sum = n1 + n2</span><br><span class="line">	sub = n1 - n2</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 不写变量也会默认按照sum, sub的顺序进行返回</span></span><br><span class="line">	<span class="keyword">return</span> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Go支持可变参数</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 支持0到多个参数</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sum</span><span class="params">(args... <span class="keyword">int</span>)</span> <span class="title">sum</span> <span class="title">int</span></span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 支持1到多个参数</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sum</span><span class="params">(n1 <span class="keyword">int</span>, args... <span class="keyword">int</span>)</span> <span class="title">sum</span> <span class="title">int</span></span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>说明：<br>（1）args是slice切片，通过args[index]可以访问到各个值。<br>（2）如果一个函数的形参列表中有可变参数，则可变参数要放在形参之后<br>案例演示：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 可变参数的使用</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sum</span><span class="params">(n1 <span class="keyword">int</span>, args ...<span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">	sum := n1</span><br><span class="line">	<span class="comment">// 遍历args</span></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(args); i++ &#123;</span><br><span class="line">		sum += args[i]</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> sum</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	res := sum(<span class="number">10</span>, <span class="number">0</span>, <span class="number">-1</span>, <span class="number">90</span>, <span class="number">10</span>)</span><br><span class="line">	fmt.Println(res)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="6-16-init函数"><a href="#6-16-init函数" class="headerlink" title="6.16 init函数"></a>6.16 init函数</h2><h3 id="6-16-1-函数说明"><a href="#6-16-1-函数说明" class="headerlink" title="6.16.1 函数说明"></a>6.16.1 函数说明</h3><p>init函数会在main函数调用前被程序调用。<br>通常可以在init函数中完成初始化工作</p>
<h3 id="6-16-2-细节说明"><a href="#6-16-2-细节说明" class="headerlink" title="6.16.2 细节说明"></a>6.16.2 细节说明</h3><ol>
<li><p>如果一个文件中包含去全局变量定义，init函数和main函数，则执行的流程是：<br>变量定义<code>-&gt;</code>init函数<code>-&gt;</code>main函数<br>案例演示：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> age = test()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">"test()..."</span>)</span><br><span class="line">	<span class="keyword">return</span> <span class="number">90</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">"init()..."</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">"main()...\nage="</span>, age)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 程序输出</span></span><br><span class="line">test()...</span><br><span class="line">init()...</span><br><span class="line">main()...</span><br><span class="line">age= <span class="number">90</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>init函数最要的工作是完成初始化工作<br>具有init函数的包，在包被import的时候，即执行了init函数</p>
</li>
<li><p>思考：如果mian.go和import1.go都含有变量定义、init函数时，执行的流程是怎么样的？<br>&emsp;&emsp;过程：import1的变量定义<code>-&gt;</code>import1的init函数<code>-&gt;</code>main中的变量定义<code>-&gt;</code>main中的init函数<code>-&gt;</code>main中的main()函数<br>&emsp;&emsp;如果import1包中也引用其他的包，则两包之间的执行流程同理。</p>
</li>
</ol>
<h2 id="6-17-匿名函数"><a href="#6-17-匿名函数" class="headerlink" title="6.17 匿名函数"></a>6.17 匿名函数</h2><h3 id="6-17-2-匿名函数使用方式1"><a href="#6-17-2-匿名函数使用方式1" class="headerlink" title="6.17.2 匿名函数使用方式1"></a>6.17.2 匿名函数使用方式1</h3><p>在定义匿名函数时就直接调用，这种方式匿名函数只能使用一次</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 案例演示，求两个数的和，使用匿名函数的方式完成</span></span><br><span class="line">	result1 := <span class="function"><span class="keyword">func</span><span class="params">(n1 <span class="keyword">int</span>, n2 <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">		<span class="keyword">return</span> n1 + n2</span><br><span class="line">	&#125;(<span class="number">10</span>, <span class="number">20</span>)</span><br><span class="line"></span><br><span class="line">	fmt.Println(result1)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line"><span class="number">30</span></span><br></pre></td></tr></table></figure>

<h3 id="6-17-3-匿名函数使用方式2"><a href="#6-17-3-匿名函数使用方式2" class="headerlink" title="6.17.3 匿名函数使用方式2"></a>6.17.3 匿名函数使用方式2</h3><p>将匿名函数赋给一个变量（函数变量），在通过该变量来调用匿名函数</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 案例演示，将匿名函数赋给变量</span></span><br><span class="line">	a := <span class="function"><span class="keyword">func</span><span class="params">(n1, n2 <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">		<span class="keyword">return</span> n1 - n2</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	result := a(<span class="number">10</span>, <span class="number">20</span>)</span><br><span class="line">	fmt.Println(result)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line"><span class="number">-10</span></span><br></pre></td></tr></table></figure>

<h3 id="6-17-3-全局匿名函数"><a href="#6-17-3-全局匿名函数" class="headerlink" title="6.17.3 全局匿名函数"></a>6.17.3 全局匿名函数</h3><p>若果将匿名函数赋给一个全局便令，那么这个匿名函数，就成为一个全局变量，可以在程序有效。</p>
<h2 id="6-18-闭包"><a href="#6-18-闭包" class="headerlink" title="6.18 闭包"></a>6.18 闭包</h2><h3 id="6-18-1-介绍"><a href="#6-18-1-介绍" class="headerlink" title="6.18.1 介绍"></a>6.18.1 介绍</h3><p>闭包就是一个<code>函数</code>与其<code>相关的引用环境</code>组合的一个整体（实体）</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 累加器</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">AddUpper</span><span class="params">()</span> <span class="title">func</span><span class="params">(<span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> n <span class="keyword">int</span> = <span class="number">10</span></span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(x <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">		n = n + x</span><br><span class="line">		<span class="keyword">return</span> n</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">//使用前面的代码</span></span><br><span class="line">	f := AddUpper()</span><br><span class="line">	fmt.Println(f(<span class="number">1</span>)) <span class="comment">// 11</span></span><br><span class="line">	fmt.Println(f(<span class="number">2</span>)) <span class="comment">// 12</span></span><br><span class="line">	fmt.Println(f(<span class="number">3</span>)) <span class="comment">// 13</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对上面代码的总结和说明</p>
<ol>
<li><p>AddUpper是一个函数，返回的数据类型是func (int) int</p>
</li>
<li><p>闭包的说明</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> n <span class="keyword">int</span> = <span class="number">10</span></span><br><span class="line"><span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(x <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">	n = n + x</span><br><span class="line">	<span class="keyword">return</span> n</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> 返回的是一个匿名函数，但是这个匿名函数引用到函数外的n，因此这个匿名函数就和n形成一个整体，构成闭包。</p>
</li>
<li><p>可以这样理解：闭包是类，函数是操作，n是字段。函数和它使用到n构成闭包。</p>
</li>
<li><p>当我们反复的调用f函数时，因为n是初始化一次，因此每调用一次就进行累计</p>
</li>
<li><p>我们要搞清楚闭包的关键，就是要分析出返回的函数它使用（引用）到哪些变量，因为和函数和他引用到的变量共同构成闭包</p>
</li>
</ol>
<h2 id="6-19-函数的defer"><a href="#6-19-函数的defer" class="headerlink" title="6.19 函数的defer"></a>6.19 函数的defer</h2><h3 id="6-19-1-快速入门案例"><a href="#6-19-1-快速入门案例" class="headerlink" title="6.19.1 快速入门案例"></a>6.19.1 快速入门案例</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sum</span><span class="params">(n1 <span class="keyword">int</span>, n2 <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">	<span class="comment">// 当执行到defer时，暂时不执行，会将defer后面的语句压入到独立的栈（defer栈）</span></span><br><span class="line">	<span class="comment">// 当函数执行完成后，在从defer栈，按照陷入后出的方式出栈、执行</span></span><br><span class="line">	<span class="keyword">defer</span> fmt.Println(<span class="string">"ok1 n1 = "</span>, n1) <span class="comment">// 3</span></span><br><span class="line">	<span class="keyword">defer</span> fmt.Println(<span class="string">"ok2 n2 = "</span>, n2) <span class="comment">// 2</span></span><br><span class="line">	res := n1 + n2</span><br><span class="line">	fmt.Println(<span class="string">"ok3 res = "</span>, res) <span class="comment">// 1</span></span><br><span class="line">	<span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	res := sum(<span class="number">10</span>, <span class="number">20</span>)</span><br><span class="line">	fmt.Println(<span class="string">"res = "</span>, res) <span class="comment">// 4</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">ok3 res =  <span class="number">30</span></span><br><span class="line">ok2 n2 =  <span class="number">20</span></span><br><span class="line">ok1 n1 =  <span class="number">10</span></span><br><span class="line">res =  <span class="number">30</span></span><br></pre></td></tr></table></figure>

<h3 id="6-19-2-defer的细节说明"><a href="#6-19-2-defer的细节说明" class="headerlink" title="6.19.2 defer的细节说明"></a>6.19.2 defer的细节说明</h3><ol start="3">
<li>在defer将语句放入到栈是，也会将相关的值拷贝同时入栈。<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sum</span><span class="params">(n1 <span class="keyword">int</span>, n2 <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">	<span class="comment">// 当执行到defer时，暂时不执行，会将defer后面的语句压入到独立的栈（defer栈）</span></span><br><span class="line">	<span class="comment">// 当函数执行完成后，在从defer栈，按照陷入后出的方式出栈、执行</span></span><br><span class="line">	<span class="keyword">defer</span> fmt.Println(<span class="string">"ok1 n1 = "</span>, n1) <span class="comment">// 3</span></span><br><span class="line">	<span class="keyword">defer</span> fmt.Println(<span class="string">"ok2 n2 = "</span>, n2) <span class="comment">// 2</span></span><br><span class="line">	n1++ <span class="comment">// 输出：n1 = 10</span></span><br><span class="line">	n2++ <span class="comment">// 输出：n2 = 20</span></span><br><span class="line">	res := n1 + n2</span><br><span class="line">	fmt.Println(<span class="string">"ok3 res = "</span>, res) <span class="comment">// 1 输出：res = 32</span></span><br><span class="line">	<span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	res := sum(<span class="number">10</span>, <span class="number">20</span>)</span><br><span class="line">	fmt.Println(<span class="string">"res = "</span>, res) <span class="comment">// 4 res = 32</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">ok3 res =  <span class="number">32</span></span><br><span class="line">ok2 n2 =  <span class="number">20</span></span><br><span class="line">ok1 n1 =  <span class="number">10</span></span><br><span class="line">res =  <span class="number">32</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="6-19-3-defer的最佳实践"><a href="#6-19-3-defer的最佳实践" class="headerlink" title="6.19.3 defer的最佳实践"></a>6.19.3 defer的最佳实践</h3><p>defer最主要的价值是在，当函数执行完毕后，可以及时的释放函数创建的资源。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 关闭资源</span></span><br><span class="line">	file = openfile(文件名)</span><br><span class="line">	<span class="keyword">defer</span> file.<span class="built_in">close</span>()</span><br><span class="line">	<span class="comment">// 其他代码</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 释放数据库资源</span></span><br><span class="line">	connect = openDatabase()</span><br><span class="line">	<span class="keyword">defer</span> connect.<span class="built_in">close</span>()</span><br><span class="line">	<span class="comment">// 其他代码</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li><p>在golang编程中的通常做法是，创建资源后，比如（打开了文件，获取了数据库的连接，或者是锁资源），可以执行defer file.close() defer connect.close()</p>
</li>
<li><p>在defer后，可以继续使用创建资源</p>
</li>
<li><p>当函数完毕后，系统会一次从defer栈中，取出语句，关闭资源</p>
</li>
<li><p>这种机制，非常简洁，程序员不用再为在什么时候关闭资源而烦心</p>
</li>
</ol>
<h2 id="6-20-值传递和引用传递"><a href="#6-20-值传递和引用传递" class="headerlink" title="6.20 值传递和引用传递"></a>6.20 值传递和引用传递</h2><h3 id="6-20-3-值类型和引用类型的分类"><a href="#6-20-3-值类型和引用类型的分类" class="headerlink" title="6.20.3 值类型和引用类型的分类"></a>6.20.3 值类型和引用类型的分类</h3><ol>
<li><p>值类型：基本数据类型 <code>int系列</code>、<code>float系列</code>、<code>bool</code>、<code>string</code>、<code>数组和结构体struct</code></p>
</li>
<li><p>引用类型：<code>指针</code>、<code>slice切片</code>、<code>map</code>、<code>管道channel</code>、<code>interface</code>等都是引用类型</p>
</li>
</ol>
<h2 id="6-21-变量作用域"><a href="#6-21-变量作用域" class="headerlink" title="6.21 变量作用域"></a>6.21 变量作用域</h2><ol>
<li><p>函数内部声明/定义的变量就是局部变量</p>
</li>
<li><p>函数外部声明/定义的变量叫全局变量，作用域在整个包都有效，如果其首字母答谢，则作用在整个程序有效</p>
</li>
<li><p>如果变量是在一个代码块，比如for/if中，那么这个变量是在这个代码块中有效</p>
</li>
<li><p>编译器采用就近原则，选取最小的定义的变量执行</p>
</li>
<li><p>全局变量不可在函数体外赋值<br>代码陷阱：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Age <span class="keyword">int</span> = <span class="number">20</span></span><br><span class="line">Name := <span class="string">"tom"</span>	<span class="comment">// 错误！</span></span><br><span class="line"><span class="comment">// "Name := "tom" "等价于var Name string Name = "tom"</span></span><br><span class="line"><span class="comment">// 变量定义与初始化可以在函数体外执行，赋值不行</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">"name"</span>, Name)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="6-23-字符串中常用的系统函数"><a href="#6-23-字符串中常用的系统函数" class="headerlink" title="6.23 字符串中常用的系统函数"></a>6.23 字符串中常用的系统函数</h2><ol>
<li><p>统计字符串的长度，按字节<code>len(str)</code><br>utf-8编码中，字母和数字占一个字节，汉字占三个字节</p>
</li>
<li><p>字符串遍历，同时处理中文的问题<code>r := []rune(str)</code><br>将字符串转换成rune的切片可解决</p>
</li>
<li><p>字符串 转 整数<code>n,err := strconv.Atoi(&quot;12&quot;)</code></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">n, err := strconv.Atoi(<span class="string">"123"</span>)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">"转换错误"</span>, err)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">"转成的结果是"</span>, n)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>整数 转 字符串：<code>strconv.Itoa(12345)</code></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">str = strconv.Itoa(<span class="number">12345</span>)</span><br><span class="line">fmt.Printf(<span class="string">"str = %v, str = %T"</span>, str, str)</span><br></pre></td></tr></table></figure>
</li>
<li><p>字符串 转 <code>[]byte</code>：<code>[]byte(&quot;hello go&quot;)</code></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> bytes = []<span class="keyword">byte</span>(<span class="string">"hello go"</span>)</span><br><span class="line">fmt.Printf(<span class="string">"bytes=%v\n"</span>, bytes)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">bytes=[<span class="number">104</span> <span class="number">101</span> <span class="number">108</span> <span class="number">108</span> <span class="number">111</span> <span class="number">32</span> <span class="number">103</span> <span class="number">111</span>]</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>[]byte</code> 转 字符串：<code>str = string([byte{97, 98, 99}])</code></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">str = <span class="keyword">string</span>([]<span class="keyword">byte</span>&#123;<span class="number">97</span>, <span class="number">98</span>, <span class="number">99</span>&#125;)</span><br><span class="line">fmt.Printf(<span class="string">"str=%v\n"</span>, str)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">str=abc</span><br></pre></td></tr></table></figure>
</li>
<li><p>10进制 转 2、8、16进制：<code>str = strconv.FormatInt(123, 2)</code>，返回对应的字符串 2可更换为8、16</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">str = strconv.FormatInt(123, 2)</span><br><span class="line">fmt.Printf(&quot;123对应的2进制是=%v\n&quot;, str)</span><br><span class="line">str = strconv.FormatInt(123, 16)</span><br><span class="line">fmt.Printf(&quot;123对应的16进制是=%v\n&quot;, str)</span><br><span class="line"></span><br><span class="line">// 输出</span><br><span class="line">123对应的2进制是=1111011</span><br><span class="line">123对应的16进制是=7b</span><br></pre></td></tr></table></figure>
</li>
<li><p>查找子串是否在指定的字符串中：<code>strings.Contains(&quot;seafood&quot;, &quot;foo&quot;)</code>返回<code>bool</code></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">b := strings.Contains(<span class="string">"seafood"</span>, <span class="string">"foo"</span>)</span><br><span class="line">fmt.Printf(<span class="string">"b=%v\n"</span>, b)</span><br><span class="line">b = strings.Contains(<span class="string">"seafood"</span>, <span class="string">"foo"</span>)</span><br><span class="line">fmt.Printf(<span class="string">"b=%v\n"</span>, b)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">b=<span class="literal">true</span></span><br><span class="line">b=<span class="literal">false</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>统计一个字符串中有几个指定的子串：<code>strings.Count(&quot;ceheese&quot;, &quot;e&quot;)</code>返回<code>int</code></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">num := strings.Count(<span class="string">"ceheese"</span>, <span class="string">"e"</span>)</span><br><span class="line">fmt.Printf(<span class="string">"num=%v"</span>, num)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">num=<span class="number">4</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>不区分大小写的字符串比较（==是区分字母大小写的）：<code>strings.EqualFold(&quot;abc&quot;, &quot;Abc&quot;)</code> 返回<code>bool</code></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">b := strings.EqualFold(<span class="string">"abc"</span>, <span class="string">"Abc"</span>)</span><br><span class="line">fmt.Println(<span class="string">"b="</span>, b)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">b= <span class="literal">true</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>返回子串在字符串中第一次出现的index值，如果没有返回-1：<code>stirngs.Index(&quot;NLT_abc&quot;, &quot;abc&quot;)</code>返回<code>int</code></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">index := strings.Index(<span class="string">"NLT_abc"</span>, <span class="string">"abc"</span>)</span><br><span class="line">fmt.Printf(<span class="string">"index=%v\n"</span>, index)</span><br><span class="line">index = strings.Index(<span class="string">"NLT_abc"</span>, <span class="string">"hello"</span>)</span><br><span class="line">fmt.Printf(<span class="string">"index=%v\n"</span>, index)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">index=<span class="number">4</span></span><br><span class="line">index=<span class="number">-1</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>返回子串在字符串最后出现的index，如果没有返回-1：<code>strings.LastIndex(&quot;go golang&quot;, &quot;go&quot;)</code>返回<code>int</code></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">index = strings.LastIndex(<span class="string">"go golang"</span>, <span class="keyword">go</span>)</span><br><span class="line">fmt.Printf(<span class="string">"index=%v"</span>, index)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">index=<span class="number">3</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>将指定的子串替换成另一个子串：<code>strings.Replace(&quot;go go hello&quot;, &quot;go&quot;, &quot;北京&quot;, n)</code>可以指定替换几个，如果n=-1表示全部替换</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">str := strings.Replace(<span class="string">"go go hello"</span>, <span class="string">"go"</span>，<span class="string">"北京"</span>, <span class="number">1</span>)</span><br><span class="line">fmt.Printf(<span class="string">"str=%v\n"</span>, str)</span><br><span class="line">str = strings.Replace(<span class="string">"go go hello"</span>, <span class="string">"go"</span>，<span class="string">"北京"</span>, <span class="number">-1</span>)</span><br><span class="line">fmt.Printf(<span class="string">"str=%v\n"</span>, str)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">str=北京 <span class="keyword">go</span> hello</span><br><span class="line">str=北京 北京 hello</span><br></pre></td></tr></table></figure>
</li>
<li><p>按照指定的某个字符，为分割标识，将一个字符串拆分成字符串数组：<code>strings.Split(&quot;hello,world,ok&quot;, &quot;,&quot;)</code></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">strArr := strings.Split(<span class="string">"hello,world,ok"</span>, <span class="string">","</span>)</span><br><span class="line">fmt.Printf(<span class="string">"strArr=%v\n"</span>, strArr)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">strArr=[hello world ok]</span><br></pre></td></tr></table></figure>
</li>
<li><p>将字符串的字母进行大小写的转换：<br>(1)&ensp;<code>strings.ToLower(&quot;Go&quot;)</code>-&gt;<code>go</code></p>
<p>(2)&ensp;<code>strings.ToUpper(&quot;Go&quot;)</code>-&gt;<code>GO</code></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">str := strings.ToLower(<span class="string">"GolAnG hEllo"</span>)</span><br><span class="line">fmt.Printf(<span class="string">"str=%v\n"</span>, str)</span><br><span class="line">str = strings.ToUpper(<span class="string">"GolAnG hEllo"</span>)</span><br><span class="line">fmt.Printf(<span class="string">"str=%v\n"</span>, str)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">str=golang hello</span><br><span class="line">str=GOLANG HELLO</span><br></pre></td></tr></table></figure>
</li>
<li><p>将字符串左右两边的空格去掉：<code>strings.TrimSpace(&quot;  tn a lone gopher ntrn   &quot;)</code></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">str := strings.TrimSpace(<span class="string">"  tn a lone gopher ntrn   "</span>)</span><br><span class="line">fmt.Printf(<span class="string">"str=%v\n"</span>, str)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">str=<span class="string">"tn a lone gopher ntrn"</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>将字符串左右两边指定的字符串去掉：<code>strings.Trim(&quot;! hello! &quot;, &quot; !&quot;)</code><br>这里是将左右两边的空格和叹号去掉</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">str := strings.Trim(<span class="string">"! hello! "</span>, <span class="string">" !"</span>)</span><br><span class="line">fmt.Printf(<span class="string">"str=%q\n"</span>, str)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">str=<span class="string">"hello"</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>将左边的指定字符去掉：<code>strings.TrimLeft(&quot;! hello! &quot;, &quot; !&quot;)</code><br>这里是将左两边的空格和叹号去掉</p>
</li>
<li><p>将右边的指定字符去掉：<code>strings.TrimRight(&quot;! hello! &quot;, &quot; !&quot;)</code><br>这里是将右两边的空格和叹号去掉</p>
</li>
<li><p>判断字符串是否以指定的字符串开头：<br><code>strings.HasPrefix(&quot;ftp://192.168.10.1&quot;, &quot;ftp&quot;)</code></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">b := strings.HasPrefix(<span class="string">"ftp://192.168.10.1"</span>, <span class="string">"ftp"</span>)</span><br><span class="line">fmt.Printf(<span class="string">"b=%v\n"</span>, b)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">b=<span class="literal">true</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>判断字符串是否以指定的字符串结束：<br><code>strings.HasSuffix(&quot;NLT_abc.jpg&quot;, &quot;abc&quot;)</code></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">b := strings.HasSuffix(<span class="string">"NLT_abc.jpg"</span>, <span class="string">"abc"</span>)</span><br><span class="line">fmt.Printf(<span class="string">"b=%v\n"</span>, b)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">b=<span class="literal">false</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="6-24-时间和日期相关的函数"><a href="#6-24-时间和日期相关的函数" class="headerlink" title="6.24 时间和日期相关的函数"></a>6.24 时间和日期相关的函数</h2><h3 id="6-24-1-基本的介绍"><a href="#6-24-1-基本的介绍" class="headerlink" title="6.24.1 基本的介绍"></a>6.24.1 基本的介绍</h3><p>说明：在编程中，程序员会经常使用到日期相关的函数，比如：统计某段代码执行花费的时间等等。</p>
<ol>
<li><p>时间和日期相关的函数需要导入time包</p>
</li>
<li><p><code>time.Time</code>类型，用于表示时间</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">now := time.Now()</span><br><span class="line">fmt.Printf(<span class="string">"now=%v\nnow type = %T"</span>, now, now)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">now=<span class="number">2019</span><span class="number">-09</span><span class="number">-26</span> <span class="number">16</span>:<span class="number">21</span>:<span class="number">33.5572177</span> +<span class="number">0800</span> CST m=+<span class="number">0.003990301</span></span><br><span class="line">now <span class="keyword">type</span> = time.Time</span><br></pre></td></tr></table></figure>
</li>
<li><p>如何获取到其它相关日期</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 通过之前的now可以获取到年月日，时分秒</span></span><br><span class="line">fmt.Printf(<span class="string">"年=%v\n"</span>, now.Year())</span><br><span class="line">fmt.Printf(<span class="string">"月=%v\n"</span>, now.Month())</span><br><span class="line">fmt.Printf(<span class="string">"月=%v\n"</span>, <span class="keyword">int</span>(now.Month())) <span class="comment">// 将月份转换成数字</span></span><br><span class="line">fmt.Printf(<span class="string">"日=%v\n"</span>, now.Day())</span><br><span class="line">fmt.Printf(<span class="string">"时=%v\n"</span>, now.Hour())</span><br><span class="line">fmt.Printf(<span class="string">"分=%v\n"</span>, now.Minute())</span><br><span class="line">fmt.Printf(<span class="string">"秒=%v\n"</span>, now.Second())</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">年=<span class="number">2019</span></span><br><span class="line">月=September</span><br><span class="line">月=<span class="number">9</span></span><br><span class="line">日=<span class="number">26</span></span><br><span class="line">时=<span class="number">16</span></span><br><span class="line">分=<span class="number">38</span></span><br><span class="line">秒=<span class="number">18</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>格式化日期时间<br>（1）使用Printf或者Sprintf()</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 格式化时间</span></span><br><span class="line">fmt.Printf(<span class="string">"当前年月日 %d-%d-%d %d:%d:%d\n"</span>, now.Year(),</span><br><span class="line">	now.Month(), now.Day(), now.Hour(), now.Minute(), now.Second())</span><br><span class="line"></span><br><span class="line">dateStr := fmt.Sprintf(<span class="string">"当前年月日 %d-%d-%d %d:%d:%d\n"</span>, now.Year(),</span><br><span class="line">	now.Month(), now.Day(), now.Hour(), now.Minute(), now.Second())</span><br><span class="line">fmt.Printf(<span class="string">"dateStr = %v\n"</span>, dateStr)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">当前年月日 <span class="number">2019</span><span class="number">-9</span><span class="number">-26</span> <span class="number">16</span>:<span class="number">38</span>:<span class="number">18</span></span><br><span class="line">当前年月日 <span class="number">2019</span><span class="number">-9</span><span class="number">-26</span> <span class="number">16</span>:<span class="number">38</span>:<span class="number">18</span></span><br></pre></td></tr></table></figure>

<p> （2）使用time.Format()方法完成<br> <code>2006-01-02 15:04:05</code>这个字符串的各个<code>数字是固定的</code>，<code>必须这样写</code><br> <code>2006-01-02 15:04:05</code>这个字符串中的各个数字可以<code>自由组合</code>，这样可以<code>按照程序需求来返回时间、日期</code></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">fmt.Printf(now.Format(<span class="string">"2006-01-02 15:04:05"</span>))</span><br><span class="line">fmt.Println()</span><br><span class="line">fmt.Printf(now.Format(<span class="string">"2006-01-02"</span>))</span><br><span class="line">fmt.Println()</span><br><span class="line">fmt.Printf(now.Format(<span class="string">"15:04:05"</span>))</span><br><span class="line">fmt.Println()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line"><span class="number">2019</span><span class="number">-09</span><span class="number">-26</span> <span class="number">16</span>:<span class="number">48</span>:<span class="number">38</span></span><br><span class="line"><span class="number">2019</span><span class="number">-09</span><span class="number">-26</span></span><br><span class="line"><span class="number">16</span>:<span class="number">48</span>:<span class="number">38</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>时间的常量</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cnost &#123;</span><br><span class="line">	Nanosecond Duration = <span class="number">1</span> <span class="comment">// 纳秒 </span></span><br><span class="line">	Microsecond	= <span class="number">1000</span> * Nanosecond <span class="comment">// 微妙</span></span><br><span class="line">	Millsecond	= <span class="number">1000</span> * Microsecond <span class="comment">// 毫秒</span></span><br><span class="line">	Second 		= <span class="number">1000</span> * Millsecond <span class="comment">// 秒</span></span><br><span class="line">	Minute 		= <span class="number">60</span> * Second <span class="comment">// 分</span></span><br><span class="line">	Hour 		= <span class="number">60</span> * Minute <span class="comment">// 时</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> 常量的作用是：<strong>在程序货获取指定时间单位的时间，比如想得到100毫秒</strong><br> 100 * time.Millsecond</p>
</li>
<li><p>结合Sleep来使用以下时间常量</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 需求： 每隔1秒钟打印一个数字，打印到100时就退出</span></span><br><span class="line">	<span class="comment">// 需求2：每隔0.1秒钟打印一个数字，打印到100时就退出</span></span><br><span class="line">	now := time.Now()</span><br><span class="line">	fmt.Printf(<span class="string">"now=%v\nnow type = %T\n"</span>, now, now)</span><br><span class="line"></span><br><span class="line">	i := <span class="number">0</span></span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		i++</span><br><span class="line">		fmt.Println(i)</span><br><span class="line">		<span class="comment">// 休眠</span></span><br><span class="line">		time.Sleep(<span class="number">100</span> * time.Millisecond)</span><br><span class="line">		<span class="keyword">if</span> i == <span class="number">100</span> &#123;</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	i = <span class="number">0</span></span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		i++</span><br><span class="line">		fmt.Println(i)</span><br><span class="line">		<span class="comment">// 休眠</span></span><br><span class="line">		time.Sleep(time.Second)</span><br><span class="line">		<span class="keyword">if</span> i == <span class="number">100</span> &#123;</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>time的Unix和UnixNano的方法<br>（1）<code>func (Time)Unix</code></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t time)</span> <span class="title">Unix</span><span class="params">()</span> <span class="title">int64</span></span></span><br><span class="line"><span class="function"><span class="title">Unix</span>将<span class="title">t</span>表示为<span class="title">Unix</span>时间，即从时间点<span class="title">January</span> 1,1970 <span class="title">UTC</span></span></span><br><span class="line"><span class="function">到时间点<span class="title">t</span>所经过的时间（单位秒）</span></span><br></pre></td></tr></table></figure>

<p> （2）<code>func (Time)UnixNano</code></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t time)</span> <span class="title">UnixNano</span><span class="params">()</span> <span class="title">int64</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">UnixNano</span>将<span class="title">t</span>表示为<span class="title">Unix</span>时间，即从时间点<span class="title">January</span> 1,1970 <span class="title">UTC</span></span></span><br><span class="line"><span class="function">到时间点<span class="title">t</span>所经过的时间（单位纳秒）。如果纳秒为单位的<span class="title">Unix</span>时间</span></span><br><span class="line"><span class="function">超出了<span class="title">int64</span>能表示的范围，结果是未定义的。主义这就意味着<span class="title">Time</span></span></span><br><span class="line"><span class="function">零值调用<span class="title">UnixNano</span>方法的话，结果是未定义的。</span></span><br></pre></td></tr></table></figure>

 <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Unix和Unixnano的使用</span></span><br><span class="line">fmt.Printf(<span class="string">"Unix时间戳=%v unixnano时间戳=%v"</span>, now.Unix(), now.UnixNano())</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">Unix时间戳=<span class="number">1569496994</span> unixnano时间戳=<span class="number">1569496994357472600</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="6-24-2-编写一段代码来统计函数test03-执行的时间"><a href="#6-24-2-编写一段代码来统计函数test03-执行的时间" class="headerlink" title="6.24.2 编写一段代码来统计函数test03()执行的时间"></a>6.24.2 编写一段代码来统计函数test03()执行的时间</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"strconv"</span></span><br><span class="line">	<span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test03</span><span class="params">()</span></span> &#123;</span><br><span class="line">	str := <span class="string">""</span></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">100000</span>; i++ &#123;</span><br><span class="line">		str += <span class="string">"hello"</span> + strconv.Itoa(i)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	start := time.Now().Unix()</span><br><span class="line">	test03()</span><br><span class="line">	end := time.Now().Unix()</span><br><span class="line">	fmt.Printf(<span class="string">"执行test03（）耗费时间为%v秒\n"</span>, end-start)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">执行test03（）耗费时间为<span class="number">6</span>秒</span><br></pre></td></tr></table></figure>

<h2 id="6-25-内置函数"><a href="#6-25-内置函数" class="headerlink" title="6.25 内置函数"></a>6.25 内置函数</h2><p>说明：Golang本身内置的函数，可以直接调用。在官方文档中的builtin包当中。</p>
<ol>
<li><p><code>len()</code>：用来求长度，比如string、array、slice、map、channel</p>
</li>
<li><p><code>new()</code>：用来分配内存，主要用来分配值类型，比如int、float32、struct… 返回的是指针<br>举例说明new()的使用</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	num1 := <span class="number">100</span></span><br><span class="line">	fmt.Printf(<span class="string">"num1的类型%T，num1的值%v，num1的地址%v\n"</span>,</span><br><span class="line">		num1, num1, &amp;num1)</span><br><span class="line"></span><br><span class="line">	num2 := <span class="built_in">new</span>(<span class="keyword">int</span>)</span><br><span class="line">	*num2 = <span class="number">100</span></span><br><span class="line">	fmt.Printf(<span class="string">"num2的类型%T，num2的值%v，num2的地址%v，num2指针指向的值%v\n"</span>,</span><br><span class="line">		num2, num2, &amp;num2, *num2)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">num1的类型<span class="keyword">int</span>，num1的值<span class="number">100</span>，num1的地址<span class="number">0xc000064058</span></span><br><span class="line">num2的类型*<span class="keyword">int</span>，num2的值<span class="number">0xc0000640a0</span>，</span><br><span class="line">	num2的地址<span class="number">0xc00008a020</span>，num2指针指向的值<span class="number">100</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><code>make()</code>：用来分配内存，主要用来分配引用类型，比如chan、map、slice</p>
</li>
</ol>
<h2 id="6-26-错误处理"><a href="#6-26-错误处理" class="headerlink" title="6.26 错误处理"></a>6.26 错误处理</h2><p>Go中错误处理的方式为：defer、panic、recover</p>
<h3 id="6-26-3-使用defer加recover的形式来处理错误"><a href="#6-26-3-使用defer加recover的形式来处理错误" class="headerlink" title="6.26.3 使用defer加recover的形式来处理错误"></a>6.26.3 使用defer加recover的形式来处理错误</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 使用defer + recover来捕获和处理异常</span></span><br><span class="line">	<span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		err := <span class="built_in">recover</span>() <span class="comment">// 内置函数，可以捕获到异常</span></span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;  <span class="comment">// 说明捕获到错误 </span></span><br><span class="line">		<span class="comment">// if err := recover(); err != nil &#123;同时定义、赋值、判断</span></span><br><span class="line">			fmt.Println(<span class="string">"err="</span>, err)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;()</span><br><span class="line"></span><br><span class="line">	num1 := <span class="number">10</span></span><br><span class="line">	num2 := <span class="number">0</span></span><br><span class="line">	res := num1 / num2</span><br><span class="line">	fmt.Println(<span class="string">"res="</span>, res)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 测试</span></span><br><span class="line">	test()</span><br><span class="line"></span><br><span class="line">	fmt.Println(<span class="string">"test()下面的代码"</span>)</span><br><span class="line">	time.Sleep(time.Second)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">err= runtime error: integer divide by zero</span><br><span class="line">test()下面的代码</span><br></pre></td></tr></table></figure>

<h3 id="6-26-4-自定义错误"><a href="#6-26-4-自定义错误" class="headerlink" title="6.26.4 自定义错误"></a>6.26.4 自定义错误</h3><p>使用errors.New和panic内置函数</p>
<ol>
<li><p>errors.New(“错误说明”)，会返回一个error类型的值，表示一个错误</p>
</li>
<li><p>panic内置函数，接收一个Interface{}类型的值（也就是任何值了）作为参数。可以接收error类型的变量，输出错误，并退出程序</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 函数去读取一个配置文件init.conf的信息</span></span><br><span class="line"><span class="comment">// 如果文件名传入不正确，我们就返回一个自定义的错误</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">readConf</span><span class="params">(name <span class="keyword">string</span>)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> name == <span class="string">"config.ini"</span> &#123;</span><br><span class="line">		<span class="comment">// 读取</span></span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="comment">// 返回一个自定义错误</span></span><br><span class="line">		<span class="keyword">return</span> errors.New(<span class="string">"读取文件错误.."</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test02</span><span class="params">()</span></span> &#123;</span><br><span class="line">	err := readConf(<span class="string">"config2.ini"</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="comment">//如果读文件发送错误，就输出这个错误，并且终止程序</span></span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	fmt.Println(<span class="string">"test02()继续执行。。。"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 测试自定义错误的使用</span></span><br><span class="line">	test02()</span><br><span class="line">	fmt.Println(<span class="string">"test02()下面的代码"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line"><span class="comment">// 不报错</span></span><br><span class="line">test02()继续执行。。。</span><br><span class="line">test02()下面的代码</span><br><span class="line"></span><br><span class="line"><span class="comment">// 报错</span></span><br><span class="line"><span class="built_in">panic</span>: 读取文件错误..</span><br><span class="line"></span><br><span class="line">goroutine <span class="number">1</span> [running]:</span><br><span class="line">main.test02()</span><br><span class="line">        .../project06/error/main.<span class="keyword">go</span>:<span class="number">39</span> +<span class="number">0x79</span></span><br><span class="line">main.main()</span><br><span class="line">        .../project06/error/main.<span class="keyword">go</span>:<span class="number">47</span> +<span class="number">0x29</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<h1 id="7-数组与切片"><a href="#7-数组与切片" class="headerlink" title="7 数组与切片"></a>7 数组与切片</h1><h2 id="7-1-数组"><a href="#7-1-数组" class="headerlink" title="7.1 数组"></a>7.1 数组</h2><p>在Go中，数组是值类型</p>
<h2 id="7-2-使用示例"><a href="#7-2-使用示例" class="headerlink" title="7.2 使用示例"></a>7.2 使用示例</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> hens [<span class="number">6</span>]<span class="keyword">float64</span></span><br><span class="line"></span><br><span class="line">	hens[<span class="number">0</span>] = <span class="number">3.0</span></span><br><span class="line">	hens[<span class="number">1</span>] = <span class="number">5.0</span></span><br><span class="line">	hens[<span class="number">2</span>] = <span class="number">1.0</span></span><br><span class="line">	hens[<span class="number">3</span>] = <span class="number">3.4</span></span><br><span class="line">	hens[<span class="number">4</span>] = <span class="number">2.0</span></span><br><span class="line">	hens[<span class="number">5</span>] = <span class="number">50.0</span></span><br><span class="line">	totalWeight := <span class="number">0.0</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(hens); i++ &#123;</span><br><span class="line">		totalWeight += hens[i]</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(<span class="string">"总体重："</span>, totalWeight)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">总体重： <span class="number">64.4</span></span><br></pre></td></tr></table></figure>

<h3 id="7-2-1-四种初始化数组的方法"><a href="#7-2-1-四种初始化数组的方法" class="headerlink" title="7.2.1 四种初始化数组的方法"></a>7.2.1 四种初始化数组的方法</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> numArr01 [<span class="number">3</span>]<span class="keyword">int</span> = [<span class="number">3</span>]<span class="keyword">int</span>&#123;<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>&#125;</span><br><span class="line"><span class="keyword">var</span> numArr02 = [<span class="number">3</span>]<span class="keyword">int</span>&#123;<span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>&#125;</span><br><span class="line"><span class="keyword">var</span> numArr03 = [...]<span class="keyword">int</span>&#123;<span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>&#125;</span><br><span class="line"><span class="comment">// 按下标位置进行赋值</span></span><br><span class="line"><span class="keyword">var</span> numArr04 = [...]<span class="keyword">int</span>&#123;<span class="number">1</span>:<span class="number">800</span>, <span class="number">0</span>:<span class="number">900</span>, <span class="number">2</span>:<span class="number">999</span>&#125;</span><br></pre></td></tr></table></figure>

<h2 id="7-3-数组的遍历"><a href="#7-3-数组的遍历" class="headerlink" title="7.3 数组的遍历"></a>7.3 数组的遍历</h2><h3 id="7-3-2-for-range遍历"><a href="#7-3-2-for-range遍历" class="headerlink" title="7.3.2 for-range遍历"></a>7.3.2 for-range遍历</h3><p><strong>for-range的基本语法</strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> inde, value := <span class="keyword">range</span> array01 &#123;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>说明：</p>
<ol>
<li><p>第一个返回值index是数组的下标</p>
</li>
<li><p>第二个value是该下标位置的值</p>
</li>
<li><p>他们都是仅在for循环内部可见的局部变量</p>
</li>
<li><p>遍历数组元素的时候，如果不想使用下标index，可以直接把下标index标为下划线<code>_</code></p>
</li>
<li><p>index和value的名称不是固定的、即程序员可以自行制定，一般命为index和value</p>
</li>
</ol>
<p><strong>for-range的案例</strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> heroes [<span class="number">3</span>]<span class="keyword">string</span> = [<span class="number">3</span>]<span class="keyword">string</span>&#123;<span class="string">"宋江"</span>, <span class="string">"吴用"</span>, <span class="string">"卢俊义"</span>&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> index, value := <span class="keyword">range</span> heroes &#123;</span><br><span class="line">		fmt.Printf(<span class="string">"i=%v v=%v\n"</span>, index, value)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> _, value := <span class="keyword">range</span> heroes &#123;</span><br><span class="line">		fmt.Printf(<span class="string">"元素的值=%v\n"</span>, value)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">i=<span class="number">0</span> v=宋江</span><br><span class="line">i=<span class="number">1</span> v=吴用</span><br><span class="line">i=<span class="number">2</span> v=卢俊义</span><br><span class="line">元素的值=宋江</span><br><span class="line">元素的值=吴用</span><br><span class="line">元素的值=卢俊义</span><br></pre></td></tr></table></figure>

<h2 id="7-7-数组使用的注意事项和细节"><a href="#7-7-数组使用的注意事项和细节" class="headerlink" title="7.7 数组使用的注意事项和细节"></a>7.7 数组使用的注意事项和细节</h2><ol>
<li><p>数组是多个相同类型数据的组合，一个数组一旦声明/定义了，其长度是固定的，不能动态变化</p>
</li>
<li><p>var arr []int 这时arr是一个slice切片，并不是数组</p>
</li>
<li><p>数组中的元素可以是任意数据类型，包括是值类型和引用类型，但不能混用</p>
</li>
<li><p>数组创建之后如果没有赋值，有默认值（零值）<br>数值类型数组：    默认值为0<br>字符串数组：        默认值为””<br>bool数组：        默认值为false</p>
</li>
<li><p>使用数组的步骤<br>（1）声明数组并开辟空间<br>（2）给数组各个元素赋值（默认零值）<br>（3）使用数组</p>
</li>
<li><p>数组的下标是从0开始的</p>
</li>
<li><p>数组下标必须在指定范围内使用，否则报<code>painc</code>数组越界，比如<code>var arr[5]int</code>，则有效下标为0-4</p>
</li>
<li><p>Go的数组属于值类型，在默认情况下是值传递，因此会进行值拷贝。<strong>数组间不会互相影响。</strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 函数参数中数组必须写为[n]&lt;type&gt;</span></span><br><span class="line"><span class="comment">// n为数组长度，type为数组值类型</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">(arr [3]<span class="keyword">int</span>)</span></span> &#123; </span><br><span class="line">	arr[<span class="number">0</span>] = <span class="number">300</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 传递数组地址时同样要遵循该原则</span></span><br><span class="line"><span class="comment">// 例如：*[n]&lt;type&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test02</span><span class="params">(arr *[3]<span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">	arr[<span class="number">0</span>] = <span class="number">300</span></span><br><span class="line">	<span class="comment">// (*arr)[0] = 300等价</span></span><br><span class="line">	<span class="comment">// 原理待解决</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	arr := [<span class="number">3</span>]<span class="keyword">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;</span><br><span class="line">	test(arr)</span><br><span class="line">	fmt.Printf(<span class="string">"arr=%v"</span>, arr)</span><br><span class="line"></span><br><span class="line">	fmt.Println()</span><br><span class="line"></span><br><span class="line">	test02(&amp;arr)</span><br><span class="line">	fmt.Printf(<span class="string">"arr=%v"</span>, arr)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">arr=[<span class="number">1</span> <span class="number">2</span> <span class="number">3</span>]</span><br><span class="line">arr=[<span class="number">300</span> <span class="number">2</span> <span class="number">3</span>]</span><br></pre></td></tr></table></figure>
</li>
<li><p>如果想在其他函数中，修改原数组的值，可以使用引用传递（指针）</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 传递数组地址时同样要遵循该原则</span></span><br><span class="line"><span class="comment">// 例如：*[n]&lt;type&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test02</span><span class="params">(arr *[3]<span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">	arr[<span class="number">0</span>] = <span class="number">300</span></span><br><span class="line">	<span class="comment">// (*arr)[0] = 300等价</span></span><br><span class="line">	<span class="comment">// 原理待解决</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	arr := [<span class="number">3</span>]<span class="keyword">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;</span><br><span class="line">	test02(&amp;arr)</span><br><span class="line">	fmt.Printf(<span class="string">"arr=%v"</span>, arr)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">arr=[<span class="number">300</span> <span class="number">2</span> <span class="number">3</span>]</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>长度是数组类型的一部分</strong>，在传递函数参数是需要考虑数组的长度</p>
</li>
</ol>
<h3 id="7-8-数组应用案例"><a href="#7-8-数组应用案例" class="headerlink" title="7.8 数组应用案例"></a>7.8 数组应用案例</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 求一个数组的和和平均值，用for-range</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> intArray = [...]<span class="keyword">int</span>&#123;<span class="number">1</span>, <span class="number">-1</span>, <span class="number">9</span>, <span class="number">90</span>, <span class="number">12</span>&#125;</span><br><span class="line">	<span class="keyword">var</span> sumArray <span class="keyword">int</span> = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> _, value := <span class="keyword">range</span> intArray &#123;</span><br><span class="line">		sumArray += value</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// go语言不能自动转换类型</span></span><br><span class="line">	<span class="comment">// 这里计算平均值需要显示的转换为浮点型</span></span><br><span class="line">	fmt.Println(<span class="string">"和为："</span>, sumArray, <span class="string">"平均值为："</span>, </span><br><span class="line">		<span class="keyword">float32</span>(sumArray)/<span class="keyword">float32</span>(<span class="built_in">len</span>(intArray)))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="7-9-切片"><a href="#7-9-切片" class="headerlink" title="7.9 切片"></a>7.9 切片</h2><h3 id="7-9-1-切片的基本介绍"><a href="#7-9-1-切片的基本介绍" class="headerlink" title="7.9.1 切片的基本介绍"></a>7.9.1 切片的基本介绍</h3><ol>
<li><p>切片的英文是slice</p>
</li>
<li><p>切片是数组的一个引用，因此切片是引用类型，在进行传递时，遵守引用传递的机制</p>
</li>
<li><p>切片的使用和数组类型，遍历切片、访问切片的元素和求切片的长度<code>len(slice)</code>都一样</p>
</li>
<li><p>切片的长度是可以变化的，因此切片是一个可以动态变化的数组</p>
</li>
<li><p>切片定义的基本语法</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> 变量名 []类型</span><br><span class="line"><span class="keyword">var</span> a []<span class="keyword">int</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="7-9-2-切片的使用示例"><a href="#7-9-2-切片的使用示例" class="headerlink" title="7.9.2 切片的使用示例"></a>7.9.2 切片的使用示例</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 演示切片的基本使用</span></span><br><span class="line">	<span class="keyword">var</span> intArr = [...]<span class="keyword">int</span>&#123;<span class="number">1</span>, <span class="number">22</span>, <span class="number">33</span>, <span class="number">66</span>, <span class="number">99</span>&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 声明/定义一个切片</span></span><br><span class="line">	<span class="comment">// slice := intArr[1:3]</span></span><br><span class="line">	<span class="comment">// 1. slice就是切片名</span></span><br><span class="line">	<span class="comment">// 2. intArr[1:3]表示slice引用到intArr这个数组</span></span><br><span class="line">	<span class="comment">// 3. 引用intArr数组的起始下标为1</span></span><br><span class="line">	<span class="comment">//    最后的下标为3（但不包含3）</span></span><br><span class="line">	slice := intArr[<span class="number">1</span>:<span class="number">3</span>]</span><br><span class="line">	fmt.Println(<span class="string">"intArr="</span>, intArr)</span><br><span class="line">	fmt.Println(<span class="string">"slice 的元素是 ="</span>, slice)</span><br><span class="line">	fmt.Println(<span class="string">"slice 的元素个数 ="</span>, <span class="built_in">len</span>(slice))</span><br><span class="line">	<span class="comment">// 切片的容量是可以动态变化 </span></span><br><span class="line">	fmt.Println(<span class="string">"slice 的容量 ="</span>, <span class="built_in">cap</span>(slice))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">intArr= [<span class="number">1</span> <span class="number">22</span> <span class="number">33</span> <span class="number">66</span> <span class="number">99</span>]</span><br><span class="line">slice 的元素是 = [<span class="number">22</span> <span class="number">33</span>]</span><br><span class="line">slice 的元素个数 = <span class="number">2</span></span><br><span class="line">slice 的容量 = <span class="number">4</span></span><br></pre></td></tr></table></figure>

<h2 id="7-12-切片在内存中形式"><a href="#7-12-切片在内存中形式" class="headerlink" title="7.12 切片在内存中形式"></a>7.12 切片在内存中形式</h2><p>slice底层由三个部分构成，本质是一个结构体（struct）<br>第一个部分是引用部分（ptr），第二个部分是长度（len），第三个部分是容量（cap）</p>
<h2 id="7-13-切片的使用方式"><a href="#7-13-切片的使用方式" class="headerlink" title="7.13 切片的使用方式"></a>7.13 切片的使用方式</h2><h3 id="方式1"><a href="#方式1" class="headerlink" title="方式1"></a>方式1</h3><p>定义一个切片，然后让切片去引用一个已经创建好的数组。<br><code>array[b:e]</code>表示创建一个包含e-b个元素的切片，第一个元素是array[b]</p>
<h3 id="方式2"><a href="#方式2" class="headerlink" title="方式2"></a>方式2</h3><p>通过make()来创建切片<br>基本语法：<code>var 切片名 []type = make([]type, len, cap)</code><br>参数说明：<br>&emsp;<code>type</code>    数据类型<br>&emsp;<code>len</code>    &ensp;大小<br>&emsp;<code>cap</code>    &ensp;切片容量（可选，如果缺省则默认与<code>len</code>大小相同。若分配，则要求大于等于<code>len</code>）</p>
<p><strong>案例演示</strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> slice []<span class="keyword">float64</span> = <span class="built_in">make</span>([]<span class="keyword">float64</span>, <span class="number">5</span>, <span class="number">10</span>)</span><br><span class="line">	slice[<span class="number">1</span>] = <span class="number">10</span></span><br><span class="line">	slice[<span class="number">3</span>] = <span class="number">20</span></span><br><span class="line"></span><br><span class="line">	fmt.Println(slice)</span><br><span class="line">	fmt.Println(<span class="string">"slice的size="</span>, <span class="built_in">len</span>(slice))</span><br><span class="line">	fmt.Println(<span class="string">"slice的cap"</span>, <span class="built_in">cap</span>(slice))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">[<span class="number">0</span> <span class="number">10</span> <span class="number">0</span> <span class="number">20</span> <span class="number">0</span>]</span><br><span class="line">slice的size= <span class="number">5</span></span><br><span class="line">slice的<span class="built_in">cap</span> <span class="number">10</span></span><br></pre></td></tr></table></figure>

<h3 id="方式3"><a href="#方式3" class="headerlink" title="方式3"></a>方式3</h3><p>定义一个切片，直接就指定具体数组，使用原理类似make()的方式</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> slice []<span class="keyword">string</span> = []<span class="keyword">string</span>&#123;<span class="string">"tom"</span>, <span class="string">"jack"</span>, <span class="string">"mary"</span>&#125;</span><br><span class="line">	fmt.Println(slice)</span><br><span class="line">	fmt.Println(<span class="built_in">len</span>(slice))</span><br><span class="line">	fmt.Println(<span class="built_in">cap</span>(slice))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">[tom jack mary]</span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">3</span></span><br></pre></td></tr></table></figure>

<h3 id="方式1与方式2的区别"><a href="#方式1与方式2的区别" class="headerlink" title="方式1与方式2的区别"></a>方式1与方式2的区别</h3><ol>
<li><p>方式1是直接引用数组，这个数组是事先存在的，程序员可见的</p>
</li>
<li><p>方式2是通过make来创建切片，make也会创建一个数组，是由切片在底层进行维护，程序员是看不见的。</p>
</li>
</ol>
<h2 id="7-14-切片的遍历"><a href="#7-14-切片的遍历" class="headerlink" title="7.14 切片的遍历"></a>7.14 切片的遍历</h2><h3 id="for循环实现切片遍历"><a href="#for循环实现切片遍历" class="headerlink" title="for循环实现切片遍历"></a>for循环实现切片遍历</h3><h3 id="for-range方式实现切片遍历"><a href="#for-range方式实现切片遍历" class="headerlink" title="for-range方式实现切片遍历"></a>for-range方式实现切片遍历</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> arr [<span class="number">5</span>]<span class="keyword">int</span> = [...]<span class="keyword">int</span>&#123;<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">40</span>, <span class="number">50</span>&#125;</span><br><span class="line">	slice := arr[<span class="number">1</span>:<span class="number">4</span>]</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(slice); i++ &#123;</span><br><span class="line">		fmt.Printf(<span class="string">"slice[%v]=%v\n"</span>, i, slice[i])</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	fmt.Println()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> index, value := <span class="keyword">range</span> slice &#123;</span><br><span class="line">		fmt.Printf(<span class="string">"slice[%v]=%v\n"</span>, index, value)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">slice[<span class="number">0</span>]=<span class="number">20</span></span><br><span class="line">slice[<span class="number">1</span>]=<span class="number">30</span></span><br><span class="line">slice[<span class="number">2</span>]=<span class="number">40</span></span><br><span class="line"></span><br><span class="line">slice[<span class="number">0</span>]=<span class="number">20</span></span><br><span class="line">slice[<span class="number">1</span>]=<span class="number">30</span></span><br><span class="line">slice[<span class="number">2</span>]=<span class="number">40</span></span><br></pre></td></tr></table></figure>

<h2 id="7-15-切片注意事项和细节说明"><a href="#7-15-切片注意事项和细节说明" class="headerlink" title="7.15 切片注意事项和细节说明"></a>7.15 切片注意事项和细节说明</h2><ol>
<li><p>切片初始化是<code>var slice = arr[stratindex:endindex]</code><br>说明：从arr数组下标<code>arr[startindex]</code>开始，取<code>endindex</code>-<code>startindex</code>个元素作为切片的元素</p>
</li>
<li><p>切片初始化是，仍然不能约见。范围在[0, len(arr)]之间，但是可以动态增长<br>（1）<code>var slice = arr[0:end]</code>可以简写<code>var slice = arr[:end]</code></p>
<p> （2）<code>var slice = arr[strat:len(arr)]</code>可以简写<code>var slice = arr[start:]</code></p>
<p> （3）<code>var slice = arr[0:len(arr)]</code>可以简写<code>var slice = arr[:]</code></p>
</li>
<li><p>cap是一个内置函数，用于统计切片的容量，即最大可以存放多少元素</p>
</li>
<li><p>切片定义完成后，还不能使用，因为本身为空，需要让其引用到一个数组，或者通过make来分配一个空间供切片使用</p>
</li>
<li><p>切片可以继续切片</p>
</li>
<li><p>用append内置函数，可以对切片进行动态增加</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> slice []<span class="keyword">int</span> = []<span class="keyword">int</span>&#123;<span class="number">100</span>, <span class="number">200</span>, <span class="number">300</span>&#125;</span><br><span class="line">	<span class="comment">// 通过append给目标切片追加具体的元素</span></span><br><span class="line">	slice2 := <span class="built_in">append</span>(slice, <span class="number">400</span>, <span class="number">500</span>, <span class="number">600</span>)</span><br><span class="line">	fmt.Println(<span class="string">"slice"</span>, slice)</span><br><span class="line">	fmt.Println(<span class="string">"slice2"</span>, slice2)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 通过append给目标追加切片</span></span><br><span class="line">	slice = <span class="built_in">append</span>(slice, slice...)</span><br><span class="line">	fmt.Println(<span class="string">"slice"</span>, slice)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">slice [<span class="number">100</span> <span class="number">200</span> <span class="number">300</span>]</span><br><span class="line">slice2 [<span class="number">100</span> <span class="number">200</span> <span class="number">300</span> <span class="number">400</span> <span class="number">500</span> <span class="number">600</span>]</span><br><span class="line">slice [<span class="number">100</span> <span class="number">200</span> <span class="number">300</span> <span class="number">100</span> <span class="number">200</span> <span class="number">300</span>]</span><br></pre></td></tr></table></figure>

<p> 对上面代码的小结：<br> （1）切片append操作的本质就是对数组扩容<br> （2）go底层会创建一下新的数组newArr（安装扩容后大小）<br> （3）将slice原本包含的元素拷贝到新的数组newArr<br> （4）slice重新引用到newArr<br> （5）注意newArr是在底层来维护的，程序员不可见</p>
</li>
<li><p>切片的拷贝操作<br>切片使用copy内置函数完成拷贝</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> slice []<span class="keyword">int</span> = []<span class="keyword">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;</span><br><span class="line">	<span class="keyword">var</span> slice2 = <span class="built_in">make</span>([]<span class="keyword">int</span> ,<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">	<span class="built_in">copy</span>(slice2, slice)</span><br><span class="line">	fmt.Println(<span class="string">"slice="</span>, slice)</span><br><span class="line">	fmt.Println(<span class="string">"slice2="</span>, slice2)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> 对上面代码的说明<br> (1)copy(para1, para2)参数的数据类型是切片<br> (2)按照上面的代码来看，slice和slice2的数据空间是独立、相互不影响。也就是说<code>slice[0]=999</code>,<code>slice2[0]</code>任然是1</p>
</li>
<li><p>关于拷贝的注意事项</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a[]<span class="keyword">int</span> = []<span class="keyword">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;</span><br><span class="line"><span class="keyword">var</span> slice = <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">1</span>)</span><br><span class="line">fmt.Println(slice) <span class="comment">// 0</span></span><br><span class="line"><span class="built_in">copy</span>(slice, a)</span><br><span class="line">fmt.Println(slice) <span class="comment">// 1</span></span><br></pre></td></tr></table></figure>

<p> <code>copy()</code>进行的是无报错复制。</p>
</li>
<li><p>切片注意事项和细节说明<br>·切片是引用类型，所以在传递时，遵守引用传递机制。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> slice []<span class="keyword">int</span></span><br><span class="line">	<span class="keyword">var</span> arr[<span class="number">5</span>]<span class="keyword">int</span> = [...]<span class="keyword">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;</span><br><span class="line">	slice = arr[:]</span><br><span class="line">	<span class="keyword">var</span> slice2 = slice</span><br><span class="line">	slice2[<span class="number">0</span>] = <span class="number">10</span></span><br><span class="line"></span><br><span class="line">	fmt.Println(<span class="string">"slice2"</span>, slice2)	<span class="comment">//[10, 2, 3, 4, 5]</span></span><br><span class="line">	fmt.Println(<span class="string">"slice"</span>, slice)	<span class="comment">//[10, 2, 3, 4, 5]</span></span><br><span class="line">	fmt.Println(<span class="string">"arr"</span>, arr)		<span class="comment">//[10, 2, 3, 4, 5]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

 <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">(slice []<span class="keyword">int</span>)</span></span> &#123; <span class="comment">// 传递的是地址值，会修改实参</span></span><br><span class="line">	slice[<span class="number">0</span>] = <span class="number">100</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> slice = []<span class="keyword">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>&#125;</span><br><span class="line">	fmt.Println(<span class="string">"slice="</span>, slice)	<span class="comment">// [1, 2, 3, 4]</span></span><br><span class="line">	test(slice)</span><br><span class="line">	fmt.Println(<span class="string">"slice="</span>, slice)	<span class="comment">// [100, 2, 3, 4]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="7-16string和slice"><a href="#7-16string和slice" class="headerlink" title="7.16string和slice"></a>7.16string和slice</h2><ol>
<li><p>string的底层是一个byte数组，因此string也可以进行切片处理</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	str := <span class="string">"hello@atguigu"</span></span><br><span class="line">	<span class="comment">// 使用切片获得atguigu</span></span><br><span class="line">	slice := str[<span class="number">6</span>:]</span><br><span class="line">	fmt.Println(<span class="string">"slice="</span>, slice)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">slice= atguigu</span><br></pre></td></tr></table></figure>
</li>
<li><p>string和切片在内存的形式，以“abce”画出内存示意图<br>字符串底层实现和切片类似</p>
</li>
<li><p>string是不可变的，也就说不能通过str[0] = ‘z’的方式来修改字符串</p>
</li>
<li><p>如果需要修改字符串，可以先将<code>string</code>-&gt;<code>[]byte</code> || <code>[]rune</code> -&gt;<code>修改</code>-&gt;<code>重写转成string</code></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">arr1 := []<span class="keyword">byte</span>(str)</span><br><span class="line">arr1[<span class="number">0</span>] = <span class="string">'z'</span></span><br><span class="line">str = <span class="keyword">string</span>(arr1)</span><br><span class="line">fmt.Println(<span class="string">"str ="</span>, str)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 细节，我们转成[]byte后，可以处理英文和数字，但是不能处理中文</span></span><br><span class="line"><span class="comment">// 原因是[]byte按字节来处理，而一个汉字是三个字节，所以会乱码</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 解决方法是将 string 转成[]rune即可，因为[]rune是按字符处理</span></span><br><span class="line"><span class="comment">// 兼容汉字</span></span><br><span class="line">arr2 := []<span class="keyword">rune</span>(str)</span><br><span class="line">arr2[<span class="number">0</span>] = <span class="string">'西'</span></span><br><span class="line">str = <span class="keyword">string</span>(arr2)</span><br><span class="line">fmt.Println(<span class="string">"str2 = "</span>, str)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">str = zello@atguigu</span><br><span class="line">str2 =  西ello@atguigu</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h1 id="8-排序和查找"><a href="#8-排序和查找" class="headerlink" title="8 排序和查找"></a>8 排序和查找</h1><h2 id="8-1-排序的介绍"><a href="#8-1-排序的介绍" class="headerlink" title="8.1 排序的介绍"></a>8.1 排序的介绍</h2><h3 id="8-1-1-内部排序"><a href="#8-1-1-内部排序" class="headerlink" title="8.1.1 内部排序"></a>8.1.1 内部排序</h3><p>指将需要处理的所有数据都加载到内存进行排序。<br>包括（<code>交换式排序法</code>、<code>选择式排序法</code>和<code>插入式排序法</code>）</p>
<p>交换排序可分为两种：</p>
<ol>
<li>冒泡排序（Bubble sort）</li>
<li>选择排序（Quick sort）</li>
</ol>
<h3 id="8-1-2-外部排序"><a href="#8-1-2-外部排序" class="headerlink" title="8.1.2 外部排序"></a>8.1.2 外部排序</h3><p>数据量过大，无法全部加载到内存中，需要借助外部存储进行排序。<br>包括（合并培训法和直接合并排序法）</p>
<h2 id="8-2-冒泡排序的思路分析"><a href="#8-2-冒泡排序的思路分析" class="headerlink" title="8.2 冒泡排序的思路分析"></a>8.2 冒泡排序的思路分析</h2><p>·冒泡排序的实现</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BubbleSort</span><span class="params">(arr *[5]<span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">"排序前 = "</span>, (*arr))</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>((*arr))<span class="number">-1</span>; i++ &#123;</span><br><span class="line">		<span class="keyword">for</span> j := <span class="number">0</span>; j &lt; <span class="built_in">len</span>(*arr)<span class="number">-1</span>-i; j++ &#123;</span><br><span class="line">			<span class="keyword">if</span> (*arr)[j] &gt; (*arr)[j+<span class="number">1</span>] &#123;</span><br><span class="line">				(*arr)[j], (*arr)[j+<span class="number">1</span>] = (*arr)[j+<span class="number">1</span>], (*arr)[j]</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		fmt.Printf(<span class="string">"第%d次循环arr=%v\n"</span>, i+<span class="number">1</span>, *arr)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	arr := [<span class="number">5</span>]<span class="keyword">int</span>&#123;<span class="number">24</span>, <span class="number">69</span>, <span class="number">80</span>, <span class="number">57</span>, <span class="number">13</span>&#125;</span><br><span class="line">	BubbleSort(&amp;arr)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">排序前 =  [<span class="number">24</span> <span class="number">69</span> <span class="number">80</span> <span class="number">57</span> <span class="number">13</span>]</span><br><span class="line">第<span class="number">1</span>次循环arr=[<span class="number">24</span> <span class="number">69</span> <span class="number">57</span> <span class="number">13</span> <span class="number">80</span>]</span><br><span class="line">第<span class="number">2</span>次循环arr=[<span class="number">24</span> <span class="number">57</span> <span class="number">13</span> <span class="number">69</span> <span class="number">80</span>]</span><br><span class="line">第<span class="number">3</span>次循环arr=[<span class="number">24</span> <span class="number">13</span> <span class="number">57</span> <span class="number">69</span> <span class="number">80</span>]</span><br><span class="line">第<span class="number">4</span>次循环arr=[<span class="number">13</span> <span class="number">24</span> <span class="number">57</span> <span class="number">69</span> <span class="number">80</span></span><br></pre></td></tr></table></figure>

<h2 id="8-3-查找"><a href="#8-3-查找" class="headerlink" title="8.3 查找"></a>8.3 查找</h2><ol>
<li><p>顺序查找</p>
</li>
<li><p>二分查找（前提：该数组有序）</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BinaryFind</span><span class="params">(arr [6]<span class="keyword">int</span>, leftIndex, rightIndex, findVal <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> leftIndex &gt; rightIndex &#123;</span><br><span class="line">		fmt.Println(<span class="string">"找不到"</span>)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	middle := (leftIndex + rightIndex) / <span class="number">2</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> arr[middle] &gt; findVal &#123;</span><br><span class="line">		BinaryFind(arr, leftIndex, middle<span class="number">-1</span>, findVal)</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> arr[middle] &lt; findVal &#123;</span><br><span class="line">		BinaryFind(arr, middle+<span class="number">1</span>, rightIndex, findVal)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"找到了，下标为"</span>, middle)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	arr := [<span class="number">6</span>]<span class="keyword">int</span>&#123;<span class="number">1</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">89</span>, <span class="number">1000</span>, <span class="number">1234</span>&#125;</span><br><span class="line">	BinaryFind(arr, <span class="number">0</span>, <span class="built_in">len</span>(arr)<span class="number">-1</span>, <span class="number">10</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="8-4-二维数组的介绍"><a href="#8-4-二维数组的介绍" class="headerlink" title="8.4 二维数组的介绍"></a>8.4 二维数组的介绍</h2><h3 id="8-4-1-二维数组的遍历"><a href="#8-4-1-二维数组的遍历" class="headerlink" title="8.4.1 二维数组的遍历"></a>8.4.1 二维数组的遍历</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> arr = [<span class="number">2</span>][<span class="number">3</span>]<span class="keyword">int</span>&#123;&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;, &#123;<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>&#125;&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// for循环进行遍历</span></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(arr); i++ &#123;</span><br><span class="line">		<span class="keyword">for</span> j := <span class="number">0</span>; j &lt; <span class="built_in">len</span>(arr[i]); j++ &#123;</span><br><span class="line">			fmt.Printf(<span class="string">"%v\t"</span>, arr[i][j])</span><br><span class="line">		&#125;</span><br><span class="line">		fmt.Println()</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println()</span><br><span class="line">	<span class="comment">// for-range进行遍历</span></span><br><span class="line">	<span class="keyword">for</span> i, v := <span class="keyword">range</span> arr &#123;</span><br><span class="line">		fmt.Println(i, v)</span><br><span class="line">		<span class="keyword">for</span> j, v2 := <span class="keyword">range</span> v &#123;</span><br><span class="line">			fmt.Println(j, v2)</span><br><span class="line">		&#125;</span><br><span class="line">		fmt.Println()</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line"><span class="number">1</span>       <span class="number">2</span>       <span class="number">3</span></span><br><span class="line"><span class="number">4</span>       <span class="number">5</span>       <span class="number">6</span></span><br><span class="line"></span><br><span class="line"><span class="number">0</span> [<span class="number">1</span> <span class="number">2</span> <span class="number">3</span>]</span><br><span class="line"><span class="number">0</span> <span class="number">1</span></span><br><span class="line"><span class="number">1</span> <span class="number">2</span></span><br><span class="line"><span class="number">2</span> <span class="number">3</span></span><br><span class="line"></span><br><span class="line"><span class="number">1</span> [<span class="number">4</span> <span class="number">5</span> <span class="number">6</span>]</span><br><span class="line"><span class="number">0</span> <span class="number">4</span></span><br><span class="line"><span class="number">1</span> <span class="number">5</span></span><br><span class="line"><span class="number">2</span> <span class="number">6</span></span><br></pre></td></tr></table></figure>

<h1 id="9-map"><a href="#9-map" class="headerlink" title="9 map"></a>9 map</h1><h2 id="9-1-map的基本介绍"><a href="#9-1-map的基本介绍" class="headerlink" title="9.1 map的基本介绍"></a>9.1 map的基本介绍</h2><p>map是key-value数据结构，又称为字段或者关联数组。</p>
<h2 id="9-2-map的声明"><a href="#9-2-map的声明" class="headerlink" title="9.2 map的声明"></a>9.2 map的声明</h2><h3 id="9-2-1-基本语法"><a href="#9-2-1-基本语法" class="headerlink" title="9.2.1 基本语法"></a>9.2.1 基本语法</h3><p><code>var map 变量名 map[keytype]valuetype</code></p>
<ol>
<li><p>key可以是什么类型<br>key可以为<code>bool</code>、<code>数字</code>、<code>string</code>、<code>指针</code>、<code>channel</code>还可以是<code>接口</code>、<code>结构体</code>、<code>数组</code><br>通常为<strong>int</strong>、<strong>string</strong><br>注：slice、map、func类型的不可以作为key</p>
</li>
<li><p>value可以是什么类型<br>value类型与key基本一致，通常为数字、stirng、map、struct</p>
</li>
</ol>
<h3 id="9-2-2-map声明的示例"><a href="#9-2-2-map声明的示例" class="headerlink" title="9.2.2 map声明的示例"></a>9.2.2 map声明的示例</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span></span><br><span class="line"><span class="keyword">var</span> a <span class="keyword">map</span>[<span class="keyword">string</span>]in</span><br><span class="line"><span class="keyword">var</span> a <span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">string</span></span><br><span class="line"><span class="keyword">var</span> a <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">map</span>[<span class="keyword">string</span>]sgring</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">声明是不会分配内存的，初始化需要make分配内存后才能赋值和使用</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p>案例演示</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// map的声明和注意事项 key不能重复，value可以重复</span></span><br><span class="line">	<span class="keyword">var</span> a <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span></span><br><span class="line">	<span class="comment">// 值使用map前，需要先make</span></span><br><span class="line">	<span class="comment">// make的作用就是给map分配数据空间</span></span><br><span class="line">	a = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>, <span class="number">10</span>)</span><br><span class="line">	a[<span class="string">"no1"</span>] = <span class="string">"宋江"</span></span><br><span class="line">	a[<span class="string">"no1"</span>] = <span class="string">"武松"</span></span><br><span class="line">	a[<span class="string">"no2"</span>] = <span class="string">"吴用"</span></span><br><span class="line">	a[<span class="string">"no3"</span>] = <span class="string">"吴用"</span></span><br><span class="line">	fmt.Println(a)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li><p>map前一定要使用make分配空间</p>
</li>
<li><p>map的key是不能重复的，如果重复了，则以最后这个key-value为准</p>
</li>
<li><p>map的value是可以相同的</p>
</li>
<li><p>map 的key-value是无序的</p>
</li>
<li><p>make内置函数</p>
</li>
</ol>
<h3 id="9-2-3-map的使用方式"><a href="#9-2-3-map的使用方式" class="headerlink" title="9.2.3 map的使用方式"></a>9.2.3 map的使用方式</h3><ol>
<li><p>方式1</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span></span><br><span class="line"><span class="comment">// 需要手动分配空间才可添加键值对</span></span><br><span class="line">a = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>, <span class="number">10</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>方式2（推荐使用）</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cities := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 可以直接添加键值对</span></span><br><span class="line">cities[<span class="string">"no1"</span>] = <span class="string">"北京"</span></span><br><span class="line">cities[<span class="string">"no2"</span>] = <span class="string">"天津"</span></span><br><span class="line">cities[<span class="string">"no3"</span>] = <span class="string">"上海"</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>方式3</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">heros := <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>&#123;</span><br><span class="line">	<span class="string">"hero1"</span>: <span class="string">"xixi"</span>,</span><br><span class="line">	<span class="string">"hero2"</span>: <span class="string">"haha"</span>,</span><br><span class="line">	<span class="string">"hero3"</span>: <span class="string">"meimei"</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 可以直接添加键值对</span></span><br><span class="line">heros[<span class="string">"hero4"</span>] = <span class="string">"hehe"</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="9-2-4-使用示例"><a href="#9-2-4-使用示例" class="headerlink" title="9.2.4 使用示例"></a>9.2.4 使用示例</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 存放3个学生信息，每个学生有name和sex信息</span></span><br><span class="line">	studentMap := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>)</span><br><span class="line"></span><br><span class="line">	studentMap[<span class="string">"stu01"</span>] = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>, <span class="number">3</span>)</span><br><span class="line">	studentMap[<span class="string">"stu01"</span>][<span class="string">"name"</span>] = <span class="string">"tom"</span></span><br><span class="line">	studentMap[<span class="string">"stu01"</span>][<span class="string">"sex"</span>] = <span class="string">"男"</span></span><br><span class="line">	studentMap[<span class="string">"stu01"</span>][<span class="string">"address"</span>] = <span class="string">"北京长安街"</span></span><br><span class="line"></span><br><span class="line">	studentMap[<span class="string">"stu02"</span>] = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>, <span class="number">3</span>)</span><br><span class="line">	studentMap[<span class="string">"stu02"</span>][<span class="string">"name"</span>] = <span class="string">"mary"</span></span><br><span class="line">	studentMap[<span class="string">"stu02"</span>][<span class="string">"sex"</span>] = <span class="string">"女"</span></span><br><span class="line">	studentMap[<span class="string">"stu02"</span>][<span class="string">"address"</span>] = <span class="string">"上海黄浦江"</span></span><br><span class="line">	fmt.Println(studentMap[<span class="string">"stu01"</span>])</span><br><span class="line">	fmt.Println(studentMap[<span class="string">"stu02"</span>])</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line"><span class="keyword">map</span>[address:北京长安街 name:tom sex:男]</span><br><span class="line"><span class="keyword">map</span>[address:上海黄浦江 name:mary sex:女]</span><br></pre></td></tr></table></figure>

<h2 id="9-3-map的增删改查操作"><a href="#9-3-map的增删改查操作" class="headerlink" title="9.3 map的增删改查操作"></a>9.3 map的增删改查操作</h2><h3 id="9-3-1-map增加和更新"><a href="#9-3-1-map增加和更新" class="headerlink" title="9.3.1 map增加和更新"></a>9.3.1 map增加和更新</h3><p><code>map[&quot;key&quot;]=value</code>：如果key还没有，就是增加。如果key存在就是修改。</p>
<h3 id="9-3-2-map的删除"><a href="#9-3-2-map的删除" class="headerlink" title="9.3.2 map的删除"></a>9.3.2 map的删除</h3><p><code>delete(map, &quot;key&quot;)</code>：delete是一个内置函数，若果key存在，就删除该key-value，如果key不存在，不操作，但是也不会报错。<br>细节说明：</p>
<ol>
<li><p>遍历key，逐个删除</p>
</li>
<li><p>使用<code>map = make(map[key]type)</code>申请一个新的空间，让gc来回收原来的空间。</p>
</li>
</ol>
<h3 id="9-3-3-map的查找"><a href="#9-3-3-map的查找" class="headerlink" title="9.3.3 map的查找"></a>9.3.3 map的查找</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	cities := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>)</span><br><span class="line">	cities[<span class="string">"no1"</span>] = <span class="string">"北京"</span></span><br><span class="line">	cities[<span class="string">"no2"</span>] = <span class="string">"天津"</span></span><br><span class="line">	cities[<span class="string">"no3"</span>] = <span class="string">"上海"</span></span><br><span class="line">	fmt.Println(cities)</span><br><span class="line"></span><br><span class="line">	val, ok := cities[<span class="string">"no1"</span>]</span><br><span class="line">	<span class="keyword">if</span> ok &#123;</span><br><span class="line">		fmt.Printf(<span class="string">"有no1 key 值为%v\n"</span>, val)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		fmt.Printf(<span class="string">"没有no1 key 值\n"</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>说明：如果cities这个map中有“no1”，那么ok就会返回true，否则返回false</p>
<h3 id="9-3-4-map的遍历"><a href="#9-3-4-map的遍历" class="headerlink" title="9.3.4 map的遍历"></a>9.3.4 map的遍历</h3><p>map的遍历使用for-range的结构遍历</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 使用for-range遍历map</span></span><br><span class="line">	cities := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>)</span><br><span class="line">	cities[<span class="string">"no1"</span>] = <span class="string">"北京"</span></span><br><span class="line">	cities[<span class="string">"no2"</span>] = <span class="string">"天津"</span></span><br><span class="line">	cities[<span class="string">"no3"</span>] = <span class="string">"上海"</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> k, v := <span class="keyword">range</span> cities &#123;</span><br><span class="line">		fmt.Printf(<span class="string">"k=%v v=%v\n"</span>, k, v)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 使用for-range遍历一个较复杂的map</span></span><br><span class="line">	studentMap := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>)</span><br><span class="line">	studentMap[<span class="string">"stu01"</span>] = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>, <span class="number">3</span>)</span><br><span class="line">	studentMap[<span class="string">"stu01"</span>][<span class="string">"name"</span>] = <span class="string">"tom"</span></span><br><span class="line">	studentMap[<span class="string">"stu01"</span>][<span class="string">"sex"</span>] = <span class="string">"男"</span></span><br><span class="line">	studentMap[<span class="string">"stu01"</span>][<span class="string">"address"</span>] = <span class="string">"北京长安街"</span></span><br><span class="line"></span><br><span class="line">	studentMap[<span class="string">"stu02"</span>] = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>, <span class="number">3</span>)</span><br><span class="line">	studentMap[<span class="string">"stu02"</span>][<span class="string">"name"</span>] = <span class="string">"mary"</span></span><br><span class="line">	studentMap[<span class="string">"stu02"</span>][<span class="string">"sex"</span>] = <span class="string">"女"</span></span><br><span class="line">	studentMap[<span class="string">"stu02"</span>][<span class="string">"address"</span>] = <span class="string">"上海黄浦江"</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> k1, v1 := <span class="keyword">range</span> studentMap &#123;</span><br><span class="line">		fmt.Println(<span class="string">"k1="</span>, k1)</span><br><span class="line">		<span class="keyword">for</span> k2, v2 := <span class="keyword">range</span> v1 &#123;</span><br><span class="line">			fmt.Printf(<span class="string">"\t k2=%v v2=%v\n"</span>, k2, v2)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">k=no1 v=北京</span><br><span class="line">k=no2 v=天津</span><br><span class="line">k=no3 v=上海</span><br><span class="line">k1= stu01</span><br><span class="line">         k2=name v2=tom</span><br><span class="line">         k2=sex v2=男</span><br><span class="line">         k2=address v2=北京长安街</span><br><span class="line">k1= stu02</span><br><span class="line">         k2=address v2=上海黄浦江</span><br><span class="line">         k2=name v2=mary</span><br><span class="line">         k2=sex v2=女</span><br></pre></td></tr></table></figure>

<h3 id="9-3-5-map的长度"><a href="#9-3-5-map的长度" class="headerlink" title="9.3.5 map的长度"></a>9.3.5 map的长度</h3><p><code>func len()</code>通过内建函数来返回map的长度（键值对个数）</p>
<h3 id="9-3-6-map切片"><a href="#9-3-6-map切片" class="headerlink" title="9.3.6 map切片"></a>9.3.6 map切片</h3><p>切片类型如果是map的话，我们则称这个切片为map切片，这样使用map个数就可以动态的变化了</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">		要求：使用一个map来记录monster的信息 name 和 age，也就是说</span></span><br><span class="line"><span class="comment">		一个monster对应一个map，并且妖怪的个数可以动态的增加=》map切片</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">	<span class="keyword">var</span> monsters []<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span></span><br><span class="line">	<span class="comment">// 准备放入两个妖怪</span></span><br><span class="line">	monsters = <span class="built_in">make</span>([]<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>, <span class="number">2</span>)</span><br><span class="line">	<span class="comment">// 增加一个妖怪的信息</span></span><br><span class="line">	<span class="keyword">if</span> monsters[<span class="number">0</span>] == <span class="literal">nil</span> &#123;</span><br><span class="line">		monsters[<span class="number">0</span>] = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>, <span class="number">2</span>)</span><br><span class="line">		monsters[<span class="number">0</span>][<span class="string">"name"</span>] = <span class="string">"牛魔王"</span></span><br><span class="line">		monsters[<span class="number">0</span>][<span class="string">"age"</span>] = <span class="string">"500"</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> monsters[<span class="number">1</span>] == <span class="literal">nil</span> &#123;</span><br><span class="line">		monsters[<span class="number">1</span>] = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>, <span class="number">2</span>)</span><br><span class="line">		monsters[<span class="number">1</span>][<span class="string">"name"</span>] = <span class="string">"红孩儿"</span></span><br><span class="line">		monsters[<span class="number">1</span>][<span class="string">"age"</span>] = <span class="string">"400"</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// if monsters[2] == nil &#123;</span></span><br><span class="line">	<span class="comment">// 	monsters[2] = make(map[string]string, 2)</span></span><br><span class="line">	<span class="comment">// 	monsters[2]["name"] = "狐狸精"</span></span><br><span class="line">	<span class="comment">// 	monsters[2]["age"] = "300"</span></span><br><span class="line">	<span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 需要使用appen函数动态增长map</span></span><br><span class="line">	<span class="comment">// 1. 先定义一个monster信息</span></span><br><span class="line">	newMonster := <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>&#123;</span><br><span class="line">		<span class="string">"name"</span>: <span class="string">"火云邪神"</span>,</span><br><span class="line">		<span class="string">"age"</span>:  <span class="string">"200"</span>,</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	monsters = <span class="built_in">append</span>(monsters, newMonster)</span><br><span class="line"></span><br><span class="line">	fmt.Println(monsters)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">[<span class="keyword">map</span>[age:<span class="number">500</span> name:牛魔王] <span class="keyword">map</span>[age:<span class="number">400</span> name:红孩儿] <span class="keyword">map</span>[age:<span class="number">200</span> name:火云邪神]]</span><br></pre></td></tr></table></figure>

<h3 id="9-3-7-map排序"><a href="#9-3-7-map排序" class="headerlink" title="9.3.7 map排序"></a>9.3.7 map排序</h3><ol>
<li><p>golang中没有一个专门的方法针对map的key进行排序</p>
</li>
<li><p>golang中的map默认是无序的，注意也不是按照添加顺序进行存放的，你每次遍历，得到的输出可能会不一样</p>
</li>
<li><p>golang中map的排序，是先将key进行排序，然后根据key值遍历输出即可</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"sort"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	map1 := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">int</span>, <span class="number">10</span>)</span><br><span class="line">	map1[<span class="number">10</span>] = <span class="number">100</span></span><br><span class="line">	map1[<span class="number">1</span>] = <span class="number">13</span></span><br><span class="line">	map1[<span class="number">4</span>] = <span class="number">56</span></span><br><span class="line">	map1[<span class="number">8</span>] = <span class="number">90</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 如果按照map的key的顺序进行排序输出</span></span><br><span class="line">	<span class="comment">// 1.先将map的key放入到切片中</span></span><br><span class="line">	<span class="comment">// 2.对切片排序</span></span><br><span class="line">	<span class="comment">// 3.遍历切片，然后按照key来输出map的值</span></span><br><span class="line">	<span class="keyword">var</span> keys []<span class="keyword">int</span></span><br><span class="line">	<span class="keyword">for</span> k, _ := <span class="keyword">range</span> map1 &#123;</span><br><span class="line">		keys = <span class="built_in">append</span>(keys, k)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 排序</span></span><br><span class="line">	sort.Ints(keys)</span><br><span class="line">	fmt.Println(keys)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> _, k := <span class="keyword">range</span> keys &#123;</span><br><span class="line">		fmt.Printf(<span class="string">"map1[%v]=%v\n"</span>, k, map1[k])</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">[<span class="number">1</span> <span class="number">4</span> <span class="number">8</span> <span class="number">10</span>]</span><br><span class="line">map1[<span class="number">1</span>]=<span class="number">13</span></span><br><span class="line">map1[<span class="number">4</span>]=<span class="number">56</span></span><br><span class="line">map1[<span class="number">8</span>]=<span class="number">90</span></span><br><span class="line">map1[<span class="number">10</span>]=<span class="number">100</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="9-3-8-map的使用细节"><a href="#9-3-8-map的使用细节" class="headerlink" title="9.3.8 map的使用细节"></a>9.3.8 map的使用细节</h3><ol>
<li><p>map是引用类型，遵守引用类型传递的机制</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">modify</span><span class="params">(map1 <span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">	map1[<span class="number">10</span>] = <span class="number">900</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// map是引用类型，遵守引用类型传递的机制，在一个函数接收map</span></span><br><span class="line">	<span class="comment">// 修改后，会直接修改原来的map</span></span><br><span class="line">	map1 := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">int</span>)</span><br><span class="line">	map1[<span class="number">1</span>] = <span class="number">90</span></span><br><span class="line">	map1[<span class="number">2</span>] = <span class="number">88</span></span><br><span class="line">	map1[<span class="number">10</span>] = <span class="number">1</span></span><br><span class="line">	map1[<span class="number">20</span>] = <span class="number">2</span></span><br><span class="line">	modify(map1)</span><br><span class="line">	fmt.Println(map1)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line"><span class="keyword">map</span>[<span class="number">1</span>:<span class="number">90</span> <span class="number">2</span>:<span class="number">88</span> <span class="number">10</span>:<span class="number">900</span> <span class="number">20</span>:<span class="number">2</span>]</span><br></pre></td></tr></table></figure>
</li>
<li><p>map的容量达到后，再向map添加元素，会自动扩容，并不会发生panic，也就说map能动态的增长 键值对（key-value）</p>
</li>
<li><p>map的value也经常使用struct类型，更适合管理复杂的数据</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Stu <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name    <span class="keyword">string</span></span><br><span class="line">	Age     <span class="keyword">int</span></span><br><span class="line">	Address <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1.map的key为学生的学号，是唯一的</span></span><br><span class="line"><span class="comment">// 2.map的value为结构体，包含学生的 名字、年龄、地址</span></span><br><span class="line">students := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]Stu, <span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建2个学生</span></span><br><span class="line">stu1 := Stu&#123;Name: <span class="string">"tom"</span>, Age: <span class="number">18</span>, Address: <span class="string">"北京"</span>&#125;</span><br><span class="line">stu2 := Stu&#123;<span class="string">"mary"</span>, <span class="number">28</span>, <span class="string">"上海"</span>&#125;</span><br><span class="line">students[<span class="string">"no1"</span>] = stu1</span><br><span class="line">students[<span class="string">"no2"</span>] = stu2</span><br><span class="line">fmt.Println(students)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 遍历各个学生的信息</span></span><br><span class="line"><span class="keyword">for</span> k, v := <span class="keyword">range</span> students &#123;</span><br><span class="line">	fmt.Printf(<span class="string">"%v,name %v,age %v,address %v\n"</span>,</span><br><span class="line">	k, v.Name, v.Age, v.Address)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">no2,name mary,age <span class="number">28</span>,address 上海</span><br><span class="line">no1,name tom,age <span class="number">18</span>,address 北京</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h1 id="10-面向对象编程（上）"><a href="#10-面向对象编程（上）" class="headerlink" title="10 面向对象编程（上）"></a>10 面向对象编程（上）</h1><ol>
<li><p>Golang并不是纯粹的面向对象语言，<code>Golang支持面向对象编程特性</code>更准确</p>
</li>
<li><p>Golang仍然有面向对象编程的继承、封装、多态的特性，只是实现的方式和其他OOP语言不一样。</p>
</li>
<li><p>Golang通过接口关联，耦合性低。Golang中面向<code>接口编程</code>是非常重要的特性。</p>
</li>
</ol>
<h2 id="10-1-结构体"><a href="#10-1-结构体" class="headerlink" title="10.1 结构体"></a>10.1 结构体</h2><h3 id="10-1-1-如何声明结构体"><a href="#10-1-1-如何声明结构体" class="headerlink" title="10.1.1 如何声明结构体"></a>10.1.1 如何声明结构体</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> 结构体名称 <span class="keyword">struct</span> &#123;</span><br><span class="line">	field1 <span class="keyword">type</span></span><br><span class="line">	field2 <span class="keyword">type</span></span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li><p>map、slice作为结构体字段时，需要手动分配空间<code>make()</code></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Person <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name   <span class="keyword">string</span></span><br><span class="line">	Age    <span class="keyword">int</span></span><br><span class="line">	Scores [<span class="number">5</span>]<span class="keyword">float64</span></span><br><span class="line">	ptr    *<span class="keyword">int</span></span><br><span class="line">	slice  []<span class="keyword">int</span></span><br><span class="line">	map1   <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> p1 Person</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 使用slice、map时</span></span><br><span class="line">	p1.slice = <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">10</span>)</span><br><span class="line">	p1.slice[<span class="number">0</span>] = <span class="number">100</span></span><br><span class="line"></span><br><span class="line">	p1.map1 = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>)</span><br><span class="line">	p1.map1[<span class="string">"key"</span>] = <span class="string">"value"</span></span><br><span class="line"></span><br><span class="line">	fmt.Println(p1)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">&#123; <span class="number">0</span> [<span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span>] &lt;<span class="literal">nil</span>&gt; [<span class="number">100</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span>] <span class="keyword">map</span>[key:value]&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>相同结构体之间赋值默认是值拷贝</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Monster <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name <span class="keyword">string</span></span><br><span class="line">	Age  <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> monster1 Monster</span><br><span class="line">monster1.Name = <span class="string">"牛魔王"</span></span><br><span class="line">monster1.Age = <span class="number">500</span></span><br><span class="line"></span><br><span class="line">monster2 := monster1</span><br><span class="line">monster2.Name = <span class="string">"狐狸精"</span></span><br><span class="line"></span><br><span class="line">fmt.Println(<span class="string">"monster1="</span>, monster1)</span><br><span class="line">fmt.Println(<span class="string">"monster2="</span>, monster2)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">monster1= &#123;牛魔王 <span class="number">500</span>&#125;</span><br><span class="line">monster2= &#123;狐狸精 <span class="number">500</span>&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="10-1-2-创建结构体的四种方法"><a href="#10-1-2-创建结构体的四种方法" class="headerlink" title="10.1.2 创建结构体的四种方法"></a>10.1.2 创建结构体的四种方法</h3><ol start="3">
<li><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Person <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name <span class="keyword">string</span></span><br><span class="line">	Age  <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p3 *Person = <span class="built_in">new</span>(Person)</span><br><span class="line"><span class="comment">// 因为p3是一个指针，因此标准的给字段赋值方式</span></span><br><span class="line"><span class="comment">// (p3*).Name = "smith" 也可以这样写 p3.Name = "smith"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 原因：go的是记者为了程序员使用方便，底层会对p3.Name="smith"进行处理</span></span><br><span class="line"><span class="comment">// 会给p3加上取值运算(*p3).Name = "smith"</span></span><br><span class="line">(*p3).Name = <span class="string">"smith"</span></span><br><span class="line">p3.Nam3 = <span class="string">"john"</span></span><br><span class="line"></span><br><span class="line">(*p3).Age = <span class="number">30</span></span><br><span class="line">fmt.Println(*p3)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">&#123;john <span class="number">30</span>&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>var person *Person = &amp;Person{}</code></p>
</li>
</ol>
<h3 id="10-1-3-结构体内存分配机制"><a href="#10-1-3-结构体内存分配机制" class="headerlink" title="10.1.3 结构体内存分配机制"></a>10.1.3 结构体内存分配机制</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> p1 Person</span><br><span class="line">p1.Age = <span class="number">10</span></span><br><span class="line">p1.Name = <span class="string">"小明"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p2 *Person = &amp;p1</span><br><span class="line"></span><br><span class="line">fmt.Println(*p2.Age)</span><br><span class="line"><span class="comment">// 不能这样写，会报错</span></span><br><span class="line"><span class="comment">// 原因是“.”的运算级比“*”高，这样相当于对Age进行取值操作</span></span><br></pre></td></tr></table></figure>

<h3 id="10-1-4-结构体使用注意事项和细节操作"><a href="#10-1-4-结构体使用注意事项和细节操作" class="headerlink" title="10.1.4 结构体使用注意事项和细节操作"></a>10.1.4 结构体使用注意事项和细节操作</h3><ol>
<li><p>结构体内存分配是连续的</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Point <span class="keyword">struct</span> &#123;</span><br><span class="line">	x <span class="keyword">int</span></span><br><span class="line">	y <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Rect <span class="keyword">struct</span> &#123;</span><br><span class="line">	leftUp, rightDown Point</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Rect2 <span class="keyword">struct</span> &#123;</span><br><span class="line">	leftUp, rightDown *Point</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	r1 := Rect&#123;Point&#123;<span class="number">1</span>, <span class="number">2</span>&#125;, Point&#123;<span class="number">3</span>, <span class="number">4</span>&#125;&#125;</span><br><span class="line">	fmt.Printf(<span class="string">"r1.leftup.x\t地址=%p r1.leftup.y\t 地址=%p\n"</span>, &amp;r1.leftUp.x, &amp;r1.leftUp.y)</span><br><span class="line">	fmt.Printf(<span class="string">"r1.rightDown.x\t地址=%p r1.rightDown.y 地址=%p\n"</span>, &amp;r1.rightDown.x, &amp;r1.rightDown.y)</span><br><span class="line"></span><br><span class="line">	r2 := Rect2&#123;&amp;Point&#123;<span class="number">1</span>, <span class="number">2</span>&#125;, &amp;Point&#123;<span class="number">3</span>, <span class="number">4</span>&#125;&#125;</span><br><span class="line">	<span class="comment">// 他们本身的地址时连续的，指向的地址可能是连续的</span></span><br><span class="line">	fmt.Printf(<span class="string">"r2.leftup本身的地址=%p\tr2.leftup.x\t地址=%p r2.leftup.y\t 地址=%p\n"</span>,</span><br><span class="line">		r2.leftUp, &amp;r2.leftUp.x, &amp;r2.leftUp.y)</span><br><span class="line">	fmt.Printf(<span class="string">"r2.rightDown本身的地址=%p\tr2.rightDown.x\t地址=%p r2.rightDown.y 地址=%p"</span>,</span><br><span class="line">		r2.rightDown, &amp;r2.rightDown.x, &amp;r2.rightDown.y)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">r1.leftup.x     地址=<span class="number">0xc000012380</span> r1.leftup.y    地址=<span class="number">0xc000012388</span></span><br><span class="line">r1.rightDown.x  地址=<span class="number">0xc000012390</span> r1.rightDown.y 地址=<span class="number">0xc000012398</span></span><br><span class="line">r2.leftup本身的地址=<span class="number">0xc0000140b0</span>        r2.leftup.x     地址=<span class="number">0xc0000140b0</span> r2.leftup.y    地址=<span class="number">0xc0000140b8</span></span><br><span class="line">r2.rightDown本身的地址=<span class="number">0xc0000140c0</span>     r2.rightDown.x  地址=<span class="number">0xc0000140c0</span> r2.rightDown.y 地址=<span class="number">0xc0000140c8</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>结构体是用户单独定义的类型，和其他类型进行转换时需要有完全相同的字段（名字、个数、类型）</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Point <span class="keyword">struct</span> &#123;</span><br><span class="line">	x <span class="keyword">int</span></span><br><span class="line">	y <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> A <span class="keyword">struct</span> &#123;</span><br><span class="line">	Num <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> B <span class="keyword">struct</span> &#123;</span><br><span class="line">	Num <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> a A</span><br><span class="line">	<span class="keyword">var</span> b B</span><br><span class="line">	a = A(b)</span><br><span class="line">	<span class="comment">// 可以转换</span></span><br><span class="line">	<span class="comment">// 但要求结构体字段要完全一致（名字、个数、类型）</span></span><br><span class="line">	fmt.Println(a, b)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>结构体进行type重新定义（相当于别名），Golang认为是新的数据类型，但是相互间可以强转</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Student <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name <span class="keyword">string</span></span><br><span class="line">	Age  <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Stu Student</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> stu1 Student</span><br><span class="line">	<span class="keyword">var</span> stu2 Stu</span><br><span class="line">	stu2 = sut1</span><br><span class="line">	<span class="comment">// 无法相互赋值，但可通过强制转换赋值</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

 <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> ingeger <span class="keyword">int</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> i integer = <span class="number">10</span></span><br><span class="line">	<span class="keyword">var</span> j <span class="keyword">int</span> = <span class="number">20</span></span><br><span class="line">	j = <span class="keyword">int</span>(i)	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>struct的每个字段上，可以写上一个tag，该tag可以通过<strong>反射机制</strong>获取，常见的使用场景就是序列化和反序列化。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"encoding/json"</span></span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Monster <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name  <span class="keyword">string</span> <span class="string">`json:"name"`</span> <span class="comment">// 结构体的标签（struct tag）</span></span><br><span class="line">	Age   <span class="keyword">int</span>    <span class="string">`json:"age"`</span></span><br><span class="line">	Skill <span class="keyword">string</span> <span class="string">`json:"skill"`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	monster := Monster&#123;<span class="string">"牛魔王"</span>, <span class="number">500</span>, <span class="string">"芭蕉扇"</span>&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 2. 将monster变量序列化为json格式字串</span></span><br><span class="line">	jsonStr, err := json.Marshal(monster)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(err)</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(<span class="string">"jsonStr"</span>, <span class="keyword">string</span>(jsonStr))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">jsonStr &#123;<span class="string">"name"</span>:<span class="string">"牛魔王"</span>,<span class="string">"age"</span>:<span class="number">500</span>,<span class="string">"skill"</span>:<span class="string">"芭蕉扇"</span>&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="10-2-方法"><a href="#10-2-方法" class="headerlink" title="10.2 方法"></a>10.2 方法</h2><p>Golang中的<strong>方法是作用在指定数据类型上的</strong>（即：和指定的数据类型绑定），因此<strong>自定义类型，都可以有方法</strong>，而不仅仅是struct</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> A <span class="keyword">struct</span> &#123;</span><br><span class="line">	Num <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a A)</span><span class="title">test</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(a.Num)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Person <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p Person)</span> <span class="title">test</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">"test()"</span>, p.Name)</span><br><span class="line">	p.Name = <span class="string">"jack"</span> <span class="comment">// 对main()中的p.Name没有影响</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> p Person</span><br><span class="line">	p.Name = <span class="string">"tom"</span></span><br><span class="line">	p.test()</span><br><span class="line">	fmt.Println(p.Name) <span class="comment">// 输出tom</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line"><span class="keyword">go</span></span><br><span class="line">test() tom</span><br><span class="line">tom</span><br></pre></td></tr></table></figure>

<p><code>func() (p Person) test() {...}</code>中p表示哪个Person变量调用，这个p就是它的副本，与函数传参类似。<br>p由程序员指定，不固定</p>
<h3 id="10-2-1-方法使用细节"><a href="#10-2-1-方法使用细节" class="headerlink" title="10.2.1 方法使用细节"></a>10.2.1 方法使用细节</h3><ol>
<li><p>为了提高效率，通常我们是将方法和结构体的指针类型绑定</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Circle <span class="keyword">struct</span> &#123;</span><br><span class="line">	radius <span class="keyword">float64</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Circle)</span> <span class="title">area2</span><span class="params">()</span> <span class="title">float64</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">3.14</span> * c.radius * c.radius</span><br><span class="line">	<span class="comment">// return 3.14 * (*c).radius * (*c).radius</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> c Circle</span><br><span class="line">	c.radius = <span class="number">5.0</span></span><br><span class="line">	res := c.area2() <span class="comment">// 编译器优化写法</span></span><br><span class="line">	<span class="comment">// res := (&amp;c).area2()原始写法</span></span><br><span class="line">	fmt.Println(<span class="string">"面积是:"</span>, res)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">面积是: <span class="number">314</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Golang中的方法作用是指定的数据类型上的（即：和指定的数据类型绑定），因此自定义类型，都可以有方法，而不仅仅是struct，比如int、float32等都可以有方法。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> integer <span class="keyword">int</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(i integer)</span> <span class="title">print</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">"i="</span>, i)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(i *integer)</span> <span class="title">change</span><span class="params">()</span></span> &#123;</span><br><span class="line">	*i = *i + <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> i integer = <span class="number">10</span></span><br><span class="line">	i.<span class="built_in">print</span>()</span><br><span class="line">	i.change()</span><br><span class="line">	fmt.Println(<span class="string">"i="</span>, i)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">i= <span class="number">10</span></span><br><span class="line">i= <span class="number">11</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>如果一个类型实现了String()这个方法，那么fmt.Println()默认会调用这个变量的String()进行输出。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Student <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name <span class="keyword">string</span></span><br><span class="line">	Age  <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(stu *Student)</span> <span class="title">String</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">	str := fmt.Sprintf(<span class="string">"Name=[%v] Age=[%v]"</span>, stu.Name, stu.Age)</span><br><span class="line">	<span class="keyword">return</span> str</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">stu := Student&#123;</span><br><span class="line">	Name: <span class="string">"tom"</span>,</span><br><span class="line">	Age:  <span class="number">20</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 如果你实现了*Student类型的String方法，就会自动调用</span></span><br><span class="line">fmt.Println(&amp;stu)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">Name=[tom] Age=[<span class="number">20</span>]</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="10-2-2-方法与函数的区别"><a href="#10-2-2-方法与函数的区别" class="headerlink" title="10.2.2 方法与函数的区别"></a>10.2.2 方法与函数的区别</h3><ol start="3">
<li>对于方法（如struct的方法），接收者为值类型时，可以直接用指针类型的变量调用方法，反过来同样可以<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Person <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name <span class="keyword">string</span></span><br><span class="line">	Age  <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 值传递还是引用传递只由方法定义所决定</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p Person)</span> <span class="title">test03</span><span class="params">()</span></span> &#123;</span><br><span class="line">	p.Name = <span class="string">"jack"</span></span><br><span class="line">	fmt.Println(<span class="string">"test03() ="</span>, p.Name)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	p := Person&#123;Name: <span class="string">"tom"</span>&#125;</span><br><span class="line">	p.test03()</span><br><span class="line">	(&amp;p).test03() <span class="comment">// 任然是值拷贝</span></span><br><span class="line">	fmt.Println(p.Name)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">test03() = jack</span><br><span class="line">test03() = jack</span><br><span class="line">tom</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="10-2-3-创建结构体变量时指定字段值"><a href="#10-2-3-创建结构体变量时指定字段值" class="headerlink" title="10.2.3 创建结构体变量时指定字段值 **"></a>10.2.3 创建结构体变量时指定字段值 **</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> stu1 *Student = &amp;Student&#123;<span class="string">"小王"</span>, <span class="number">29</span>&#125;</span><br><span class="line">stu2 := &amp;Student&#123;<span class="string">"小王·"</span>, <span class="number">30</span>&#125;</span><br><span class="line"><span class="keyword">var</span> stu3 = &amp;Student&#123;</span><br><span class="line">	Name : <span class="string">"小李"</span></span><br><span class="line">	Age : <span class="number">56</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fmt.Println(stu1, stu2, stu3)</span><br><span class="line">fmt.Println(*stu1, *stu2, *stu3)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">&amp;&#123;小王 <span class="number">29</span>&#125; &amp;&#123;小王· <span class="number">30</span>&#125; &amp;&#123;小李 <span class="number">56</span>&#125;</span><br><span class="line">&#123;小王 <span class="number">29</span>&#125; &#123;小王· <span class="number">30</span>&#125; &#123;小李 <span class="number">56</span>&#125;</span><br></pre></td></tr></table></figure>

<h3 id="10-2-4-工厂模式"><a href="#10-2-4-工厂模式" class="headerlink" title="10.2.4 工厂模式"></a>10.2.4 工厂模式</h3><p>Golang中的结构体没有<code>构造函数</code>，通常可以使用<code>工厂模式</code>来解决这个问题</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">文件结构</span><br><span class="line">factory</span><br><span class="line">├─main</span><br><span class="line">│   main.go</span><br><span class="line">└─model</span><br><span class="line">    student.go</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> model</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个结构体</span></span><br><span class="line"><span class="keyword">type</span> student <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name  <span class="keyword">string</span></span><br><span class="line">	Score <span class="keyword">float64</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 因为student结构体首字母是小写，因此是只能在model使用</span></span><br><span class="line"><span class="comment">// 我们通过工厂模式来解决</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewStudent</span><span class="params">(n <span class="keyword">string</span>, s <span class="keyword">float64</span>)</span> *<span class="title">student</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> &amp;student&#123;</span><br><span class="line">		Name:  n,</span><br><span class="line">		Score: s,</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *student)</span> <span class="title">GetScore</span><span class="params">()</span> <span class="title">float64</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> s.score</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"gocode/project10/factory/model"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// var stu = model.Student&#123;</span></span><br><span class="line">	<span class="comment">// 	Name:  "tom",</span></span><br><span class="line">	<span class="comment">// 	Score: 78.9,</span></span><br><span class="line">	<span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 当student结构体首字母是小写的时候，我们可以通过工厂模式解决</span></span><br><span class="line">	<span class="keyword">var</span> stu = model.NewStudent(<span class="string">"tom~"</span>, <span class="number">88.8</span>)</span><br><span class="line">	fmt.Println(stu) <span class="comment">// &amp;&#123;...&#125;</span></span><br><span class="line">	fmt.Println(*stu)</span><br><span class="line">	fmt.Println(<span class="string">"name = "</span>, stu.Name, <span class="string">"score = "</span>, stu.GetScore())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">&amp;&#123;tom~ <span class="number">88.8</span>&#125;</span><br><span class="line">&#123;tom~ <span class="number">88.8</span>&#125;</span><br><span class="line">name =  tom~ score =  <span class="number">88.8</span></span><br></pre></td></tr></table></figure>

<h1 id="11-面向对象编程（下）"><a href="#11-面向对象编程（下）" class="headerlink" title="11 面向对象编程（下）"></a>11 面向对象编程（下）</h1><h2 id="11-3-面向对象编程三大特性"><a href="#11-3-面向对象编程三大特性" class="headerlink" title="11.3 面向对象编程三大特性"></a>11.3 面向对象编程三大特性</h2><h3 id="11-3-1-基本介绍"><a href="#11-3-1-基本介绍" class="headerlink" title="11.3.1 基本介绍"></a>11.3.1 基本介绍</h3><p>Golang任然有面向对象编程的继承、封装和多态的特性，只是实现的方式和其他OOP语言不一样。</p>
<h3 id="11-3-2-封装介绍"><a href="#11-3-2-封装介绍" class="headerlink" title="11.3.2 封装介绍"></a>11.3.2 封装介绍</h3><p>封装就是把抽象出的<code>字段和对字段的操作封装在一起</code>，数据被保护在内部，程序的其他包只有通过被授权的操作（方法），才能对字段进行操作。</p>
<h3 id="11-3-3-封装的理解和好处"><a href="#11-3-3-封装的理解和好处" class="headerlink" title="11.3.3 封装的理解和好处"></a>11.3.3 封装的理解和好处</h3><ol>
<li><p>隐藏实现细节</p>
</li>
<li><p>可以对数据进行验证，保证安全合理（Age）</p>
</li>
</ol>
<h3 id="11-3-4-如何体现封装"><a href="#11-3-4-如何体现封装" class="headerlink" title="11.3.4 如何体现封装"></a>11.3.4 如何体现封装</h3><ol>
<li><p>对结构体中的属性进行封装</p>
</li>
<li><p>通过方法、包实现封装</p>
</li>
</ol>
<h3 id="11-3-5-封装的实现步骤"><a href="#11-3-5-封装的实现步骤" class="headerlink" title="11.3.5 封装的实现步骤"></a>11.3.5 封装的实现步骤</h3><ol start="2">
<li>给结构体所在包提供几个工厂模式的函数，首字母大写。类似一个构造函数。</li>
</ol>
<h3 id="11-3-6-嵌套匿名结构体的基本语法"><a href="#11-3-6-嵌套匿名结构体的基本语法" class="headerlink" title="11.3.6 嵌套匿名结构体的基本语法"></a>11.3.6 嵌套匿名结构体的基本语法</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Goods <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name  <span class="keyword">string</span></span><br><span class="line">	Price <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Book <span class="keyword">struct</span> &#123;</span><br><span class="line">	Goods <span class="comment">// 这里就是嵌套匿名结构体Goods</span></span><br><span class="line">	Writer <span class="keyword">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Student <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name  <span class="keyword">string</span></span><br><span class="line">	Age   <span class="keyword">int</span></span><br><span class="line">	Score <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将Pupil和Graduate共有的方法绑定到*Student</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(stu *Student)</span> <span class="title">ShowInfo</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Printf(<span class="string">"学生名=%v 年龄=%v 成绩=%v\n"</span>,</span><br><span class="line">		stu.Name, stu.Age, stu.Score)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(stu *Student)</span> <span class="title">SetScore</span><span class="params">(score <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">	stu.Score = score</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 小学生结构体</span></span><br><span class="line"><span class="keyword">type</span> Pupil <span class="keyword">struct</span> &#123;</span><br><span class="line">	Student <span class="comment">// 嵌入了Student匿名结构体</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这是Pupil特有的方法，保留</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p *Pupil)</span> <span class="title">testing</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">"小学生正在考试中..."</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 大学生结构体</span></span><br><span class="line"><span class="keyword">type</span> Graduate <span class="keyword">struct</span> &#123;</span><br><span class="line">	Student</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这是Graduate特有的方法，保留</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(g *Graduate)</span> <span class="title">testing</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">"大学生正在考试中..."</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 当我们对结构体嵌入了匿名结构体后，使用方法会发生变化</span></span><br><span class="line">	pupil := &amp;Pupil&#123;&#125;</span><br><span class="line">	pupil.Student.Name = <span class="string">"tom"</span></span><br><span class="line">	pupil.Student.Age = <span class="number">8</span></span><br><span class="line"></span><br><span class="line">	pupil.testing()</span><br><span class="line">	pupil.Student.SetScore(<span class="number">90</span>)</span><br><span class="line">	pupil.Student.ShowInfo()</span><br><span class="line"></span><br><span class="line">	graduate := &amp;Graduate&#123;&#125;</span><br><span class="line">	graduate.Student.Name = <span class="string">"mary"</span></span><br><span class="line">	graduate.Student.Age = <span class="number">28</span></span><br><span class="line"></span><br><span class="line">	graduate.testing()</span><br><span class="line">	graduate.Student.SetScore(<span class="number">70</span>)</span><br><span class="line">	graduate.Student.ShowInfo()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">小学生正在考试中...</span><br><span class="line">学生名=tom 年龄=<span class="number">8</span> 成绩=<span class="number">90</span></span><br><span class="line">大学生正在考试中...</span><br><span class="line">学生名=mary 年龄=<span class="number">28</span> 成绩=<span class="number">70</span></span><br></pre></td></tr></table></figure>

<h3 id="11-3-7-继承的深入讨论"><a href="#11-3-7-继承的深入讨论" class="headerlink" title="11.3.7 继承的深入讨论"></a>11.3.7 继承的深入讨论</h3><ol>
<li><p>结构体可以使用<code>嵌套匿名结构体所有的字段和方法</code>，即首字母大小或小写的字段、方法都可以使用</p>
</li>
<li><p>匿名结构体字段访问可以简化<br><code>a.b.Name</code>-&gt;<code>a.Name</code>其中a继承自b<br>（1）编译器会先看a对应的类型有没有Name，如果有则直接调用a类型的Name字段<br>（2）如果没有就去看a中嵌入的结构体b中有没有，如果有叫调用，如果没有继续查找。若都无法找到，则报错。</p>
</li>
<li><p>当结构体和匿名结构体有相同的字段或方法时，编译器采用就近原则访问，如果希望访问匿名结构体的字段和方法，可以通过匿名结构体来区分</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> A <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name <span class="keyword">string</span></span><br><span class="line">	Age  <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a *A)</span> <span class="title">SayOk</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">"A Sayok"</span>, a.Name)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a *A)</span><span class="title">hello</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">"A hello"</span>, a.Name)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> B <span class="keyword">struct</span> &#123;</span><br><span class="line">	A</span><br><span class="line">	Name <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> (b *B) SayOk() &#123;</span><br><span class="line">	fmt.Println(<span class="string">"B SayOk"</span>, b.Name)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> b B</span><br><span class="line">	b.Name = <span class="string">"jack"</span></span><br><span class="line">	b.A.Name = <span class="string">"scot"</span></span><br><span class="line">	b.age = <span class="number">100</span></span><br><span class="line">	b.SayOk()</span><br><span class="line">	b.hello()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">B SayOk jack</span><br><span class="line">A hello scot</span><br></pre></td></tr></table></figure>
</li>
<li><p>结构体嵌入两个（或多个）匿名结构体，如两个匿名结构体有相同的字段和方法（同时结构体本身没有同名的字段和方法），在访问时，就必须明确指出匿名结构体名字否则编译报错。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> A <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name <span class="keyword">string</span></span><br><span class="line">	age  <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> B <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name  <span class="keyword">string</span></span><br><span class="line">	Score <span class="keyword">float64</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> C <span class="keyword">struct</span> &#123;</span><br><span class="line">	A</span><br><span class="line">	B</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> c C</span><br><span class="line">	<span class="comment">// 如果c没有Name字段，而A和B有Name，这是就必须通过指定匿名结构体名字来区分</span></span><br><span class="line">	<span class="comment">// 所以c.Name就会报编译错误，这个规则对方法也一样。</span></span><br><span class="line">	c.A.Name = <span class="string">"tom"</span></span><br><span class="line">	c.B.Name = <span class="string">"jack"</span></span><br><span class="line">	<span class="comment">// c.Name = "tom" // error</span></span><br><span class="line">	fmt.Println(c)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">&#123;&#123;tom <span class="number">0</span>&#125; &#123;jack <span class="number">0</span>&#125;&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>如果一个struct嵌套了一个有名结构体，这种模式就是<code>组合</code>，如果是组合关系，那么在访问组合的结构体的字段或方法是，必须带上结构体的名字</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> A <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> D <span class="keyword">struct</span> &#123;</span><br><span class="line">	a A</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> d D</span><br><span class="line">d.a.Name = <span class="string">"jack"</span></span><br><span class="line"><span class="comment">// d.Name // error</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>嵌套匿名结构体后，也可以在创建结构体变量（实例）时，直接指定各个匿名结构体字段的值</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Goods <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name  <span class="keyword">string</span></span><br><span class="line">	Price <span class="keyword">float64</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Brand <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name    <span class="keyword">string</span></span><br><span class="line">	Address <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> TV <span class="keyword">struct</span> &#123;</span><br><span class="line">	Goods</span><br><span class="line">	Brand</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 第一种定义方式</span></span><br><span class="line">tv := TV&#123;Goods&#123;<span class="string">"电视机"</span>, <span class="number">5000.99</span>&#125;, Brand&#123;<span class="string">"海尔"</span>, <span class="string">"山东"</span>&#125;&#125;</span><br><span class="line"><span class="comment">// 第二种定义方式</span></span><br><span class="line">tv2 := TV&#123;</span><br><span class="line">	Goods&#123;</span><br><span class="line">		Name:  <span class="string">"电视机2"</span>,</span><br><span class="line">		Price: <span class="number">5000.88</span>,</span><br><span class="line">	&#125;,</span><br><span class="line">	Brand&#123;</span><br><span class="line">		Name:    <span class="string">"海尔2"</span>,</span><br><span class="line">		Address: <span class="string">"山东2"</span>,</span><br><span class="line">	&#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fmt.Println(tv)</span><br><span class="line">fmt.Println(tv2)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">&#123;&#123;电视机 <span class="number">5000.99</span>&#125; &#123;海尔 山东&#125;&#125;</span><br><span class="line">&#123;&#123;电视机<span class="number">2</span> <span class="number">5000.88</span>&#125; &#123;海尔<span class="number">2</span> 山东<span class="number">2</span>&#125;&#125;</span><br></pre></td></tr></table></figure>

<p> 可以在结构体中嵌入结构体指针，提高运算效率</p>
 <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Goods <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name  <span class="keyword">string</span></span><br><span class="line">	Price <span class="keyword">float64</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Brand <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name    <span class="keyword">string</span></span><br><span class="line">	Address <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> TV <span class="keyword">struct</span> &#123;</span><br><span class="line">	*Goods</span><br><span class="line">	*Brand</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">tv3 := TV&#123;&amp;Goods&#123;<span class="string">"电视机3"</span>, <span class="number">5000.99</span>&#125;, &amp;Brand&#123;<span class="string">"海尔3"</span>, <span class="string">"山东"</span>&#125;&#125;</span><br><span class="line">fmt.Println(tv3)</span><br><span class="line">fmt.Println(*tv3.Goods, *tv3.Brand)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">&#123;<span class="number">0xc00005c420</span> <span class="number">0xc00005c440</span>&#125;</span><br><span class="line">&#123;电视机<span class="number">3</span> <span class="number">5000.99</span>&#125; &#123;海尔<span class="number">3</span> 山东&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="11-3-8-多重继承"><a href="#11-3-8-多重继承" class="headerlink" title="11.3.8 多重继承"></a>11.3.8 多重继承</h3><ol>
<li><p>如嵌入的匿名结构体有相同的字段名或者方法名，则在访问时需要通过匿名结构体类型来区分</p>
</li>
<li><p>为了保证代码的简洁性，建议尽量不使用多重继承</p>
</li>
</ol>
<h2 id="11-5-接口"><a href="#11-5-接口" class="headerlink" title="11.5 接口"></a>11.5 接口</h2><h3 id="11-5-1-为什么要有接口？"><a href="#11-5-1-为什么要有接口？" class="headerlink" title="11.5.1 为什么要有接口？"></a>11.5.1 为什么要有接口？</h3><p>降低代码耦合性，提高代码通用性。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 声明一个接口</span></span><br><span class="line"><span class="keyword">type</span> Usb <span class="keyword">interface</span> &#123;</span><br><span class="line">	<span class="comment">// 声明了两个没有实现的方法</span></span><br><span class="line">	Start()</span><br><span class="line">	Stop()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Phone <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 让Phone实现Usb接口的方法</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p Phone)</span> <span class="title">Start</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">"手机开始工作。。。"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p Phone)</span> <span class="title">Stop</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">"手机停止工作。。。"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Camera <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 让Camera实现Usb接口的方法</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c Camera)</span> <span class="title">Start</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">"相机开始工作。。。"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c Camera)</span> <span class="title">Stop</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">"相机停止工作。。。"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 计算机</span></span><br><span class="line"><span class="keyword">type</span> Computer <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 编写一个方法Working，接收一个Usb接口类型变量</span></span><br><span class="line"><span class="comment">// 只要实现了Usb接口</span></span><br><span class="line"><span class="comment">// 所谓实现Usb接口，就是指实现了Usb接口声明的所有方法</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c Computer)</span> <span class="title">Working</span><span class="params">(usb Usb)</span></span> &#123;</span><br><span class="line">	usb.Start()</span><br><span class="line">	usb.Stop()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 测试</span></span><br><span class="line">	<span class="comment">// 先创建结构体变量</span></span><br><span class="line">	computer := Computer&#123;&#125;</span><br><span class="line">	phone := Phone&#123;&#125;</span><br><span class="line">	camera := Camera&#123;&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 关键点</span></span><br><span class="line">	computer.Working(phone)</span><br><span class="line">	computer.Working(camera)</span><br><span class="line">	fmt.Println()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">手机开始工作。。。</span><br><span class="line">手机停止工作。。。</span><br><span class="line">相机开始工作。。。</span><br><span class="line">相机停止工作。。。</span><br></pre></td></tr></table></figure>

<h3 id="11-5-2-基本介绍"><a href="#11-5-2-基本介绍" class="headerlink" title="11.5.2 基本介绍"></a>11.5.2 基本介绍</h3><p><code>interface</code>类型可以定义一组方法，但这些不需要事先，并且interface不能包含任何变量。</p>
<h3 id="11-5-3-基本语法"><a href="#11-5-3-基本语法" class="headerlink" title="11.5.3 基本语法"></a>11.5.3 基本语法</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> 接口名 <span class="keyword">interface</span> &#123;</span><br><span class="line">	method1(参数列表) 返回值列表</span><br><span class="line">	method2(参数列表) 返回值列表</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>小结：</p>
<ol>
<li><p>接口里的所有方法都没有方法体，即接口的方法都是没有实现的发方法。接口体现了程序设计的<code>多态和高内聚低耦合</code>的思想。</p>
</li>
<li><p>Golang中的接口，不需要显示的实现。只要一个变量，含有接口类型的所有方法，那么这个变量就实现了这个接口。因此，<code>Golang中没有implement这样的关键字。</code></p>
</li>
</ol>
<h3 id="11-5-4-接口使用的注意事项和细节"><a href="#11-5-4-接口使用的注意事项和细节" class="headerlink" title="11.5.4 接口使用的注意事项和细节"></a>11.5.4 接口使用的注意事项和细节</h3><ol>
<li><p>接口本身不能创建实例，但是可以执行一个实现了该接口的自定义类型的变量（实例）</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> AInterface <span class="keyword">interface</span> &#123;</span><br><span class="line">	Say()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Stu <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(stu Stu)</span> <span class="title">Say</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">"Stu Say()"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> stu Stu <span class="comment">// 结构体变量，实现了Say()，实现了AInterface</span></span><br><span class="line">	<span class="keyword">var</span> a AInterface = stu</span><br><span class="line">	a.Say()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">Stu Say()</span><br></pre></td></tr></table></figure>
</li>
<li><p>接口所有的方法都没有方法体，即都没有实现的方法</p>
</li>
<li><p>在Golang中，一个自定义类型需要将某个接口的所有方法都实现，我们说这个自定义类型实现了该接口</p>
</li>
<li><p>一个自定义类型只有实现了某个接口，才能将该自定义类型的实例（变量）赋给接口类型</p>
</li>
<li><p>只要是自定义数据类型，就可以实现接口，不仅仅是结构体类型。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> AInterface <span class="keyword">interface</span> &#123;</span><br><span class="line">	Say()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Integer <span class="keyword">int</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(i Integer)</span> <span class="title">Say</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">"Integer i = "</span>, i)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> integer Integer = <span class="number">100</span></span><br><span class="line"><span class="keyword">var</span> b AInterface = integer</span><br><span class="line">b.Say()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">Integer i =  <span class="number">100</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>一个自定义类型可以实现多个接口</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> AInterface <span class="keyword">interface</span> &#123;</span><br><span class="line">	Say()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> BInterface <span class="keyword">interface</span> &#123;</span><br><span class="line">	Hello()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Monster <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(m Monster)</span> <span class="title">Hello</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">"Monster Hello()"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(m Monster)</span> <span class="title">Say</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">"Monster Say()"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> monster Monster</span><br><span class="line"><span class="keyword">var</span> a2 AInterface = monster</span><br><span class="line"><span class="keyword">var</span> b2 BInterface = monster</span><br><span class="line">a2.Say()</span><br><span class="line">b2.Hello()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">Monster Say()</span><br><span class="line">Monster Hello()</span><br></pre></td></tr></table></figure>
</li>
<li><p>Golang接口中不能有任何变量</p>
</li>
<li><p>一个接口（比如A接口）可以继承多个接口</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> BInterface <span class="keyword">interface</span> &#123;</span><br><span class="line">	test01()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> CInterface <span class="keyword">interface</span> &#123;</span><br><span class="line">	test02()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> AInterface <span class="keyword">interface</span> &#123;</span><br><span class="line">	BInterface</span><br><span class="line">	CInterface</span><br><span class="line">	test03()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果要实现AInterface，就需要将BInterface CInterface的方法都实现</span></span><br><span class="line"><span class="keyword">type</span> Stu <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(stu Stu)</span> <span class="title">test01</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(stu Stu)</span> <span class="title">test02</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(stu Stu)</span> <span class="title">test03</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> stu Stu</span><br><span class="line">	<span class="keyword">var</span> a AInterface = stu</span><br><span class="line">	fmt.Println(a)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">&#123;&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>interface类型默认是一个指针（引用类型），如果没有对interface初始化就是用，那么会输出nil</p>
</li>
<li><p>空接口<code>interface{}</code>没有任何方法，所以<code>所有类型都实现了空接口</code>，即<code>我们可以把任何变量赋给空接口</code>。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> T <span class="keyword">interface</span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> t T = stu</span><br><span class="line">fmt.Println(t)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> t2 <span class="keyword">interface</span>&#123;&#125; = stu</span><br><span class="line"><span class="keyword">var</span> num1 <span class="keyword">float64</span> = <span class="number">8.8</span></span><br><span class="line">t2 = num1</span><br><span class="line">fmt.Println(t2)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">&#123;&#125;</span><br><span class="line"><span class="number">8.8</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="11-5-5-接口使用示例"><a href="#11-5-5-接口使用示例" class="headerlink" title="11.5.5 接口使用示例"></a>11.5.5 接口使用示例</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// sort包中的Sort函数介绍</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Sort</span><span class="params">(data Interface)</span></span></span><br><span class="line"><span class="function"><span class="title">Sort</span> 对 <span class="title">data</span> 进行排序。 它调用一次 <span class="title">data</span>.<span class="title">Len</span> 来决定排序的长度 <span class="title">n</span>，调用 <span class="title">data</span>.<span class="title">Less</span> 和 <span class="title">data</span>.<span class="title">Swap</span> 的开销为 <span class="title">O</span><span class="params">(n*log(n)</span>)。此排序为不稳定排序。</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">type</span> <span class="title">Interface</span> <span class="title">interface</span></span> &#123;</span><br><span class="line">	<span class="comment">// Len 为集合内元素的总数</span></span><br><span class="line">	Len() <span class="keyword">int</span></span><br><span class="line">	<span class="comment">// Less 返回索引为 i 的元素是否应排在索引为 j 的元素之前。</span></span><br><span class="line">	Less(i, j <span class="keyword">int</span>) <span class="keyword">bool</span></span><br><span class="line">	<span class="comment">// Swap 交换索引为 i 和 j 的元素</span></span><br><span class="line">	Swap(i, j <span class="keyword">int</span>)</span><br><span class="line">&#125;</span><br><span class="line">任何实现了 sort.Interface 的类型（一般为集合），均可使用该包中的方法进行排序。 这些方法要求集合内列出元素的索引为整数。</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"math/rand"</span></span><br><span class="line">	<span class="string">"sort"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1.声明一个Hero结构体</span></span><br><span class="line"><span class="keyword">type</span> Hero <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name <span class="keyword">string</span></span><br><span class="line">	Age  <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.声明一个Hero结构体切片类型</span></span><br><span class="line"><span class="keyword">type</span> HeroSlice []Hero</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.实现Interface接口</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(hs HeroSlice)</span> <span class="title">Len</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">len</span>(hs)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Less方法就是决定什么标准进行排序</span></span><br><span class="line"><span class="comment">// 1.按Hero年龄从小到大排序</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(hs HeroSlice)</span> <span class="title">Less</span><span class="params">(i, j <span class="keyword">int</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">	<span class="comment">// return hs[i].Age &lt; hs[j].Age</span></span><br><span class="line">	<span class="comment">// 修改成对姓名排序</span></span><br><span class="line">	<span class="keyword">return</span> hs[i].Name &lt; hs[j].Name</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(hs HeroSlice)</span> <span class="title">Swap</span><span class="params">(i, j <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">	<span class="comment">// temp := hs[i]</span></span><br><span class="line">	<span class="comment">// hs[i] = hs[j]</span></span><br><span class="line">	<span class="comment">// hs[j] = temp</span></span><br><span class="line">	hs[i], hs[j] = hs[j], hs[i]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 新增student结构体，同样可以简单替换。</span></span><br><span class="line"><span class="keyword">type</span> student <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name  <span class="keyword">string</span></span><br><span class="line">	Age   <span class="keyword">int</span></span><br><span class="line">	Score <span class="keyword">float64</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 先定义一个数组/切片</span></span><br><span class="line">	<span class="keyword">var</span> intSlice = []<span class="keyword">int</span>&#123;<span class="number">0</span>, <span class="number">-1</span>, <span class="number">10</span>, <span class="number">7</span>, <span class="number">90</span>&#125;</span><br><span class="line">	<span class="comment">// 要求对intSclie进行排序</span></span><br><span class="line">	<span class="comment">// 1. 冒泡排序</span></span><br><span class="line">	<span class="comment">// 2. 也可以使用系统提供的方法</span></span><br><span class="line">	sort.Ints(intSlice)</span><br><span class="line">	fmt.Println(intSlice)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 对一个结构体切片进行排序</span></span><br><span class="line">	<span class="comment">// 1. 冒泡排序。。。</span></span><br><span class="line">	<span class="comment">// 2. 也可以使用系统提供的方法</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 测试看看我们是否可以对结构体切片进行排序</span></span><br><span class="line">	<span class="keyword">var</span> heros HeroSlice</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">		hero := Hero&#123;</span><br><span class="line">			Name: fmt.Sprintf(<span class="string">"英雄No.%d"</span>, rand.Intn(<span class="number">100</span>)),</span><br><span class="line">			Age:  rand.Intn(<span class="number">100</span>),</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// 将hero append到切片中</span></span><br><span class="line">		heros = <span class="built_in">append</span>(heros, hero)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 看看排序前的顺序</span></span><br><span class="line">	<span class="keyword">for</span> _, v := <span class="keyword">range</span> heros &#123;</span><br><span class="line">		fmt.Println(v)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	fmt.Println(<span class="string">"------排序后------"</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 调用sort.Sort()</span></span><br><span class="line">	sort.Sort(heros)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> _, v := <span class="keyword">range</span> heros &#123;</span><br><span class="line">		fmt.Println(v)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">[<span class="number">-1</span> <span class="number">0</span> <span class="number">7</span> <span class="number">10</span> <span class="number">90</span>]</span><br><span class="line">&#123;英雄No<span class="number">.81</span> <span class="number">87</span>&#125;</span><br><span class="line">&#123;英雄No<span class="number">.47</span> <span class="number">59</span>&#125;</span><br><span class="line">&#123;英雄No<span class="number">.81</span> <span class="number">18</span>&#125;</span><br><span class="line">&#123;英雄No<span class="number">.25</span> <span class="number">40</span>&#125;</span><br><span class="line">&#123;英雄No<span class="number">.56</span> <span class="number">0</span>&#125;</span><br><span class="line">&#123;英雄No<span class="number">.94</span> <span class="number">11</span>&#125;</span><br><span class="line">&#123;英雄No<span class="number">.62</span> <span class="number">89</span>&#125;</span><br><span class="line">&#123;英雄No<span class="number">.28</span> <span class="number">74</span>&#125;</span><br><span class="line">&#123;英雄No<span class="number">.11</span> <span class="number">45</span>&#125;</span><br><span class="line">&#123;英雄No<span class="number">.37</span> <span class="number">6</span>&#125;</span><br><span class="line">------排序后------</span><br><span class="line">&#123;英雄No<span class="number">.11</span> <span class="number">45</span>&#125;</span><br><span class="line">&#123;英雄No<span class="number">.25</span> <span class="number">40</span>&#125;</span><br><span class="line">&#123;英雄No<span class="number">.28</span> <span class="number">74</span>&#125;</span><br><span class="line">&#123;英雄No<span class="number">.37</span> <span class="number">6</span>&#125;</span><br><span class="line">&#123;英雄No<span class="number">.47</span> <span class="number">59</span>&#125;</span><br><span class="line">&#123;英雄No<span class="number">.56</span> <span class="number">0</span>&#125;</span><br><span class="line">&#123;英雄No<span class="number">.62</span> <span class="number">89</span>&#125;</span><br><span class="line">&#123;英雄No<span class="number">.81</span> <span class="number">87</span>&#125;</span><br><span class="line">&#123;英雄No<span class="number">.81</span> <span class="number">18</span>&#125;</span><br><span class="line">&#123;英雄No<span class="number">.94</span> <span class="number">11</span>&#125;</span><br></pre></td></tr></table></figure>

<h3 id="11-5-6-接口和继承"><a href="#11-5-6-接口和继承" class="headerlink" title="11.5.6 接口和继承"></a>11.5.6 接口和继承</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Monkey结构体</span></span><br><span class="line"><span class="keyword">type</span> Monkey <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *Monkey)</span> <span class="title">climbing</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(this.Name, <span class="string">"生来会爬树"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 声明接口</span></span><br><span class="line"><span class="keyword">type</span> BirdAble <span class="keyword">interface</span> &#123;</span><br><span class="line">	Flying()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> FishAble <span class="keyword">interface</span> &#123;</span><br><span class="line">	Swimming()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// LittleMonkey结构体</span></span><br><span class="line"><span class="keyword">type</span> LittleMonkey <span class="keyword">struct</span> &#123;</span><br><span class="line">	Monkey <span class="comment">// 继承</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 让LittleMonkey实现Flying()接口</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *LittleMonkey)</span> <span class="title">Flying</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(this.Name, <span class="string">"通过学习，会飞翔了。"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *LittleMonkey)</span> <span class="title">Swimming</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(this.Name, <span class="string">"通过学习，会游泳了。"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 创建一个LittleMonkey示例</span></span><br><span class="line">	monkey := LittleMonkey&#123;</span><br><span class="line">		Monkey&#123;</span><br><span class="line">			Name: <span class="string">"悟空"</span>,</span><br><span class="line">		&#125;,</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	monkey.climbing()</span><br><span class="line">	monkey.Flying()</span><br><span class="line">	monkey.Swimming()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">悟空 生来会爬树</span><br><span class="line">悟空 通过学习，会飞翔了。</span><br><span class="line">悟空 通过学习，会游泳了。</span><br></pre></td></tr></table></figure>

<p>小结：</p>
<ol>
<li><p>当A结构体继承了B结构体，那么就会自动的继承了B结构体的字段和方法，并且可以直接使用。</p>
</li>
<li><p>当A结构体需要扩展功能，同时不希望去破坏这个继承关系，则可以去实现某个接口即可，因此实现接口是对继承机制的一种补充。</p>
</li>
<li><p>继承了A结构体的C结构体无法使用接口的特殊功能。</p>
</li>
<li><p>接口可以看作继承的一种补充<br>既不会破坏结构体的完整性，又能起到补充的规范性</p>
</li>
<li><p>接口和继承的解决的问题不同<br> <strong>继承的价值</strong>主要在于：解决代码的复用性和可维护性。<br> <strong>接口的价值</strong>主要在于：设计，设计好各种规范（方法），让其他自定义类型去实现这些方法。</p>
</li>
<li><p>接口比继承更加灵活<br>接口比继承更加灵活，继承是满足is-a的关系，而接口只需要满足like-a的关系</p>
</li>
<li><p>接口在一定程度上可以实现代码解耦</p>
</li>
</ol>
<h2 id="11-6-多态"><a href="#11-6-多态" class="headerlink" title="11.6 多态"></a>11.6 多态</h2><h3 id="11-6-1-基本介绍"><a href="#11-6-1-基本介绍" class="headerlink" title="11.6.1 基本介绍"></a>11.6.1 基本介绍</h3><p>在Go语言中，多态特征是通过接口实现的。可以按照统一的接口来调用不同的实现。这时接口变量就呈现不同的形态。</p>
<h3 id="11-6-2-接口体现多态特征"><a href="#11-6-2-接口体现多态特征" class="headerlink" title="11.6.2 接口体现多态特征"></a>11.6.2 接口体现多态特征</h3><ol>
<li><p>多态参数<br>在前面的Usb接口案例，Usb usb，既可以接收手机变量，又可以接收接口多态。</p>
</li>
<li><p>多态数组<br>给Usb数组中，存放Phone结构体和Camera结构体变量</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 声明一个接口</span></span><br><span class="line"><span class="keyword">type</span> Usb <span class="keyword">interface</span> &#123;</span><br><span class="line">	<span class="comment">// 声明了两个没有实现的方法</span></span><br><span class="line">	Start()</span><br><span class="line">	Stop()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Phone <span class="keyword">struct</span> &#123;</span><br><span class="line">	name <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 让Phone实现Usb接口的方法</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p Phone)</span> <span class="title">Start</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">"手机开始工作。。。"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p Phone)</span> <span class="title">Stop</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">"手机停止工作。。。"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Camera <span class="keyword">struct</span> &#123;</span><br><span class="line">	name <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 让Camera实现Usb接口的方法</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c Camera)</span> <span class="title">Start</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">"相机开始工作。。。"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c Camera)</span> <span class="title">Stop</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">"相机停止工作。。。"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 计算机</span></span><br><span class="line"><span class="keyword">type</span> Computer <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 编写一个方法Working，接收一个Usb接口类型变量</span></span><br><span class="line"><span class="comment">// 只要实现了Usb接口</span></span><br><span class="line"><span class="comment">// 所谓实现Usb接口，就是指实现了Usb接口声明的所有方法</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c Computer)</span> <span class="title">Working</span><span class="params">(usb Usb)</span></span> &#123;</span><br><span class="line">	usb.Start()</span><br><span class="line">	usb.Stop()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 定义一个接口数组，可以存放Phone和Camear的结构体变量</span></span><br><span class="line">	<span class="comment">// 这里就体现出多态数组</span></span><br><span class="line">	<span class="keyword">var</span> usbArr [<span class="number">3</span>]Usb</span><br><span class="line">	usbArr[<span class="number">0</span>] = Phone&#123;<span class="string">"vivo"</span>&#125;</span><br><span class="line">	usbArr[<span class="number">1</span>] = Phone&#123;<span class="string">"小米"</span>&#125;</span><br><span class="line">	usbArr[<span class="number">2</span>] = Camera&#123;<span class="string">"尼康"</span>&#125;</span><br><span class="line"></span><br><span class="line">	fmt.Println(usbArr)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">[&#123;vivo&#125; &#123;小米&#125; &#123;尼康&#125;]</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="11-7-类型断言"><a href="#11-7-类型断言" class="headerlink" title="11.7 类型断言"></a>11.7 类型断言</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Point <span class="keyword">struct</span> &#123;</span><br><span class="line">	x <span class="keyword">int</span></span><br><span class="line">	y <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> a <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line">	<span class="keyword">var</span> point Point = Point&#123;<span class="number">1</span>, <span class="number">2</span>&#125;</span><br><span class="line">	a = point</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> b Point</span><br><span class="line">	<span class="comment">// b = a 不可以</span></span><br><span class="line">	<span class="comment">// b = a.(Point) // 可以</span></span><br><span class="line">	b = a.(Point)</span><br><span class="line">	fmt.Println(b)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">&#123;<span class="number">1</span> <span class="number">2</span>&#125;</span><br></pre></td></tr></table></figure>

<p>a.(Point)就是类型断言，表示判断a是否指向Point类型的变量，如果是就转成Point类型并赋给b变量，否则报错</p>
<h3 id="11-7-1-基本介绍"><a href="#11-7-1-基本介绍" class="headerlink" title="11.7.1 基本介绍"></a>11.7.1 基本介绍</h3><p>类型断言，由于接口是一般类型，不知道具体类型，如果要转成具体类型，就需要使用类型断言。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 类型断言的其他案例</span></span><br><span class="line"><span class="keyword">var</span> x <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line"><span class="keyword">var</span> c <span class="keyword">float32</span> = <span class="number">1.1</span></span><br><span class="line">x = c <span class="comment">// 空接口，可以接收任意类型</span></span><br><span class="line"><span class="comment">// x-&gt;float32[使用类型断言]</span></span><br><span class="line">y := x.(<span class="keyword">float32</span>)</span><br><span class="line">fmt.Printf(<span class="string">"y的类型是%T，值是%v"</span>, y, y)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// </span></span><br><span class="line">y的类型是<span class="keyword">float32</span>，值是<span class="number">1.1</span></span><br></pre></td></tr></table></figure>

<p>如果类型不匹配，就会报panic，因此进行类型断言时，要确保远原来空接口指向的就是要断言的类型</p>
<p>如何在进行断言时，带上检测机制。如果成功ok，否则也不报panic？</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 类型断言的其他案例（带检测）</span></span><br><span class="line"><span class="keyword">var</span> x <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line"><span class="keyword">var</span> c <span class="keyword">float32</span> = <span class="number">2.1</span></span><br><span class="line">x = c <span class="comment">// 空接口，可以接收任意类型</span></span><br><span class="line"><span class="comment">// x-&gt;float32[使用类型断言]</span></span><br><span class="line"><span class="comment">// 下面的类型断言是对上面的缩写</span></span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">y, err := x.(float32)</span></span><br><span class="line"><span class="comment">if err&#123;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">if</span> y, err := x.(<span class="keyword">float32</span>); err &#123;</span><br><span class="line">	fmt.Println(<span class="string">"convert success"</span>)</span><br><span class="line">	fmt.Printf(<span class="string">"y的类型是%T，值是%v\n"</span>, y, y)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">"convert fail"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fmt.Println(<span class="string">"okokook~~~"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">convert success</span><br><span class="line">y的类型是<span class="keyword">float32</span>，值是<span class="number">2.1</span></span><br><span class="line">okokook~~~</span><br></pre></td></tr></table></figure>

<h3 id="11-7-2-类型断言的最佳实践"><a href="#11-7-2-类型断言的最佳实践" class="headerlink" title="11.7.2 类型断言的最佳实践"></a>11.7.2 类型断言的最佳实践</h3><p>对前面的Usb示例进行更改，Phone还有一个特有的方法call()，遍历Usb数组，如果是Phone变量，除了调用Usb接口声明的方法外，还需要调用Phone特有方法call</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 声明一个接口</span></span><br><span class="line"><span class="keyword">type</span> Usb <span class="keyword">interface</span> &#123;</span><br><span class="line">	<span class="comment">// 声明了两个没有实现的方法</span></span><br><span class="line">	Start()</span><br><span class="line">	Stop()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Phone <span class="keyword">struct</span> &#123;</span><br><span class="line">	name <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 让Phone实现Usb接口的方法</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p Phone)</span> <span class="title">Start</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">"手机开始工作。。。"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p Phone)</span> <span class="title">Stop</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">"手机停止工作。。。"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p Phone)</span> <span class="title">Call</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(p.name, <span class="string">"手机 开始打电话"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Camera <span class="keyword">struct</span> &#123;</span><br><span class="line">	name <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 让Camera实现Usb接口的方法</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c Camera)</span> <span class="title">Start</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">"相机开始工作。。。"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c Camera)</span> <span class="title">Stop</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">"相机停止工作。。。"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 计算机</span></span><br><span class="line"><span class="keyword">type</span> Computer <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 编写一个方法Working，接收一个Usb接口类型变量</span></span><br><span class="line"><span class="comment">// 只要实现了Usb接口</span></span><br><span class="line"><span class="comment">// 所谓实现Usb接口，就是指实现了Usb接口声明的所有方法</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c Computer)</span> <span class="title">Working</span><span class="params">(usb Usb)</span></span> &#123;</span><br><span class="line">	usb.Start()</span><br><span class="line">	<span class="comment">// 如果usb是指向Phone结构体的，则还需要调用Call方法</span></span><br><span class="line">	<span class="comment">// 类型断言</span></span><br><span class="line">	<span class="keyword">if</span> phone, ok := usb.(Phone); ok &#123;</span><br><span class="line">		phone.Call()</span><br><span class="line">	&#125;</span><br><span class="line">	usb.Stop()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 定义一个接口数组，可以存放Phone和Camear的结构体变量</span></span><br><span class="line">	<span class="comment">// 这里就体现出多态数组</span></span><br><span class="line">	<span class="keyword">var</span> usbArr [<span class="number">3</span>]Usb</span><br><span class="line">	usbArr[<span class="number">0</span>] = Phone&#123;<span class="string">"vivo"</span>&#125;</span><br><span class="line">	usbArr[<span class="number">1</span>] = Phone&#123;<span class="string">"小米"</span>&#125;</span><br><span class="line">	usbArr[<span class="number">2</span>] = Camera&#123;<span class="string">"尼康"</span>&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 遍历</span></span><br><span class="line">	<span class="comment">// Phone还有一个特有的方法call()，遍历Usb数组，如果是Phone变量</span></span><br><span class="line">	<span class="comment">// 除了调用Usb接口声明的方法外，还需要调用Phone特有方法call</span></span><br><span class="line">	<span class="keyword">var</span> computer Computer</span><br><span class="line">	<span class="keyword">for</span> _, v := <span class="keyword">range</span> usbArr &#123;</span><br><span class="line">		computer.Working(v)</span><br><span class="line">		fmt.Println()</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">手机开始工作。。。</span><br><span class="line">vivo 手机 开始打电话</span><br><span class="line">手机停止工作。。。</span><br><span class="line"></span><br><span class="line">手机开始工作。。。</span><br><span class="line">小米 手机 开始打电话</span><br><span class="line">手机停止工作。。。</span><br><span class="line"></span><br><span class="line">相机开始工作。。。</span><br><span class="line">相机停止工作。。。</span><br></pre></td></tr></table></figure>

<h3 id="最佳实践2"><a href="#最佳实践2" class="headerlink" title="最佳实践2"></a>最佳实践2</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 编写一个函数，可以判断输入的参数数十秒类型</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TypeJude</span><span class="params">(item ...<span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line">	<span class="keyword">for</span> index, x := <span class="keyword">range</span> item &#123;</span><br><span class="line">		indexPrint := index + <span class="number">1</span></span><br><span class="line">		<span class="keyword">switch</span> x.(<span class="keyword">type</span>) &#123;</span><br><span class="line">		<span class="keyword">case</span> <span class="keyword">bool</span>:</span><br><span class="line">			fmt.Printf(<span class="string">"第%v个参数是bool类型，值是%v\n"</span>, indexPrint, x)</span><br><span class="line">		<span class="keyword">case</span> <span class="keyword">float32</span>:</span><br><span class="line">			fmt.Printf(<span class="string">"第%v个参数是float32类型，值是%v\n"</span>, indexPrint, x)</span><br><span class="line">		<span class="keyword">case</span> <span class="keyword">float64</span>:</span><br><span class="line">			fmt.Printf(<span class="string">"第%v个参数是float64类型，值是%v\n"</span>, indexPrint, x)</span><br><span class="line">		<span class="keyword">case</span> <span class="keyword">int</span>, <span class="keyword">int32</span>, <span class="keyword">int64</span>:</span><br><span class="line">			fmt.Printf(<span class="string">"第%v个参数是整型，值是%v\n"</span>, indexPrint, x)</span><br><span class="line">		<span class="keyword">case</span> <span class="keyword">string</span>:</span><br><span class="line">			fmt.Printf(<span class="string">"第%v个参数是string类型，值是%v\n"</span>, indexPrint, x)</span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">			fmt.Printf(<span class="string">"第%v个参数不确定，值是%v\n"</span>, indexPrint, x)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> n1 <span class="keyword">float32</span> = <span class="number">1.1</span></span><br><span class="line">	<span class="keyword">var</span> n2 <span class="keyword">float64</span> = <span class="number">2.3</span></span><br><span class="line">	<span class="keyword">var</span> n3 <span class="keyword">int32</span> = <span class="number">30</span></span><br><span class="line">	<span class="keyword">var</span> name <span class="keyword">string</span> = <span class="string">"tom"</span></span><br><span class="line">	address := <span class="string">"北京"</span></span><br><span class="line">	n4 := <span class="number">300</span></span><br><span class="line">	TypeJude(n1, n2, n3, name, address, n4)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">第<span class="number">1</span>个参数是<span class="keyword">float32</span>类型，值是<span class="number">1.1</span></span><br><span class="line">第<span class="number">2</span>个参数是<span class="keyword">float64</span>类型，值是<span class="number">2.3</span></span><br><span class="line">第<span class="number">3</span>个参数是整型，值是<span class="number">30</span></span><br><span class="line">第<span class="number">4</span>个参数是<span class="keyword">string</span>类型，值是tom</span><br><span class="line">第<span class="number">5</span>个参数是<span class="keyword">string</span>类型，值是北京</span><br><span class="line">第<span class="number">6</span>个参数是整型，值是<span class="number">300</span></span><br></pre></td></tr></table></figure>

<h1 id="12-项目1-家庭收支记账软件项目"><a href="#12-项目1-家庭收支记账软件项目" class="headerlink" title="12 项目1-家庭收支记账软件项目"></a>12 项目1-家庭收支记账软件项目</h1><h2 id="12-1-项目开发流程说明"><a href="#12-1-项目开发流程说明" class="headerlink" title="12.1 项目开发流程说明"></a>12.1 项目开发流程说明</h2><ol>
<li>需求分析<br>30%时间比<br>需求分析师：<ol>
<li>懂技术</li>
<li>懂业务<br>结果：需求分析报告</li>
</ol>
</li>
</ol>
<ol start="2">
<li>设计阶段<br>20%时间比<br>项目经理、架构师<ol>
<li>架构【开发语言、框架、数据库、操作系统…】</li>
<li>选人【】<br>结果：设计文档【类图、示例图、流程图、数据库(核心)、界面原型（核心）…】</li>
</ol>
</li>
</ol>
<ol start="3">
<li>实现阶段（代码）<br>20%时间比<br>软件工程师：<ol>
<li>实现各个模块</li>
</ol>
</li>
</ol>
<ol start="4">
<li>测试阶段<br>与实现螺旋递增，分为单元测试与整体测试<br>软件测试工程师：<ol>
<li>黑盒测试</li>
<li>白盒测试（懂代码）</li>
<li>灰盒测试</li>
</ol>
</li>
</ol>
<ol start="5">
<li><p>实施阶段<br>实施工程师</p>
</li>
<li><p>维护阶段<br>用户发现问题-&gt;返回给对接的人-&gt;对接进行调试和修改</p>
</li>
</ol>
<h2 id="12-2-项目需求说明"><a href="#12-2-项目需求说明" class="headerlink" title="12.2 项目需求说明"></a>12.2 项目需求说明</h2><ol>
<li>模拟实现基于文本界面的《家庭记账软件》</li>
<li>该软件能够记录家庭的收入、支出，并能够打印出收支项目</li>
</ol>
<h2 id="12-3-项目的界面"><a href="#12-3-项目的界面" class="headerlink" title="12.3 项目的界面"></a>12.3 项目的界面</h2><h2 id="12-4-项目代码实现1"><a href="#12-4-项目代码实现1" class="headerlink" title="12.4 项目代码实现1"></a>12.4 项目代码实现1</h2><p>实现基本功能（先使用面向过程，后面改成面向对象）</p>
<p>编写文件 TestMyAccount.go 完成基本功能</p>
<ol>
<li>先完成可以显示主菜单，并且可以退出</li>
<li>完成可以显示明细的功能</li>
<li>完成登记收入的功能</li>
<li>完成登记支出的功能</li>
</ol>
<h3 id="12-4-1-功能1"><a href="#12-4-1-功能1" class="headerlink" title="12.4.1 功能1"></a>12.4.1 功能1</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 声明一个变量，保存接收用户输入的选项</span></span><br><span class="line">	key := <span class="string">""</span></span><br><span class="line">	<span class="comment">// 声明一个变量，控制是否退出for循环</span></span><br><span class="line">	loop := <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 显示主菜单</span></span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"----------------家庭收支记账软件-----------------"</span>)</span><br><span class="line">		fmt.Println(<span class="string">"                 1 收入明细"</span>)</span><br><span class="line">		fmt.Println(<span class="string">"                 2 登记收入"</span>)</span><br><span class="line">		fmt.Println(<span class="string">"                 3 登记支出"</span>)</span><br><span class="line">		fmt.Println(<span class="string">"                 4 退出软件"</span>)</span><br><span class="line">		fmt.Println(<span class="string">"请选择（1-4）："</span>)</span><br><span class="line"></span><br><span class="line">		fmt.Scanln(&amp;key)</span><br><span class="line"></span><br><span class="line">		<span class="keyword">switch</span> key &#123;</span><br><span class="line">		<span class="keyword">case</span> <span class="string">"1"</span>:</span><br><span class="line">			fmt.Println(<span class="string">"----------------当前收支明细-----------------"</span>)</span><br><span class="line">		<span class="keyword">case</span> <span class="string">"2"</span>:</span><br><span class="line">		<span class="keyword">case</span> <span class="string">"3"</span>:</span><br><span class="line">			fmt.Println(<span class="string">"登记支出。。"</span>)</span><br><span class="line">		<span class="keyword">case</span> <span class="string">"4"</span>:</span><br><span class="line">			loop = <span class="literal">false</span></span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">			fmt.Println(<span class="string">"请输入正确的选项。。"</span>)</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> !loop &#123;</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(<span class="string">"你退出了家庭记账软件的使用"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">----------------家庭收支记账软件-----------------</span><br><span class="line">                 1 收入明细</span><br><span class="line">                 2 登记收入</span><br><span class="line">                 3 登记支出</span><br><span class="line">                 4 退出软件</span><br><span class="line">请选择（1-4）：</span><br><span class="line">1</span><br><span class="line">----------------当前收支明细-----------------</span><br><span class="line">----------------家庭收支记账软件-----------------</span><br><span class="line">                 1 收入明细</span><br><span class="line">                 2 登记收入</span><br><span class="line">                 3 登记支出</span><br><span class="line">                 4 退出软件</span><br><span class="line">请选择（1-4）：</span><br><span class="line">2</span><br><span class="line">----------------家庭收支记账软件-----------------</span><br><span class="line">                 1 收入明细</span><br><span class="line">                 2 登记收入</span><br><span class="line">                 3 登记支出</span><br><span class="line">                 4 退出软件</span><br><span class="line">请选择（1-4）：</span><br><span class="line">4</span><br><span class="line">你退出了家庭记账软件的使用</span><br></pre></td></tr></table></figure>

<h3 id="12-4-2-功能2-完成可以显示明细和登记收入的功能"><a href="#12-4-2-功能2-完成可以显示明细和登记收入的功能" class="headerlink" title="12.4.2 功能2 完成可以显示明细和登记收入的功能"></a>12.4.2 功能2 完成可以显示明细和登记收入的功能</h3><p>思路分析：</p>
<ol>
<li><p>因为需要显示明细，我们定义一个变量details string来记录</p>
</li>
<li><p>还需要定义变量来记录余额(balance)、每次收支的金额(money)、每次收支的说明(note)</p>
</li>
</ol>
<p>新增代码</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义账户余额</span></span><br><span class="line"><span class="keyword">var</span> balance <span class="keyword">float64</span> = <span class="number">10000.0</span></span><br><span class="line"><span class="comment">// 每次收支的金额</span></span><br><span class="line"><span class="keyword">var</span> money <span class="keyword">float64</span> = <span class="number">0.0</span></span><br><span class="line"><span class="comment">// 每次收支的说明</span></span><br><span class="line"><span class="keyword">var</span> note <span class="keyword">string</span> = <span class="string">""</span></span><br><span class="line"><span class="comment">// 收支的一个详情，字符串来记录</span></span><br><span class="line"><span class="comment">// 当有收支是，只需要对details进行拼接处理即可</span></span><br><span class="line"><span class="keyword">var</span> details <span class="keyword">string</span> = <span class="string">"收支\t账户金额\t收支金额\t说    明"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="string">"2"</span>:</span><br><span class="line">	fmt.Println(<span class="string">"本次收入金额："</span>)</span><br><span class="line">	fmt.Scanln(&amp;money)</span><br><span class="line">	balance += money</span><br><span class="line">	fmt.Println(<span class="string">"本次收入说明："</span>)</span><br><span class="line">	fmt.Scanln(&amp;note)</span><br><span class="line">	<span class="comment">// 将这个收入情况拼接到details变量</span></span><br><span class="line">	details += fmt.Sprintf(<span class="string">"\n收入\t%v\t\t%v\t\t%v"</span>, balance, money, note)</span><br></pre></td></tr></table></figure>

<h3 id="12-4-2-功能3-完成可以登记支出的功能"><a href="#12-4-2-功能3-完成可以登记支出的功能" class="headerlink" title="12.4.2 功能3 完成可以登记支出的功能"></a>12.4.2 功能3 完成可以登记支出的功能</h3><p>思路分析：<br>登记支出的功能和登记收入的功能类型，做些修改即可</p>
<p>新增代码</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">fmt.Println(<span class="string">"本次支出金额："</span>)</span><br><span class="line">			fmt.Scanln(&amp;money)</span><br><span class="line"></span><br><span class="line">			<span class="comment">// 这里需要做一个必要的判断</span></span><br><span class="line">			<span class="keyword">if</span> money &gt; balance &#123;</span><br><span class="line">				fmt.Println(<span class="string">"余额不足"</span>)</span><br><span class="line">				<span class="keyword">break</span></span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				balance -= money</span><br><span class="line">			&#125;</span><br><span class="line">			fmt.Println(<span class="string">"本次支出说明："</span>)</span><br><span class="line">			fmt.Scanln(&amp;note)</span><br><span class="line">			<span class="comment">// 将这个收入情况拼接到details变量</span></span><br><span class="line">			details += fmt.Sprintf(<span class="string">"\n支出\t%v\t\t%v\t\t%v"</span>, balance, money, note)</span><br></pre></td></tr></table></figure>

<h3 id="12-4-2-项目代码实现改进"><a href="#12-4-2-项目代码实现改进" class="headerlink" title="12.4.2 项目代码实现改进"></a>12.4.2 项目代码实现改进</h3><ol>
<li><p>用户输入4退出时，给出提示“你确定要退出吗？y/n”，必须输入正确y/n，否则循环输入指令，知道输入y或者n。<br>新增代码</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="string">"4"</span>:</span><br><span class="line">	fmt.Println(<span class="string">"你确定要退出吗？y/n"</span>)</span><br><span class="line">	chioce := <span class="string">""</span></span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		fmt.Scanln(&amp;chioce)</span><br><span class="line">		<span class="keyword">if</span> chioce == <span class="string">"y"</span> || chioce == <span class="string">"n"</span> &#123;</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		&#125;</span><br><span class="line">		fmt.Println(<span class="string">"你的输入有误，请重新输入"</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> chioce == <span class="string">"y"</span> &#123;</span><br><span class="line">		loop = <span class="literal">false</span></span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>当没有任何收支明细是，提示“当前没有收支明细…来一笔吧！”<br>新增代码：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义一个变量，记录是否有收支的行为</span></span><br><span class="line">flag := <span class="literal">false</span></span><br><span class="line"><span class="keyword">case</span> <span class="string">"1"</span>:</span><br><span class="line">	<span class="keyword">if</span> flag == <span class="literal">true</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"----------------当前收支明细-----------------"</span>)</span><br><span class="line">		fmt.Println(details)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"----------------当前收支明细-----------------"</span>)</span><br><span class="line">		fmt.Println(<span class="string">"当前没有收支明细...来一笔吧！"</span>)</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>将面向过程的代码修改成面向对象的方法<br>思路分析：<br>把记账软件的功能，封装到一个结构体中，然后调用该结构体的方法，来实现记账、显示明细。结构体的名字FamilyAccount。</p>
<p> 再通过在main方法中，创建一个结构体FamilyAccount示例，实现记账即可</p>
<p> 代码实现：<br> 代码并不需要重写，只需要重写组织一下即可</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">文件结构</span><br><span class="line">familyaccount</span><br><span class="line">├─main</span><br><span class="line">│   main.go</span><br><span class="line">└─utils</span><br><span class="line">    familyaccount.go</span><br></pre></td></tr></table></figure>

 <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.go</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"gocode/project12/familyaccount/utils"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">"这个是面向对象的方式完成~"</span>)</span><br><span class="line">	utils.NewFamilyAccount().MainMenu()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

 <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// familyaccount.go</span></span><br><span class="line"><span class="keyword">package</span> utils</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> FamilyAccount <span class="keyword">struct</span> &#123;</span><br><span class="line">	<span class="comment">// 声明必要的字段</span></span><br><span class="line">	<span class="comment">// 声明一个字段，保存接收用户输入的选项</span></span><br><span class="line">	key <span class="keyword">string</span></span><br><span class="line">	<span class="comment">// 声明一个字段，控制是否退出for循环</span></span><br><span class="line">	loop <span class="keyword">bool</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 定义账户余额</span></span><br><span class="line">	balance <span class="keyword">float64</span></span><br><span class="line">	<span class="comment">// 每次收支的金额</span></span><br><span class="line">	money <span class="keyword">float64</span></span><br><span class="line">	<span class="comment">// 每次收支的说明</span></span><br><span class="line">	note <span class="keyword">string</span></span><br><span class="line">	<span class="comment">// 定义一个字段，记录是否有收支的行为</span></span><br><span class="line">	flag <span class="keyword">bool</span></span><br><span class="line">	<span class="comment">// 收支的一个详情，字符串来记录</span></span><br><span class="line">	<span class="comment">// 当有收支是，只需要对details进行拼接处理即可</span></span><br><span class="line">	details <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 编写一个工厂模式的构造方法，返回一个*FamilyAccout实例</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewFamilyAccount</span><span class="params">()</span> *<span class="title">FamilyAccount</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> &amp;FamilyAccount&#123;</span><br><span class="line">		key:     <span class="string">""</span>,</span><br><span class="line">		loop:    <span class="literal">true</span>,</span><br><span class="line">		balance: <span class="number">10000.0</span>,</span><br><span class="line">		money:   <span class="number">0.0</span>,</span><br><span class="line">		note:    <span class="string">""</span>,</span><br><span class="line">		flag:    <span class="literal">false</span>,</span><br><span class="line">		details: <span class="string">"收支\t账户金额\t收支金额\t说    明"</span>,</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将显示明细写成一个方法</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *FamilyAccount)</span> <span class="title">showDetails</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> this.flag == <span class="literal">true</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"----------------当前收支明细-----------------"</span>)</span><br><span class="line">		fmt.Println(this.details)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"----------------当前收支明细-----------------"</span>)</span><br><span class="line">		fmt.Println(<span class="string">"当前没有收支明细...来一笔吧！"</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将登记收入写成一个方法，和*FamilyAccout绑定</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *FamilyAccount)</span> <span class="title">income</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Printf(<span class="string">"本次收入金额："</span>)</span><br><span class="line">	fmt.Scanln(&amp;this.money)</span><br><span class="line">	this.balance += this.money</span><br><span class="line">	fmt.Printf(<span class="string">"本次收入说明："</span>)</span><br><span class="line">	fmt.Scanln(&amp;this.note)</span><br><span class="line">	<span class="comment">// 将这个收入情况拼接到details变量</span></span><br><span class="line">	this.details += fmt.Sprintf(<span class="string">"\n收入\t%v\t\t%v\t\t%v"</span>, this.balance, this.money, this.note)</span><br><span class="line">	this.flag = <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将登记支出也写成一个方法，和*FamilyAccount绑定</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *FamilyAccount)</span> <span class="title">pay</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">"本次支出金额："</span>)</span><br><span class="line">	fmt.Scanln(&amp;this.money)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 这里需要做一个必要的判断</span></span><br><span class="line">	<span class="keyword">if</span> this.money &gt; this.balance &#123;</span><br><span class="line">		fmt.Println(<span class="string">"余额不足"</span>)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		this.balance -= this.money</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(<span class="string">"本次支出说明："</span>)</span><br><span class="line">	fmt.Scanln(&amp;this.note)</span><br><span class="line">	<span class="comment">// 将这个收入情况拼接到details变量</span></span><br><span class="line">	this.details += fmt.Sprintf(<span class="string">"\n支出\t%v\t\t%v\t\t%v"</span>, this.balance, this.money, this.note)</span><br><span class="line">	this.flag = <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将退出系统也写成一个方法，和*FamilyAccount绑定</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *FamilyAccount)</span> <span class="title">exit</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">"你确定要退出吗？y/n"</span>)</span><br><span class="line">	chioce := <span class="string">""</span></span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		fmt.Scanln(&amp;chioce)</span><br><span class="line">		<span class="keyword">if</span> chioce == <span class="string">"y"</span> || chioce == <span class="string">"n"</span> &#123;</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		&#125;</span><br><span class="line">		fmt.Println(<span class="string">"你的输入有误，请重新输入"</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> chioce == <span class="string">"y"</span> &#123;</span><br><span class="line">		this.loop = <span class="literal">false</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 给该结构体绑定相应的方法</span></span><br><span class="line"><span class="comment">// 显示主菜单</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *FamilyAccount)</span> <span class="title">MainMenu</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"\n----------------家庭收支记账软件-----------------"</span>)</span><br><span class="line">		fmt.Println(<span class="string">"                 1 收入明细"</span>)</span><br><span class="line">		fmt.Println(<span class="string">"                 2 登记收入"</span>)</span><br><span class="line">		fmt.Println(<span class="string">"                 3 登记支出"</span>)</span><br><span class="line">		fmt.Println(<span class="string">"                 4 退出软件"</span>)</span><br><span class="line">		fmt.Println(<span class="string">"请选择（1-4）："</span>)</span><br><span class="line"></span><br><span class="line">		fmt.Scanln(&amp;this.key)</span><br><span class="line"></span><br><span class="line">		<span class="keyword">switch</span> this.key &#123;</span><br><span class="line">		<span class="keyword">case</span> <span class="string">"1"</span>:</span><br><span class="line">			this.showDetails()</span><br><span class="line">		<span class="keyword">case</span> <span class="string">"2"</span>:</span><br><span class="line">			this.income()</span><br><span class="line">		<span class="keyword">case</span> <span class="string">"3"</span>:</span><br><span class="line">			this.pay()</span><br><span class="line">		<span class="keyword">case</span> <span class="string">"4"</span>:</span><br><span class="line">			this.exit()</span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">			fmt.Println(<span class="string">"请输入正确的选项。。"</span>)</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> !this.loop &#123;</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(<span class="string">"你退出了家庭记账软件的使用"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h1 id="13-项目2-客户信息管理系统"><a href="#13-项目2-客户信息管理系统" class="headerlink" title="13 项目2-客户信息管理系统"></a>13 项目2-客户信息管理系统</h1><h2 id="13-1-项目需求分析"><a href="#13-1-项目需求分析" class="headerlink" title="13.1 项目需求分析"></a>13.1 项目需求分析</h2><ol>
<li>模拟实现一个基于文本界面的《客户信息管理软件》</li>
<li>该软件能够实现对客户对象的插入、修改和删除（用切片实现），并能够打印客户明细表</li>
</ol>
<h2 id="13-2-项目的界面设计"><a href="#13-2-项目的界面设计" class="headerlink" title="13.2 项目的界面设计"></a>13.2 项目的界面设计</h2><h2 id="13-3-程序框架图的设计"><a href="#13-3-程序框架图的设计" class="headerlink" title="13.3 程序框架图的设计"></a>13.3 程序框架图的设计</h2><p>客户关系管理的程序框架图</p>
<p><code>第三个实现</code><br>customerView.go【界面】v</p>
<ol>
<li>可以显示界面</li>
<li>可以接收用户的输入</li>
<li>根据用户的输入完成客户的管理【修改、删除、显示等等】，它是调用customerService.go来实现的</li>
<li>含customerService字段</li>
</ol>
<p><code>第二个实现</code><br>customerService.go【处理业务逻辑】</p>
<ol>
<li>完成对客户的各种操作</li>
<li>对客户的增、删除、修改、显示</li>
<li>会声明customer的切片</li>
</ol>
<p><code>第一个实现</code><br>customer.go【表示数据】model层</p>
<ol>
<li>表示一个客户</li>
<li>客户各种字段<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Customerstruct&#123;</span><br><span class="line">	Id     <span class="keyword">int</span></span><br><span class="line">	Name   <span class="keyword">string</span></span><br><span class="line">	Gender <span class="keyword">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="13-4-项目功能实现-显示主菜单和完成退出软件功能"><a href="#13-4-项目功能实现-显示主菜单和完成退出软件功能" class="headerlink" title="13.4 项目功能实现-显示主菜单和完成退出软件功能"></a>13.4 项目功能实现-显示主菜单和完成退出软件功能</h2><ul>
<li><p>功能说明<br>当用户运行程序时，可以看到主菜单，当输入5是，可以退出该软件</p>
</li>
<li><p>思路分析<br>编写customerView.go，另外可以吧customer.go和customerService.go写上</p>
</li>
<li><p>代码实现</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">文件结构：</span><br><span class="line">customerManager</span><br><span class="line">├─model</span><br><span class="line">│   customer.go</span><br><span class="line">├─service</span><br><span class="line">│   customerService.go</span><br><span class="line">└─view</span><br><span class="line">    customerView.go</span><br></pre></td></tr></table></figure>

  <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// customer.go</span></span><br><span class="line"><span class="keyword">package</span> model</span><br><span class="line"></span><br><span class="line"><span class="comment">// 声明一个customer结构体，表示一个客户信息</span></span><br><span class="line"><span class="keyword">type</span> Customer <span class="keyword">struct</span> &#123;</span><br><span class="line">	Id     <span class="keyword">int</span></span><br><span class="line">	Name   <span class="keyword">string</span></span><br><span class="line">	Gender <span class="keyword">string</span></span><br><span class="line">	Age    <span class="keyword">int</span></span><br><span class="line">	Phone  <span class="keyword">string</span></span><br><span class="line">	Email  <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 编写一个工厂模式，返回一个customer的实力</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewCustomer</span><span class="params">(id <span class="keyword">int</span>, name <span class="keyword">string</span>, gender <span class="keyword">string</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">	age <span class="keyword">int</span>, phone <span class="keyword">string</span>, email <span class="keyword">string</span>)</span> <span class="title">Customer</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> Customer&#123;</span><br><span class="line">		Id:     id,</span><br><span class="line">		Name:   name,</span><br><span class="line">		Gender: gender,</span><br><span class="line">		Age:    age,</span><br><span class="line">		Phone:  phone,</span><br><span class="line">		Email:  email,</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

  <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// customerService.go</span></span><br><span class="line"><span class="keyword">package</span> service</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"gocode/project12/customerManager/model"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 该CustomerService，完成对Customer的操作，包括</span></span><br><span class="line"><span class="comment">// 增删改查</span></span><br><span class="line"><span class="keyword">type</span> CustomerService <span class="keyword">struct</span> &#123;</span><br><span class="line">	customers []model.Customer</span><br><span class="line">	<span class="comment">// 声明一个字段，表示当前切片含有多少个客户</span></span><br><span class="line">	<span class="comment">// 该字段后面，还可以作为新字段的编号id+1</span></span><br><span class="line">	customerNum <span class="keyword">int</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

  <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// customerView.go</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> customerView <span class="keyword">struct</span> &#123;</span><br><span class="line">	<span class="comment">// 定义必要的字段</span></span><br><span class="line">	key  <span class="keyword">string</span> <span class="comment">// 接收用户的输入</span></span><br><span class="line">	loop <span class="keyword">bool</span>   <span class="comment">// 表示是否循环显示菜单</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 显示主菜单</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *customerView)</span> <span class="title">mainMenu</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"\n----------------客户信息管理软件-----------------"</span>)</span><br><span class="line">		fmt.Println(<span class="string">"                 1 添加客户"</span>)</span><br><span class="line">		fmt.Println(<span class="string">"                 2 修改客户"</span>)</span><br><span class="line">		fmt.Println(<span class="string">"                 3 删除客户"</span>)</span><br><span class="line">		fmt.Println(<span class="string">"                 4 客户列表"</span>)</span><br><span class="line">		fmt.Println(<span class="string">"                 5 退    出"</span>)</span><br><span class="line">		fmt.Println(<span class="string">"请选择（1-5）："</span>)</span><br><span class="line"></span><br><span class="line">		fmt.Scanln(&amp;this.key)</span><br><span class="line"></span><br><span class="line">		<span class="keyword">switch</span> this.key &#123;</span><br><span class="line">		<span class="keyword">case</span> <span class="string">"1"</span>:</span><br><span class="line">			fmt.Println(<span class="string">"添 加 客 户"</span>)</span><br><span class="line">		<span class="keyword">case</span> <span class="string">"2"</span>:</span><br><span class="line">			fmt.Println(<span class="string">"修 改 客 户"</span>)</span><br><span class="line">		<span class="keyword">case</span> <span class="string">"3"</span>:</span><br><span class="line">			fmt.Println(<span class="string">"删 除 客 户"</span>)</span><br><span class="line">		<span class="keyword">case</span> <span class="string">"4"</span>:</span><br><span class="line">			fmt.Println(<span class="string">"客 户 列 表"</span>)</span><br><span class="line">		<span class="keyword">case</span> <span class="string">"5"</span>:</span><br><span class="line">			this.loop = <span class="literal">false</span></span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">			fmt.Println(<span class="string">"你的输入有误，请重新输入..."</span>)</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> !this.loop &#123;</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	fmt.Println(<span class="string">"你退出了客户关系管理系统"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 在主函数中，创建一个customer实例，并运行显示主菜单</span></span><br><span class="line">	customerView := customerView&#123;</span><br><span class="line">		key:  <span class="string">""</span>,</span><br><span class="line">		loop: <span class="literal">true</span>,</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	customerView.mainMenu()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="13-5-项目功能实现-完成显示客户列表的功能"><a href="#13-5-项目功能实现-完成显示客户列表的功能" class="headerlink" title="13.5 项目功能实现-完成显示客户列表的功能"></a>13.5 项目功能实现-完成显示客户列表的功能</h2><ul>
<li><p>功能说明</p>
</li>
<li><p>思路分析</p>
<ol>
<li>customerView.go【界面】<br> 编写一个方法list去调用customerSer的List方法，并显示客户列表 </li>
<li>customerService.go【业务逻辑】<br> 显示客户列表<ul>
<li>编写方法List【返回客户信息，其实就是切片】</li>
<li>编写NewCustomerService返回一个customerService实例 </li>
</ul>
</li>
<li>customer.go【数据】<br> 写一个方法，返回用户的信息</li>
</ol>
</li>
<li><p>新增代码</p>
  <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// customer.go</span></span><br><span class="line"><span class="comment">// 返回格式化后的字符串</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this Customer)</span> <span class="title">GetInfo</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">	info := fmt.Sprintf(<span class="string">"%v\t%v\t%v\t%v\t%v\t%v\t"</span>, this.Id, this.Name,</span><br><span class="line">		this.Gender, this.Age, this.Phone, this.Email)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> info</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

  <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// customerService.go</span></span><br><span class="line"><span class="comment">// 编写一个方法，可以返回CustomerSer</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewCustomerService</span><span class="params">()</span> *<span class="title">CustomerService</span></span> &#123;</span><br><span class="line">	<span class="comment">// 为了能够看到有客户在切片中，我们初始化一个客户</span></span><br><span class="line">	customerService := &amp;CustomerService&#123;&#125;</span><br><span class="line">	customerService.customerNum = <span class="number">1</span></span><br><span class="line">	customer := model.NewCustomer(<span class="number">1</span>, <span class="string">"张三"</span>, <span class="string">"男"</span>, <span class="number">20</span>, <span class="string">"112"</span>, <span class="string">"zs@sohu.com"</span>)</span><br><span class="line">	customerService.customers = <span class="built_in">append</span>(customerService.customers, customer)</span><br><span class="line">	<span class="keyword">return</span> customerService</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 返回客户切片</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *CustomerService)</span> <span class="title">List</span><span class="params">()</span> []<span class="title">model</span>.<span class="title">Customer</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> this.customers</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

  <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// customerView.go</span></span><br><span class="line"><span class="keyword">type</span> customerView <span class="keyword">struct</span> &#123;</span><br><span class="line">	<span class="comment">// 定义必要的字段</span></span><br><span class="line">	key  <span class="keyword">string</span> <span class="comment">// 接收用户的输入</span></span><br><span class="line">	loop <span class="keyword">bool</span>   <span class="comment">// 表示是否循环显示菜单</span></span><br><span class="line">	<span class="comment">// 增加一个字段customerService</span></span><br><span class="line">	customnerService *service.CustomerService</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 显示所有的客户信息</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *customerView)</span> <span class="title">list</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 首先获取当前所有的客户信息</span></span><br><span class="line">	customers := this.customnerService.List()</span><br><span class="line">	<span class="comment">// 显示</span></span><br><span class="line">	fmt.Println(<span class="string">"-------------------客户列表-------------------"</span>)</span><br><span class="line">	fmt.Println(<span class="string">"编号\t姓名\t性别\t年龄\t电话\t邮箱"</span>)</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(customers); i++ &#123;</span><br><span class="line">		fmt.Println(customers[i].GetInfo())</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(<span class="string">"-----------------客户列表完成-----------------\n\n"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="string">"4"</span>:</span><br><span class="line">	this.list()</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="13-6-项目功能实现-添加客户的功能"><a href="#13-6-项目功能实现-添加客户的功能" class="headerlink" title="13.6 项目功能实现-添加客户的功能"></a>13.6 项目功能实现-添加客户的功能</h2><ul>
<li><p>功能说明</p>
</li>
<li><p>思路分析</p>
<ol>
<li>customerView.go【界面】<br> add方法去调用customerService的Add方法，完成客户添加</li>
<li>customerService.go【业务逻辑】<br> 添加客户<ul>
<li>编写方法Add将新的客户加到customer切片</li>
</ul>
</li>
<li>customer.go【数据】</li>
</ol>
</li>
<li><p>新增代码</p>
  <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// customer.go</span></span><br><span class="line"><span class="comment">// 第二种创建Customer实例方法，不带id</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewCustomer2</span><span class="params">(name <span class="keyword">string</span>, gender <span class="keyword">string</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">	age <span class="keyword">int</span>, phone <span class="keyword">string</span>, email <span class="keyword">string</span>)</span> <span class="title">Customer</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> Customer&#123;</span><br><span class="line">		Name:   name,</span><br><span class="line">		Gender: gender,</span><br><span class="line">		Age:    age,</span><br><span class="line">		Phone:  phone,</span><br><span class="line">		Email:  email,</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

  <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// customerService.go</span></span><br><span class="line"><span class="comment">// 添加客户到customers切片</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *CustomerService)</span> <span class="title">Add</span><span class="params">(customer model.Customer)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">	<span class="comment">// 我们确定一个id添加的规则，就是添加的顺序</span></span><br><span class="line">	this.customerNum++</span><br><span class="line">	customer.Id = this.customerNum</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	this.customers = <span class="built_in">append</span>(this.customers, customer)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

  <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// customerView.go</span></span><br><span class="line"><span class="comment">// 得到用户的数据、信息构建新用户，并完成添加</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *customerView)</span> <span class="title">add</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">"-------------------添加客户---------------------"</span>)</span><br><span class="line">	fmt.Println(<span class="string">"姓名："</span>)</span><br><span class="line">	name := <span class="string">""</span></span><br><span class="line">	fmt.Scanln(&amp;name)</span><br><span class="line">	fmt.Println(<span class="string">"性别"</span>)</span><br><span class="line">	gender := <span class="string">""</span></span><br><span class="line">	fmt.Scanln(&amp;gender)</span><br><span class="line">	fmt.Println(<span class="string">"年龄"</span>)</span><br><span class="line">	age := <span class="number">0</span></span><br><span class="line">	fmt.Scanln(&amp;age)</span><br><span class="line">	fmt.Println(<span class="string">"电话"</span>)</span><br><span class="line">	phone := <span class="string">""</span></span><br><span class="line">	fmt.Scanln(&amp;phone)</span><br><span class="line">	fmt.Println(<span class="string">"邮箱"</span>)</span><br><span class="line">	email := <span class="string">""</span></span><br><span class="line">	fmt.Scanln(&amp;email)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 构建一个新的customer实例</span></span><br><span class="line">	<span class="comment">// id号唯一，由系统指定</span></span><br><span class="line">	customer := model.NewCustomer2(name, gender, age, phone, email)</span><br><span class="line">	<span class="keyword">if</span> this.customnerService.Add(customer) &#123;</span><br><span class="line">		fmt.Println(<span class="string">"-------------------添加完成---------------------"</span>)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"-------------------添加失败---------------------"</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="string">"1"</span>:</span><br><span class="line">	this.add()</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="13-7-项目功能实现-完成删除客户的功能"><a href="#13-7-项目功能实现-完成删除客户的功能" class="headerlink" title="13.7 项目功能实现-完成删除客户的功能"></a>13.7 项目功能实现-完成删除客户的功能</h2><ul>
<li><p>功能说明<br>  用户输入用户编号，进行判断后删除</p>
</li>
<li><p>思路分析</p>
<ol>
<li>customerView.go【界面】<br> delet方法，调用customerService的Delet方法，完成客户删除</li>
<li>customerService.go【业务逻辑】<br> 编写方法Delet(id int)删除一个客户<br> 编写方法FindById(id int)返回id号队员的切片的下标</li>
<li>customer.go【数据】</li>
</ol>
</li>
<li><p>新增代码</p>
  <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// customerService.go</span></span><br><span class="line"><span class="comment">// 根据id删除客户（从切片中删除）</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *CustomerService)</span> <span class="title">Delete</span><span class="params">(id <span class="keyword">int</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">	index := this.FindById(id)</span><br><span class="line">	<span class="comment">// 如果index == -1，说明没有这个客户</span></span><br><span class="line">	<span class="keyword">if</span> index == <span class="number">-1</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 如何从切片中删除一个元素</span></span><br><span class="line">	this.customers = <span class="built_in">append</span>(this.customers[:index],</span><br><span class="line">		this.customers[index+<span class="number">1</span>:]...)</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 根据id查找客户在切片中对应下标，如果没有该客户，返回-1</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *CustomerService)</span> <span class="title">FindById</span><span class="params">(id <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">	index := <span class="number">-1</span></span><br><span class="line">	<span class="comment">// 遍历this.customers切片</span></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(this.customers); i++ &#123;</span><br><span class="line">		<span class="keyword">if</span> this.customers[i].Id == id &#123;</span><br><span class="line">			<span class="comment">// 找到</span></span><br><span class="line">			index = i</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> index</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

  <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// customerView.go</span></span><br><span class="line"><span class="comment">// 得到用户的输入id，删除该id对应的客户</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *customerView)</span> <span class="title">delete</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">"-------------------删除客户---------------------"</span>)</span><br><span class="line">	fmt.Println(<span class="string">"请选择删除客户编号（-1退出）："</span>)</span><br><span class="line">	id := <span class="number">01</span></span><br><span class="line">	fmt.Scanln(&amp;id)</span><br><span class="line">	<span class="keyword">if</span> id == <span class="number">-1</span> &#123;</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">		<span class="comment">// 放弃删除</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	fmt.Println(<span class="string">"确认删除请输入（Y/N）："</span>)</span><br><span class="line">	choice := <span class="string">""</span></span><br><span class="line">	fmt.Scanln(&amp;choice)</span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> choice == <span class="string">"y"</span> || choice == <span class="string">"Y"</span> &#123;</span><br><span class="line">			<span class="comment">// 调用customerService的Delete方法</span></span><br><span class="line">			<span class="keyword">if</span> this.customnerService.Delete(id) &#123;</span><br><span class="line">				fmt.Println(<span class="string">"-------------------删除完成---------------------"</span>)</span><br><span class="line">				<span class="keyword">return</span></span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				fmt.Println(<span class="string">"-----------删除失败，输入的id号不存在------------"</span>)</span><br><span class="line">				<span class="keyword">return</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> choice == <span class="string">"n"</span> || choice == <span class="string">"N"</span> &#123;</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="13-8-项目功能实现-完善退出确认功能"><a href="#13-8-项目功能实现-完善退出确认功能" class="headerlink" title="13.8 项目功能实现-完善退出确认功能"></a>13.8 项目功能实现-完善退出确认功能</h2><ul>
<li>功能说明</li>
<li>思路分析<br>  需要编写customerView.go【界面】</li>
<li>新增代码  <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// customerView.go</span></span><br><span class="line"><span class="comment">// 退出菜单</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *customerView)</span> <span class="title">exit</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		choice := <span class="string">""</span></span><br><span class="line">		fmt.Println(<span class="string">"确认是否退出（Y/N）："</span>)</span><br><span class="line">		fmt.Scanln(&amp;choice)</span><br><span class="line">		<span class="keyword">if</span> choice == <span class="string">"y"</span> || choice == <span class="string">"Y"</span> &#123;</span><br><span class="line">			this.loop = <span class="literal">false</span></span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> choice == <span class="string">"n"</span> || choice == <span class="string">"N"</span> &#123;</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="string">"5"</span>:</span><br><span class="line">	this.exit()</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="13-9-项目功能实现-完成修改客户的功能"><a href="#13-9-项目功能实现-完成修改客户的功能" class="headerlink" title="13.9 项目功能实现-完成修改客户的功能"></a>13.9 项目功能实现-完成修改客户的功能</h2><ul>
<li><p>功能说明</p>
</li>
<li><p>思路分析</p>
<ol>
<li>customerView.go<br> update方法调用customerService的Update方法，完成客户修改</li>
<li>customerView.go<br> 编写一个Update(..)方法</li>
</ol>
</li>
<li><p>新增代码</p>
  <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// customer.go</span></span><br><span class="line"><span class="comment">// Get方法，用于获取各字段的值</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *Customer)</span> <span class="title">GetName</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> this.Name</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *Customer)</span> <span class="title">GetGender</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> this.Gender</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *Customer)</span> <span class="title">GetAge</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> this.Age</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *Customer)</span> <span class="title">GetPhone</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> this.Phone</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *Customer)</span> <span class="title">GetEmail</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> this.Email</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Set方法，用于设置各字段的值</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *Customer)</span> <span class="title">SetName</span><span class="params">(name <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> name != <span class="string">""</span> &#123;</span><br><span class="line">		this.Name = name</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *Customer)</span> <span class="title">SetGender</span><span class="params">(gender <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> gender != <span class="string">""</span> &#123;</span><br><span class="line">		this.Gender = gender</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *Customer)</span> <span class="title">SetAge</span><span class="params">(age <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> age &gt; <span class="number">0</span> &amp;&amp; age &lt;= <span class="number">120</span> &#123;</span><br><span class="line">		this.Age = age</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *Customer)</span> <span class="title">SetPhone</span><span class="params">(phone <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> phone != <span class="string">""</span> &#123;</span><br><span class="line">		this.Phone = phone</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *Customer)</span> <span class="title">SetEmail</span><span class="params">(email <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> email != <span class="string">""</span> &#123;</span><br><span class="line">		this.Email = email</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

  <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// customerService.go</span></span><br><span class="line"><span class="comment">// 修改客户信息，成功返回true，失败返回false</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *CustomerService)</span> <span class="title">Update</span><span class="params">(name <span class="keyword">string</span>, gender <span class="keyword">string</span>, age <span class="keyword">int</span>, phone <span class="keyword">string</span>, email <span class="keyword">string</span>, customer *model.Customer)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">	customer.SetName(name)</span><br><span class="line">	customer.SetGender(gender)</span><br><span class="line">	customer.SetAge(age)</span><br><span class="line">	customer.SetPhone(phone)</span><br><span class="line">	customer.SetEmail(email)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

  <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// customerView.go</span></span><br><span class="line"><span class="comment">// 修改客户</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *customerView)</span> <span class="title">update</span><span class="params">()</span></span> &#123;</span><br><span class="line">	customerNo := <span class="number">0</span></span><br><span class="line">	fmt.Println(<span class="string">"请选择待修改客户编号（-1退出）："</span>)</span><br><span class="line">	fmt.Scanln(&amp;customerNo)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> customerNo == <span class="number">-1</span> &#123;</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		customerNo = this.customnerService.FindById(customerNo)</span><br><span class="line">		<span class="keyword">if</span> customerNo != <span class="number">-1</span> &#123;</span><br><span class="line">			customer := this.customnerService.List()</span><br><span class="line">			name := <span class="string">""</span></span><br><span class="line">			fmt.Printf(<span class="string">"姓名（%v）："</span>, customer[customerNo].GetName())</span><br><span class="line">			fmt.Scanln(&amp;name)</span><br><span class="line">			gender := <span class="string">""</span></span><br><span class="line">			fmt.Printf(<span class="string">"性别（%v）："</span>, customer[customerNo].GetGender())</span><br><span class="line">			fmt.Scanln(&amp;gender)</span><br><span class="line">			age := <span class="number">0</span></span><br><span class="line">			fmt.Printf(<span class="string">"年龄（%d）："</span>, customer[customerNo].GetAge())</span><br><span class="line">			fmt.Scanln(&amp;age)</span><br><span class="line">			phone := <span class="string">""</span></span><br><span class="line">			fmt.Printf(<span class="string">"电话（%v）："</span>, customer[customerNo].GetPhone())</span><br><span class="line">			fmt.Scanln(&amp;phone)</span><br><span class="line">			email := <span class="string">""</span></span><br><span class="line">			fmt.Printf(<span class="string">"邮箱（%v）："</span>, customer[customerNo].GetEmail())</span><br><span class="line">			fmt.Scanln(&amp;email)</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span> this.customnerService.Update(name, gender, age, phone, email, &amp;customer[customerNo]) &#123;</span><br><span class="line">				fmt.Println(<span class="string">"-------------------修改成功---------------------"</span>)</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				fmt.Println(<span class="string">"-------------------修改失败---------------------"</span>)</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			fmt.Println(<span class="string">"------------------没有该Id的用户。--------------------"</span>)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="13-10-项目完整代码"><a href="#13-10-项目完整代码" class="headerlink" title="13.10 项目完整代码"></a>13.10 项目完整代码</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">文件结构：</span><br><span class="line">customerManager</span><br><span class="line">├─model</span><br><span class="line">│   customer.go</span><br><span class="line">├─service</span><br><span class="line">│   customerService.go</span><br><span class="line">└─view</span><br><span class="line">    customerView.go</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// customer.go</span></span><br><span class="line"><span class="keyword">package</span> model</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 声明一个customer结构体，表示一个客户信息</span></span><br><span class="line"><span class="keyword">type</span> Customer <span class="keyword">struct</span> &#123;</span><br><span class="line">	Id     <span class="keyword">int</span></span><br><span class="line">	Name   <span class="keyword">string</span></span><br><span class="line">	Gender <span class="keyword">string</span></span><br><span class="line">	Age    <span class="keyword">int</span></span><br><span class="line">	Phone  <span class="keyword">string</span></span><br><span class="line">	Email  <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 编写一个工厂模式，返回一个customer的实例</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewCustomer</span><span class="params">(id <span class="keyword">int</span>, name <span class="keyword">string</span>, gender <span class="keyword">string</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">	age <span class="keyword">int</span>, phone <span class="keyword">string</span>, email <span class="keyword">string</span>)</span> <span class="title">Customer</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> Customer&#123;</span><br><span class="line">		Id:     id,</span><br><span class="line">		Name:   name,</span><br><span class="line">		Gender: gender,</span><br><span class="line">		Age:    age,</span><br><span class="line">		Phone:  phone,</span><br><span class="line">		Email:  email,</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 第二种创建Customer实例方法，不带id</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewCustomer2</span><span class="params">(name <span class="keyword">string</span>, gender <span class="keyword">string</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">	age <span class="keyword">int</span>, phone <span class="keyword">string</span>, email <span class="keyword">string</span>)</span> <span class="title">Customer</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> Customer&#123;</span><br><span class="line">		Name:   name,</span><br><span class="line">		Gender: gender,</span><br><span class="line">		Age:    age,</span><br><span class="line">		Phone:  phone,</span><br><span class="line">		Email:  email,</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 返回格式化后的字符串</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this Customer)</span> <span class="title">GetInfo</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">	info := fmt.Sprintf(<span class="string">"%v\t%v\t%v\t%v\t%v\t%v\t"</span>, this.Id, this.Name,</span><br><span class="line">		this.Gender, this.Age, this.Phone, this.Email)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> info</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Get方法，用于获取各字段的值</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *Customer)</span> <span class="title">GetName</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> this.Name</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *Customer)</span> <span class="title">GetGender</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> this.Gender</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *Customer)</span> <span class="title">GetAge</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> this.Age</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *Customer)</span> <span class="title">GetPhone</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> this.Phone</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *Customer)</span> <span class="title">GetEmail</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> this.Email</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Set方法，用于设置各字段的值</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *Customer)</span> <span class="title">SetName</span><span class="params">(name <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> name != <span class="string">""</span> &#123;</span><br><span class="line">		this.Name = name</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *Customer)</span> <span class="title">SetGender</span><span class="params">(gender <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> gender != <span class="string">""</span> &#123;</span><br><span class="line">		this.Gender = gender</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *Customer)</span> <span class="title">SetAge</span><span class="params">(age <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> age &gt; <span class="number">0</span> &amp;&amp; age &lt;= <span class="number">120</span> &#123;</span><br><span class="line">		this.Age = age</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *Customer)</span> <span class="title">SetPhone</span><span class="params">(phone <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> phone != <span class="string">""</span> &#123;</span><br><span class="line">		this.Phone = phone</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *Customer)</span> <span class="title">SetEmail</span><span class="params">(email <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> email != <span class="string">""</span> &#123;</span><br><span class="line">		this.Email = email</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// customerService.go</span></span><br><span class="line"><span class="keyword">package</span> service</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"gocode/project12/customerManager/model"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 该CustomerService，完成对Customer的操作，包括</span></span><br><span class="line"><span class="comment">// 增删改查</span></span><br><span class="line"><span class="keyword">type</span> CustomerService <span class="keyword">struct</span> &#123;</span><br><span class="line">	customers []model.Customer</span><br><span class="line">	<span class="comment">// 声明一个字段，表示当前切片含有多少个客户</span></span><br><span class="line">	<span class="comment">// 该字段后面，还可以作为新字段的编号id+1</span></span><br><span class="line">	customerNum <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 编写一个方法，可以返回CustomerSer</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewCustomerService</span><span class="params">()</span> *<span class="title">CustomerService</span></span> &#123;</span><br><span class="line">	<span class="comment">// 为了能够看到有客户在切片中，我们初始化一个客户</span></span><br><span class="line">	customerService := &amp;CustomerService&#123;&#125;</span><br><span class="line">	customerService.customerNum = <span class="number">1</span></span><br><span class="line">	customer := model.NewCustomer(<span class="number">1</span>, <span class="string">"张三"</span>, <span class="string">"男"</span>, <span class="number">20</span>, <span class="string">"112"</span>, <span class="string">"zs@sohu.com"</span>)</span><br><span class="line">	customerService.customers = <span class="built_in">append</span>(customerService.customers, customer)</span><br><span class="line">	<span class="keyword">return</span> customerService</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 返回客户切片</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *CustomerService)</span> <span class="title">List</span><span class="params">()</span> []<span class="title">model</span>.<span class="title">Customer</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> this.customers</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加客户到customers切片</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *CustomerService)</span> <span class="title">Add</span><span class="params">(customer model.Customer)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">	<span class="comment">// 我们确定一个id添加的规则，就是添加的顺序</span></span><br><span class="line">	this.customerNum++</span><br><span class="line">	customer.Id = this.customerNum</span><br><span class="line">	this.customers = <span class="built_in">append</span>(this.customers, customer)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 根据id删除客户（从切片中删除）</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *CustomerService)</span> <span class="title">Delete</span><span class="params">(id <span class="keyword">int</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">	index := this.FindById(id)</span><br><span class="line">	<span class="comment">// 如果index == -1，说明没有这个客户</span></span><br><span class="line">	<span class="keyword">if</span> index == <span class="number">-1</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 如何从切片中删除一个元素</span></span><br><span class="line">	this.customers = <span class="built_in">append</span>(this.customers[:index],</span><br><span class="line">		this.customers[index+<span class="number">1</span>:]...)</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 根据id查找客户在切片中对应下标，如果没有该客户，返回-1</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *CustomerService)</span> <span class="title">FindById</span><span class="params">(id <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">	index := <span class="number">-1</span></span><br><span class="line">	<span class="comment">// 遍历this.customers切片</span></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(this.customers); i++ &#123;</span><br><span class="line">		<span class="keyword">if</span> this.customers[i].Id == id &#123;</span><br><span class="line">			<span class="comment">// 找到</span></span><br><span class="line">			index = i</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> index</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 修改客户信息，成功返回true，失败返回false</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *CustomerService)</span> <span class="title">Update</span><span class="params">(name <span class="keyword">string</span>, gender <span class="keyword">string</span>, age <span class="keyword">int</span>, phone <span class="keyword">string</span>, email <span class="keyword">string</span>, customer *model.Customer)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">	customer.SetName(name)</span><br><span class="line">	customer.SetGender(gender)</span><br><span class="line">	customer.SetAge(age)</span><br><span class="line">	customer.SetPhone(phone)</span><br><span class="line">	customer.SetEmail(email)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// customerView.go</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"gocode/project12/customerManager/model"</span></span><br><span class="line">	<span class="string">"gocode/project12/customerManager/service"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> customerView <span class="keyword">struct</span> &#123;</span><br><span class="line">	<span class="comment">// 定义必要的字段</span></span><br><span class="line">	key  <span class="keyword">string</span> <span class="comment">// 接收用户的输入</span></span><br><span class="line">	loop <span class="keyword">bool</span>   <span class="comment">// 表示是否循环显示菜单</span></span><br><span class="line">	<span class="comment">// 增加一个字段customerService</span></span><br><span class="line">	customnerService *service.CustomerService</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 显示所有的客户信息</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *customerView)</span> <span class="title">list</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 首先获取当前所有的客户信息</span></span><br><span class="line">	customers := this.customnerService.List()</span><br><span class="line">	<span class="comment">// 显示</span></span><br><span class="line">	fmt.Println(<span class="string">"-------------------客户列表-------------------"</span>)</span><br><span class="line">	fmt.Println(<span class="string">"编号\t姓名\t性别\t年龄\t电话\t邮箱"</span>)</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(customers); i++ &#123;</span><br><span class="line">		fmt.Println(customers[i].GetInfo())</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(<span class="string">"-----------------客户列表完成-----------------\n\n"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 得到用户的数据、信息构建新用户，并完成添加</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *customerView)</span> <span class="title">add</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">"-------------------添加客户---------------------"</span>)</span><br><span class="line">	fmt.Println(<span class="string">"姓名："</span>)</span><br><span class="line">	name := <span class="string">""</span></span><br><span class="line">	fmt.Scanln(&amp;name)</span><br><span class="line">	fmt.Println(<span class="string">"性别"</span>)</span><br><span class="line">	gender := <span class="string">""</span></span><br><span class="line">	fmt.Scanln(&amp;gender)</span><br><span class="line">	fmt.Println(<span class="string">"年龄"</span>)</span><br><span class="line">	age := <span class="number">0</span></span><br><span class="line">	fmt.Scanln(&amp;age)</span><br><span class="line">	fmt.Println(<span class="string">"电话"</span>)</span><br><span class="line">	phone := <span class="string">""</span></span><br><span class="line">	fmt.Scanln(&amp;phone)</span><br><span class="line">	fmt.Println(<span class="string">"邮箱"</span>)</span><br><span class="line">	email := <span class="string">""</span></span><br><span class="line">	fmt.Scanln(&amp;email)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 构建一个新的customer实例</span></span><br><span class="line">	<span class="comment">// id号唯一，由系统指定</span></span><br><span class="line">	customer := model.NewCustomer2(name, gender, age, phone, email)</span><br><span class="line">	<span class="keyword">if</span> this.customnerService.Add(customer) &#123;</span><br><span class="line">		fmt.Println(<span class="string">"-------------------添加完成---------------------"</span>)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"-------------------添加失败---------------------"</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 得到用户的输入id，删除该id对应的客户</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *customerView)</span> <span class="title">delete</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">"-------------------删除客户---------------------"</span>)</span><br><span class="line">	fmt.Println(<span class="string">"请选择删除客户编号（-1退出）："</span>)</span><br><span class="line">	id := <span class="number">01</span></span><br><span class="line">	fmt.Scanln(&amp;id)</span><br><span class="line">	<span class="keyword">if</span> id == <span class="number">-1</span> &#123;</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">		<span class="comment">// 放弃删除</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	fmt.Println(<span class="string">"确认删除请输入（Y/N）："</span>)</span><br><span class="line">	choice := <span class="string">""</span></span><br><span class="line">	fmt.Scanln(&amp;choice)</span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> choice == <span class="string">"y"</span> || choice == <span class="string">"Y"</span> &#123;</span><br><span class="line">			<span class="comment">// 调用customerService的Delete方法</span></span><br><span class="line">			<span class="keyword">if</span> this.customnerService.Delete(id) &#123;</span><br><span class="line">				fmt.Println(<span class="string">"-------------------删除完成---------------------"</span>)</span><br><span class="line">				<span class="keyword">return</span></span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				fmt.Println(<span class="string">"-----------删除失败，输入的id号不存在------------"</span>)</span><br><span class="line">				<span class="keyword">return</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> choice == <span class="string">"n"</span> || choice == <span class="string">"N"</span> &#123;</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 退出菜单</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *customerView)</span> <span class="title">exit</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		choice := <span class="string">""</span></span><br><span class="line">		fmt.Println(<span class="string">"确认是否退出（Y/N）："</span>)</span><br><span class="line">		fmt.Scanln(&amp;choice)</span><br><span class="line">		<span class="keyword">if</span> choice == <span class="string">"y"</span> || choice == <span class="string">"Y"</span> &#123;</span><br><span class="line">			this.loop = <span class="literal">false</span></span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> choice == <span class="string">"n"</span> || choice == <span class="string">"N"</span> &#123;</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 修改客户</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *customerView)</span> <span class="title">update</span><span class="params">()</span></span> &#123;</span><br><span class="line">	customerNo := <span class="number">0</span></span><br><span class="line">	fmt.Println(<span class="string">"请选择待修改客户编号（-1退出）："</span>)</span><br><span class="line">	fmt.Scanln(&amp;customerNo)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> customerNo == <span class="number">-1</span> &#123;</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		customerNo = this.customnerService.FindById(customerNo)</span><br><span class="line">		<span class="keyword">if</span> customerNo != <span class="number">-1</span> &#123;</span><br><span class="line">			customer := this.customnerService.List()</span><br><span class="line">			name := <span class="string">""</span></span><br><span class="line">			fmt.Printf(<span class="string">"姓名（%v）："</span>, customer[customerNo].GetName())</span><br><span class="line">			fmt.Scanln(&amp;name)</span><br><span class="line">			gender := <span class="string">""</span></span><br><span class="line">			fmt.Printf(<span class="string">"性别（%v）："</span>, customer[customerNo].GetGender())</span><br><span class="line">			fmt.Scanln(&amp;gender)</span><br><span class="line">			age := <span class="number">0</span></span><br><span class="line">			fmt.Printf(<span class="string">"年龄（%d）："</span>, customer[customerNo].GetAge())</span><br><span class="line">			fmt.Scanln(&amp;age)</span><br><span class="line">			phone := <span class="string">""</span></span><br><span class="line">			fmt.Printf(<span class="string">"电话（%v）："</span>, customer[customerNo].GetPhone())</span><br><span class="line">			fmt.Scanln(&amp;phone)</span><br><span class="line">			email := <span class="string">""</span></span><br><span class="line">			fmt.Printf(<span class="string">"邮箱（%v）："</span>, customer[customerNo].GetEmail())</span><br><span class="line">			fmt.Scanln(&amp;email)</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span> this.customnerService.Update(name, gender, age, phone, email, &amp;customer[customerNo]) &#123;</span><br><span class="line">				fmt.Println(<span class="string">"-------------------修改成功---------------------"</span>)</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				fmt.Println(<span class="string">"-------------------修改失败---------------------"</span>)</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			fmt.Println(<span class="string">"------------------没有该Id的用户。--------------------"</span>)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 显示主菜单</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *customerView)</span> <span class="title">mainMenu</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"\n----------------客户信息管理软件-----------------"</span>)</span><br><span class="line">		fmt.Println(<span class="string">"                 1 添加客户"</span>)</span><br><span class="line">		fmt.Println(<span class="string">"                 2 修改客户"</span>)</span><br><span class="line">		fmt.Println(<span class="string">"                 3 删除客户"</span>)</span><br><span class="line">		fmt.Println(<span class="string">"                 4 客户列表"</span>)</span><br><span class="line">		fmt.Println(<span class="string">"                 5 退    出"</span>)</span><br><span class="line">		fmt.Println(<span class="string">"请选择（1-5）："</span>)</span><br><span class="line"></span><br><span class="line">		fmt.Scanln(&amp;this.key)</span><br><span class="line"></span><br><span class="line">		<span class="keyword">switch</span> this.key &#123;</span><br><span class="line">		<span class="keyword">case</span> <span class="string">"1"</span>:</span><br><span class="line">			this.add()</span><br><span class="line">		<span class="keyword">case</span> <span class="string">"2"</span>:</span><br><span class="line">			this.update()</span><br><span class="line">		<span class="keyword">case</span> <span class="string">"3"</span>:</span><br><span class="line">			this.<span class="built_in">delete</span>()</span><br><span class="line">		<span class="keyword">case</span> <span class="string">"4"</span>:</span><br><span class="line">			this.list()</span><br><span class="line">		<span class="keyword">case</span> <span class="string">"5"</span>:</span><br><span class="line">			this.exit()</span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">			fmt.Println(<span class="string">"你的输入有误，请重新输入..."</span>)</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> !this.loop &#123;</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	fmt.Println(<span class="string">"你退出了客户关系管理系统"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 在主函数中，创建一个customer实例，并运行显示主菜单</span></span><br><span class="line">	customerView := customerView&#123;</span><br><span class="line">		key:  <span class="string">""</span>,</span><br><span class="line">		loop: <span class="literal">true</span>,</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 这里完成对customerView结构体的customerService字段的初始化</span></span><br><span class="line">	customerView.customnerService = service.NewCustomerService()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 显示主菜单</span></span><br><span class="line">	customerView.mainMenu()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="第14章-文件操作"><a href="#第14章-文件操作" class="headerlink" title="第14章 文件操作"></a>第14章 文件操作</h1><h2 id="14-1-文件-基本介绍"><a href="#14-1-文件-基本介绍" class="headerlink" title="14.1 文件-基本介绍"></a>14.1 文件-基本介绍</h2><ol>
<li><p>文件在程序中是以流的形式存在。</p>
<ul>
<li><p>文件-&gt;内存 为 输入流（读文件）</p>
</li>
<li><p>内存-&gt;文件 为 输出流（写文件）</p>
<p><code>流</code>：数据在数据源（文件）和程序（内存）之间经历的路径<br><code>输入流</code>：数据从数据源（文件）到程序（内存）的路径<br><code>输出流</code>：数据从程序（内存）到数据源（文件）的路径</p>
</li>
</ul>
</li>
<li><p>os.File封装所有文件相关操作，File是一个结构体</p>
</li>
</ol>
<h2 id="14-2-常用的文件操作函数和方法"><a href="#14-2-常用的文件操作函数和方法" class="headerlink" title="14.2 常用的文件操作函数和方法"></a>14.2 常用的文件操作函数和方法</h2><ol>
<li>打开一个文件进行操作<br>使用的是<code>func Open(name string) (file *File, err error)</code>方法。</li>
<li>关闭一个文件<br>使用的是<code>func (f *File)Close() error</code>方法</li>
</ol>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"os"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 打开文件</span></span><br><span class="line">	<span class="comment">// 概念说明：file的叫法</span></span><br><span class="line">	<span class="comment">// 1. fil e叫 file对象</span></span><br><span class="line">	<span class="comment">// 2. file 叫 file指针</span></span><br><span class="line">	<span class="comment">// 3. file 叫 file文件句柄</span></span><br><span class="line">	file, err := os.Open(<span class="string">"d:/test.txt"</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"open file err="</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 输出文件，看看文件是什么，看出file就是一个指针</span></span><br><span class="line">	fmt.Printf(<span class="string">"file=%v"</span>, file)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 关闭文件</span></span><br><span class="line">	err = file.Close()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"close file err="</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">file=&amp;&#123;<span class="number">0xc000076780</span>&#125;</span><br></pre></td></tr></table></figure>

<h2 id="14-3-读文件操作应用实例"><a href="#14-3-读文件操作应用实例" class="headerlink" title="14.3 读文件操作应用实例"></a>14.3 读文件操作应用实例</h2><ol>
<li><p>读取文件的内容并显示在终端（带缓冲区的方式），使用os.Open,file.Close,bufin.NewReader(),reader.ReadString函数和方法</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"bufio"</span></span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"io"</span></span><br><span class="line">	<span class="string">"os"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 打开文件</span></span><br><span class="line">	<span class="comment">// 概念说明：file的叫法</span></span><br><span class="line">	<span class="comment">// 1. fil e叫 file对象</span></span><br><span class="line">	<span class="comment">// 2. file 叫 file指针</span></span><br><span class="line">	<span class="comment">// 3. file 叫 file文件句柄</span></span><br><span class="line">	file, err := os.Open(<span class="string">"d:/test.txt"</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"open file err="</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 当函数退出时，要及时的关闭file</span></span><br><span class="line">	<span class="keyword">defer</span> file.Close() <span class="comment">// 要及时关闭file句柄，否则会有内测泄露</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 创建一个*Reader，是带缓冲</span></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">		const(</span></span><br><span class="line"><span class="comment">			defaultBufsize = 4096 // 默认缓冲区为4096</span></span><br><span class="line"><span class="comment">		)</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">	reader := bufio.NewReader(file)</span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		str, err := reader.ReadString(<span class="string">'\n'</span>) <span class="comment">// 读到一个换行就结束一次</span></span><br><span class="line">		<span class="keyword">if</span> err == io.EOF &#123;                  <span class="comment">// io.EOF表示文件末尾</span></span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// 输出内容</span></span><br><span class="line">		fmt.Print(str)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	fmt.Println(<span class="string">"文件读取结束"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">hello,world!</span><br><span class="line">北京！abc!golang!</span><br><span class="line"><span class="keyword">go</span>,hello,world!</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">文件读取结束</span><br></pre></td></tr></table></figure>
</li>
<li><p>读取文件的内容并显示在终端（使用ioutil一次将整个文件读取到内存中），这种方式适用于文件不大的情况。相关方法和函数（ioutil.ReadFile）</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"io/ioutil"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 使用ioutil.ReadFile一次性将文件读取到位</span></span><br><span class="line">	<span class="comment">// 仅仅适用于文件较小的情况</span></span><br><span class="line">	file := <span class="string">"d:/test.txt"</span></span><br><span class="line">	content, err := ioutil.ReadFile(file)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"read file err=%v"</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 把读取到的内容显示到终端</span></span><br><span class="line">	<span class="comment">// fmt.Printf("%v", content) // []byte</span></span><br><span class="line">	fmt.Printf(<span class="string">"%v"</span>, <span class="keyword">string</span>(content)) <span class="comment">// []byte</span></span><br><span class="line">	<span class="comment">// 因为，我们没有显式的Open文件，因此也不需要显式的Close文件</span></span><br><span class="line">	<span class="comment">// 因为，文件Open和Close被封装到ReadFile函数内部</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">hello,world!</span><br><span class="line">北京！abc!golang!</span><br><span class="line"><span class="keyword">go</span>,hello,world!</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="14-4-写文件操作应用实例"><a href="#14-4-写文件操作应用实例" class="headerlink" title="14.4 写文件操作应用实例"></a>14.4 写文件操作应用实例</h2><h3 id="14-4-1-基本介绍"><a href="#14-4-1-基本介绍" class="headerlink" title="14.4.1 基本介绍"></a>14.4.1 基本介绍</h3><ul>
<li><p><code>func OpenFile(name string, flag int, perm FileMode) (file *File, err Error)</code><br>说明：os.OpenFile是一个更一般性的文件打开函数，它会使用指定的选项（如O_RDONLY等）、指定的模式（如0666等）打开指定名称的文件。如果操作成功，返回的文件对象可用于I/O。如果出错，错误底层类型是<code>*PathError</code>。</p>
</li>
<li><p>第二个参数：文件打开模式（可以组合，使用<code>|</code>连接）</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> (</span><br><span class="line">    O_RDONLY <span class="keyword">int</span> = syscall.O_RDONLY <span class="comment">// 只读模式打开文件</span></span><br><span class="line">    O_WRONLY <span class="keyword">int</span> = syscall.O_WRONLY <span class="comment">// 只写模式打开文件</span></span><br><span class="line">    O_RDWR   <span class="keyword">int</span> = syscall.O_RDWR   <span class="comment">// 读写模式打开文件</span></span><br><span class="line">    O_APPEND <span class="keyword">int</span> = syscall.O_APPEND <span class="comment">// 写操作时将数据附加到文件尾部</span></span><br><span class="line">    O_CREATE <span class="keyword">int</span> = syscall.O_CREAT  <span class="comment">// 如果不存在将创建一个新文件</span></span><br><span class="line">    O_EXCL   <span class="keyword">int</span> = syscall.O_EXCL   <span class="comment">// 和O_CREATE配合使用，文件必须不存在</span></span><br><span class="line">    O_SYNC   <span class="keyword">int</span> = syscall.O_SYNC   <span class="comment">// 打开文件用于同步I/O</span></span><br><span class="line">    O_TRUNC  <span class="keyword">int</span> = syscall.O_TRUNC  <span class="comment">// 如果可能，打开时清空文件</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
</li>
<li><p>第三个参数：权限控制（linux）<br><code>r:2^2=4</code><br><code>w:2^1=2</code><br><code>x:2^0=1</code></p>
</li>
</ul>
<h3 id="14-4-2-基本应用实例-方式一"><a href="#14-4-2-基本应用实例-方式一" class="headerlink" title="14.4.2 基本应用实例-方式一"></a>14.4.2 基本应用实例-方式一</h3><ol>
<li><p>创建一个新文件，写入内容 5句“hello,Gardon”</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"bufio"</span></span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"os"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 创建一个新文件，写入内容 5句“hello，Gardon”</span></span><br><span class="line">	<span class="comment">// 1. 打开文件d:/abc.txt</span></span><br><span class="line">	filePath := <span class="string">"d:/abc.txt"</span></span><br><span class="line">	file, err := os.OpenFile(filePath, os.O_WRONLY|os.O_CREATE, <span class="number">0666</span>)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Printf(<span class="string">"open file err=%v\n"</span>, err)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 及时关闭句柄</span></span><br><span class="line">	<span class="keyword">defer</span> file.Close()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 准备写入5句“hello, Gardon”</span></span><br><span class="line">	str := <span class="string">"hello, Gardon\n"</span></span><br><span class="line">	<span class="comment">// 写入时，使用带缓存的*Writer</span></span><br><span class="line">	writer := bufio.NewWriter(file)</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">5</span>; i++ &#123;</span><br><span class="line">		writer.WriteString(str)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 因为Writer是带缓存，因此在调用WriterString方法时，其实</span></span><br><span class="line">	<span class="comment">// 内容是先写入到缓存的，所以需要调用Flush方法，将缓存的数据</span></span><br><span class="line">	<span class="comment">// 写入到文件中，否则文件中会丢失数据。</span></span><br><span class="line">	writer.Flush()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>打开一个存在的文件中，将原来的内容覆盖成新的内容10句“你好，BK！”</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"bufio"</span></span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"os"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 创建一个新文件，写入内容 5句“hello，Gardon”</span></span><br><span class="line">	<span class="comment">// 1. 打开已经存在的文件d:/abc.txt</span></span><br><span class="line">	filePath := <span class="string">"d:/abc.txt"</span></span><br><span class="line">	file, err := os.OpenFile(filePath, os.O_WRONLY|os.O_TRUNC, <span class="number">0666</span>)<span class="comment">// 打开模式发生了变化</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Printf(<span class="string">"open file err=%v\n"</span>, err)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 及时关闭句柄</span></span><br><span class="line">	<span class="keyword">defer</span> file.Close()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 准备写入5句“hello, Gardon”</span></span><br><span class="line">	str := <span class="string">"你好，BK\n"</span></span><br><span class="line">	<span class="comment">// 写入时，使用带缓存的*Writer</span></span><br><span class="line">	writer := bufio.NewWriter(file)</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">		writer.WriteString(str)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 因为Writer是带缓存，因此在调用WriterString方法时，其实</span></span><br><span class="line">	<span class="comment">// 内容是先写入到缓存的，所以需要调用Flush方法，将缓存的数据</span></span><br><span class="line">	<span class="comment">// 写入到文件中，否则文件中会丢失数据。</span></span><br><span class="line">	writer.Flush()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>打开一个存在的文件，在原来的内容最佳内容“ABC！ENGLISH！”</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"bufio"</span></span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"os"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 1. 打开已经存在的文件d:/abc.txt</span></span><br><span class="line">	filePath := <span class="string">"d:/abc.txt"</span></span><br><span class="line">	file, err := os.OpenFile(filePath, os.O_WRONLY|os.O_APPEND, <span class="number">0666</span>)<span class="comment">// 打开模式发生了变化</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Printf(<span class="string">"open file err=%v\n"</span>, err)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 及时关闭句柄</span></span><br><span class="line">	<span class="keyword">defer</span> file.Close()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 准备写入5句“hello, Gardon”</span></span><br><span class="line">	str := <span class="string">"ABC!ENGLSH!\n"</span></span><br><span class="line">	<span class="comment">// 写入时，使用带缓存的*Writer</span></span><br><span class="line">	writer := bufio.NewWriter(file)</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">		writer.WriteString(str)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 因为Writer是带缓存，因此在调用WriterString方法时，其实</span></span><br><span class="line">	<span class="comment">// 内容是先写入到缓存的，所以需要调用Flush方法，将缓存的数据</span></span><br><span class="line">	<span class="comment">// 写入到文件中，否则文件中会丢失数据。</span></span><br><span class="line">	writer.Flush()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>打开一个存在的文件，将原来的内容读出显示在终端，并且追加5句“hello，北京！”</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"bufio"</span></span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"io"</span></span><br><span class="line">	<span class="string">"os"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 1. 打开已经存在的文件d:/abc.txt</span></span><br><span class="line">	filePath := <span class="string">"d:/abc.txt"</span></span><br><span class="line">	file, err := os.OpenFile(filePath, os.O_RDWR|os.O_APPEND, <span class="number">0666</span>)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Printf(<span class="string">"open file err=%v\n"</span>, err)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 及时关闭句柄</span></span><br><span class="line">	<span class="keyword">defer</span> file.Close()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 先读取原来文件的内容并且显示在终端</span></span><br><span class="line">	reader := bufio.NewReader(file)</span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		str, err := reader.ReadString(<span class="string">'\n'</span>)</span><br><span class="line">		<span class="keyword">if</span> err == io.EOF &#123;</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// 显示到终端</span></span><br><span class="line">		fmt.Printf(str)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 准备写入5句“hello, 北京”</span></span><br><span class="line">	str := <span class="string">"hello,北京\n"</span></span><br><span class="line">	<span class="comment">// 写入时，使用带缓存的*Writer</span></span><br><span class="line">	writer := bufio.NewWriter(file)</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">		writer.WriteString(str)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 因为Writer是带缓存，因此在调用WriterString方法时，其实</span></span><br><span class="line">	<span class="comment">// 内容是先写入到缓存的，所以需要调用Flush方法，将缓存的数据</span></span><br><span class="line">	<span class="comment">// 写入到文件中，否则文件中会丢失数据。</span></span><br><span class="line">	writer.Flush()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">你好，BK你好，BK</span><br><span class="line">你好，BK</span><br><span class="line">你好，BK</span><br><span class="line">你好，BK</span><br><span class="line">你好，BK</span><br><span class="line">你好，BK</span><br><span class="line">你好，BK</span><br><span class="line">你好，BK</span><br><span class="line">你好，BK</span><br><span class="line">ABC!ENGLSH!</span><br><span class="line">ABC!ENGLSH!</span><br><span class="line">ABC!ENGLSH!</span><br><span class="line">ABC!ENGLSH!</span><br><span class="line">ABC!ENGLSH!</span><br><span class="line">ABC!ENGLSH!</span><br><span class="line">ABC!ENGLSH!</span><br><span class="line">ABC!ENGLSH!</span><br><span class="line">ABC!ENGLSH!</span><br><span class="line">ABC!ENGLSH!</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="14-4-3-基本应用实例-方式二"><a href="#14-4-3-基本应用实例-方式二" class="headerlink" title="14.4.3 基本应用实例-方式二"></a>14.4.3 基本应用实例-方式二</h3><p>编写一个程序，将一个文件的内容，写入到另一个文件。注：这两个文件已经存在了。<br><code>说明</code>：使用ioutil.ReadFile/ioutil.WriteFile完成写文件的任务</p>
<ul>
<li>代码实现<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"io/ioutil"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 将d:/abc/txt 文件内容导入到 e:/kkk.txt</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 1. 首先将 d:/abc.txt 内容读取到内存</span></span><br><span class="line">	<span class="comment">// 2. 将读取到的内容写入 e:/kkk.txt</span></span><br><span class="line"></span><br><span class="line">	file1Path := <span class="string">"d:/abc.txt"</span></span><br><span class="line">	file2Path := <span class="string">"e:/kkk.txt"</span></span><br><span class="line"></span><br><span class="line">	data, err := ioutil.ReadFile(file1Path)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="comment">// 说明读文件有错误</span></span><br><span class="line">		fmt.Printf(<span class="string">"read file err=%v"</span>, err)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	err = ioutil.WriteFile(file2Path, data, <span class="number">0666</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Printf(<span class="string">"write file error=%v"</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="14-4-4-判断文件是否存在"><a href="#14-4-4-判断文件是否存在" class="headerlink" title="14.4.4 判断文件是否存在"></a>14.4.4 判断文件是否存在</h3><p>golang判断文件或文件夹是否存在的方法为使用os.Stat()函数返回的错误值进行判断：</p>
<ol>
<li>如果返回的错误为nil，说明文件后文件夹存在</li>
<li>如果返回的错误类型使用os.IsNotExist()判断为true，说明文件或文件夹存在</li>
<li>如果返回的错误为其他类型，则不确定是否存在</li>
</ol>
<p>自己写的一个函数</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">PathExists</span><span class="params">(path <span class="keyword">string</span>)</span> <span class="params">(<span class="keyword">bool</span>, error)</span></span> &#123;</span><br><span class="line">	_, err := os.Stat(path)</span><br><span class="line">	<span class="keyword">if</span> err == <span class="literal">nil</span> &#123; <span class="comment">// 文件或目录存在</span></span><br><span class="line">		<span class="keyword">return</span> <span class="literal">true</span>, <span class="literal">nil</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> os.IsNotExist(err) &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>, <span class="literal">nil</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="literal">false</span>, err</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="14-5-文件编程应用实例"><a href="#14-5-文件编程应用实例" class="headerlink" title="14.5 文件编程应用实例"></a>14.5 文件编程应用实例</h2><h3 id="14-5-1-拷贝文件"><a href="#14-5-1-拷贝文件" class="headerlink" title="14.5.1 拷贝文件"></a>14.5.1 拷贝文件</h3><p>说明：将一张图片/电影/MP3拷贝到另外一个文件 e:/abc.jpg<br><code>func Copy(dst Writer, str Reader) (written int64, err error)</code><br>注意：Copy函数是io包提供的。</p>
<p>代码实现</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"bufio"</span></span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"io"</span></span><br><span class="line">	<span class="string">"os"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 自己编写一个函数，接收两个文件路径 srcFileName dstFileName</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">CopyFile</span><span class="params">(dstFileName <span class="keyword">string</span>, srcFileName <span class="keyword">string</span>)</span> <span class="params">(witten <span class="keyword">int64</span>, err error)</span></span> &#123;</span><br><span class="line">	srcFile, err := os.Open(srcFileName)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Printf(<span class="string">"open file err=%v\n"</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> srcFile.Close()</span><br><span class="line">	<span class="comment">// 通过srcFile，获取到Reader</span></span><br><span class="line">	reader := bufio.NewReader(srcFile)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 打开dstFileName</span></span><br><span class="line">	dstFile, err := os.OpenFile(dstFileName, os.O_WRONLY|os.O_CREATE, <span class="number">0666</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Printf(<span class="string">"open file err=%v\n"</span>, err)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 通过dstFile，获取到writer</span></span><br><span class="line">	writer := bufio.NewWriter(dstFile)</span><br><span class="line">	<span class="keyword">defer</span> dstFile.Close()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> io.Copy(writer, reader)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 将d:/abc.jpg 文件拷贝到 e:/def.jpg</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 调用copyFile完成文件拷贝</span></span><br><span class="line">	srcFile := <span class="string">"d:/abc.jpg"</span></span><br><span class="line">	dstFile := <span class="string">"e:/def.jpg"</span></span><br><span class="line"></span><br><span class="line">	_, err := CopyFile(dstFile, srcFile)</span><br><span class="line">	<span class="keyword">if</span> err == <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"拷贝完成"</span>)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		fmt.Printf(<span class="string">"拷贝错误 err=%v"</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="14-5-2-统计英文、数字、空格和其他字符"><a href="#14-5-2-统计英文、数字、空格和其他字符" class="headerlink" title="14.5.2 统计英文、数字、空格和其他字符"></a>14.5.2 统计英文、数字、空格和其他字符</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"bufio"</span></span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"io"</span></span><br><span class="line">	<span class="string">"os"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> CharCount <span class="keyword">struct</span> &#123;</span><br><span class="line">	ChCount    <span class="keyword">int</span> <span class="comment">// 记录 英文字符 个数</span></span><br><span class="line">	NumCount   <span class="keyword">int</span> <span class="comment">// 记录 数字字符 个数</span></span><br><span class="line">	SpaceCount <span class="keyword">int</span> <span class="comment">// 记录 空格字符 个数</span></span><br><span class="line">	OtherCount <span class="keyword">int</span> <span class="comment">// 记录 其他字符 个数</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 思路：打开一个文件，创建一个Reader</span></span><br><span class="line">	<span class="comment">// 每读取一行，就去统计该行有多少个 英文、数字、空格和其他字符</span></span><br><span class="line">	<span class="comment">// 然后将结果保存到一个结构体当中</span></span><br><span class="line">	fileName := <span class="string">"e:/abc.txt"</span></span><br><span class="line">	file, err := os.Open(fileName)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Printf(<span class="string">"open file err=%v"</span>, err)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> file.Close()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 定义CharCount实例</span></span><br><span class="line">	<span class="keyword">var</span> count CharCount</span><br><span class="line">	<span class="comment">// 创建一个Reader</span></span><br><span class="line">	reader := bufio.NewReader(file)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 开始循环的读取fileName的内容</span></span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		str, err := reader.ReadString(<span class="string">'\n'</span>)</span><br><span class="line">		<span class="keyword">if</span> err == io.EOF &#123;</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span> _, v := <span class="keyword">range</span> str &#123;</span><br><span class="line">			<span class="keyword">switch</span> &#123;</span><br><span class="line">			<span class="keyword">case</span> v &gt;= <span class="string">'a'</span> &amp;&amp; v &lt;= <span class="string">'z'</span>:</span><br><span class="line">				<span class="keyword">fallthrough</span> <span class="comment">// 穿透</span></span><br><span class="line">			<span class="keyword">case</span> v &gt;= <span class="string">'A'</span> &amp;&amp; v &lt;= <span class="string">'Z'</span>:</span><br><span class="line">				count.ChCount++</span><br><span class="line">			<span class="keyword">case</span> v == <span class="string">' '</span> || v == <span class="string">'\t'</span>:</span><br><span class="line">				count.SpaceCount++</span><br><span class="line">			<span class="keyword">case</span> v &gt;= <span class="string">'0'</span> &amp;&amp; v &lt;= <span class="string">'9'</span>:</span><br><span class="line">				count.NumCount++</span><br><span class="line">			<span class="keyword">default</span>:</span><br><span class="line">				count.OtherCount++</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 输出统计的结果，看看是否正确</span></span><br><span class="line">	fmt.Printf(<span class="string">"字符的个数为%v 数字的个数为%v 空格的个数为%v 其他字符的个数为%v"</span>,</span><br><span class="line">		count.ChCount, count.NumCount, count.SpaceCount, count.OtherCount)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">字符的个数为<span class="number">13</span> 数字的个数为<span class="number">7</span> 空格的个数为<span class="number">2</span> 其他字符的个数为<span class="number">4</span></span><br></pre></td></tr></table></figure>

<p>文本文件内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ab123 89popj</span><br><span class="line">yy89 hello</span><br><span class="line">// 此行换成换行符</span><br></pre></td></tr></table></figure>

<h2 id="14-6-命令行参数"><a href="#14-6-命令行参数" class="headerlink" title="14.6 命令行参数"></a>14.6 命令行参数</h2><h3 id="14-6-1-需求"><a href="#14-6-1-需求" class="headerlink" title="14.6.1 需求"></a>14.6.1 需求</h3><p>我们需要后驱命令行输入的各种参数</p>
<h3 id="14-6-2-基本介绍"><a href="#14-6-2-基本介绍" class="headerlink" title="14.6.2 基本介绍"></a>14.6.2 基本介绍</h3><p><code>os.Args</code>是一个string切片，用来存储所有的命令行参数</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Args []<span class="keyword">string</span></span><br><span class="line"></span><br><span class="line">Args保管了命令行参数，第一个是程序名。</span><br></pre></td></tr></table></figure>

<h3 id="14-6-3-案例"><a href="#14-6-3-案例" class="headerlink" title="14.6.3 案例"></a>14.6.3 案例</h3><p>编写一段代码，获取命令行参数</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"os"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">"命令行的参数有："</span>, <span class="built_in">len</span>(os.Args))</span><br><span class="line">	<span class="comment">// 遍历os.Args切片，就可以得到所有的命令行输入参数值</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i, v := <span class="keyword">range</span> os.Args &#123;</span><br><span class="line">		fmt.Printf(<span class="string">"args[%v]=%v\n"</span>, i, v)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">在工程main包中，使用命令：</span></span><br><span class="line"><span class="comment">	go build -o test.exe main.go</span></span><br><span class="line"><span class="comment">来生成可执行文件，之后运行可执行文件。</span></span><br><span class="line"><span class="comment">此处运行指令为：</span></span><br><span class="line"><span class="comment">	test.exe d:/aaa/bbb/init.log 909</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">命令行的参数有： <span class="number">3</span></span><br><span class="line">args[<span class="number">0</span>]=E:\ScourceCode\gocode\src\gocode\project14\argsdemo\exec01\test.exe</span><br><span class="line">args[<span class="number">1</span>]=d:/aaa/bbb/init.log</span><br><span class="line">args[<span class="number">2</span>]=<span class="number">909</span></span><br></pre></td></tr></table></figure>

<h3 id="16-6-4-flag包来解析参数"><a href="#16-6-4-flag包来解析参数" class="headerlink" title="16.6.4 flag包来解析参数"></a>16.6.4 flag包来解析参数</h3><ol>
<li><p>说明<br>前面的方式是比较原生的方式，对解析参数不是特别的方便，特别是带有指定参数形式的命令行</p>
<p> 比如：<code>cmd&gt;main.exe -f c:/aaa.txt -p 200 -u root</code>这样的形式命令行，go设计者给我们提供了flag包，可以方便的解析命令行参数，而且参数顺序可以随意</p>
 <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// flag包</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">IntVar</span></span></span><br><span class="line"><span class="function"><span class="title">func</span> <span class="title">IntVar</span><span class="params">(p *<span class="keyword">int</span>, name <span class="keyword">string</span>, value <span class="keyword">int</span>, usage <span class="keyword">string</span>)</span></span></span><br><span class="line"><span class="function">  <span class="title">IntVar</span>用指定的名称、默认值、使用信息注册一个<span class="title">int</span>类型<span class="title">flag</span>，并将<span class="title">flag</span>的值保存到<span class="title">p</span>指向的变量。</span></span><br><span class="line"><span class="function">类似的有<span class="title">StringVar</span>、<span class="title">BoolVar</span>、<span class="title">Int64Var</span>...</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">func</span> <span class="title">Set</span></span></span><br><span class="line"><span class="function"><span class="title">func</span> <span class="title">Set</span><span class="params">(name, value <span class="keyword">string</span>)</span> <span class="title">error</span></span></span><br><span class="line"><span class="function">  设置已注册的<span class="title">flag</span>的值。</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">func</span> <span class="title">Parse</span></span></span><br><span class="line"><span class="function"><span class="title">func</span> <span class="title">Parse</span><span class="params">()</span></span></span><br><span class="line"><span class="function">  从<span class="title">os</span>.<span class="title">Args</span>[1:]中解析注册的<span class="title">flag</span>。必须在所有<span class="title">flag</span>都注册好而未访问其值时执行。未注册却使用<span class="title">flag</span> -<span class="title">help</span>时，会返回<span class="title">ErrHelp</span>。</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>代码实例</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"flag"</span></span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 定义几个变量，用于接收命令行的参数</span></span><br><span class="line">	<span class="keyword">var</span> user <span class="keyword">string</span></span><br><span class="line">	<span class="keyword">var</span> pwd <span class="keyword">string</span></span><br><span class="line">	<span class="keyword">var</span> host <span class="keyword">string</span></span><br><span class="line">	<span class="keyword">var</span> port <span class="keyword">int</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// &amp;user 就是用来接收用户命令输入的 -u 后面的参数值</span></span><br><span class="line">	<span class="comment">// "u"，就是 -u 指定参数</span></span><br><span class="line">	<span class="comment">// ""，默认值</span></span><br><span class="line">	<span class="comment">// "用户名，默认为空" 说明</span></span><br><span class="line">	flag.StringVar(&amp;user, <span class="string">"u"</span>, <span class="string">""</span>, <span class="string">"用户名，默认为空"</span>)</span><br><span class="line">	flag.StringVar(&amp;pwd, <span class="string">"pwd"</span>, <span class="string">""</span>, <span class="string">"密码，默认为空"</span>)</span><br><span class="line">	flag.StringVar(&amp;host, <span class="string">"h"</span>, <span class="string">"localhost"</span>, <span class="string">"主机名，默认为localhost"</span>)</span><br><span class="line">	flag.IntVar(&amp;port, <span class="string">"port"</span>, <span class="number">3306</span>, <span class="string">"端口号，默认为3306"</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 这里有一个非常重要的操作，转换必须调用该方法</span></span><br><span class="line">	flag.Parse()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 输出结果</span></span><br><span class="line">	fmt.Printf(<span class="string">"user=%v pwd=%v host=%v post=%v"</span>,</span><br><span class="line">		user, pwd, host, port)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">在main包中生成可执行文件，过程略</span></span><br><span class="line"><span class="comment">输入指令为以下两条：</span></span><br><span class="line"><span class="comment">	.\test.exe -u Bk -pwd 123 -h 192.168.1.1 -port 80</span></span><br><span class="line"><span class="comment">	.\test.exe -h 192.168.1.1 -u test -pwd 222</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">user=Bk pwd=<span class="number">123</span> host=<span class="number">192.168</span><span class="number">.1</span><span class="number">.1</span> post=<span class="number">80</span></span><br><span class="line">user=test pwd=<span class="number">222</span> host=<span class="number">192.168</span><span class="number">.1</span><span class="number">.1</span> post=<span class="number">3306</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="14-7-json基本介绍"><a href="#14-7-json基本介绍" class="headerlink" title="14.7 json基本介绍"></a>14.7 json基本介绍</h2><h3 id="14-7-1-概述"><a href="#14-7-1-概述" class="headerlink" title="14.7.1 概述"></a>14.7.1 概述</h3><ul>
<li><p>JSON（JavaScript Object Notation）是一种轻量级的数据交换格式。易于人阅读和编写，同时也易于机器解析和生成<code>key - value</code>。</p>
</li>
<li><p>JSON是在2001年开始推广使用的数据格式，目前已经成为主流的数据格式</p>
</li>
<li><p>JSON易于机器解析狠生成，并且有效地提升网络传输效率，通常程序在网络传输时会先将数据（结构体、map等）序列化成JSON字符串，到接收方得到JSON字符串时，再反序列化恢复成原来的数据类型（结构体、map等）</p>
</li>
</ul>
<h3 id="14-7-2-json的应用场景"><a href="#14-7-2-json的应用场景" class="headerlink" title="14.7.2 json的应用场景"></a>14.7.2 json的应用场景</h3><ol>
<li>web编程中的应用 <code>b/s模式</code><ul>
<li>web服务器<br>  go数组-（jso序列化）&gt;json字符串-（传输遵守json）&gt;</li>
<li>浏览器<br>  -（传输遵守json）&gt;json字符串-(反序列化)&gt;还原数组，在dom编写显示</li>
</ul>
</li>
</ol>
<ol start="2">
<li>tcp编程中的应用【go写了聊天系统】 <code>c/s模式</code><ul>
<li>客户端A<br>  数组-（序列化）&gt;jso字符-&gt;（后台服务器）</li>
<li>后台服务器go<br>  （客户端A）-&gt;中转-&gt;（客户端B）</li>
<li>客户端B<br>  （后台服务器）-&gt;json字符串-（反序列化）&gt;数组-&gt;显示</li>
</ul>
</li>
</ol>
<h3 id="14-7-3-jaon数据格式说明"><a href="#14-7-3-jaon数据格式说明" class="headerlink" title="14.7.3 jaon数据格式说明"></a>14.7.3 jaon数据格式说明</h3><ul>
<li><p>在JS语言中，一切都是对象。因此，任何的数据类型都可以通过JSON来表示，例如字符串、数字、对象、数组、map、结构体等</p>
</li>
<li><p>JSON键值对是用来保存数据的一种方式，键值对组合中的键名卸载前面并用双引号<code>&quot;&quot;</code>包裹，使用冒号<code>:</code>分割，然后紧接着值<br><code>{&quot;key1&quot;:val1,&quot;key2&quot;:val2,&quot;key3&quot;:val3,&quot;key4&quot;:[val4,val5]}</code></p>
</li>
<li><p>例如</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;firstName&quot;:&quot;Json&quot;&#125;</span><br><span class="line"></span><br><span class="line">&#123;&quot;name&quot;:&quot;tom&quot;, &quot;age&quot;:18,&quot;address&quot;:[&quot;北京&quot;,&quot;上海&quot;]&#125;</span><br><span class="line"></span><br><span class="line">[&#123;&quot;name&quot;:&quot;tom&quot;, &quot;age&quot;:18, &quot;address&quot;:[&quot;北京&quot;,&quot;上海&quot;]&#125;, &#123;&quot;name&quot;:&quot;mary&quot;,  &quot;age&quot;:28, &quot;address&quot;:[&quot;广州&quot;,&quot;深圳&quot;]&#125;]</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="14-7-4-json的序列化"><a href="#14-7-4-json的序列化" class="headerlink" title="14.7.4 json的序列化"></a>14.7.4 json的序列化</h3><ol>
<li><p>介绍<br> json序列化是指，将有key-value结构的数据类型（比如结构体、map、切片）序列化成json字符串的操作</p>
</li>
<li><p>应用案例</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"encoding/json"</span></span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Monster <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name     <span class="keyword">string</span></span><br><span class="line">	Age      <span class="keyword">int</span></span><br><span class="line">	Birthday <span class="keyword">string</span></span><br><span class="line">	Sal      <span class="keyword">float64</span></span><br><span class="line">	Skill    <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">testStruct</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 演示</span></span><br><span class="line">	monster := Monster&#123;</span><br><span class="line">		Name:     <span class="string">"牛魔王"</span>,</span><br><span class="line">		Age:      <span class="number">500</span>,</span><br><span class="line">		Birthday: <span class="string">"2011-11-11"</span>,</span><br><span class="line">		Sal:      <span class="number">8000.0</span>,</span><br><span class="line">		Skill:    <span class="string">"牛魔拳"</span>,</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 将monster序列化</span></span><br><span class="line">	data, err := json.Marshal(&amp;monster)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Printf(<span class="string">"序列化错误 err=%v\n"</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 输出序列化后的结果</span></span><br><span class="line">	fmt.Printf(<span class="string">"monster序列化后=%v\n"</span>, <span class="keyword">string</span>(data))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将map进行序列化</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">testMap</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 定义一个map</span></span><br><span class="line">	<span class="keyword">var</span> a <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">interface</span>&#123;&#125;</span><br><span class="line">	<span class="comment">// 使用map之前，需要make</span></span><br><span class="line">	a = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">interface</span>&#123;&#125;)</span><br><span class="line"></span><br><span class="line">	a[<span class="string">"name"</span>] = <span class="string">"红孩儿"</span></span><br><span class="line">	a[<span class="string">"age"</span>] = <span class="number">30</span></span><br><span class="line">	a[<span class="string">"address"</span>] = <span class="string">"洪崖洞"</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 将a序列化</span></span><br><span class="line">	data, err := json.Marshal(&amp;a)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Printf(<span class="string">"序列化错误 err=%v\n"</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 输出序列化后的结果</span></span><br><span class="line">	fmt.Printf(<span class="string">"a序列化后=%v\n"</span>, <span class="keyword">string</span>(data))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 对切片进行序列化，切片类型 []map[string]interface&#123;&#125;</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">testSlice</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> slice []<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">interface</span>&#123;&#125;</span><br><span class="line">	<span class="keyword">var</span> m1 <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">interface</span>&#123;&#125;</span><br><span class="line">	<span class="comment">// 使用map前，需要make</span></span><br><span class="line">	m1 = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">interface</span>&#123;&#125;)</span><br><span class="line">	m1[<span class="string">"name"</span>] = <span class="string">"jack"</span></span><br><span class="line">	m1[<span class="string">"age"</span>] = <span class="string">"7"</span></span><br><span class="line">	m1[<span class="string">"address"</span>] = <span class="string">"北京"</span></span><br><span class="line">	slice = <span class="built_in">append</span>(slice, m1)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> m2 <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">interface</span>&#123;&#125;</span><br><span class="line">	<span class="comment">// 使用map前，需要make</span></span><br><span class="line">	m2 = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">interface</span>&#123;&#125;)</span><br><span class="line">	m2[<span class="string">"name"</span>] = <span class="string">"tom"</span></span><br><span class="line">	m2[<span class="string">"age"</span>] = <span class="string">"20"</span></span><br><span class="line">	m2[<span class="string">"address"</span>] = [<span class="number">2</span>]<span class="keyword">string</span>&#123;<span class="string">"墨西哥"</span>, <span class="string">"新加坡"</span>&#125;</span><br><span class="line">	slice = <span class="built_in">append</span>(slice, m2)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 将切片进行序列化操作</span></span><br><span class="line">	data, err := json.Marshal(&amp;slice)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Printf(<span class="string">"序列化错误 err=%v\n"</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 输出序列化后的结果</span></span><br><span class="line">	fmt.Printf(<span class="string">"slice序列化后=%v\n"</span>, <span class="keyword">string</span>(data))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 对基本数据类型序列化，意义不大</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">testFloat64</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> num1 <span class="keyword">float64</span> = <span class="number">2345.67</span></span><br><span class="line"></span><br><span class="line">	data, err := json.Marshal(&amp;num1)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Printf(<span class="string">"序列化错误 err=%v\n"</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	fmt.Printf(<span class="string">"num1 序列化之后：%v"</span>, <span class="keyword">string</span>(data))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 演示结构体、map、切片进行序列化</span></span><br><span class="line">	testStruct()</span><br><span class="line">	testMap()</span><br><span class="line">	testSlice()</span><br><span class="line">	testFloat64()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">monster序列化后=&#123;<span class="string">"Name"</span>:<span class="string">"牛魔王"</span>,<span class="string">"Age"</span>:<span class="number">500</span>,<span class="string">"Birthday"</span>:<span class="string">"2011-11-11"</span>,<span class="string">"Sal"</span>:<span class="number">8000</span>,<span class="string">"Skill"</span>:<span class="string">"牛</span></span><br><span class="line"><span class="string">魔拳"</span>&#125;</span><br><span class="line">a序列化后=&#123;<span class="string">"address"</span>:<span class="string">"洪崖洞"</span>,<span class="string">"age"</span>:<span class="number">30</span>,<span class="string">"name"</span>:<span class="string">"红孩儿"</span>&#125;</span><br><span class="line">slice序列化后=[&#123;<span class="string">"address"</span>:<span class="string">"北京"</span>,<span class="string">"age"</span>:<span class="string">"7"</span>,<span class="string">"name"</span>:<span class="string">"jack"</span>&#125;,&#123;<span class="string">"address"</span>:[<span class="string">"墨西哥"</span>,<span class="string">"新加坡"</span>],<span class="string">"age"</span>:<span class="string">"20"</span>,<span class="string">"name"</span>:<span class="string">"tom"</span>&#125;]</span><br><span class="line">num1 序列化之后：<span class="number">2345.67</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<ul>
<li>注意事项<br>对于结构体的序列化，如果我们希望序列化后的key的名字由我们重新指定，那么可以给struct指定一个tag标签<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Monster <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name     <span class="keyword">string</span>  <span class="string">`json:"monster_name"`</span> <span class="comment">// 反射机制</span></span><br><span class="line">	Age      <span class="keyword">int</span>     <span class="string">`json:"monster_age"`</span></span><br><span class="line">	Birthday <span class="keyword">string</span>  <span class="string">`json:"monster_birthday"`</span></span><br><span class="line">	Sal      <span class="keyword">float64</span> <span class="string">`json:"monster_float64"`</span></span><br><span class="line">	Skill    <span class="keyword">string</span>  <span class="string">`json:"monster_skill"`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 序列化后</span></span><br><span class="line">monster序列化后=&#123;<span class="string">"monster_name"</span>:<span class="string">"牛魔王"</span>,<span class="string">"monster_age"</span>:<span class="number">500</span>,<span class="string">"monster_birthday"</span>:<span class="string">"2011-11-11"</span>,<span class="string">"monster_float64"</span>:<span class="number">8000</span>,<span class="string">"monster_skill"</span>:<span class="string">"牛魔拳"</span>&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="14-8-json的反序列化"><a href="#14-8-json的反序列化" class="headerlink" title="14.8 json的反序列化"></a>14.8 json的反序列化</h2><ul>
<li><p>介绍<br>将json字符串转换为对应的数据类型如结构体、切片、数组。</p>
</li>
<li><p>代码实例<br>结构体、map、切片的反序列化</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">func Unmarshal</span><br><span class="line">func Unmarshal(data []byte, v interface&#123;&#125;) error</span><br><span class="line">Unmarshal函数解析json编码的数据并将结果存入v指向的值。</span><br><span class="line"></span><br><span class="line">Unmarshal和Marshal做相反的操作，必要时申请映射、切片或指针，有如下的附加规则：</span><br><span class="line"></span><br><span class="line">要将json数据解码写入一个指针，Unmarshal函数首先处理json数据是json字面值null的情况。</span><br><span class="line">此时，函数将指针设为nil；否则，函数将json数据解码写入指针指向的值；</span><br><span class="line">如果指针本身是nil，函数会先申请一个值并使指针指向它。</span><br><span class="line"></span><br><span class="line">要将json数据解码写入一个结构体，函数会匹配输入对象的键和Marshal使用的键</span><br><span class="line">（结构体字段名或者它的标签指定的键名）。优先选择精确的匹配，但也接受大小写不敏感的</span><br><span class="line">匹配。</span><br><span class="line"></span><br><span class="line">要将json数据解码写入一个接口类型值，函数会将数据解码为如下类型写入接口：</span><br><span class="line"></span><br><span class="line">Bool                   对应JSON布尔类型</span><br><span class="line">float64                对应JSON数字类型</span><br><span class="line">string                 对应JSON字符串类型</span><br><span class="line">[]interface&#123;&#125;          对应JSON数组</span><br><span class="line">map[string]interface&#123;&#125; 对应JSON对象</span><br><span class="line">nil                    对应JSON的null</span><br><span class="line">如果一个JSON值不匹配给出的目标类型，或者如果一个json数字写入目标类型时溢出，Unmarshal</span><br><span class="line">函数会跳过该字段并尽量完成其余的解码操作。如果没有出现更加严重的错误，本函数会返回</span><br><span class="line">一个描述第一个此类错误的详细信息的UnmarshalTypeError。</span><br><span class="line"></span><br><span class="line">JSON的null值解码为go的接口、指针、切片时会将它们设为nil，因为null在json里一般表示“不存在”。 </span><br><span class="line">解码json的null值到其他go类型时，不会造成任何改变，也不会产生错误。</span><br><span class="line"></span><br><span class="line">当解码字符串时，不合法的utf-8或utf-16代理（字符）对不视为错误，而是将非法字符替换为unicode字符U+FFFD。</span><br></pre></td></tr></table></figure>

  <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"encoding/json"</span></span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Monster <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name     <span class="keyword">string</span></span><br><span class="line">	Age      <span class="keyword">int</span></span><br><span class="line">	Birthday <span class="keyword">string</span></span><br><span class="line">	Sal      <span class="keyword">float64</span></span><br><span class="line">	Skill    <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 演示将json字符串，反序列化成结构体</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">unmarshalStruct</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 说明 str 在项目开发中是在网络、读取文件获取到的</span></span><br><span class="line">	str := <span class="string">"&#123;\"Name\":\"牛魔王\",\"Age\":500,\"Birthday\":\"2011-11-11\",\"Sal\":8000,\"Skill\":\"牛魔拳\"&#125;"</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 定义一个monster的实例</span></span><br><span class="line">	<span class="keyword">var</span> monster Monster</span><br><span class="line">	err := json.Unmarshal([]<span class="keyword">byte</span>(str), &amp;monster)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Printf(<span class="string">"unmarshal err=%v\n"</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	fmt.Printf(<span class="string">"反序列化后 monster=%v\n"</span>, monster)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将json字符串，反序列化为map</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">unmarshalMap</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// str := "&#123;\"address\":\"洪崖洞\",\"age\":30,\"name\":\"红孩儿\"&#125;"</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 模拟程序或网络获取的序列化的map</span></span><br><span class="line">	str := testMap()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> a <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">interface</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 反序列化map时，不需要手动make</span></span><br><span class="line">	<span class="comment">// make操作被封装到了unmarshal()函数当中了</span></span><br><span class="line">	err := json.Unmarshal([]<span class="keyword">byte</span>(str), &amp;a)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Printf(<span class="string">"unmarshal err=%v\n"</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	fmt.Printf(<span class="string">"反序列化后 a=%v\n"</span>, a)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将json字符串，反序列化为slice</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">unmarshalSlice</span><span class="params">()</span></span> &#123;</span><br><span class="line">	str := <span class="string">"[&#123;\"address\":\"北京\",\"age\":\"7\",\"name\":\"jack\"&#125;,&#123;\"address\":[\"墨西哥\",\"新加坡\"],\"age\":\"20\",\"name\":\"tom\"&#125;]"</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> slice []<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">interface</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">	err := json.Unmarshal([]<span class="keyword">byte</span>(str), &amp;slice)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Printf(<span class="string">"unmarshal err=%v\n"</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	fmt.Printf(<span class="string">"反序列化后 slice=%v\n"</span>, slice)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将map进行序列化，然后返回序列化后的map</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">testMap</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">	<span class="comment">// 定义一个map</span></span><br><span class="line">	<span class="keyword">var</span> a <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">interface</span>&#123;&#125;</span><br><span class="line">	<span class="comment">// 使用map之前，需要make</span></span><br><span class="line">	a = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">interface</span>&#123;&#125;)</span><br><span class="line"></span><br><span class="line">	a[<span class="string">"name"</span>] = <span class="string">"红孩儿"</span></span><br><span class="line">	a[<span class="string">"age"</span>] = <span class="number">30</span></span><br><span class="line">	a[<span class="string">"address"</span>] = <span class="string">"洪崖洞"</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 将a序列化</span></span><br><span class="line">	data, err := json.Marshal(&amp;a)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Printf(<span class="string">"序列化错误 err=%v\n"</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// // 输出序列化后的结果</span></span><br><span class="line">	<span class="comment">// fmt.Printf("a序列化后=%v\n", string(data))</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">string</span>(data)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	unmarshalStruct()</span><br><span class="line">	unmarshalMap()</span><br><span class="line">	unmarshalSlice()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">反序列化后 monster=&#123;牛魔王 <span class="number">500</span> <span class="number">2011</span><span class="number">-11</span><span class="number">-11</span> <span class="number">8000</span> 牛魔拳&#125;</span><br><span class="line">反序列化后 a=<span class="keyword">map</span>[address:洪崖洞 age:<span class="number">30</span> name:红孩儿]</span><br><span class="line">反序列化后 slice=[<span class="keyword">map</span>[address:北京 age:<span class="number">7</span> name:jack] <span class="keyword">map</span>[address:[墨西哥 新加坡] age:<span class="number">20</span> name:tom]]</span><br></pre></td></tr></table></figure>
</li>
<li><p>对上面代码的小结</p>
<ol>
<li><p>在反序列化一个json串时，要确保反序列化后的数据要与反序列化前的数据类型一致</p>
</li>
<li><p>如果json字符串是通过程序获取的，则不需要对<code>&quot;</code>进行转义处理</p>
</li>
</ol>
</li>
</ul>
<h1 id="第15章-单元测试"><a href="#第15章-单元测试" class="headerlink" title="第15章 单元测试"></a>第15章 单元测试</h1><h2 id="15-1-先看一个需求"><a href="#15-1-先看一个需求" class="headerlink" title="15.1 先看一个需求"></a>15.1 先看一个需求</h2><p>在我们工作中，我们会遇到这种情况，看看实际输出的结果是否和预期的结果一致，如果一致则说明函数运行正确，否则函数有错误，需要修改错误。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">addUpper</span><span class="params">(n <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">	res := <span class="number">0</span></span><br><span class="line">	<span class="keyword">for</span> i:= <span class="number">1</span>;i &lt;= n;i++ &#123;</span><br><span class="line">		res += i</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="15-2-传统的方法"><a href="#15-2-传统的方法" class="headerlink" title="15.2 传统的方法"></a>15.2 传统的方法</h2><h3 id="15-2-1-传统的方式来进行测试"><a href="#15-2-1-传统的方式来进行测试" class="headerlink" title="15.2.1 传统的方式来进行测试"></a>15.2.1 传统的方式来进行测试</h3><p>在main函数中，调用addUpper函数，看看实际输出的结果是否和预期的一致，如果一致，这说明函数正确，否则函数有错误，然后修改错误。</p>
<ul>
<li>代码实现<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 一个被测试函数</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">addUpper</span><span class="params">(n <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">	res := <span class="number">0</span></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">1</span>; i &lt;= n<span class="number">-1</span>; i++ &#123;</span><br><span class="line">		res += i</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 传统的方法，就是在main函数中使用，看看结果是否正确</span></span><br><span class="line">	res := addUpper(<span class="number">10</span>)</span><br><span class="line">	<span class="keyword">if</span> res != <span class="number">55</span> &#123;</span><br><span class="line">		fmt.Printf(<span class="string">"addUpper错误！返回值=%v 期望值=%v"</span>, res, <span class="number">55</span>)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		fmt.Printf(<span class="string">"测试正确 返回值=%v 期望值=%v"</span>, res, <span class="number">55</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">addUpper错误！返回值=<span class="number">45</span> 期望值=<span class="number">55</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="15-2-2-传统方法的缺点分析"><a href="#15-2-2-传统方法的缺点分析" class="headerlink" title="15.2.2 传统方法的缺点分析"></a>15.2.2 传统方法的缺点分析</h3><ol>
<li><p>不方便，我们需要在mian函数中去调用，这样就需要去修改mian函数，如果现在项目正在运行，就可能去停止项目</p>
</li>
<li><p>不利于管理，因为当我们测试多个函数或多个模块是，都需要写在main函数中，不利于我们管理和清晰我们思路</p>
</li>
<li><p>引出单元测试-&gt;testing测试框架，可以很好的解决问题。</p>
</li>
</ol>
<h2 id="15-3-单元测试-基本介绍"><a href="#15-3-单元测试-基本介绍" class="headerlink" title="15.3 单元测试-基本介绍"></a>15.3 单元测试-基本介绍</h2><p>Go语言中自带有一个轻量级的测试框架testing和自带的go test命令还实现单元测试和性能测试，testing框架和其他语言中的测试框架类似，可以基于这个框架写针对相应函数的测试用例，也可以基于该框架写相应的压力测试用例。通过单元测试可以解决的问题如下：</p>
<ol>
<li><p>确保每个函数是可运行，并且运行结果是正确的</p>
</li>
<li><p>确保写出来的代码性能是好的</p>
</li>
<li><p>单元测试能及时的发现程序设计或实现的逻辑错误，使问题及早暴露，便于问题的定位解决，而且性能测试的重点在于发信程序设计上的一些问题，让程序能够在高并发的情况下还能保持稳定。</p>
</li>
</ol>
<h2 id="15-4-单元测-快速入门"><a href="#15-4-单元测-快速入门" class="headerlink" title="15.4 单元测-快速入门"></a>15.4 单元测-快速入门</h2><p>使用Go的单元测试，对addUpper和sub函数进行测试。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">testing 提供对 Go 包的自动化测试的支持。通过 `go test` 命令，能够自动执行如下形式的任何函数：</span><br><span class="line"></span><br><span class="line">func TestXxx(*testing.T)</span><br><span class="line">其中 Xxx 可以是任何字母数字字符串（但第一个字母不能是 [a-z]），用于识别测试例程。</span><br><span class="line"></span><br><span class="line">在这些函数中，使用 Error, Fail 或相关方法来发出失败信号。</span><br><span class="line"></span><br><span class="line">要编写一个新的测试套件，需要创建一个名称以 _test.go 结尾的文件，该文件包含 `TestXxx` 函数，如上所述。 </span><br><span class="line">将该文件放在与被测试的包相同的包中。该文件将被排除在正常的程序包之外，但在运行 “go test” 命令时将被包含。 </span><br><span class="line">有关详细信息，请运行 “go help test” 和 “go help testflag” 了解。</span><br><span class="line"></span><br><span class="line">如果有需要，可以调用 *T 和 *B 的 Skip 方法，跳过该测试或基准测试：</span><br><span class="line"></span><br><span class="line">func TestTimeConsuming(t *testing.T) &#123;</span><br><span class="line">    if testing.Short() &#123;</span><br><span class="line">        t.Skip(&quot;skipping test in short mode.&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="15-4-1-演示如何进行单元测试"><a href="#15-4-1-演示如何进行单元测试" class="headerlink" title="15.4.1 演示如何进行单元测试"></a>15.4.1 演示如何进行单元测试</h3><ul>
<li><p>文件结构：</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">testcase01</span><br><span class="line">    cal.go</span><br><span class="line">    cal_test.go</span><br><span class="line">    sub_test.go</span><br></pre></td></tr></table></figure>
</li>
<li><p>代码实例</p>
  <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// cal.go</span></span><br><span class="line"><span class="keyword">package</span> cal</span><br><span class="line"></span><br><span class="line"><span class="comment">// 一个被测试函数</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">addUpper</span><span class="params">(n <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">	res := <span class="number">0</span></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">1</span>; i &lt;= n; i++ &#123;</span><br><span class="line">		res += i</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 一个被测试函数</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">addUpper2</span><span class="params">(n <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">	res := <span class="number">0</span></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">1</span>; i &lt;= n<span class="number">-1</span>; i++ &#123;</span><br><span class="line">		res += i</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getSub</span><span class="params">(n1 <span class="keyword">int</span>, n2 <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> n1 - n2</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

  <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// cal_test.go</span></span><br><span class="line"><span class="keyword">package</span> cal</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"testing"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 编写要给测试用例，去测试addUpper是否正确</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestAddUpper</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 调用</span></span><br><span class="line">	res := addUpper(<span class="number">10</span>)</span><br><span class="line">	<span class="keyword">if</span> res != <span class="number">55</span> &#123;</span><br><span class="line">		<span class="comment">// fmt.Printf("AddUpper(10) 执行错误，期望值=%v 实际值=%v\n", 55, res)</span></span><br><span class="line">		t.Fatalf(<span class="string">"addUpper(10) 执行错误，期望值=%v 实际值=%v\n"</span>, <span class="number">55</span>, res)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 如果正确，输出日志</span></span><br><span class="line">	t.Logf(<span class="string">"AddUpper(10) 执行正确"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

  <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// sub_test.go</span></span><br><span class="line"><span class="keyword">package</span> cal</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"testing"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestGetSub</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 调用</span></span><br><span class="line">	res := getSub(<span class="number">10</span>, <span class="number">7</span>)</span><br><span class="line">	<span class="keyword">if</span> res != <span class="number">3</span> &#123;</span><br><span class="line">		<span class="comment">// fmt.Printf("AddUpper(10) 执行错误，期望值=%v 实际值=%v\n", 55, res)</span></span><br><span class="line">		t.Fatalf(<span class="string">"getSub(10) 执行错误，期望值=%v 实际值=%v\n"</span>, <span class="number">3</span>, res)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 如果正确，输出日志</span></span><br><span class="line">	t.Logf(<span class="string">"getSub(10) 执行正确"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>  在testcase01文件夹下执行命令<code>go test -v</code>，输出如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">=== RUN   TestAddUpper</span><br><span class="line">--- PASS: TestAddUpper (0.00s)</span><br><span class="line">    cal_test.go:16: AddUpper(10) 执行正确</span><br><span class="line">=== RUN   TestGetSub</span><br><span class="line">--- PASS: TestGetSub (0.00s)</span><br><span class="line">    sub_test.go:15: getSub(10) 执行正确</span><br><span class="line">PASS</span><br><span class="line">ok      gocode/project15/testingdemo/exec01/testcase01  0.386s</span><br></pre></td></tr></table></figure>
</li>
<li><p>底层原理<br>testing框架：</p>
  <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>将xxx_test.<span class="keyword">go</span>的文件引用</span><br><span class="line"><span class="keyword">import</span> ...</span><br><span class="line">main() &#123;</span><br><span class="line">	<span class="comment">// 2.调用TestXxx()函数</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="15-4-2-单元测试快速入门总结"><a href="#15-4-2-单元测试快速入门总结" class="headerlink" title="15.4.2 单元测试快速入门总结"></a>15.4.2 单元测试快速入门总结</h3><ol>
<li><p>测试用例文件名必须以<code>_test.go</code>结尾。比如<code>cal_test.go</code>，cal不是固定的</p>
</li>
<li><p>测试用例函数必须以Test开头，一般来说就是Test+被测试的函数名，比如TestAddUpper。</p>
</li>
<li><p><code>TestAddUpper(t *testing.T)</code>的形参必须是<code>*testing.T</code><br>&emsp;&ensp;<a href="https://studygolang.com/static/pkgdoc/pkg/testing.htm" target="_blank" rel="noopener">testing包详解</a></p>
</li>
<li><p>一个测试用例文件中，可以有多个测试用例函数，比如TestAddUpper、TestSub</p>
</li>
<li><p>运行测试用例指令</p>
<ol>
<li>cmd&gt;go test 【如果运行正确，无日志，错误时会输出日志】</li>
<li>cmd&gt;go test -v 【运行正确或错误，都输出日志】</li>
</ol>
</li>
</ol>
<ol start="6">
<li><p>当出现错误时，可以使用t.Fatalf来格式化输出错误信息，并退出程序</p>
</li>
<li><p>t.Logf方法可以输出相应的日志</p>
</li>
<li><p>测试用例函数，并没有放在main函数中，也执行了，这就是测试用例的方便之处</p>
</li>
<li><p>PASS表示测试用例运行成功，FALL表示测试用例运行失败</p>
</li>
<li><p>测试单个文件一定要带上被测试的源文件<br>&emsp;&ensp;<code>go test -v cal_test.go cal.go</code></p>
</li>
<li><p>测试单个方法<br>&emsp;&ensp;<code>go test -v -test.run TestAddUpper</code></p>
</li>
</ol>
<h1 id="第16章-goroutine（协程）和channel（管道）"><a href="#第16章-goroutine（协程）和channel（管道）" class="headerlink" title="第16章 goroutine（协程）和channel（管道）"></a>第16章 goroutine（协程）和channel（管道）</h1><h2 id="16-1-goroutine-看一个需求"><a href="#16-1-goroutine-看一个需求" class="headerlink" title="16.1 goroutine-看一个需求"></a>16.1 goroutine-看一个需求</h2><ul>
<li>需求：要求统计1-9000000000的数字中，哪些是素数</li>
</ul>
<h2 id="16-2-goroutine-基本介绍"><a href="#16-2-goroutine-基本介绍" class="headerlink" title="16.2 goroutine-基本介绍"></a>16.2 goroutine-基本介绍</h2><h3 id="16-2-1-进程和线程说明"><a href="#16-2-1-进程和线程说明" class="headerlink" title="16.2.1 进程和线程说明"></a>16.2.1 进程和线程说明</h3><ol>
<li><p>进程就是程序在操作系统中的一次执行过程，是系统进行资源分配和调度的基本单位</p>
</li>
<li><p>线程是进程的一个执行实例，是程序执行的最小单位，它是比进程更小的能独立运行的基本单位</p>
</li>
<li><p>一个进程可以创建和销毁多个线程，同一个进程中的多个线程可以并发执行。</p>
</li>
<li><p>一个程序至少有一个进程，一个进程至少有一个线程</p>
</li>
</ol>
<h3 id="16-2-2-并发和并行"><a href="#16-2-2-并发和并行" class="headerlink" title="16.2.2 并发和并行"></a>16.2.2 并发和并行</h3><ol>
<li><p>多线程程序在单核上运行，就是并发<br> 并发的特点：</p>
<ul>
<li>多个额任务在一个CPU上</li>
<li>从微观的角度看，在一个时间点上，其实只有一个任务在执行</li>
</ul>
</li>
<li><p>多线程程序在多核上运行，就是并行<br> 并行的特点：</p>
<ul>
<li>多个任务作用在多个CPU上</li>
<li>从微观的角度看，在一个时间上，就是有多个任务同时执行</li>
<li>这样看来，并行的速度要更快</li>
</ul>
</li>
</ol>
<p><code>并发</code>：因为是在一个CPU上，比如有10个线程，每个线程执行10毫秒（进行轮询操作），从人的角度看，好像这个10个线程都在运行，但是从微观上看，在某一时间点看，其实只有一个线程在执行，这就是并发</p>
<p><code>并行</code>：因为实在多个CPU上（比如有10个CPU），比如有10个线程，每个线程执行10毫秒（各自在不同CPU上执行），从人的角度看，这10个线程都在运行</p>
<h3 id="16-2-3-Go协程和Go主线程"><a href="#16-2-3-Go协程和Go主线程" class="headerlink" title="16.2.3 Go协程和Go主线程"></a>16.2.3 Go协程和Go主线程</h3><ol>
<li><p>Go主线程（有程序员可直接称为线程/也可以理解成进程）：一个Go线程上，可以起多个协程，你可以这样理解，<strong>协程是轻量级线程</strong>。</p>
<p> Go主线程可以有很多个协程</p>
</li>
<li><p>Go协程的特点</p>
<ul>
<li>有独立的栈空间</li>
<li>共享程序堆空间</li>
<li>调度由用户控制</li>
<li>协程是轻量级的线程</li>
</ul>
</li>
</ol>
<h2 id="16-3-goroutine快速入门"><a href="#16-3-goroutine快速入门" class="headerlink" title="16.3 goroutine快速入门"></a>16.3 goroutine快速入门</h2><h3 id="16-3-1-案例说明"><a href="#16-3-1-案例说明" class="headerlink" title="16.3.1 案例说明"></a>16.3.1 案例说明</h3><ul>
<li><p>编写一个程序，完成如下功能</p>
<ol>
<li>在主线程（可以理解成进程）中，开启一个goroutine，该协程每隔1秒输出“hello,world”</li>
<li>在主线程中每隔一秒输出“hello,golang”，输出10次后，退出程序</li>
<li>要求主线程和goroutine同时执行</li>
<li>画出主线程和协程执行流程图</li>
</ol>
</li>
<li><p>代码实现</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"strconv"</span></span><br><span class="line">	<span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 编写一个函数，每隔1秒输出“hello,world”</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt;= <span class="number">10</span>; i++ &#123;</span><br><span class="line">		fmt.Println(<span class="string">"test():hello,world"</span> + strconv.Itoa(i))</span><br><span class="line">		time.Sleep(time.Second)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">go</span> test() <span class="comment">// 开启了一个协程</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt;= <span class="number">10</span>; i++ &#123;</span><br><span class="line">		fmt.Println(<span class="string">"main():hello,golang"</span> + strconv.Itoa(i))</span><br><span class="line">		time.Sleep(time.Second)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">main():hello,golang0</span><br><span class="line">test():hello,world0</span><br><span class="line">test():hello,world1</span><br><span class="line">main():hello,golang1</span><br><span class="line">main():hello,golang2</span><br><span class="line">test():hello,world2</span><br><span class="line">test():hello,world3</span><br><span class="line">main():hello,golang3</span><br><span class="line">main():hello,golang4</span><br><span class="line">test():hello,world4</span><br><span class="line">test():hello,world5</span><br><span class="line">main():hello,golang5</span><br><span class="line">test():hello,world6</span><br><span class="line">main():hello,golang6</span><br><span class="line">main():hello,golang7</span><br><span class="line">test():hello,world7</span><br><span class="line">test():hello,world8</span><br><span class="line">main():hello,golang8</span><br><span class="line">test():hello,world9</span><br><span class="line">main():hello,golang9</span><br><span class="line">main():hello,golang10</span><br><span class="line">test():hello,world10</span><br></pre></td></tr></table></figure>

<p>  主线程和协程执行流程：<br>  <a href="https://imgchr.com/i/K67DOJ" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2019/10/28/K67DOJ.md.png" alt="K67DOJ.md.png"></a></p>
</li>
</ul>
<h3 id="16-3-2-快速入门小结"><a href="#16-3-2-快速入门小结" class="headerlink" title="16.3.2 快速入门小结"></a>16.3.2 快速入门小结</h3><ol>
<li><p>主线程是一个物理线程，直接作用在CPU上的。是重量级的，非常耗费CPU资源。</p>
</li>
<li><p>协程是从主线程开启的，是轻量级的线程，是逻辑态。对资源消耗相对小。</p>
</li>
<li><p>Golang的协程机制是重要的特点，可以轻松的开启上万个协程。其他编程预压你的并发机制一般基于线程的，开启过多的线程，资源耗费大，这里就凸显Golang在并发上面的优势了。</p>
</li>
</ol>
<h2 id="16-4-goroutine的调度模型"><a href="#16-4-goroutine的调度模型" class="headerlink" title="16.4 goroutine的调度模型"></a>16.4 goroutine的调度模型</h2><h3 id="16-4-1-MPG模式基本介绍"><a href="#16-4-1-MPG模式基本介绍" class="headerlink" title="16.4.1 MPG模式基本介绍"></a>16.4.1 MPG模式基本介绍</h3><p><img src="https://s2.ax1x.com/2019/10/28/K6bJP0.png" alt="K6bJP0.png"></p>
<ol>
<li><p>M:操作系统的主线程（是物理线程）</p>
</li>
<li><p>P:协程执行所需的上下文<br> 上下文环境可简单的理解为协程运行所需要的资源、环境</p>
</li>
<li><p>G:协程</p>
</li>
</ol>
<h3 id="16-4-2-MPG模式运行的状态1"><a href="#16-4-2-MPG模式运行的状态1" class="headerlink" title="16.4.2 MPG模式运行的状态1"></a>16.4.2 MPG模式运行的状态1</h3><p><img src="https://s2.ax1x.com/2019/10/28/K6qAL4.png" alt="K6qAL4.png"></p>
<ol>
<li><p>当前程序有3个M，如果3个M都在一个CPU运行，就是并发，如果在不同的CPU运行就是并行</p>
</li>
<li><p>M1,M2,M3正在执行一个G，M1的协程队列有3个，M2的协程队列有3个，M3的协程队列有两个</p>
</li>
<li><p>从上图可以看到：Go的协程是轻量级的线程，是逻辑态的，Go可以容易的起上万个协程。</p>
</li>
<li><p>其他程序c/java的多线程，汪汪是内核态的，比较重量级，几千个线程可能耗光CPU</p>
</li>
</ol>
<h3 id="16-4-3-MPG模式运行的状态2"><a href="#16-4-3-MPG模式运行的状态2" class="headerlink" title="16.4.3 MPG模式运行的状态2"></a>16.4.3 MPG模式运行的状态2</h3><p><img src="https://s2.ax1x.com/2019/10/28/K6LVc8.png" alt="K6LVc8.png"></p>
<ol>
<li><p>分成两个部分来看。</p>
</li>
<li><p>软来的情况是M0主线程正在执行Go协程，另外有三个协程在队列等待。</p>
</li>
<li><p>如果G0协程阻塞，比如读取文件或数据库等。</p>
</li>
<li><p>这是就会创建M1主线程（也可能是从已有的线程池中取M1），并且将等待的3个协程挂到M1下开始执行，M0的主线程下的G0仍然执行文件io的读写。</p>
</li>
<li><p>这样的MPG调度模式，可以即让Go执行，同时也不会让队列的其他协程一直阻塞，仍然可以并发/并行执行。</p>
</li>
<li><p>等到G0不阻塞了，M0会被放到空闲的主线程继续执行（从已有的线程池中取），同时G0又会被唤醒。</p>
</li>
</ol>
<h2 id="16-5-设置Golang如下cpu的个数"><a href="#16-5-设置Golang如下cpu的个数" class="headerlink" title="16.5 设置Golang如下cpu的个数"></a>16.5 设置Golang如下cpu的个数</h2><ul>
<li><p>基本介绍</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">func NumCPU</span><br><span class="line">func NumCPU() int</span><br><span class="line">    NumCPU返回本地机器的逻辑CPU个数。</span><br><span class="line"></span><br><span class="line">func GOMAXPROCS</span><br><span class="line">func GOMAXPROCS(n int) int</span><br><span class="line">    GOMAXPROCS设置可同时执行的最大CPU数，并返回先前的设置。 若 n &lt; 1，它就不会更改当前设置。</span><br><span class="line">本地机器的逻辑CPU数可通过 NumCPU 查询。本函数在调度程序优化后会去掉。</span><br></pre></td></tr></table></figure>
</li>
<li><p>代码演示</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"runtime"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	cpuNum := runtime.NumCPU()</span><br><span class="line">	fmt.Println(<span class="string">"cpuNum="</span>, cpuNum)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 可以自己设置使用多少个CPU</span></span><br><span class="line">	runtime.GOMAXPROCS(cpuNum - <span class="number">1</span>)</span><br><span class="line">	fmt.Println(<span class="string">"ok!"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">cpuNum= <span class="number">8</span></span><br><span class="line">ok!</span><br></pre></td></tr></table></figure>
</li>
<li><p>注意事项</p>
<ol>
<li><p>Go1.8后，默认让程序运行在多核上，可以不用设置</p>
</li>
<li><p>Go1.8前，还是要设置一下，可以更高效的利用CPU</p>
</li>
</ol>
</li>
</ul>
<h2 id="16-6-channel（管道）-看个需求"><a href="#16-6-channel（管道）-看个需求" class="headerlink" title="16.6 channel（管道）-看个需求"></a>16.6 channel（管道）-看个需求</h2><ul>
<li><p>需求：要求计算1-200的各个数的阶乘，并且吧各个数的阶乘放到map中。最后显示出来，要求使用goroutine完成。</p>
</li>
<li><p>分析思路</p>
<ol>
<li>使用goroutine来完成，效率高，但会出现<strong>并发/并行安全问题</strong></li>
<li>这里就提出了不同goroutine如何通信的问题</li>
</ol>
</li>
<li><p>代码实现</p>
<ol>
<li><p>代用goroutine来完成（看看使用goroutine并发完成会出现什么问题）</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 需求：计算1-200的各个数的阶乘，并且将各个数的阶乘放入到map中。</span></span><br><span class="line"><span class="comment">// 最后显示出来，要求使用goroutine完成</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 思路</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	1. 编写一个函数，来计算各个数的阶乘，并放入到一个map当中</span></span><br><span class="line"><span class="comment">	2. 我们启动的协程是多个，统一的将阶层结果放入到map中</span></span><br><span class="line"><span class="comment">	3. map应该做成一个全局的</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line">	myMap = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">int</span>, <span class="number">10</span>)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// test函数就是计算n的阶乘，将这个结果放入到myMap当中</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">(n <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">	res := <span class="number">1</span></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">1</span>; i &lt;= n; i++ &#123;</span><br><span class="line">		res *= i</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 这里我们将res这个结果放入到myMap中</span></span><br><span class="line">	myMap[n] = res <span class="comment">// concurrent map writers?</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 我们这里开启多个协程，完成这个任务</span></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">1</span>; i &lt;= <span class="number">200</span>; i++ &#123;</span><br><span class="line">		<span class="keyword">go</span> test(i)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 休眠10秒钟【第二个问题，等多久？】，看协程是否计算完成</span></span><br><span class="line">	time.Sleep(time.Second * <span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 这里我们输出结果，遍历这个结果</span></span><br><span class="line">	<span class="keyword">for</span> i, v := <span class="keyword">range</span> myMap &#123;</span><br><span class="line">		fmt.Printf(<span class="string">"map[%d]=%d\n"</span>, i, v)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 输出过长，此处不列举</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>在运行某个程序是，如何知道是否存在资源竞争问题。方法很简单，在编译该程序时，增加一个参数<code>-race</code>即可<br>编译时使用<code>go build -race main.go</code>，之后运行<code>main.exe</code>即可<br>关键输出如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">map[9]=362880</span><br><span class="line">map[185]=0</span><br><span class="line">map[167]=0</span><br><span class="line">Found 2 data race(s)</span><br></pre></td></tr></table></figure>
</li>
<li><p>示意图<br> 多个协程同时向map进行了写操作导致出现了问题。<br> <img src="https://s2.ax1x.com/2019/10/28/KcFMss.png" alt="KcFMss.png"></p>
</li>
</ol>
</li>
</ul>
<h3 id="16-6-1-channel（管道）-基本介绍"><a href="#16-6-1-channel（管道）-基本介绍" class="headerlink" title="16.6.1 channel（管道）-基本介绍"></a>16.6.1 channel（管道）-基本介绍</h3><ul>
<li>不同goroutine之间如何通讯<ol>
<li>全局变量加锁同步</li>
<li>使用管道channle来解决</li>
</ol>
</li>
</ul>
<h3 id="16-6-2-使用全局变量加锁同步改进程序"><a href="#16-6-2-使用全局变量加锁同步改进程序" class="headerlink" title="16.6.2 使用全局变量加锁同步改进程序"></a>16.6.2 使用全局变量加锁同步改进程序</h3><ul>
<li>因为没有对全局变量m加锁，因此会出现资源争夺问题，代码会出现错误，提示concurrent map writes</li>
<li>解决方案：加入互斥锁</li>
<li>我们的阶乘很大，结果会越界，可以将阶乘改成sum += uint64(i)<br><img src="https://s2.ax1x.com/2019/10/28/KgZvhq.png" alt="KgZvhq.png"></li>
<li>代码改进<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 第一个改进的地方</span></span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line">	myMap = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">int</span>, <span class="number">10</span>)</span><br><span class="line">	<span class="comment">// 声明一个全局的互斥锁</span></span><br><span class="line">	<span class="comment">// lock 是一个全局的互斥锁</span></span><br><span class="line">	<span class="comment">// sync 是包：synchornized 同步</span></span><br><span class="line">	<span class="comment">// Mutex 是互斥的意思</span></span><br><span class="line">	lock sync.Mutex</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 第二个改进的地方</span></span><br><span class="line"><span class="comment">// 这里我们将res这个结果放入到myMap中</span></span><br><span class="line"><span class="comment">// 加锁</span></span><br><span class="line">lock.Lock()</span><br><span class="line">myMap[n] = res <span class="comment">// concurrent map writers?</span></span><br><span class="line"><span class="comment">// 解锁</span></span><br><span class="line">lock.Unlock()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 第三个改进的地方</span></span><br><span class="line">lock.Lock()</span><br><span class="line"><span class="keyword">for</span> i, v := <span class="keyword">range</span> myMap &#123;</span><br><span class="line">	fmt.Printf(<span class="string">"map[%d]=%d\n"</span>, i, v)</span><br><span class="line">&#125;</span><br><span class="line">lock.Unlock()</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="16-6-3-为什么需要channel"><a href="#16-6-3-为什么需要channel" class="headerlink" title="16.6.3 为什么需要channel"></a>16.6.3 为什么需要channel</h3><ol>
<li><p>前面使用全局变量加锁同步来解决goroutine的通讯，但不完美</p>
</li>
<li><p>主线程在等待所有goroutine全部完成的时间很难确定，我们这里设置10秒钟，仅仅是估算。</p>
</li>
<li><p>如果主线程休眠时间长了，会加长等待时间，可能还有goroutine处于工作状态，这是也会随主线程的退出而销毁</p>
</li>
<li><p>通过全局变量加锁同步来实现通讯，并不利用多个线程对全局变量的读写操作。</p>
</li>
<li><p>上面种种分析都在呼唤一个新的通讯机制-channel</p>
</li>
</ol>
<h3 id="16-6-4-channle的介绍"><a href="#16-6-4-channle的介绍" class="headerlink" title="16.6.4 channle的介绍"></a>16.6.4 channle的介绍</h3><ol>
<li><p>channel本质就是一个数据结构-队列。</p>
</li>
<li><p>数据是先进先出。【FIFO】</p>
</li>
<li><p>线程安全，多goroutine访问时，不需要加锁，就是说channle本身就是线程安全的，不会发生资源竞争问题。</p>
</li>
<li><p>channel是有类型的，一个string的channel只能存放string类型数据</p>
</li>
</ol>
<h3 id="16-6-5-定义-声明"><a href="#16-6-5-定义-声明" class="headerlink" title="16.6.5 定义/声明"></a>16.6.5 定义/声明</h3><p><code>var 变量名 chan 数据类型</code><br>举例：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> intChan vhan <span class="keyword">int</span></span><br><span class="line"><span class="keyword">var</span> mapChan <span class="keyword">chan</span> <span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">string</span></span><br><span class="line"><span class="keyword">var</span> perChan <span class="keyword">chan</span> Person</span><br><span class="line"><span class="keyword">var</span> perChan2 <span class="keyword">chan</span> *Person</span><br></pre></td></tr></table></figure>

<p>说明：</p>
<ol>
<li>channel是引用类型</li>
<li>channel必须初始化后才能写入数据，即make后才能使用</li>
<li>管道是有类型的，intChan只能写入整数int</li>
</ol>
<p>管道的初始化，写入数据到管道，从管道读取数据及基本的注意事项</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 演示一下管道的使用</span></span><br><span class="line">	<span class="comment">// 1. 创建一个可以存放3个int类型的管道</span></span><br><span class="line">	<span class="keyword">var</span> intChan <span class="keyword">chan</span> <span class="keyword">int</span></span><br><span class="line">	intChan = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 2. 看看intChan的值</span></span><br><span class="line">	fmt.Printf(<span class="string">"intChan的值=%v intChan本身的地址=%v\n"</span>, intChan, &amp;intChan)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 3. 向管道写入数据</span></span><br><span class="line">	intChan &lt;- <span class="number">10</span></span><br><span class="line">	num := <span class="number">211</span></span><br><span class="line">	intChan &lt;- num</span><br><span class="line">	intChan &lt;- <span class="number">50</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 注意点：当我们给管道写入数据时，不能超过其容量</span></span><br><span class="line">	<span class="comment">// intChan &lt;- 90</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 4. 看看管道的长度和cap（容量）</span></span><br><span class="line">	fmt.Printf(<span class="string">"channel len = %v cap = %v\n"</span>, <span class="built_in">len</span>(intChan), <span class="built_in">cap</span>(intChan))</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 5. 从管道中读取数据</span></span><br><span class="line">	<span class="keyword">var</span> num2 <span class="keyword">int</span></span><br><span class="line">	num2 = &lt;-intChan</span><br><span class="line">	fmt.Println(<span class="string">"num2="</span>, num2)</span><br><span class="line">	fmt.Printf(<span class="string">"channel len=%v cap=%v \n"</span>, <span class="built_in">len</span>(intChan), <span class="built_in">cap</span>(intChan))</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 6. 在没有协程的情况下，如果我们的管道数据已经全部取出，再取就会报告 deadlock</span></span><br><span class="line"></span><br><span class="line">	num3 := &lt;-intChan</span><br><span class="line">	num4 := &lt;-intChan</span><br><span class="line">	num5 := &lt;-intChan</span><br><span class="line"></span><br><span class="line">	fmt.Println(<span class="string">"num3="</span>, num3, <span class="string">"num4="</span>, num4, <span class="string">"num5="</span>, num5)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">intChan的值=<span class="number">0xc000094080</span> intChan本身的地址=<span class="number">0xc00008a018</span></span><br><span class="line">channel <span class="built_in">len</span> = <span class="number">3</span> <span class="built_in">cap</span> = <span class="number">3</span></span><br><span class="line">num2= <span class="number">10</span></span><br><span class="line">channel <span class="built_in">len</span>=<span class="number">2</span> <span class="built_in">cap</span>=<span class="number">3</span></span><br><span class="line">fatal error: all goroutines are asleep - deadlock!</span><br><span class="line"></span><br><span class="line">goroutine <span class="number">1</span> [<span class="keyword">chan</span> receive]:</span><br><span class="line">main.main()</span><br><span class="line">        E:/ScourceCode/gocode/src/gocode/project16/channeldemo/<span class="number">01</span>-demo/main.<span class="keyword">go</span>:<span class="number">38</span> +<span class="number">0x4d</span>8</span><br><span class="line">exit status <span class="number">2</span></span><br></pre></td></tr></table></figure>

<h3 id="16-6-7-channel使用的注意事项"><a href="#16-6-7-channel使用的注意事项" class="headerlink" title="16.6.7 channel使用的注意事项"></a>16.6.7 channel使用的注意事项</h3><ol>
<li><p>channel只能存放指定的数据类型</p>
</li>
<li><p>channel的数据放满后，就不能再放入</p>
</li>
<li><p>如果从channel取出数据后，可以继续存放了</p>
</li>
<li><p>在没有使用协程的情况，如果channel数据取完了，再取就会报dead lock</p>
</li>
</ol>
<ul>
<li><p>管道的基本使用<br><img src="https://s2.ax1x.com/2019/10/28/Kg1Z6I.md.png" alt="Kg1Z6I.png"><br><img src="https://s2.ax1x.com/2019/10/28/Kg1nnP.md.png" alt="Kg1nnP.png"><br><img src="https://s2.ax1x.com/2019/10/28/Kg1K78.md.png" alt="Kg1K78.png"><br><img src="https://s2.ax1x.com/2019/10/28/Kg1ltg.md.png" alt="Kg1ltg.png"><br><img src="https://s2.ax1x.com/2019/10/28/Kg18pj.md.png" alt="Kg18pj.png"></p>
<ul>
<li>6）空接口类型channel的使用<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Cat <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name <span class="keyword">string</span></span><br><span class="line">	Age  <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 定义一个可以存放任意数据类型的管道 3个数据</span></span><br><span class="line">	<span class="comment">// var allChan chan interface&#123;&#125;</span></span><br><span class="line">	allChan := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">interface</span>&#123;&#125;, <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">	allChan &lt;- <span class="number">10</span></span><br><span class="line">	allChan &lt;- <span class="string">"tom jack"</span></span><br><span class="line">	cat := Cat&#123;<span class="string">"小花猫"</span>, <span class="number">4</span>&#125;</span><br><span class="line">	allChan &lt;- cat</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 我们希望活的到管道中的第三个元素，则先将前两个退出</span></span><br><span class="line">	&lt;-allChan</span><br><span class="line">	&lt;-allChan</span><br><span class="line"></span><br><span class="line">	newCat := &lt;-allChan <span class="comment">// 从管道中取出的Cat是什么？</span></span><br><span class="line">	fmt.Printf(<span class="string">"newCat=%T,newCat=%v\n"</span>, newCat, newCat)</span><br><span class="line">	<span class="comment">// 下面的写法是错误的！编译不通过</span></span><br><span class="line">	<span class="comment">// fmt.Printf("newCat.Name=%v\n", newCat.Name)</span></span><br><span class="line">	<span class="comment">// 使用类型断言</span></span><br><span class="line">	a := newCat.(Cat)</span><br><span class="line">	fmt.Printf(<span class="string">"a.Name=%v\n"</span>, a.Name)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">newCat=main.Cat,newCat=&#123;小花猫 <span class="number">4</span>&#125;</span><br><span class="line">a.Name=小花猫</span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ul>
<h2 id="16-8-channel的遍历和关闭"><a href="#16-8-channel的遍历和关闭" class="headerlink" title="16.8 channel的遍历和关闭"></a>16.8 channel的遍历和关闭</h2><h3 id="16-8-1-channel的遍历"><a href="#16-8-1-channel的遍历" class="headerlink" title="16.8.1 channel的遍历"></a>16.8.1 channel的遍历</h3><p>channel支持for-range的方式遍历，请注意两个细节</p>
<ol>
<li>在遍历时，如果channel没有关闭，则会出现deadlock的错误</li>
<li>在遍历时，如果channel已经关闭，则会正常遍历数据，遍历完后，就会推出遍历<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 遍历管道</span></span><br><span class="line">	intChan2 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, <span class="number">100</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 放入100个数据到管道</span></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">100</span>; i++ &#123;</span><br><span class="line">		intChan2 &lt;- i * <span class="number">2</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 遍历</span></span><br><span class="line">	<span class="comment">// for i := 0; i &lt; len(intChan2); i++ &#123;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 在遍历时，如果channel没有关闭，则会出现deadlock的错误，牢记关闭管道</span></span><br><span class="line">	<span class="built_in">close</span>(intChan2)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> v := <span class="keyword">range</span> intChan2 &#123;</span><br><span class="line">		fmt.Println(<span class="string">"v="</span>, v)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出略</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="16-8-2-channel的关闭"><a href="#16-8-2-channel的关闭" class="headerlink" title="16.8.2 channel的关闭"></a>16.8.2 channel的关闭</h3><p>使用内置函数close可以关闭channel，但channel关闭后，就不能再向channel写数据了，但是仍然可以从该channel读取数据。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">	intChan := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, <span class="number">3</span>)</span><br><span class="line">	intChan &lt;- <span class="number">100</span></span><br><span class="line">	intChan &lt;- <span class="number">200</span></span><br><span class="line">	<span class="built_in">close</span>(intChan)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 这是不能再写入数据到channel</span></span><br><span class="line">	<span class="comment">// intChan &lt;- 300</span></span><br><span class="line">	fmt.Println(<span class="string">"okook"</span>)</span><br><span class="line">	<span class="comment">// 当管道关闭后，读取数据是没问题的</span></span><br><span class="line">	n1 := &lt;-intChan</span><br><span class="line">	fmt.Println(<span class="string">"n1="</span>, n1)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">okook</span><br><span class="line">n1= <span class="number">100</span></span><br></pre></td></tr></table></figure>

<h2 id="16-9-goroutine和channel结合"><a href="#16-9-goroutine和channel结合" class="headerlink" title="16.9 goroutine和channel结合"></a>16.9 goroutine和channel结合</h2><h3 id="16-9-1-应用案例1"><a href="#16-9-1-应用案例1" class="headerlink" title="16.9.1 应用案例1"></a>16.9.1 应用案例1</h3><ol>
<li>开启一个wirteData协程，向管道intChan中写入50个整数</li>
<li>开启一个readData协程，从管道intChan中读取writeData写入的数据</li>
<li>主义：writeData和readData操作的事同一个管道</li>
<li>主线程需要等待writeData和readData协程都完成工作才能退出</li>
</ol>
<ul>
<li><p>思路分析：<br><img src="https://s2.ax1x.com/2019/10/29/K22SLq.png" alt="K22SLq.png"></p>
</li>
<li><p>代码演示</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// write Data</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">writeData</span><span class="params">(intChan <span class="keyword">chan</span> <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">50</span>; i++ &#123;</span><br><span class="line">		<span class="comment">// 放入数据</span></span><br><span class="line">		intChan &lt;- i</span><br><span class="line">		fmt.Println(<span class="string">"writeData"</span>, i)</span><br><span class="line">		<span class="comment">// time.Sleep(time.Second)</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">close</span>(intChan)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// read Data</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">readData</span><span class="params">(intChan <span class="keyword">chan</span> <span class="keyword">int</span>, exitChan <span class="keyword">chan</span> <span class="keyword">bool</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		v, ok := &lt;-intChan</span><br><span class="line">		<span class="keyword">if</span> !ok &#123;</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		&#125;</span><br><span class="line">		fmt.Printf(<span class="string">"readData 读到数据=%v\n"</span>, v)</span><br><span class="line">		<span class="comment">// time.Sleep(time.Second)</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// readData 读取完数据后，即任务完成</span></span><br><span class="line">	exitChan &lt;- <span class="literal">true</span></span><br><span class="line">	<span class="built_in">close</span>(exitChan)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 创建两个管道</span></span><br><span class="line">	intChan := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, <span class="number">50</span>)</span><br><span class="line">	exitChan := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">bool</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">go</span> writeData(intChan)</span><br><span class="line">	<span class="keyword">go</span> readData(intChan, exitChan)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// time.Sleep(time.Second * 10)</span></span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		ok := &lt;-exitChan</span><br><span class="line">		<span class="keyword">if</span> !ok &#123;</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出略</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>channel与goroutine的应用</p>
<ol>
<li><p>启动1个协程，将1-2000的数放入到一个channel中，比如numChan</p>
</li>
<li><p>启动8个协程，从numChan取出数（比如n），并计算1+…+n的值，并存放到resChan</p>
</li>
<li><p>最后8个协程协同完成工作后，再遍历resChan，显示结果[如res[1]=1…res[10]=55..]</p>
</li>
<li><p>注意，考虑resChan chan int 是否合适</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"sort"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> numStruct <span class="keyword">struct</span> &#123;</span><br><span class="line">	num <span class="keyword">int</span></span><br><span class="line">	res <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个通知变量，在7个协程完成工作后</span></span><br><span class="line"><span class="comment">// 第8个协程能及时的关闭结果通道，并通过退出信号通告通知主线程</span></span><br><span class="line"><span class="keyword">var</span> finGoro <span class="keyword">int</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 向numChan中放入数据</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">inputNum</span><span class="params">(numChan <span class="keyword">chan</span> <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">1</span>; i &lt;= <span class="number">2000</span>; i++ &#123;</span><br><span class="line">		numChan &lt;- i</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">close</span>(numChan)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 从numChan中取出数据，并将计算结果放入resChan中</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">inputRes</span><span class="params">(numChan <span class="keyword">chan</span> <span class="keyword">int</span>, resChan <span class="keyword">chan</span> <span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">int</span>, exitChan <span class="keyword">chan</span> <span class="keyword">bool</span>)</span></span> &#123;</span><br><span class="line">	<span class="comment">// 将结果集设计为map类型，方便输出</span></span><br><span class="line">	<span class="keyword">var</span> sum <span class="keyword">int</span></span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		<span class="comment">// 从numChan中取出数据num</span></span><br><span class="line">		num, ok := &lt;-numChan</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 如果通知变量大于等于7则表示这是最后一个运行中的协程</span></span><br><span class="line">		<span class="comment">// 如果numChan中已无待处理数据，则关闭结果通道，并给退出信号通道穿递一个true值</span></span><br><span class="line">		<span class="keyword">if</span> finGoro &gt;= <span class="number">7</span> &#123;</span><br><span class="line">			<span class="keyword">if</span> !ok &#123;</span><br><span class="line">				<span class="built_in">close</span>(resChan)</span><br><span class="line">				exitChan &lt;- <span class="literal">true</span></span><br><span class="line">				<span class="built_in">close</span>(exitChan)</span><br><span class="line">				<span class="keyword">break</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 如果通道关闭则表示待计算的数据计算完毕跳出循环</span></span><br><span class="line">		<span class="keyword">if</span> !ok &#123;</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 计算num的阶和</span></span><br><span class="line">		sum = <span class="number">0</span></span><br><span class="line">		<span class="keyword">for</span> i := <span class="number">1</span>; i &lt;= num; i++ &#123;</span><br><span class="line">			sum += i</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// channel传输的数据采用的是引用传递，因而这里采用这样的方式</span></span><br><span class="line">		<span class="comment">// 每次开辟新的空间，避免之前数据被修改的情况</span></span><br><span class="line">		newResMap := <span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">int</span>&#123;</span><br><span class="line">			num: sum,</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// 将结果map传入map通道当中</span></span><br><span class="line">		resChan &lt;- newResMap</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 协程执行完毕后，通知变量自增</span></span><br><span class="line">	finGoro++</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 初始化通知变量的值</span></span><br><span class="line">	finGoro = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">	numChan := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, <span class="number">250</span>)</span><br><span class="line">	resChan := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">int</span>, <span class="number">2000</span>)</span><br><span class="line">	exitChan := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">bool</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 同时1个输入协程与8个协程输出计算结果</span></span><br><span class="line">	<span class="keyword">go</span> inputNum(numChan)</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">8</span>; i++ &#123;</span><br><span class="line">		<span class="keyword">go</span> inputRes(numChan, resChan, exitChan)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 循环等待退出通道的信号</span></span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		ok := &lt;-exitChan</span><br><span class="line">		<span class="keyword">if</span> !ok &#123;</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 定义一个切片，用于接收结果通道的数据，方便后期处理</span></span><br><span class="line">	sliceResMap := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">int</span>, <span class="number">2000</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 将200个只含一个元素的map整合到1个有200个元素的map当中</span></span><br><span class="line">	<span class="keyword">for</span> k := <span class="keyword">range</span> resChan &#123;</span><br><span class="line">		<span class="keyword">for</span> i, v := <span class="keyword">range</span> k &#123;</span><br><span class="line">			sliceResMap[i] = v</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 想对sliceResMap排序，则需先将sliceResMap中的key取出到一个切片中</span></span><br><span class="line">	<span class="keyword">var</span> keys []<span class="keyword">int</span></span><br><span class="line">	<span class="keyword">for</span> i, _ := <span class="keyword">range</span> sliceResMap &#123;</span><br><span class="line">		keys = <span class="built_in">append</span>(keys, i)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 在通过sort中对int数据排序的方法进行排序</span></span><br><span class="line">	sort.Ints(keys)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 遍历keys切片，将排序后的切片结果取出，进行输出</span></span><br><span class="line">	<span class="keyword">for</span> _, k := <span class="keyword">range</span> keys &#123;</span><br><span class="line">		fmt.Printf(<span class="string">"res[%v]=%v\n"</span>, k, sliceResMap[k])</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
</li>
</ul>
<h3 id="16-9-2-应用实例2-阻塞"><a href="#16-9-2-应用实例2-阻塞" class="headerlink" title="16.9.2 应用实例2-阻塞"></a>16.9.2 应用实例2-阻塞</h3><p><img src="https://s2.ax1x.com/2019/10/29/KfV8oQ.png" alt="KfV8oQ.png"></p>
<h3 id="16-9-3-应用实例3"><a href="#16-9-3-应用实例3" class="headerlink" title="16.9.3 应用实例3"></a>16.9.3 应用实例3</h3><ul>
<li>需求：<br>  要求统计1-8000的数字中，哪些是素数？</li>
<li>分析思路<ul>
<li>传统的方法，就是使用一个循环，循环的判断各个数是不是素数</li>
<li>使用并发/并行的方式，将统计素数的任务分配给多个（4个）goroutine去完成，完成任务时间段。<br><img src="https://s2.ax1x.com/2019/10/29/KfnY7T.png" alt="KfnY7T.png"></li>
</ul>
</li>
<li>代码实现<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 向intChan放入1-8000个数</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">putNum</span><span class="params">(intChan <span class="keyword">chan</span> <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">2</span>; i &lt;= <span class="number">8000</span>; i++ &#123;</span><br><span class="line">		intChan &lt;- i</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 关闭intChan</span></span><br><span class="line">	<span class="built_in">close</span>(intChan)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 从intChan取出数据，并判断是否为素数，如果是</span></span><br><span class="line"><span class="comment">// 就放入到primeChan</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">primeNum</span><span class="params">(intChan <span class="keyword">chan</span> <span class="keyword">int</span>, primeChan <span class="keyword">chan</span> <span class="keyword">int</span>, exitChan <span class="keyword">chan</span> <span class="keyword">bool</span>)</span></span> &#123;</span><br><span class="line">	<span class="comment">// 使用for循环</span></span><br><span class="line">	<span class="keyword">var</span> num <span class="keyword">int</span></span><br><span class="line">	<span class="keyword">var</span> flag, ok <span class="keyword">bool</span></span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		time.Sleep(time.Millisecond * <span class="number">10</span>)</span><br><span class="line">		num, ok = &lt;-intChan</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> !ok &#123; <span class="comment">// intChan取不到</span></span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		flag = <span class="literal">true</span> <span class="comment">// 假设是素数</span></span><br><span class="line">		<span class="comment">// 判断num是不是素数</span></span><br><span class="line">		<span class="keyword">for</span> i := <span class="number">2</span>; i &lt; num; i++ &#123;</span><br><span class="line">			<span class="keyword">if</span> num%i == <span class="number">0</span> &#123;</span><br><span class="line">				<span class="comment">// 说明该num不是素数</span></span><br><span class="line">				flag = <span class="literal">false</span></span><br><span class="line">				<span class="keyword">break</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> flag &#123;</span><br><span class="line">			<span class="comment">// 将这个数放入到primeChan</span></span><br><span class="line">			primeChan &lt;- num</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	fmt.Println(<span class="string">"有一个协程因为取不到数据，退出"</span>)</span><br><span class="line">	<span class="comment">// 这里我们还不能关闭permeChan</span></span><br><span class="line">	<span class="comment">// 向exitChan写入true</span></span><br><span class="line">	exitChan &lt;- <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	intChan := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, <span class="number">1000</span>)</span><br><span class="line">	primeChan := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, <span class="number">2000</span>) <span class="comment">// 放入结果</span></span><br><span class="line">	<span class="comment">// 标识退出的管道</span></span><br><span class="line">	exitChan := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">bool</span>, <span class="number">4</span>) <span class="comment">// 4个</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 开启一个协程，向intChan放入1-8000个数</span></span><br><span class="line">	<span class="keyword">go</span> putNum(intChan)</span><br><span class="line">	<span class="comment">// 开启四个协程，从intChan取出数据，并判断是否为素数，如果是</span></span><br><span class="line">	<span class="comment">// 就放入到primeChan</span></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">4</span>; i++ &#123;</span><br><span class="line">		<span class="keyword">go</span> primeNum(intChan, primeChan, exitChan)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 这里我们主线程要进行处理</span></span><br><span class="line">	<span class="comment">// 直接</span></span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">4</span>; i++ &#123;</span><br><span class="line">			&lt;-exitChan</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// 当我们从exitChan取出了4个结果，就可以放心的关闭primeChan</span></span><br><span class="line">		<span class="built_in">close</span>(primeChan)</span><br><span class="line">		<span class="built_in">close</span>(exitChan)</span><br><span class="line">	&#125;()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 遍历我们的primeChan，把结果取出</span></span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		res, ok := &lt;-primeChan</span><br><span class="line">		<span class="keyword">if</span> !ok &#123;</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// 将结果输出</span></span><br><span class="line">		fmt.Printf(<span class="string">"素数=%d\n"</span>, res)</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(<span class="string">"主线程退出"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出略</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>结论：使用Go协程后，执行的速度，比普通方法至少提高了4倍数（和CPU个数有关）</p>
<h2 id="16-10-channel使用细节和注意事项"><a href="#16-10-channel使用细节和注意事项" class="headerlink" title="16.10 channel使用细节和注意事项"></a>16.10 channel使用细节和注意事项</h2><ol>
<li><p>chanel可以声明为只读，或者只写性质</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 管道可以声明为只读或只写</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 1. 在默认情况下，管道是双向的</span></span><br><span class="line">	<span class="comment">// var cha1 chan int // 可读可写</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 2. 声明为只写</span></span><br><span class="line">	<span class="keyword">var</span> chan2 <span class="keyword">chan</span>&lt;- <span class="keyword">int</span></span><br><span class="line">	chan2 = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, <span class="number">3</span>)</span><br><span class="line">	chan2 &lt;- <span class="number">20</span></span><br><span class="line">	<span class="comment">// num := &lt;-chan2 // error</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 3. 声明为只读</span></span><br><span class="line">	<span class="keyword">var</span> chan3 &lt;-<span class="keyword">chan</span> <span class="keyword">int</span></span><br><span class="line">	num2 := &lt;-chan3</span><br><span class="line"></span><br><span class="line">	fmt.Println(<span class="string">"chan2="</span>, chan2)</span><br><span class="line">	fmt.Println(<span class="string">"num2"</span>, num2)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>channel只读和只写的最佳实践<br> <img src="https://s2.ax1x.com/2019/10/29/KfJlI1.png" alt="KfJlI1.png"></p>
</li>
<li><p>使用select可以解决从管道取数据的阻塞问题</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 使用select可以解决从管道取出数据的阻塞问题</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 1. 定义一个管道 10个数据int</span></span><br><span class="line">	intChan := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, <span class="number">10</span>)</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">		intChan &lt;- i</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 2. 定义一个管道 5个数据istring</span></span><br><span class="line">	stringChan := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">string</span>, <span class="number">5</span>)</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">5</span>; i++ &#123;</span><br><span class="line">		stringChan &lt;- <span class="string">"hello"</span> + fmt.Sprintf(<span class="string">"%d"</span>, i)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 传统的方法在遍历管道时，如果不关闭会阻塞而导致dead lock</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 在实际开发中，可能我们不好确定什么时候关闭该管道</span></span><br><span class="line">	<span class="comment">// 可以使用select方式可以解决</span></span><br><span class="line">label:</span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		<span class="keyword">select</span> &#123;</span><br><span class="line">		<span class="keyword">case</span> v := &lt;-intChan: <span class="comment">// 注意：这里，如果intChan一直没有关闭</span></span><br><span class="line">			<span class="comment">// 不会一直阻塞而deadlock，会自动到下一个case匹配</span></span><br><span class="line">			fmt.Printf(<span class="string">"从intChan读取了数据%d\n"</span>, v)</span><br><span class="line">			time.Sleep(time.Second)</span><br><span class="line">		<span class="keyword">case</span> v := &lt;-stringChan:</span><br><span class="line">			fmt.Printf(<span class="string">"从stringChan读取的数据%s\n"</span>, v)</span><br><span class="line">			time.Sleep(time.Second)</span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">			fmt.Println(<span class="string">"都取不到，不玩了，可以加入自己的逻辑了"</span>)</span><br><span class="line">			time.Sleep(time.Second)</span><br><span class="line">			<span class="comment">// 在协程中直接返回即可</span></span><br><span class="line">			<span class="keyword">break</span> label</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">从intChan读取了数据<span class="number">0</span></span><br><span class="line">从intChan读取了数据<span class="number">1</span></span><br><span class="line">从intChan读取了数据<span class="number">2</span></span><br><span class="line">从intChan读取了数据<span class="number">3</span></span><br><span class="line">从stringChan读取的数据hello0</span><br><span class="line">从stringChan读取的数据hello1</span><br><span class="line">从stringChan读取的数据hello2</span><br><span class="line">从stringChan读取的数据hello3</span><br><span class="line">从intChan读取了数据<span class="number">4</span></span><br><span class="line">从intChan读取了数据<span class="number">5</span></span><br><span class="line">从intChan读取了数据<span class="number">6</span></span><br><span class="line">从stringChan读取的数据hello4</span><br><span class="line">从intChan读取了数据<span class="number">7</span></span><br><span class="line">从intChan读取了数据<span class="number">8</span></span><br><span class="line">从intChan读取了数据<span class="number">9</span></span><br><span class="line">都取不到，不玩了，可以加入自己的逻辑了</span><br></pre></td></tr></table></figure>
</li>
<li><p>goroutine中使用recover，解决协程中出现panic，导致程序崩溃问题</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sayHello</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">		time.Sleep(time.Second)</span><br><span class="line">		fmt.Println(<span class="string">"hello,world"</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 这里我们使用defer + recover</span></span><br><span class="line">	<span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		<span class="comment">// 捕获test抛出的panic</span></span><br><span class="line">		<span class="keyword">if</span> err := <span class="built_in">recover</span>(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">			fmt.Println(<span class="string">"test()发生错误"</span>, err)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;()</span><br><span class="line">	<span class="comment">// 定义一个map</span></span><br><span class="line">	<span class="keyword">var</span> myMap <span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">string</span></span><br><span class="line">	myMap[<span class="number">0</span>] = <span class="string">"golang"</span> <span class="comment">// error</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">go</span> sayHello()</span><br><span class="line">	<span class="keyword">go</span> test()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">		fmt.Println(<span class="string">"main()ok = "</span>, i)</span><br><span class="line">		time.Sleep(time.Second)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">main()ok =  <span class="number">0</span></span><br><span class="line">test()发生错误 assignment to entry in <span class="literal">nil</span> <span class="keyword">map</span></span><br><span class="line">hello,world</span><br><span class="line">main()ok =  <span class="number">1</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<ul>
<li>说明：<br>如果我们起了一个协程，但是这个协程出现了panic，如果我们没有捕获这个panic就会造成程序崩溃，这是我们可以在goroutine中使用recover()来捕获panic，进行处理，这样即使这个协程发生了问题，但是主线程不受影响，可以继续执行。</li>
</ul>
<h1 id="第17章-反射"><a href="#第17章-反射" class="headerlink" title="第17章 反射"></a>第17章 反射</h1><h2 id="17-1-反射的使用场景"><a href="#17-1-反射的使用场景" class="headerlink" title="17.1 反射的使用场景"></a>17.1 反射的使用场景</h2><p>序列化与反序列化是的tag</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> People <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name <span class="keyword">string</span> <span class="string">`json:name`</span></span><br><span class="line">	Age  <span class="keyword">int</span>    <span class="string">`json:age`</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="17-2-使用反射机制，编写函数的适配器：桥连接"><a href="#17-2-使用反射机制，编写函数的适配器：桥连接" class="headerlink" title="17.2 使用反射机制，编写函数的适配器：桥连接"></a>17.2 使用反射机制，编写函数的适配器：桥连接</h2><ol>
<li><p>定义两个匿名函数</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">test1 := <span class="function"><span class="keyword">func</span><span class="params">(v1 <span class="keyword">int</span>, v2 <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">	t.Log(v2, v2)</span><br><span class="line">&#125;</span><br><span class="line">test2 := <span class="function"><span class="keyword">func</span><span class="params">(v1 <span class="keyword">int</span>, v2 <span class="keyword">int</span>, s <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">	t.Log(v1, v2, s)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>定义一个适配器函数用作统一处理接口，其结构大致如下</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">bridge := <span class="function"><span class="keyword">func</span><span class="params">(call <span class="keyword">interface</span>&#123;&#125;, args ...<span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line">	<span class="comment">// 内容</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 实现调用test1()对应的函数</span></span><br><span class="line">bridge(test1, <span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line"><span class="comment">// 实现调用test2()对应的函数</span></span><br><span class="line">bridge(test2, <span class="number">1</span>, <span class="number">2</span>, <span class="string">"test2"</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>要求使用反射机制完成（note：学习reflect后，回头来解决）(go<br>框架)</p>
</li>
</ol>
<h2 id="17-3-反射的基本介绍"><a href="#17-3-反射的基本介绍" class="headerlink" title="17.3 反射的基本介绍"></a>17.3 反射的基本介绍</h2><h3 id="17-3-1-基本介绍"><a href="#17-3-1-基本介绍" class="headerlink" title="17.3.1 基本介绍"></a>17.3.1 基本介绍</h3><ol>
<li><p>反射可以在运行时动态获取变量的各种信息，比如变量的类型（type），类别（kind）</p>
</li>
<li><p>如果是结构体变量，还可以获取到结构体本身的信息（包括结构体的字段、方法）</p>
</li>
<li><p>通过反射，可以修改变量的值，可以调用关联的方法</p>
</li>
<li><p>使用反射，需要<code>import (&quot;reflect&quot;)</code></p>
</li>
<li><p>示意图：<br> <img src="https://s2.ax1x.com/2019/10/30/KhrUk8.png" alt="KhrUk8.png"><br> <a href="https://studygolang.com/static/pkgdoc/pkg/reflect.htm" target="_blank" rel="noopener">reflect包介绍</a></p>
</li>
</ol>
<h2 id="17-3-2-反射的应用场景"><a href="#17-3-2-反射的应用场景" class="headerlink" title="17.3.2 反射的应用场景"></a>17.3.2 反射的应用场景</h2><ul>
<li>反射常见的应用场景有以下两种<ol>
<li>不知道接口调用哪个函数，根据传入函数在运行时确定调用的具体接口，这种需要对函数或方法反射。例如以下的这种桥接模式：<br><code>func bridge(funcPtr interface{}, args ...interface{})</code><br>第一个参数funcPtr以接口的形式传入函数指针，函数参数args以可变参数的形式传入，bridge函数中可以用反射来动态执行funcPtr函数。</li>
<li>对结构体序列化时，如果结构体有指定Tag，也会使用到反射生成对应的字符串。</li>
</ol>
</li>
</ul>
<h2 id="17-3-3-反射重要的函数和概念"><a href="#17-3-3-反射重要的函数和概念" class="headerlink" title="17.3.3 反射重要的函数和概念"></a>17.3.3 反射重要的函数和概念</h2><ol>
<li><p><code>reflect.TypeOf(变量名)</code>，获取变量的类型，返回<code>reflet.Type</code>类型</p>
</li>
<li><p><code>reflect.ValueOf(变量名)</code>，获取变量的值，返回<code>reflect.Vlaue</code>类型。<code>reflect.Value</code>是一个结构体变量。</p>
</li>
<li><p>变量、interface{}和reflect.Value是可以相互转换的，这点在实际开发中，会经常使用到。<br> <img src="https://s2.ax1x.com/2019/10/30/Kh6MfU.png" alt="Kh6MfU.png"><br> <img src="https://s2.ax1x.com/2019/10/30/Kh636J.png" alt="Kh636J.png"></p>
</li>
</ol>
<h2 id="17-4-反射的快速入门"><a href="#17-4-反射的快速入门" class="headerlink" title="17.4 反射的快速入门"></a>17.4 反射的快速入门</h2><h3 id="17-4-1-快速入门说明"><a href="#17-4-1-快速入门说明" class="headerlink" title="17.4.1 快速入门说明"></a>17.4.1 快速入门说明</h3><ul>
<li><p>案例1：<br>  对基本数据类型、interface{}、reflect.Value进行反射的操作。</p>
<ul>
<li>代码演示<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"reflect"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 专门演示反射</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">reflectTest01</span><span class="params">(b <span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 通过反射获取到传入的变量的type，kind，值</span></span><br><span class="line">	<span class="comment">// 1. 先获取到reflect.Type</span></span><br><span class="line">	rTyp := reflect.TypeOf(b)</span><br><span class="line">	fmt.Println(<span class="string">"rTyp ="</span>, rTyp)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 2. 获取到reflect.Value</span></span><br><span class="line">	rVal := reflect.ValueOf(b)</span><br><span class="line">	fmt.Printf(<span class="string">"rVal=%v rval type=%T\n"</span>, rVal, rVal)</span><br><span class="line">	<span class="comment">// 这样才能取到rval中变量的int类型的值</span></span><br><span class="line">	n2 := <span class="number">2</span> + rVal.Int()</span><br><span class="line">	fmt.Println(<span class="string">"n2="</span>, n2)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 下面我们将rVal转成interface&#123;&#125;</span></span><br><span class="line">	iV := rVal.Interface()</span><br><span class="line">	<span class="comment">// 将interface&#123;&#125;通过断言转成需要的类型</span></span><br><span class="line">	num2 := iV.(<span class="keyword">int</span>)</span><br><span class="line">	fmt.Println(<span class="string">"num2="</span>, num2)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 1. 先定义一个int</span></span><br><span class="line">	<span class="keyword">var</span> num <span class="keyword">int</span> = <span class="number">100</span></span><br><span class="line">	reflectTest01(num)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">rTyp = <span class="keyword">int</span></span><br><span class="line">rVal=<span class="number">100</span> rval <span class="keyword">type</span>=reflect.Value</span><br><span class="line">n2= <span class="number">102</span></span><br><span class="line">num2= <span class="number">100</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>案例2：<br>  对结构体类型、interface{}、reflect.Value()进行反射的基本操作。</p>
<ul>
<li>代码演示<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"reflect"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 专门演示反射【对结构体的反射】</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">reflectTest02</span><span class="params">(b <span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line">	<span class="comment">// 通过反射获取到传入的变量的type，kind，值</span></span><br><span class="line">	<span class="comment">// 1. 先获取到reflect.Type</span></span><br><span class="line">	rTyp := reflect.TypeOf(b)</span><br><span class="line">	fmt.Println(<span class="string">"rTyp ="</span>, rTyp)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 2. 获取到reflect.Value</span></span><br><span class="line">	rVal := reflect.ValueOf(b)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 下面我们将rVal转成interface&#123;&#125;</span></span><br><span class="line">	iV := rVal.Interface()</span><br><span class="line">	fmt.Printf(<span class="string">"iV = %v iV = %T\n"</span>, iV, iV)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 错误，编译器无法在编译的时候识别iV的类型</span></span><br><span class="line">	<span class="comment">// fmt.Printf("name=%v\n", iV.Name)</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 将interface&#123;&#125;通过断言转成需要的类型</span></span><br><span class="line">	<span class="comment">// 这里简单实用了一个带检测的类型断言</span></span><br><span class="line">	<span class="comment">// 开发中可以使用switch的断言形式来做的更灵活</span></span><br><span class="line">	stu, ok := iV.(Studnet)</span><br><span class="line">	<span class="keyword">if</span> ok &#123;</span><br><span class="line">		fmt.Printf(<span class="string">"stu.Name=%v\n"</span>, stu.Name)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Studnet <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name <span class="keyword">string</span></span><br><span class="line">	Age  <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// // 1. 先定义一个int</span></span><br><span class="line">	<span class="comment">// var num int = 100</span></span><br><span class="line">	<span class="comment">// reflectTest01(num)</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 2. 定义一个Student实例</span></span><br><span class="line">	stu := Studnet&#123;</span><br><span class="line">		Name: <span class="string">"tom"</span>,</span><br><span class="line">		Age:  <span class="number">20</span>,</span><br><span class="line">	&#125;</span><br><span class="line">	reflectTest02(stu)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">rTyp = main.Studnet</span><br><span class="line">iV = &#123;tom <span class="number">20</span>&#125; iV = main.Studnet</span><br><span class="line">stu.Name=tom</span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ul>
<h2 id="17-5-反射的注意事项和细节"><a href="#17-5-反射的注意事项和细节" class="headerlink" title="17.5 反射的注意事项和细节"></a>17.5 反射的注意事项和细节</h2><ol>
<li><p>reflect.Value.Kind，获取变量的类型，返回的是一个常量</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">func (Value) Kind</span><br><span class="line">  func (v Value) Kind() Kind</span><br><span class="line">  Kind返回v持有的值的分类，如果v是Value零值，返回值为Invalid</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">type Kind</span><br><span class="line">  type Kind uint</span><br><span class="line">  Kind代表Type类型值表示的具体分类。零值表示非法分类。</span><br><span class="line"></span><br><span class="line">const (</span><br><span class="line">    Invalid Kind = iota</span><br><span class="line">    Bool</span><br><span class="line">    Int</span><br><span class="line">    Int8</span><br><span class="line">    Int16</span><br><span class="line">    Int32</span><br><span class="line">    Int64</span><br><span class="line">    Uint</span><br><span class="line">    Uint8</span><br><span class="line">    Uint16</span><br><span class="line">    Uint32</span><br><span class="line">    Uint64</span><br><span class="line">    Uintptr</span><br><span class="line">    Float32</span><br><span class="line">    Float64</span><br><span class="line">    Complex64</span><br><span class="line">    Complex128</span><br><span class="line">    Array</span><br><span class="line">    Chan</span><br><span class="line">    Func</span><br><span class="line">    Interface</span><br><span class="line">    Map</span><br><span class="line">    Ptr</span><br><span class="line">    Slice</span><br><span class="line">    String</span><br><span class="line">    Struct</span><br><span class="line">    UnsafePointer</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>Type</code>是类型，<code>Kind</code>是类别，<code>Type</code>和<code>Kind</code>可能是相同的，也可能是不同的。</p>
<ul>
<li>比如：<code>var num int = 10</code><br>  num的<code>Type</code>是<code>int</code>，<code>Kind</code>也是<code>int</code></li>
<li>比如：<code>var stu Student</code><br>  stu的<code>Type</code>是<code>包名.Student</code>，<code>Kind</code>是<code>struct</code></li>
</ul>
</li>
</ol>
<ol start="3">
<li><p>通过反射可以让变量在<code>interface{}</code>和<code>Reflect.Value</code>之间互相切换，这点在前面画过示意图并在快速入门案例中将结果，这里我们看下如何在代码中体现。</p>
</li>
<li><p>使用反射的方式来获取变量的值（并返回对应的类型），要求数据类型匹配，比如x是<code>int</code>，那么就应该使用<code>reflect.Value(x).Int</code>，而不能使用其它的，否者报<code>panic</code></p>
</li>
<li><p>通过反射的来修改变量，注意当使用SetXxx方法来设置需要通过对应的指针类型来完成，这样才能改变传入的变量的值，同时需要使用reflect.Value.Elem()方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">func (Value) Elem</span><br><span class="line">  func (v Value) Elem() Value</span><br><span class="line">  Elem返回v持有的接口保管的值的Value封装，或者v持有的指针指向的值的Value封装。</span><br><span class="line">  如果v的Kind不是Interface或Ptr会panic；如果v持有的值为nil，会返回Value零值。</span><br></pre></td></tr></table></figure>

 <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"reflect"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">通过反射，修改</span></span><br><span class="line"><span class="comment">	num int的值</span></span><br><span class="line"><span class="comment">	student 的值</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">reflect01</span><span class="params">(b <span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line">	<span class="comment">// 2. 获取到reflect.Value</span></span><br><span class="line">	rVal := reflect.ValueOf(b)</span><br><span class="line">	<span class="comment">// 看看rVal的Kind是什么</span></span><br><span class="line">	fmt.Printf(<span class="string">"rval kind=%v\n"</span>, rVal.Kind())</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 3. rVal</span></span><br><span class="line">	<span class="comment">// Elem返回v持有的接口保管的值的Value封装，或者v持有的指针指向的值的Value封装。</span></span><br><span class="line">	rVal.Elem().SetInt(<span class="number">20</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> num <span class="keyword">int</span> = <span class="number">10</span></span><br><span class="line">	reflect01(&amp;num)</span><br><span class="line">	fmt.Println(<span class="string">"num ="</span>, num)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">rval kind=ptr</span><br><span class="line">num = <span class="number">20</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>reflect.Value().Elem()应该如何理解？</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// rVal.Elem()用于获取指针指向的变量，类似</span></span><br><span class="line"><span class="keyword">var</span> num = <span class="number">10</span></span><br><span class="line"><span class="keyword">var</span> b *<span class="keyword">int</span> = &amp;num</span><br><span class="line">*b = <span class="number">3</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="17-6-小练习"><a href="#17-6-小练习" class="headerlink" title="17.6 小练习"></a>17.6 小练习</h2><ol>
<li><p>给你一个变量<code>var v float64 = 1.2</code>，请使用反射来得到它的<code>reflect.Value</code>，然后获取对应的<code>Type</code>，<code>Kind</code>和值，并将<code>reflect.Value</code>转换成<code>interface{}</code>再将<code>interface{}</code>转换成<code>float64</code></p>
<ul>
<li>代码演示<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"reflect"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	给你一个变量 var v float64 = 1.2</span></span><br><span class="line"><span class="comment">	请使用反射来得到它的 reflect.Value</span></span><br><span class="line"><span class="comment">	然后获取对应的Type，Kind和值</span></span><br><span class="line"><span class="comment">	并将 reflect.Value 转换成 interface&#123;&#125;</span></span><br><span class="line"><span class="comment">	再将 interface&#123;&#125; 转换成 float64</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义反射函数</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">reflectFloat64</span><span class="params">(b <span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line">	<span class="comment">// 1. 获取Value</span></span><br><span class="line">	rVal := reflect.ValueOf(b)</span><br><span class="line">	fmt.Printf(<span class="string">"reflect.Value() = %v\n"</span>, rVal)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 2. 获取Type</span></span><br><span class="line">	rTyp := reflect.TypeOf(b)</span><br><span class="line">	fmt.Printf(<span class="string">"reflect.Type() = %v\n"</span>, rTyp)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 3. 获取Kind</span></span><br><span class="line">	rKin := rVal.Kind()</span><br><span class="line">	fmt.Printf(<span class="string">"reflect.Kind() = %v\n"</span>, rKin)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 4. 将rVal 转换成interfac&#123;&#125;</span></span><br><span class="line">	fV := rVal.Interface()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 将interface&#123;&#125;转换成float64</span></span><br><span class="line">	v := fV.(<span class="keyword">float64</span>)</span><br><span class="line"></span><br><span class="line">	fmt.Printf(<span class="string">"获取到的值 = %v\n"</span>, v)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> v <span class="keyword">float64</span> = <span class="number">1.2</span></span><br><span class="line">	reflectFloat64(v)</span><br><span class="line">	fmt.Println()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">reflect.Value() = <span class="number">1.2</span></span><br><span class="line">reflect.Type() = <span class="keyword">float64</span></span><br><span class="line">reflect.Kind() = <span class="keyword">float64</span></span><br><span class="line">获取到的值 = <span class="number">1.2</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>判断代码是否正确</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"reflect"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> str <span class="keyword">string</span> = <span class="string">"tom"</span> <span class="comment">// ok</span></span><br><span class="line"></span><br><span class="line">	fs := reflect.ValueOf(str) <span class="comment">// ok fs-&gt;string</span></span><br><span class="line">	fs.SetString(<span class="string">"jack"</span>) <span class="comment">// error</span></span><br><span class="line">	fmt.Printf(<span class="string">"%v\n"</span>, str)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line"><span class="built_in">panic</span>: reflect: reflect.Value.SetString using unaddressable value</span><br><span class="line"></span><br><span class="line">goroutine <span class="number">1</span> [running]:</span><br><span class="line">reflect.flag.mustBeAssignable(<span class="number">0x98</span>)</span><br></pre></td></tr></table></figure>

<p> 更改后：</p>
 <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"reflect"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> str <span class="keyword">string</span> = <span class="string">"tom"</span> <span class="comment">// ok</span></span><br><span class="line"></span><br><span class="line">	fs := reflect.ValueOf(&amp;str) <span class="comment">// ok fs-&gt;string</span></span><br><span class="line">	fs.Elem().SetString(<span class="string">"jack"</span>) <span class="comment">// ok</span></span><br><span class="line">	fmt.Printf(<span class="string">"%v\n"</span>, str)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">jack</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="17-7-反射的最佳实践"><a href="#17-7-反射的最佳实践" class="headerlink" title="17.7 反射的最佳实践"></a>17.7 反射的最佳实践</h2><ol>
<li>使用反射遍历结构体的字段，调用结构体的方法，并获取结构体标签的值<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">func (Value) Method</span><br><span class="line">  func (v Value) Method(i int) Value</span><br><span class="line">  返回v持有值类型的第i个方法的已绑定（到v的持有值的）状态的函数形式的Value封装。</span><br><span class="line">  返回值调用Call方法时不应包含接收者；</span><br><span class="line">  返回值持有的函数总是使用v的持有者作为接收者（即第一个参数）。</span><br><span class="line">  如果i出界，或者v的持有值是接口类型的零值（nil），会panic。</span><br><span class="line"></span><br><span class="line">func (Value) Call</span><br><span class="line">  func (v Value) Call(in []Value) []Value</span><br><span class="line">  Call方法使用输入的参数in调用v持有的函数</span><br><span class="line">  例如，如果len(in) == 3，v.Call(in)代表调用v(in[0], in[1], in[2])（其中Value值表示其持有值）。</span><br><span class="line">  如果v的Kind不是Func会panic。它返回函数所有输出结果的Value封装的切片。</span><br><span class="line">  和go代码一样，每一个输入实参的持有值都必须可以直接赋值给函数对应输入参数的类型。</span><br><span class="line">  如果v持有值是可变参数函数，Call方法会自行创建一个代表可变参数的切片，将对应可变参数的值都拷贝到里面。</span><br></pre></td></tr></table></figure>
</li>
</ol>
<ul>
<li>代码实例  <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"reflect"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义了Monster结构体</span></span><br><span class="line"><span class="keyword">type</span> Monster <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name  <span class="keyword">string</span>  <span class="string">`json:"name"`</span></span><br><span class="line">	Age   <span class="keyword">int</span>     <span class="string">`json:"monster_age"`</span></span><br><span class="line">	Score <span class="keyword">float32</span> <span class="string">`json:"成绩"`</span></span><br><span class="line">	Sex   <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方法，显示s的值</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s Monster)</span> <span class="title">Print</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">"---start---"</span>)</span><br><span class="line">	fmt.Println(s)</span><br><span class="line">	fmt.Println(<span class="string">"---end---"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方法，返回两个数的和</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s Monster)</span> <span class="title">GetSum</span><span class="params">(n1, n2 <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> n1 + n2</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方法，接收4个值，给Monster赋值</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s Monster)</span> <span class="title">Set</span><span class="params">(name <span class="keyword">string</span>, age <span class="keyword">int</span>, score <span class="keyword">float32</span>, sex <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">	s.Name = name</span><br><span class="line">	s.Age = age</span><br><span class="line">	s.Score = score</span><br><span class="line">	s.Sex = sex</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestStruct</span><span class="params">(a <span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line">	<span class="comment">// 获取refle.Type 类型</span></span><br><span class="line">	typ := reflect.TypeOf(a)</span><br><span class="line">	<span class="comment">// 获取refle.Value类型</span></span><br><span class="line">	val := reflect.ValueOf(a)</span><br><span class="line">	<span class="comment">// 获取到a对应的类别</span></span><br><span class="line">	kd := val.Kind()</span><br><span class="line">	<span class="comment">// 如果传入的不是struct，就退出</span></span><br><span class="line">	<span class="keyword">if</span> kd != reflect.Struct &#123;</span><br><span class="line">		fmt.Println(<span class="string">"expect struct"</span>)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 获取到该结构体有几个字段</span></span><br><span class="line">	num := val.NumField()</span><br><span class="line">	fmt.Printf(<span class="string">"struct has %d fields\n"</span>, num)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 遍历结构体所有字段</span></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; num; i++ &#123;</span><br><span class="line">		fmt.Printf(<span class="string">"Field %d: 值为 = %v\n"</span>, i, val.Field(i))</span><br><span class="line">		<span class="comment">// 获取到struct标签，注意需要通过reflect.Type来获取tag标签的值</span></span><br><span class="line">		tagVal := typ.Field(i).Tag.Get(<span class="string">"json"</span>)</span><br><span class="line">		<span class="comment">// 如果该字段有标签则显示，没有则不显示</span></span><br><span class="line">		<span class="keyword">if</span> tagVal != <span class="string">""</span> &#123;</span><br><span class="line">			fmt.Printf(<span class="string">"Field %d: tag为 = %v\n"</span>, i, tagVal)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 获取到该结构体有多少个方法</span></span><br><span class="line">	numOfMethod := val.NumMethod()</span><br><span class="line">	fmt.Printf(<span class="string">"struct has %d methods\n"</span>, numOfMethod)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// var params []reflect.Value</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 方法的排序默认是按照函数名的排序（ASCII码）</span></span><br><span class="line">	<span class="comment">// 获取到第2个方法，并调用，传入nil</span></span><br><span class="line">	val.Method(<span class="number">1</span>).Call(<span class="literal">nil</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 调用结构体的第1个方法Method(0)</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 声明了 []reflect.Value</span></span><br><span class="line">	<span class="keyword">var</span> params []reflect.Value </span><br><span class="line"></span><br><span class="line">	params = <span class="built_in">append</span>(params, reflect.ValueOf(<span class="number">10</span>))</span><br><span class="line">	params = <span class="built_in">append</span>(params, reflect.ValueOf(<span class="number">40</span>))</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 传入的参数是 []reflect.Value，返回[]reflect.Value</span></span><br><span class="line">	res := val.Method(<span class="number">0</span>).Call(params)  </span><br><span class="line"></span><br><span class="line">	<span class="comment">// 返回结果，返回的结果是 []reflect.Value</span></span><br><span class="line">	fmt.Println(<span class="string">"res ="</span>, res[<span class="number">0</span>].Int()) </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 创建了一个Monster实例</span></span><br><span class="line">	<span class="keyword">var</span> a Monster = Monster&#123;</span><br><span class="line">		Name:  <span class="string">"黄鼠狼精"</span>,</span><br><span class="line">		Age:   <span class="number">400</span>,</span><br><span class="line">		Score: <span class="number">30.8</span>,</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 将Monster实例传递给了TestStruct(a)</span></span><br><span class="line">	TestStruct(a)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line"><span class="keyword">struct</span> has <span class="number">4</span> fields</span><br><span class="line">Field <span class="number">0</span>: 值为 = 黄鼠狼精</span><br><span class="line">Field <span class="number">0</span>: tag为 = name</span><br><span class="line">Field <span class="number">1</span>: 值为 = <span class="number">400</span></span><br><span class="line">Field <span class="number">1</span>: tag为 = monster_age</span><br><span class="line">Field <span class="number">2</span>: 值为 = <span class="number">30.8</span></span><br><span class="line">Field <span class="number">2</span>: tag为 = 成绩</span><br><span class="line">Field <span class="number">3</span>: 值为 =</span><br><span class="line"><span class="keyword">struct</span> has <span class="number">3</span> methods</span><br><span class="line">---start---</span><br><span class="line">&#123;黄鼠狼精 <span class="number">400</span> <span class="number">30.8</span> &#125;</span><br><span class="line">---end---</span><br><span class="line">res = <span class="number">50</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<ol start="2">
<li><p>使用反射的方式来获取结构体的tag标签，遍历字段的值，修改字段值，调用结构体方法（要求：通过传递地址的方式完成，在前面案例上修改即可）</p>
</li>
<li><p>定义两个函数<code>test1</code>和<code>test2</code>，定义一个适配器函数用作统一处理接口：</p>
<ol>
<li><p>定义了两个函数</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">test1 := <span class="function"><span class="keyword">func</span><span class="params">(v1, v2 <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">	t.Log(v1, v2)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">test2 := <span class="function"><span class="keyword">func</span><span class="params">(v1, v2 <span class="keyword">int</span>, s <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">	t.Log(v1, v2, s)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>定义一个适配器函数作统一处理接口，其大致结构如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">bridge := <span class="function"><span class="keyword">func</span><span class="params">(call <span class="keyword">interface</span>&#123;&#125;, args ...<span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line">	<span class="comment">// 内容</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现调用test1对应的函数</span></span><br><span class="line">bridge(test1, <span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现调用test2对应的函数</span></span><br><span class="line">bridge(test2, <span class="number">1</span>, <span class="number">2</span>, <span class="string">"test2"</span>)</span><br></pre></td></tr></table></figure>
</li>
</ol>
<ul>
<li>代码实例<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> test</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"testing"</span></span><br><span class="line">	<span class="string">"reflect"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 文件命名 xxx_test.go</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestReflectFunc</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">	call1 := <span class="function"><span class="keyword">func</span><span class="params">(v1 <span class="keyword">int</span>, v2 <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">		t.Log(v1, v2)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	call2 := <span class="function"><span class="keyword">func</span><span class="params">(v1 <span class="keyword">int</span>, v2 <span class="keyword">int</span>, s <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">		t.Log(v1, v2, s)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> (</span><br><span class="line">		function reflect.Value</span><br><span class="line">		inValue []reflect.Value</span><br><span class="line">		n <span class="keyword">int</span></span><br><span class="line">	)</span><br><span class="line"></span><br><span class="line">	bridge := <span class="function"><span class="keyword">func</span><span class="params">(call <span class="keyword">interface</span>&#123;&#125;, args ...<span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line">		n = <span class="built_in">len</span>(args)</span><br><span class="line">		inValue = <span class="built_in">make</span>([]reflect.Value, n)</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; n; i++ &#123;</span><br><span class="line">			inValue[i] = reflect.ValueOf(args[i])</span><br><span class="line">		&#125;</span><br><span class="line">		function = reflect.ValueOf(call)</span><br><span class="line">		function.Call(inValue)</span><br><span class="line">	&#125;</span><br><span class="line">	bridge(call1, <span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">	bridge(call2, <span class="number">1</span>, <span class="number">2</span>, <span class="string">"test2"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>使用反射去操作任意的结构体【了解】</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> test</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> user <span class="keyword">struct</span> &#123;</span><br><span class="line">	UserId <span class="keyword">string</span></span><br><span class="line">	Name   <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 文件命名 xxx_test.go</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestReflectStruct</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> (</span><br><span class="line">		model *user</span><br><span class="line">		sv reflect.Value</span><br><span class="line">	)</span><br><span class="line">	model = &amp;user&#123;&#125;</span><br><span class="line">	sv = reflect.ValueOf(model)</span><br><span class="line">	t.Log(<span class="string">"reflect.ValueOf"</span>, sv.Kind().String())</span><br><span class="line">	sv = sv.Elem()</span><br><span class="line">	t.Log(<span class="string">"reflect.ValueOf.Elm"</span>, sv.Kind().String())</span><br><span class="line">	sv.FieldByName(<span class="string">"UserId"</span>).SetString(<span class="string">"12345678"</span>)</span><br><span class="line">	sv.FieldByName(<span class="string">"Name"</span>).SetString(<span class="string">"nickname"</span>)</span><br><span class="line">	t.Log(<span class="string">"model"</span>, model)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用反射创建并操作结构体：【了解】</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> test_02</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"reflect"</span></span><br><span class="line">	<span class="string">"testing"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> user <span class="keyword">struct</span> &#123;</span><br><span class="line">	UserId <span class="keyword">string</span></span><br><span class="line">	Name   <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestReflectStructPtr</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> (</span><br><span class="line">		model *user</span><br><span class="line">		st    reflect.Type</span><br><span class="line">		elem  reflect.Value</span><br><span class="line">	)</span><br><span class="line"></span><br><span class="line">	st = reflect.TypeOf(model)                       </span><br><span class="line">	<span class="comment">// 获取类型*user</span></span><br><span class="line">	t.Log(<span class="string">"reflect.TypeOf"</span>, st.Kind().String())      </span><br><span class="line">	<span class="comment">// ptr</span></span><br><span class="line">	st = st.Elem()                                  </span><br><span class="line">	<span class="comment">// st指向的类型</span></span><br><span class="line">	t.Log(<span class="string">"reflect.TypeOf.Elem"</span>, st.Kind().String()) </span><br><span class="line">	<span class="comment">// struct</span></span><br><span class="line"></span><br><span class="line">	elem = reflect.New(st)</span><br><span class="line">	<span class="comment">// New返回一个value类型值，该值持有一个指向类型为type的新申请的零值指针</span></span><br><span class="line">	t.Log(<span class="string">"reflect.New"</span>, elem.Kind().String())             <span class="comment">// ptr</span></span><br><span class="line">	t.Log(<span class="string">"reflect.New.Elem"</span>, elem.Elem().Kind().String()) <span class="comment">// struct</span></span><br><span class="line">	<span class="comment">// model 就是创建的user结构体变量（实例）</span></span><br><span class="line"></span><br><span class="line">	model = elem.Interface().(*user)                 </span><br><span class="line">	<span class="comment">// model是*user它的指向和elem是一样的</span></span><br><span class="line">	elem = elem.Elem()                               </span><br><span class="line">	<span class="comment">// 取得elem指向的值</span></span><br><span class="line">	elem.FieldByName(<span class="string">"UserId"</span>).SetString(<span class="string">"12345678"</span>) </span><br><span class="line">	<span class="comment">// 赋值</span></span><br><span class="line">	elem.FieldByName(<span class="string">"Name"</span>).SetString(<span class="string">"nickname"</span>)</span><br><span class="line">	t.Log(<span class="string">"model model.Name"</span>, model, model.Name)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">=== RUN   TestReflectStructPtr</span><br><span class="line">--- PASS: TestReflectStructPtr (<span class="number">0.00s</span>)</span><br><span class="line">    model_test.<span class="keyword">go</span>:<span class="number">21</span>: reflect.TypeOf ptr</span><br><span class="line">    model_test.<span class="keyword">go</span>:<span class="number">23</span>: reflect.TypeOf.Elem <span class="keyword">struct</span></span><br><span class="line">    model_test.<span class="keyword">go</span>:<span class="number">26</span>: reflect.New ptr</span><br><span class="line">    model_test.<span class="keyword">go</span>:<span class="number">27</span>: reflect.New.Elem <span class="keyword">struct</span></span><br><span class="line">    model_test.<span class="keyword">go</span>:<span class="number">33</span>: model model.Name &amp;&#123;<span class="number">12345678</span> nickname&#125; nickname</span><br><span class="line">PASS</span><br><span class="line">ok      command-line-arguments  <span class="number">0.428s</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<h1 id="第18章-TCP编程"><a href="#第18章-TCP编程" class="headerlink" title="第18章 TCP编程"></a>第18章 TCP编程</h1><ul>
<li><p>网络编程分为两种</p>
<ol>
<li>TCP socket编程</li>
<li>b/s结构的http编程</li>
</ol>
</li>
<li><p>OSI与TCP/IP参考模型 *****
  <img src="https://s2.ax1x.com/2019/11/06/MPiurR.png" alt="MPiurR.png"></p>
</li>
</ul>
<h2 id="18-2-端口"><a href="#18-2-端口" class="headerlink" title="18.2 端口"></a>18.2 端口</h2><h2 id="18-2-1-端口的基本知识"><a href="#18-2-1-端口的基本知识" class="headerlink" title="18.2.1 端口的基本知识"></a>18.2.1 端口的基本知识</h2><ul>
<li><p>一台电脑有65535个端口</p>
</li>
<li><p>0号是保留端口</p>
</li>
<li><p>常见端口（1-1024）<br>  <code>22</code>：SSH远程登录协议<br>  <code>23</code>：Tenlnet使用<br>  <code>21</code>：FTP使用<br>  <code>25</code>：smtp服务使用<br>  <code>80</code>：IIS使用<br>  <code>7</code>&ensp;：echo服务使用</p>
</li>
</ul>
<h2 id="18-2-2-端口使用注意事项"><a href="#18-2-2-端口使用注意事项" class="headerlink" title="18.2.2 端口使用注意事项"></a>18.2.2 端口使用注意事项</h2><ol>
<li><p>在计算机（尤其是服务器）要尽可能的少开端口</p>
</li>
<li><p>一个端口只能被一个程序监听</p>
</li>
<li><p>如果使用<code>netstat -an</code>可以查看本机有哪些端口在监听</p>
</li>
<li><p>可以使用<code>netstat -anb</code>来查看监听端口的pid，再结合任务管理器关闭不安全的端口</p>
</li>
</ol>
<h2 id="18-3-TCP-socket编程的快速入门"><a href="#18-3-TCP-socket编程的快速入门" class="headerlink" title="18.3 TCP socket编程的快速入门"></a>18.3 TCP socket编程的快速入门</h2><h3 id="18-3-1-服务端的处理流程"><a href="#18-3-1-服务端的处理流程" class="headerlink" title="18.3.1 服务端的处理流程"></a>18.3.1 服务端的处理流程</h3><ol>
<li>监听端口（8888）</li>
<li>接收客户端的tcp连接，建立客户端和服务器端的连接</li>
<li>创建goroutine，处理该连接的请求（通常客户端会通过连接发送请求包）</li>
</ol>
<h3 id="18-3-2-客户端的处理流程"><a href="#18-3-2-客户端的处理流程" class="headerlink" title="18.3.2 客户端的处理流程"></a>18.3.2 客户端的处理流程</h3><ol>
<li>建立与服务端的连接</li>
<li>发送请求数据（终端），接收服务器端返回的结果数据</li>
<li>关闭连接</li>
</ol>
<h3 id="18-3-3-Go服务器-客户端原理图"><a href="#18-3-3-Go服务器-客户端原理图" class="headerlink" title="18.3.3 Go服务器/客户端原理图"></a>18.3.3 Go服务器/客户端原理图</h3><p><img src="https://s2.ax1x.com/2019/11/06/MP1tSA.png" alt="MP1tSA.png"></p>
<h3 id="18-3-4-代码实现"><a href="#18-3-4-代码实现" class="headerlink" title="18.3.4 代码实现"></a>18.3.4 代码实现</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// server.go</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"net"</span> <span class="comment">// 做socket开发时，net包含了我们需要所有的方法和函数</span></span><br><span class="line">	<span class="string">"strings"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">process</span><span class="params">(conn net.Conn)</span></span> &#123;</span><br><span class="line">	<span class="comment">// 这里我们循环接收客户端发送的数据</span></span><br><span class="line">	<span class="keyword">defer</span> conn.Close() <span class="comment">// 这个连接要关闭</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		<span class="comment">// 创建一个新的切片</span></span><br><span class="line">		buf := <span class="built_in">make</span>([]<span class="keyword">byte</span>, <span class="number">1024</span>)</span><br><span class="line">		<span class="comment">// 1. 等待客户端通过conn发送信息</span></span><br><span class="line">		<span class="comment">// 2. 如果客户端没有write发送，那么协程就阻塞在这里</span></span><br><span class="line">		fmt.Println(<span class="string">"服务器在等待客户端发送信息"</span> + conn.RemoteAddr().String())</span><br><span class="line">		n, err := conn.Read(buf) <span class="comment">// 从conn读取，n表示读取到了多少字节</span></span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			fmt.Println(<span class="string">"Server Read err="</span>, err)</span><br><span class="line">			<span class="keyword">return</span> <span class="comment">// 重要</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// 去除回车、换行后的消息是"exit"的话，就退出</span></span><br><span class="line">		<span class="keyword">if</span> strings.Trim(<span class="keyword">string</span>(buf[:n]), <span class="string">" \r\n"</span>) == <span class="string">"exit"</span> &#123;</span><br><span class="line">			fmt.Println(<span class="string">"用户输入了exit关闭了连接"</span>)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// 3. 显示客户发送的内容到服务器端</span></span><br><span class="line">		fmt.Print(<span class="keyword">string</span>(buf[:n])) <span class="comment">// 只显示读取到的字节数的内容</span></span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">"服务器开始监听..."</span>)</span><br><span class="line">	<span class="comment">// net.Listen("tcp", "127.0.0.1:8888")</span></span><br><span class="line">	<span class="comment">// 1. tcp 表示使用网络协议是tcp</span></span><br><span class="line">	<span class="comment">// 2. 0.0.0.0:8888 表示在本地监听 8888端口</span></span><br><span class="line">	listen, err := net.Listen(<span class="string">"tcp"</span>, <span class="string">"0.0.0.0:8888"</span>)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"listen err="</span>, err)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 延时关闭</span></span><br><span class="line">	<span class="keyword">defer</span> listen.Close()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 循环等待客户端连接</span></span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		<span class="comment">// 等待客户端来连接</span></span><br><span class="line">		fmt.Println(<span class="string">"等待客户端来连接"</span>)</span><br><span class="line">		conn, err := listen.Accept()</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			fmt.Println(<span class="string">"Accep() err"</span>, err)</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			fmt.Printf(<span class="string">"Accept() suc con=%v 客户端ip=%v\n"</span>, conn,</span><br><span class="line">				conn.RemoteAddr().String())</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// 这里准备启一个协程为客户端服务</span></span><br><span class="line">		<span class="keyword">go</span> process(conn)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	fmt.Printf(<span class="string">"listen suc =%v\n"</span>, listen)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"bufio"</span></span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"net"</span></span><br><span class="line">	<span class="string">"os"</span></span><br><span class="line">	<span class="string">"strings"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	conn, err := net.Dial(<span class="string">"tcp"</span>, <span class="string">"0.0.0.0:8888"</span>)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"client dial err="</span>, err)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 功能1：客户端可以发送单行数据，然后就退出</span></span><br><span class="line">	reader := bufio.NewReader(os.Stdin) <span class="comment">// os.Stdin 代表标准输入（万物皆文件）</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		fmt.Printf(<span class="string">"请输入你要发送的数据发送数据:"</span>)</span><br><span class="line">		<span class="comment">// 从终端读取一行用户输入，并准备发送给服务器</span></span><br><span class="line">		line, err := reader.ReadString(<span class="string">'\n'</span>)</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			fmt.Println(<span class="string">"readstring err="</span>, err)</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// 在将line发送给服务器</span></span><br><span class="line">		_, err = conn.Write([]<span class="keyword">byte</span>(line))</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			fmt.Println(<span class="string">"conn.Write err="</span>, err)</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// 去除回车、换行、空格后的消息是"exit"的话，就退出</span></span><br><span class="line">		<span class="keyword">if</span> strings.Trim(line, <span class="string">" \r\n"</span>) == <span class="string">"exit"</span> &#123;</span><br><span class="line">			fmt.Println(<span class="string">"客户端输入了exit，连接关闭"</span>)</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// fmt.Printf("客户端发送了 %d 个字节的数据\n", n)</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出效果略</p>
<h2 id="18-4-经典项目-海量用户即使通讯系统"><a href="#18-4-经典项目-海量用户即使通讯系统" class="headerlink" title="18.4 经典项目-海量用户即使通讯系统"></a>18.4 经典项目-海量用户即使通讯系统</h2><h3 id="18-4-1-项目开发流程"><a href="#18-4-1-项目开发流程" class="headerlink" title="18.4.1 项目开发流程"></a>18.4.1 项目开发流程</h3><ol>
<li>需求分析</li>
<li>设计阶段</li>
<li>编码阶段</li>
<li>测试阶段</li>
<li>实施</li>
</ol>
<h3 id="18-4-2-需求分析"><a href="#18-4-2-需求分析" class="headerlink" title="18.4.2 需求分析"></a>18.4.2 需求分析</h3><ol>
<li>用户注册</li>
<li>用户登录</li>
<li>显示在线用户列表</li>
<li>群聊（广播）</li>
<li>点对点聊天</li>
<li>离线留言</li>
</ol>
<h3 id="18-4-3-界面设计"><a href="#18-4-3-界面设计" class="headerlink" title="18.4.3 界面设计"></a>18.4.3 界面设计</h3><h3 id="18-4-4-项目开发前的技术准备"><a href="#18-4-4-项目开发前的技术准备" class="headerlink" title="18.4.4 项目开发前的技术准备"></a>18.4.4 项目开发前的技术准备</h3><p>项目要保存用户信息和消息数据，因此我们需要学习数据库（Redis或者Mysql），这里我们选择Redis。需要学习如何在Golang中使用Redis（见19章）。</p>
<h1 id="第19章-Redis的使用"><a href="#第19章-Redis的使用" class="headerlink" title="第19章 Redis的使用"></a>第19章 Redis的使用</h1><h2 id="19-1-Redis的基本介绍"><a href="#19-1-Redis的基本介绍" class="headerlink" title="19.1 Redis的基本介绍"></a>19.1 Redis的基本介绍</h2><ol>
<li>Redis是NoSQL数据库，不是传统的关系型数据库。</li>
<li>Rdis：REmote Dictionary Server（远程字典服务器），Redis性能非常高，单机能够达到15W qps，通常适合做缓存，也可以持久化。</li>
</ol>
<h2 id="19-2-Redis操作的基本原理"><a href="#19-2-Redis操作的基本原理" class="headerlink" title="19.2 Redis操作的基本原理"></a>19.2 Redis操作的基本原理</h2><p><img src="https://s2.ax1x.com/2019/11/13/MGS7p8.png" alt="MGS7p8.png"></p>
<h2 id="19-3-Redis的安装和基本使用"><a href="#19-3-Redis的安装和基本使用" class="headerlink" title="19.3 Redis的安装和基本使用"></a>19.3 Redis的安装和基本使用</h2><h3 id="19-3-2-Redis的基本使用"><a href="#19-3-2-Redis的基本使用" class="headerlink" title="19.3.2 Redis的基本使用"></a>19.3.2 Redis的基本使用</h3><p>说明：Redis安装好后，默认有16个数据库，初始默认使用0号库，编号是0…15</p>
<ol>
<li>添加key-val <code>[set]</code></li>
<li>查看当前Redis的所有key <code>[keys *]</code></li>
<li>切换redis数据库 <code>[select index]</code></li>
<li>如何查看当前数据库的key-val数量 <code>[dbsize]</code></li>
<li>清空当前数据库的key-val和清空所有数据库的key-val <code>[flushdb flushall]</code></li>
</ol>
<h2 id="19-4-Redis的Crud操作"><a href="#19-4-Redis的Crud操作" class="headerlink" title="19.4 Redis的Crud操作"></a>19.4 Redis的Crud操作</h2><h3 id="19-4-1-Redis的五大数据类型"><a href="#19-4-1-Redis的五大数据类型" class="headerlink" title="19.4.1 Redis的五大数据类型"></a>19.4.1 Redis的五大数据类型</h3><p>Redis的五大数据类型是：String（字符串）、Hash（哈希）、List（列表）、Set（集合）和zset（sorted set 有序结合）</p>
<h3 id="19-4-2-String（字符串）-介绍"><a href="#19-4-2-String（字符串）-介绍" class="headerlink" title="19.4.2 String（字符串）-介绍"></a>19.4.2 String（字符串）-介绍</h3><ol>
<li>string是redis最基本的类型，一个key对应一个value</li>
<li>string类型时二进制安全的。除普通的字符串外，可以看存放图片等数据。</li>
<li>redis中字符串value最大是512M</li>
</ol>
<ul>
<li>String(字符串)-CRUD<ul>
<li>set：如果存在就相当于修改，不存在就是添加</li>
<li>get：获取输入的键对应的值</li>
<li>del：删除输入的键对应的值</li>
</ul>
</li>
<li>setex（set with expire）键秒值<br>  格式：setex key seconds value<br>  说明：设置以key为键的value值存在seconds秒</li>
<li>mset（同时设置一个或多个key-value对）<br>  格式：mset key1 value1 key2 value2 … keyX valueX</li>
<li>mget（同时获取一个或多个key-value值）<br>  格式：mget key1 key2 … keyX</li>
</ul>
<h3 id="19-4-3-Hash（哈希，类型golang中的Map）-介绍"><a href="#19-4-3-Hash（哈希，类型golang中的Map）-介绍" class="headerlink" title="19.4.3 Hash（哈希，类型golang中的Map）-介绍"></a>19.4.3 Hash（哈希，类型golang中的Map）-介绍</h3><ol>
<li>Redis hash是一个键值对集合。var user1 map[string]string</li>
<li>Redis hash是一个string类型的field和value的映射表，hash特别适合用于存储对象。</li>
</ol>
<ul>
<li>举例：存放一个User信息<br>  user1 name smith age 30 job “golang coder”<br>  说明：key:user1 name smith age 30 job “golang coder”<br>  格式：hset key field value [field vaule] </li>
<li>Hash（哈希，类似golang里的Map）-CRUD<br>  hset/hget/hgetall/hdel<br>  hmset设置字段的值<br>  hset这种一个字段的值</li>
<li>Hash-使用细节和注意事项<ol>
<li>在给user设置name和age时，前面我们是一步一步设置，使用hmset和hmget可以一次性来设置多个field的值和返回多个field的值</li>
<li>hlen统计一个hash有几个元素</li>
<li>hexists key field：查看哈希表key中，给定域field是否存在</li>
</ol>
</li>
</ul>
<h3 id="19-4-4-List（列表）-介绍"><a href="#19-4-4-List（列表）-介绍" class="headerlink" title="19.4.4 List（列表）-介绍"></a>19.4.4 List（列表）-介绍</h3><p>列表是简单的字符串列表，按照插入顺序排列。你可以添加一个元素到列表的头部（左边）或者尾部（右边）<br>List本质是个链表，List的元素是有序的，元素的值是可以重复的。</p>
<ul>
<li><p>入门案例<br>  存放多个地址信息：<code>city beijing tianjing shanghai</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">lpush city beijing tianjing shanghai</span><br><span class="line">lrage ciyt 0 -1</span><br><span class="line">// 输出</span><br><span class="line">&quot;shanghai&quot;</span><br><span class="line">&quot;tianjing&quot;</span><br><span class="line">&quot;beijing&quot;</span><br></pre></td></tr></table></figure>

<p>  说明：</p>
<ol>
<li><code>lpush key value [valu-e ...]</code></li>
<li><code>lrange key start stop</code>：0表示列表开头，-1表示列表全部元素</li>
</ol>
</li>
<li><p>List（列表）-CRUD</p>
<ol>
<li><p><code>lpush</code>：从头部插入</p>
</li>
<li><p><code>rpush</code>：从尾部插入</p>
</li>
<li><p><code>lrang</code>：</p>
<p> 命令格式：<code>lrange key start stop</code></p>
<p> 说明：返回列表key中指定区间的元素，区间以偏移量start和stop指定。下标（index）参数start和stop都以0位底，也就是说，以0表示列表的第一个元素，以1表示列表的第二个元素，以此类推。-1表示列表倒数第一个元素，-2表示列表倒数第二个元素。</p>
</li>
<li><p><code>lpop</code>：从链表左边取出并移除一个数据</p>
</li>
<li><p><code>rpop</code>：从链表的右边取出并移除一个数据</p>
</li>
<li><p><code>del</code>：根据key值删除链表</p>
</li>
</ol>
</li>
<li><p>List-使用细节和注意事项</p>
<ol>
<li><p>index：按照索引小标获得元素（从左到右，编号从0开始）</p>
</li>
<li><p>llen key：返回列表key的长度，如果key不存在，则key被解释到一个空列表，返回0</p>
</li>
<li><p>list的其他说明：</p>
<ul>
<li>list数据，可以从左或右插入添加</li>
<li>如果值全部移除，对应的键也就消失了</li>
</ul>
</li>
</ol>
</li>
</ul>

      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/05/06/导航栏使用测试/" rel="next" title="导航栏使用测试">
                <i class="fa fa-chevron-left"></i> 导航栏使用测试
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/07/01/编程风格-好代码的逻辑/" rel="prev" title="编程风格-好代码的逻辑">
                编程风格-好代码的逻辑 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/author.jpg" alt="B1aK2">
            
              <p class="site-author-name" itemprop="name">B1aK2</p>
              <div class="site-description motion-element" itemprop="description">Wonderful Everyday Down the Rabbit-Hole</div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">11</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                      <a href="/categories/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">3</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
            </nav>
          

          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/yourname" title="GitHub &rarr; https://github.com/yourname" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
            </div>
          

          

          
          

          
            
          
          

        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#3-变量"><span class="nav-number">1.</span> <span class="nav-text">3 变量</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#3-12-字符串类型：string"><span class="nav-number">1.1.</span> <span class="nav-text">3.12 字符串类型：string</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-13-基本数据类型默认值"><span class="nav-number">1.2.</span> <span class="nav-text">3.13 基本数据类型默认值</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-13-1-基本介绍"><span class="nav-number">1.2.1.</span> <span class="nav-text">3.13.1 基本介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-13-2-基本类型的默认值如下"><span class="nav-number">1.2.2.</span> <span class="nav-text">3.13.2 基本类型的默认值如下</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-14-基本数据类型的相互转换"><span class="nav-number">1.3.</span> <span class="nav-text">3.14 基本数据类型的相互转换</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-14-1-基本介绍"><span class="nav-number">1.3.1.</span> <span class="nav-text">3.14.1 基本介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-14-2-基本语法"><span class="nav-number">1.3.2.</span> <span class="nav-text">3.14.2 基本语法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-14-3-案例演示"><span class="nav-number">1.3.3.</span> <span class="nav-text">3.14.3 案例演示</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-14-4-基本数据类型相互转换的注意事项"><span class="nav-number">1.3.4.</span> <span class="nav-text">3.14.4 基本数据类型相互转换的注意事项</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-14-5-练习题"><span class="nav-number">1.3.5.</span> <span class="nav-text">3.14.5 练习题</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-15-基本数据类型和string的转换"><span class="nav-number">1.4.</span> <span class="nav-text">3.15 基本数据类型和string的转换</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-15-1-基本介绍"><span class="nav-number">1.4.1.</span> <span class="nav-text">3.15.1 基本介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-15-2-基本数据类型转string类型"><span class="nav-number">1.4.2.</span> <span class="nav-text">3.15.2 基本数据类型转string类型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-15-3-string类转换基本数据类型"><span class="nav-number">1.4.3.</span> <span class="nav-text">3.15.3 string类转换基本数据类型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-15-4-string转基本数据类型的注意事项"><span class="nav-number">1.4.4.</span> <span class="nav-text">3.15.4 string转基本数据类型的注意事项</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-16-指针"><span class="nav-number">1.5.</span> <span class="nav-text">3.16 指针</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-16-1-基本介绍"><span class="nav-number">1.5.1.</span> <span class="nav-text">3.16.1 基本介绍</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-17-值类型和引用类型"><span class="nav-number">1.6.</span> <span class="nav-text">3.17 值类型和引用类型</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-17-1-常见的值类型和引用类型"><span class="nav-number">1.6.1.</span> <span class="nav-text">3.17.1 常见的值类型和引用类型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-17-2-值类型和引用类型的特点"><span class="nav-number">1.6.2.</span> <span class="nav-text">3.17.2 值类型和引用类型的特点</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-18-标识符的命名规范"><span class="nav-number">1.7.</span> <span class="nav-text">3.18 标识符的命名规范</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-18-1-标识符概念"><span class="nav-number">1.7.1.</span> <span class="nav-text">3.18.1 标识符概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-18-2-标识符的命名规则（重要）"><span class="nav-number">1.7.2.</span> <span class="nav-text">3.18.2 标识符的命名规则（重要）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-18-3-标识符命名注意事项"><span class="nav-number">1.7.3.</span> <span class="nav-text">3.18.3 标识符命名注意事项</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-20-常量"><span class="nav-number">1.7.4.</span> <span class="nav-text">3.20 常量</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#4-运算符"><span class="nav-number">2.</span> <span class="nav-text">4 运算符</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#4-1-运算符的基本介绍"><span class="nav-number">2.1.</span> <span class="nav-text">4.1 运算符的基本介绍</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-2-算数运算符"><span class="nav-number">2.2.</span> <span class="nav-text">4.2 算数运算符</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-3-算数运算符使用细节"><span class="nav-number">2.2.1.</span> <span class="nav-text">4.2.3 算数运算符使用细节</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-9-运算符的优先级"><span class="nav-number">2.3.</span> <span class="nav-text">4.9 运算符的优先级</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-9-1-运算符优先级一览表"><span class="nav-number">2.3.1.</span> <span class="nav-text">4.9.1 运算符优先级一览表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-9-2-总结："><span class="nav-number">2.3.2.</span> <span class="nav-text">4.9.2 总结：</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-12-位运算"><span class="nav-number">2.4.</span> <span class="nav-text">4.12 位运算</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-12-2-原码、反码、补码"><span class="nav-number">2.4.1.</span> <span class="nav-text">4.12.2 原码、反码、补码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-12-3-移位运算"><span class="nav-number">2.4.2.</span> <span class="nav-text">4.12.3 移位运算</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#5-程序流程"><span class="nav-number">3.</span> <span class="nav-text">5 程序流程</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-3-3-单分支的细节说明"><span class="nav-number">3.0.1.</span> <span class="nav-text">5.3.3 单分支的细节说明</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-3-4-多分支的细节说明"><span class="nav-number">3.0.2.</span> <span class="nav-text">5.3.4 多分支的细节说明</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-4-switch分支控制"><span class="nav-number">3.1.</span> <span class="nav-text">5.4 switch分支控制</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-4-1-基本的介绍"><span class="nav-number">3.1.1.</span> <span class="nav-text">5.4.1 基本的介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-4-2-基本语法"><span class="nav-number">3.1.2.</span> <span class="nav-text">5.4.2 基本语法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-4-3-总结"><span class="nav-number">3.1.3.</span> <span class="nav-text">5.4.3 总结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-5-for循环"><span class="nav-number">3.2.</span> <span class="nav-text">5.5 for循环</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-字符串遍历方式"><span class="nav-number">3.2.1.</span> <span class="nav-text">5. 字符串遍历方式</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-6-while和do……while的实现"><span class="nav-number">3.3.</span> <span class="nav-text">5.6 while和do……while的实现</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-6-1-for循环实现while的效果"><span class="nav-number">3.3.1.</span> <span class="nav-text">5.6.1 for循环实现while的效果</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-6-2-for循环实现do……while循环"><span class="nav-number">3.3.2.</span> <span class="nav-text">5.6.2 for循环实现do……while循环</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-8-跳转控制语句-break"><span class="nav-number">3.4.</span> <span class="nav-text">5.8 跳转控制语句-break</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-8-1-看一个具体需求，引出break"><span class="nav-number">3.4.1.</span> <span class="nav-text">5.8.1 看一个具体需求，引出break</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-8-6-break的注意事项和使用细节"><span class="nav-number">3.4.2.</span> <span class="nav-text">5.8.6 break的注意事项和使用细节</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-函数"><span class="nav-number">3.5.</span> <span class="nav-text">6 函数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#6-1-函数注意事项"><span class="nav-number">3.5.1.</span> <span class="nav-text">6.1 函数注意事项</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-16-init函数"><span class="nav-number">3.6.</span> <span class="nav-text">6.16 init函数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#6-16-1-函数说明"><span class="nav-number">3.6.1.</span> <span class="nav-text">6.16.1 函数说明</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-16-2-细节说明"><span class="nav-number">3.6.2.</span> <span class="nav-text">6.16.2 细节说明</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-17-匿名函数"><span class="nav-number">3.7.</span> <span class="nav-text">6.17 匿名函数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#6-17-2-匿名函数使用方式1"><span class="nav-number">3.7.1.</span> <span class="nav-text">6.17.2 匿名函数使用方式1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-17-3-匿名函数使用方式2"><span class="nav-number">3.7.2.</span> <span class="nav-text">6.17.3 匿名函数使用方式2</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-17-3-全局匿名函数"><span class="nav-number">3.7.3.</span> <span class="nav-text">6.17.3 全局匿名函数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-18-闭包"><span class="nav-number">3.8.</span> <span class="nav-text">6.18 闭包</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#6-18-1-介绍"><span class="nav-number">3.8.1.</span> <span class="nav-text">6.18.1 介绍</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-19-函数的defer"><span class="nav-number">3.9.</span> <span class="nav-text">6.19 函数的defer</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#6-19-1-快速入门案例"><span class="nav-number">3.9.1.</span> <span class="nav-text">6.19.1 快速入门案例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-19-2-defer的细节说明"><span class="nav-number">3.9.2.</span> <span class="nav-text">6.19.2 defer的细节说明</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-19-3-defer的最佳实践"><span class="nav-number">3.9.3.</span> <span class="nav-text">6.19.3 defer的最佳实践</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-20-值传递和引用传递"><span class="nav-number">3.10.</span> <span class="nav-text">6.20 值传递和引用传递</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#6-20-3-值类型和引用类型的分类"><span class="nav-number">3.10.1.</span> <span class="nav-text">6.20.3 值类型和引用类型的分类</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-21-变量作用域"><span class="nav-number">3.11.</span> <span class="nav-text">6.21 变量作用域</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-23-字符串中常用的系统函数"><span class="nav-number">3.12.</span> <span class="nav-text">6.23 字符串中常用的系统函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-24-时间和日期相关的函数"><span class="nav-number">3.13.</span> <span class="nav-text">6.24 时间和日期相关的函数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#6-24-1-基本的介绍"><span class="nav-number">3.13.1.</span> <span class="nav-text">6.24.1 基本的介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-24-2-编写一段代码来统计函数test03-执行的时间"><span class="nav-number">3.13.2.</span> <span class="nav-text">6.24.2 编写一段代码来统计函数test03()执行的时间</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-25-内置函数"><span class="nav-number">3.14.</span> <span class="nav-text">6.25 内置函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-26-错误处理"><span class="nav-number">3.15.</span> <span class="nav-text">6.26 错误处理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#6-26-3-使用defer加recover的形式来处理错误"><span class="nav-number">3.15.1.</span> <span class="nav-text">6.26.3 使用defer加recover的形式来处理错误</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-26-4-自定义错误"><span class="nav-number">3.15.2.</span> <span class="nav-text">6.26.4 自定义错误</span></a></li></ol></li></ol><li class="nav-item nav-level-1"><a class="nav-link" href="#7-数组与切片"><span class="nav-number">4.</span> <span class="nav-text">7 数组与切片</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#7-1-数组"><span class="nav-number">4.1.</span> <span class="nav-text">7.1 数组</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-2-使用示例"><span class="nav-number">4.2.</span> <span class="nav-text">7.2 使用示例</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#7-2-1-四种初始化数组的方法"><span class="nav-number">4.2.1.</span> <span class="nav-text">7.2.1 四种初始化数组的方法</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-3-数组的遍历"><span class="nav-number">4.3.</span> <span class="nav-text">7.3 数组的遍历</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#7-3-2-for-range遍历"><span class="nav-number">4.3.1.</span> <span class="nav-text">7.3.2 for-range遍历</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-7-数组使用的注意事项和细节"><span class="nav-number">4.4.</span> <span class="nav-text">7.7 数组使用的注意事项和细节</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#7-8-数组应用案例"><span class="nav-number">4.4.1.</span> <span class="nav-text">7.8 数组应用案例</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-9-切片"><span class="nav-number">4.5.</span> <span class="nav-text">7.9 切片</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#7-9-1-切片的基本介绍"><span class="nav-number">4.5.1.</span> <span class="nav-text">7.9.1 切片的基本介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-9-2-切片的使用示例"><span class="nav-number">4.5.2.</span> <span class="nav-text">7.9.2 切片的使用示例</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-12-切片在内存中形式"><span class="nav-number">4.6.</span> <span class="nav-text">7.12 切片在内存中形式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-13-切片的使用方式"><span class="nav-number">4.7.</span> <span class="nav-text">7.13 切片的使用方式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#方式1"><span class="nav-number">4.7.1.</span> <span class="nav-text">方式1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#方式2"><span class="nav-number">4.7.2.</span> <span class="nav-text">方式2</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#方式3"><span class="nav-number">4.7.3.</span> <span class="nav-text">方式3</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#方式1与方式2的区别"><span class="nav-number">4.7.4.</span> <span class="nav-text">方式1与方式2的区别</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-14-切片的遍历"><span class="nav-number">4.8.</span> <span class="nav-text">7.14 切片的遍历</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#for循环实现切片遍历"><span class="nav-number">4.8.1.</span> <span class="nav-text">for循环实现切片遍历</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#for-range方式实现切片遍历"><span class="nav-number">4.8.2.</span> <span class="nav-text">for-range方式实现切片遍历</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-15-切片注意事项和细节说明"><span class="nav-number">4.9.</span> <span class="nav-text">7.15 切片注意事项和细节说明</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-16string和slice"><span class="nav-number">4.10.</span> <span class="nav-text">7.16string和slice</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#8-排序和查找"><span class="nav-number">5.</span> <span class="nav-text">8 排序和查找</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#8-1-排序的介绍"><span class="nav-number">5.1.</span> <span class="nav-text">8.1 排序的介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#8-1-1-内部排序"><span class="nav-number">5.1.1.</span> <span class="nav-text">8.1.1 内部排序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-1-2-外部排序"><span class="nav-number">5.1.2.</span> <span class="nav-text">8.1.2 外部排序</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-2-冒泡排序的思路分析"><span class="nav-number">5.2.</span> <span class="nav-text">8.2 冒泡排序的思路分析</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-3-查找"><span class="nav-number">5.3.</span> <span class="nav-text">8.3 查找</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-4-二维数组的介绍"><span class="nav-number">5.4.</span> <span class="nav-text">8.4 二维数组的介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#8-4-1-二维数组的遍历"><span class="nav-number">5.4.1.</span> <span class="nav-text">8.4.1 二维数组的遍历</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#9-map"><span class="nav-number">6.</span> <span class="nav-text">9 map</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#9-1-map的基本介绍"><span class="nav-number">6.1.</span> <span class="nav-text">9.1 map的基本介绍</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-2-map的声明"><span class="nav-number">6.2.</span> <span class="nav-text">9.2 map的声明</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#9-2-1-基本语法"><span class="nav-number">6.2.1.</span> <span class="nav-text">9.2.1 基本语法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-2-2-map声明的示例"><span class="nav-number">6.2.2.</span> <span class="nav-text">9.2.2 map声明的示例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-2-3-map的使用方式"><span class="nav-number">6.2.3.</span> <span class="nav-text">9.2.3 map的使用方式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-2-4-使用示例"><span class="nav-number">6.2.4.</span> <span class="nav-text">9.2.4 使用示例</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-3-map的增删改查操作"><span class="nav-number">6.3.</span> <span class="nav-text">9.3 map的增删改查操作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#9-3-1-map增加和更新"><span class="nav-number">6.3.1.</span> <span class="nav-text">9.3.1 map增加和更新</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-3-2-map的删除"><span class="nav-number">6.3.2.</span> <span class="nav-text">9.3.2 map的删除</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-3-3-map的查找"><span class="nav-number">6.3.3.</span> <span class="nav-text">9.3.3 map的查找</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-3-4-map的遍历"><span class="nav-number">6.3.4.</span> <span class="nav-text">9.3.4 map的遍历</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-3-5-map的长度"><span class="nav-number">6.3.5.</span> <span class="nav-text">9.3.5 map的长度</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-3-6-map切片"><span class="nav-number">6.3.6.</span> <span class="nav-text">9.3.6 map切片</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-3-7-map排序"><span class="nav-number">6.3.7.</span> <span class="nav-text">9.3.7 map排序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-3-8-map的使用细节"><span class="nav-number">6.3.8.</span> <span class="nav-text">9.3.8 map的使用细节</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#10-面向对象编程（上）"><span class="nav-number">7.</span> <span class="nav-text">10 面向对象编程（上）</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#10-1-结构体"><span class="nav-number">7.1.</span> <span class="nav-text">10.1 结构体</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#10-1-1-如何声明结构体"><span class="nav-number">7.1.1.</span> <span class="nav-text">10.1.1 如何声明结构体</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-1-2-创建结构体的四种方法"><span class="nav-number">7.1.2.</span> <span class="nav-text">10.1.2 创建结构体的四种方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-1-3-结构体内存分配机制"><span class="nav-number">7.1.3.</span> <span class="nav-text">10.1.3 结构体内存分配机制</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-1-4-结构体使用注意事项和细节操作"><span class="nav-number">7.1.4.</span> <span class="nav-text">10.1.4 结构体使用注意事项和细节操作</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#10-2-方法"><span class="nav-number">7.2.</span> <span class="nav-text">10.2 方法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#10-2-1-方法使用细节"><span class="nav-number">7.2.1.</span> <span class="nav-text">10.2.1 方法使用细节</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-2-2-方法与函数的区别"><span class="nav-number">7.2.2.</span> <span class="nav-text">10.2.2 方法与函数的区别</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-2-3-创建结构体变量时指定字段值"><span class="nav-number">7.2.3.</span> <span class="nav-text">10.2.3 创建结构体变量时指定字段值 **</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-2-4-工厂模式"><span class="nav-number">7.2.4.</span> <span class="nav-text">10.2.4 工厂模式</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#11-面向对象编程（下）"><span class="nav-number">8.</span> <span class="nav-text">11 面向对象编程（下）</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#11-3-面向对象编程三大特性"><span class="nav-number">8.1.</span> <span class="nav-text">11.3 面向对象编程三大特性</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#11-3-1-基本介绍"><span class="nav-number">8.1.1.</span> <span class="nav-text">11.3.1 基本介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-3-2-封装介绍"><span class="nav-number">8.1.2.</span> <span class="nav-text">11.3.2 封装介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-3-3-封装的理解和好处"><span class="nav-number">8.1.3.</span> <span class="nav-text">11.3.3 封装的理解和好处</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-3-4-如何体现封装"><span class="nav-number">8.1.4.</span> <span class="nav-text">11.3.4 如何体现封装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-3-5-封装的实现步骤"><span class="nav-number">8.1.5.</span> <span class="nav-text">11.3.5 封装的实现步骤</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-3-6-嵌套匿名结构体的基本语法"><span class="nav-number">8.1.6.</span> <span class="nav-text">11.3.6 嵌套匿名结构体的基本语法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-3-7-继承的深入讨论"><span class="nav-number">8.1.7.</span> <span class="nav-text">11.3.7 继承的深入讨论</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-3-8-多重继承"><span class="nav-number">8.1.8.</span> <span class="nav-text">11.3.8 多重继承</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#11-5-接口"><span class="nav-number">8.2.</span> <span class="nav-text">11.5 接口</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#11-5-1-为什么要有接口？"><span class="nav-number">8.2.1.</span> <span class="nav-text">11.5.1 为什么要有接口？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-5-2-基本介绍"><span class="nav-number">8.2.2.</span> <span class="nav-text">11.5.2 基本介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-5-3-基本语法"><span class="nav-number">8.2.3.</span> <span class="nav-text">11.5.3 基本语法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-5-4-接口使用的注意事项和细节"><span class="nav-number">8.2.4.</span> <span class="nav-text">11.5.4 接口使用的注意事项和细节</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-5-5-接口使用示例"><span class="nav-number">8.2.5.</span> <span class="nav-text">11.5.5 接口使用示例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-5-6-接口和继承"><span class="nav-number">8.2.6.</span> <span class="nav-text">11.5.6 接口和继承</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#11-6-多态"><span class="nav-number">8.3.</span> <span class="nav-text">11.6 多态</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#11-6-1-基本介绍"><span class="nav-number">8.3.1.</span> <span class="nav-text">11.6.1 基本介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-6-2-接口体现多态特征"><span class="nav-number">8.3.2.</span> <span class="nav-text">11.6.2 接口体现多态特征</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#11-7-类型断言"><span class="nav-number">8.4.</span> <span class="nav-text">11.7 类型断言</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#11-7-1-基本介绍"><span class="nav-number">8.4.1.</span> <span class="nav-text">11.7.1 基本介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-7-2-类型断言的最佳实践"><span class="nav-number">8.4.2.</span> <span class="nav-text">11.7.2 类型断言的最佳实践</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#最佳实践2"><span class="nav-number">8.4.3.</span> <span class="nav-text">最佳实践2</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#12-项目1-家庭收支记账软件项目"><span class="nav-number">9.</span> <span class="nav-text">12 项目1-家庭收支记账软件项目</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#12-1-项目开发流程说明"><span class="nav-number">9.1.</span> <span class="nav-text">12.1 项目开发流程说明</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#12-2-项目需求说明"><span class="nav-number">9.2.</span> <span class="nav-text">12.2 项目需求说明</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#12-3-项目的界面"><span class="nav-number">9.3.</span> <span class="nav-text">12.3 项目的界面</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#12-4-项目代码实现1"><span class="nav-number">9.4.</span> <span class="nav-text">12.4 项目代码实现1</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#12-4-1-功能1"><span class="nav-number">9.4.1.</span> <span class="nav-text">12.4.1 功能1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#12-4-2-功能2-完成可以显示明细和登记收入的功能"><span class="nav-number">9.4.2.</span> <span class="nav-text">12.4.2 功能2 完成可以显示明细和登记收入的功能</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#12-4-2-功能3-完成可以登记支出的功能"><span class="nav-number">9.4.3.</span> <span class="nav-text">12.4.2 功能3 完成可以登记支出的功能</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#12-4-2-项目代码实现改进"><span class="nav-number">9.4.4.</span> <span class="nav-text">12.4.2 项目代码实现改进</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#13-项目2-客户信息管理系统"><span class="nav-number">10.</span> <span class="nav-text">13 项目2-客户信息管理系统</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#13-1-项目需求分析"><span class="nav-number">10.1.</span> <span class="nav-text">13.1 项目需求分析</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#13-2-项目的界面设计"><span class="nav-number">10.2.</span> <span class="nav-text">13.2 项目的界面设计</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#13-3-程序框架图的设计"><span class="nav-number">10.3.</span> <span class="nav-text">13.3 程序框架图的设计</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#13-4-项目功能实现-显示主菜单和完成退出软件功能"><span class="nav-number">10.4.</span> <span class="nav-text">13.4 项目功能实现-显示主菜单和完成退出软件功能</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#13-5-项目功能实现-完成显示客户列表的功能"><span class="nav-number">10.5.</span> <span class="nav-text">13.5 项目功能实现-完成显示客户列表的功能</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#13-6-项目功能实现-添加客户的功能"><span class="nav-number">10.6.</span> <span class="nav-text">13.6 项目功能实现-添加客户的功能</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#13-7-项目功能实现-完成删除客户的功能"><span class="nav-number">10.7.</span> <span class="nav-text">13.7 项目功能实现-完成删除客户的功能</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#13-8-项目功能实现-完善退出确认功能"><span class="nav-number">10.8.</span> <span class="nav-text">13.8 项目功能实现-完善退出确认功能</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#13-9-项目功能实现-完成修改客户的功能"><span class="nav-number">10.9.</span> <span class="nav-text">13.9 项目功能实现-完成修改客户的功能</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#13-10-项目完整代码"><span class="nav-number">10.10.</span> <span class="nav-text">13.10 项目完整代码</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#第14章-文件操作"><span class="nav-number">11.</span> <span class="nav-text">第14章 文件操作</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#14-1-文件-基本介绍"><span class="nav-number">11.1.</span> <span class="nav-text">14.1 文件-基本介绍</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#14-2-常用的文件操作函数和方法"><span class="nav-number">11.2.</span> <span class="nav-text">14.2 常用的文件操作函数和方法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#14-3-读文件操作应用实例"><span class="nav-number">11.3.</span> <span class="nav-text">14.3 读文件操作应用实例</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#14-4-写文件操作应用实例"><span class="nav-number">11.4.</span> <span class="nav-text">14.4 写文件操作应用实例</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#14-4-1-基本介绍"><span class="nav-number">11.4.1.</span> <span class="nav-text">14.4.1 基本介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#14-4-2-基本应用实例-方式一"><span class="nav-number">11.4.2.</span> <span class="nav-text">14.4.2 基本应用实例-方式一</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#14-4-3-基本应用实例-方式二"><span class="nav-number">11.4.3.</span> <span class="nav-text">14.4.3 基本应用实例-方式二</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#14-4-4-判断文件是否存在"><span class="nav-number">11.4.4.</span> <span class="nav-text">14.4.4 判断文件是否存在</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#14-5-文件编程应用实例"><span class="nav-number">11.5.</span> <span class="nav-text">14.5 文件编程应用实例</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#14-5-1-拷贝文件"><span class="nav-number">11.5.1.</span> <span class="nav-text">14.5.1 拷贝文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#14-5-2-统计英文、数字、空格和其他字符"><span class="nav-number">11.5.2.</span> <span class="nav-text">14.5.2 统计英文、数字、空格和其他字符</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#14-6-命令行参数"><span class="nav-number">11.6.</span> <span class="nav-text">14.6 命令行参数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#14-6-1-需求"><span class="nav-number">11.6.1.</span> <span class="nav-text">14.6.1 需求</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#14-6-2-基本介绍"><span class="nav-number">11.6.2.</span> <span class="nav-text">14.6.2 基本介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#14-6-3-案例"><span class="nav-number">11.6.3.</span> <span class="nav-text">14.6.3 案例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#16-6-4-flag包来解析参数"><span class="nav-number">11.6.4.</span> <span class="nav-text">16.6.4 flag包来解析参数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#14-7-json基本介绍"><span class="nav-number">11.7.</span> <span class="nav-text">14.7 json基本介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#14-7-1-概述"><span class="nav-number">11.7.1.</span> <span class="nav-text">14.7.1 概述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#14-7-2-json的应用场景"><span class="nav-number">11.7.2.</span> <span class="nav-text">14.7.2 json的应用场景</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#14-7-3-jaon数据格式说明"><span class="nav-number">11.7.3.</span> <span class="nav-text">14.7.3 jaon数据格式说明</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#14-7-4-json的序列化"><span class="nav-number">11.7.4.</span> <span class="nav-text">14.7.4 json的序列化</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#14-8-json的反序列化"><span class="nav-number">11.8.</span> <span class="nav-text">14.8 json的反序列化</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#第15章-单元测试"><span class="nav-number">12.</span> <span class="nav-text">第15章 单元测试</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#15-1-先看一个需求"><span class="nav-number">12.1.</span> <span class="nav-text">15.1 先看一个需求</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#15-2-传统的方法"><span class="nav-number">12.2.</span> <span class="nav-text">15.2 传统的方法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#15-2-1-传统的方式来进行测试"><span class="nav-number">12.2.1.</span> <span class="nav-text">15.2.1 传统的方式来进行测试</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#15-2-2-传统方法的缺点分析"><span class="nav-number">12.2.2.</span> <span class="nav-text">15.2.2 传统方法的缺点分析</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#15-3-单元测试-基本介绍"><span class="nav-number">12.3.</span> <span class="nav-text">15.3 单元测试-基本介绍</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#15-4-单元测-快速入门"><span class="nav-number">12.4.</span> <span class="nav-text">15.4 单元测-快速入门</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#15-4-1-演示如何进行单元测试"><span class="nav-number">12.4.1.</span> <span class="nav-text">15.4.1 演示如何进行单元测试</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#15-4-2-单元测试快速入门总结"><span class="nav-number">12.4.2.</span> <span class="nav-text">15.4.2 单元测试快速入门总结</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#第16章-goroutine（协程）和channel（管道）"><span class="nav-number">13.</span> <span class="nav-text">第16章 goroutine（协程）和channel（管道）</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#16-1-goroutine-看一个需求"><span class="nav-number">13.1.</span> <span class="nav-text">16.1 goroutine-看一个需求</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#16-2-goroutine-基本介绍"><span class="nav-number">13.2.</span> <span class="nav-text">16.2 goroutine-基本介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#16-2-1-进程和线程说明"><span class="nav-number">13.2.1.</span> <span class="nav-text">16.2.1 进程和线程说明</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#16-2-2-并发和并行"><span class="nav-number">13.2.2.</span> <span class="nav-text">16.2.2 并发和并行</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#16-2-3-Go协程和Go主线程"><span class="nav-number">13.2.3.</span> <span class="nav-text">16.2.3 Go协程和Go主线程</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#16-3-goroutine快速入门"><span class="nav-number">13.3.</span> <span class="nav-text">16.3 goroutine快速入门</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#16-3-1-案例说明"><span class="nav-number">13.3.1.</span> <span class="nav-text">16.3.1 案例说明</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#16-3-2-快速入门小结"><span class="nav-number">13.3.2.</span> <span class="nav-text">16.3.2 快速入门小结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#16-4-goroutine的调度模型"><span class="nav-number">13.4.</span> <span class="nav-text">16.4 goroutine的调度模型</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#16-4-1-MPG模式基本介绍"><span class="nav-number">13.4.1.</span> <span class="nav-text">16.4.1 MPG模式基本介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#16-4-2-MPG模式运行的状态1"><span class="nav-number">13.4.2.</span> <span class="nav-text">16.4.2 MPG模式运行的状态1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#16-4-3-MPG模式运行的状态2"><span class="nav-number">13.4.3.</span> <span class="nav-text">16.4.3 MPG模式运行的状态2</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#16-5-设置Golang如下cpu的个数"><span class="nav-number">13.5.</span> <span class="nav-text">16.5 设置Golang如下cpu的个数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#16-6-channel（管道）-看个需求"><span class="nav-number">13.6.</span> <span class="nav-text">16.6 channel（管道）-看个需求</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#16-6-1-channel（管道）-基本介绍"><span class="nav-number">13.6.1.</span> <span class="nav-text">16.6.1 channel（管道）-基本介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#16-6-2-使用全局变量加锁同步改进程序"><span class="nav-number">13.6.2.</span> <span class="nav-text">16.6.2 使用全局变量加锁同步改进程序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#16-6-3-为什么需要channel"><span class="nav-number">13.6.3.</span> <span class="nav-text">16.6.3 为什么需要channel</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#16-6-4-channle的介绍"><span class="nav-number">13.6.4.</span> <span class="nav-text">16.6.4 channle的介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#16-6-5-定义-声明"><span class="nav-number">13.6.5.</span> <span class="nav-text">16.6.5 定义/声明</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#16-6-7-channel使用的注意事项"><span class="nav-number">13.6.6.</span> <span class="nav-text">16.6.7 channel使用的注意事项</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#16-8-channel的遍历和关闭"><span class="nav-number">13.7.</span> <span class="nav-text">16.8 channel的遍历和关闭</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#16-8-1-channel的遍历"><span class="nav-number">13.7.1.</span> <span class="nav-text">16.8.1 channel的遍历</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#16-8-2-channel的关闭"><span class="nav-number">13.7.2.</span> <span class="nav-text">16.8.2 channel的关闭</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#16-9-goroutine和channel结合"><span class="nav-number">13.8.</span> <span class="nav-text">16.9 goroutine和channel结合</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#16-9-1-应用案例1"><span class="nav-number">13.8.1.</span> <span class="nav-text">16.9.1 应用案例1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#16-9-2-应用实例2-阻塞"><span class="nav-number">13.8.2.</span> <span class="nav-text">16.9.2 应用实例2-阻塞</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#16-9-3-应用实例3"><span class="nav-number">13.8.3.</span> <span class="nav-text">16.9.3 应用实例3</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#16-10-channel使用细节和注意事项"><span class="nav-number">13.9.</span> <span class="nav-text">16.10 channel使用细节和注意事项</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#第17章-反射"><span class="nav-number">14.</span> <span class="nav-text">第17章 反射</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#17-1-反射的使用场景"><span class="nav-number">14.1.</span> <span class="nav-text">17.1 反射的使用场景</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#17-2-使用反射机制，编写函数的适配器：桥连接"><span class="nav-number">14.2.</span> <span class="nav-text">17.2 使用反射机制，编写函数的适配器：桥连接</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#17-3-反射的基本介绍"><span class="nav-number">14.3.</span> <span class="nav-text">17.3 反射的基本介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#17-3-1-基本介绍"><span class="nav-number">14.3.1.</span> <span class="nav-text">17.3.1 基本介绍</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#17-3-2-反射的应用场景"><span class="nav-number">14.4.</span> <span class="nav-text">17.3.2 反射的应用场景</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#17-3-3-反射重要的函数和概念"><span class="nav-number">14.5.</span> <span class="nav-text">17.3.3 反射重要的函数和概念</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#17-4-反射的快速入门"><span class="nav-number">14.6.</span> <span class="nav-text">17.4 反射的快速入门</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#17-4-1-快速入门说明"><span class="nav-number">14.6.1.</span> <span class="nav-text">17.4.1 快速入门说明</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#17-5-反射的注意事项和细节"><span class="nav-number">14.7.</span> <span class="nav-text">17.5 反射的注意事项和细节</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#17-6-小练习"><span class="nav-number">14.8.</span> <span class="nav-text">17.6 小练习</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#17-7-反射的最佳实践"><span class="nav-number">14.9.</span> <span class="nav-text">17.7 反射的最佳实践</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#第18章-TCP编程"><span class="nav-number">15.</span> <span class="nav-text">第18章 TCP编程</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#18-2-端口"><span class="nav-number">15.1.</span> <span class="nav-text">18.2 端口</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#18-2-1-端口的基本知识"><span class="nav-number">15.2.</span> <span class="nav-text">18.2.1 端口的基本知识</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#18-2-2-端口使用注意事项"><span class="nav-number">15.3.</span> <span class="nav-text">18.2.2 端口使用注意事项</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#18-3-TCP-socket编程的快速入门"><span class="nav-number">15.4.</span> <span class="nav-text">18.3 TCP socket编程的快速入门</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#18-3-1-服务端的处理流程"><span class="nav-number">15.4.1.</span> <span class="nav-text">18.3.1 服务端的处理流程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#18-3-2-客户端的处理流程"><span class="nav-number">15.4.2.</span> <span class="nav-text">18.3.2 客户端的处理流程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#18-3-3-Go服务器-客户端原理图"><span class="nav-number">15.4.3.</span> <span class="nav-text">18.3.3 Go服务器/客户端原理图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#18-3-4-代码实现"><span class="nav-number">15.4.4.</span> <span class="nav-text">18.3.4 代码实现</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#18-4-经典项目-海量用户即使通讯系统"><span class="nav-number">15.5.</span> <span class="nav-text">18.4 经典项目-海量用户即使通讯系统</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#18-4-1-项目开发流程"><span class="nav-number">15.5.1.</span> <span class="nav-text">18.4.1 项目开发流程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#18-4-2-需求分析"><span class="nav-number">15.5.2.</span> <span class="nav-text">18.4.2 需求分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#18-4-3-界面设计"><span class="nav-number">15.5.3.</span> <span class="nav-text">18.4.3 界面设计</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#18-4-4-项目开发前的技术准备"><span class="nav-number">15.5.4.</span> <span class="nav-text">18.4.4 项目开发前的技术准备</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#第19章-Redis的使用"><span class="nav-number">16.</span> <span class="nav-text">第19章 Redis的使用</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#19-1-Redis的基本介绍"><span class="nav-number">16.1.</span> <span class="nav-text">19.1 Redis的基本介绍</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#19-2-Redis操作的基本原理"><span class="nav-number">16.2.</span> <span class="nav-text">19.2 Redis操作的基本原理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#19-3-Redis的安装和基本使用"><span class="nav-number">16.3.</span> <span class="nav-text">19.3 Redis的安装和基本使用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#19-3-2-Redis的基本使用"><span class="nav-number">16.3.1.</span> <span class="nav-text">19.3.2 Redis的基本使用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#19-4-Redis的Crud操作"><span class="nav-number">16.4.</span> <span class="nav-text">19.4 Redis的Crud操作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#19-4-1-Redis的五大数据类型"><span class="nav-number">16.4.1.</span> <span class="nav-text">19.4.1 Redis的五大数据类型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#19-4-2-String（字符串）-介绍"><span class="nav-number">16.4.2.</span> <span class="nav-text">19.4.2 String（字符串）-介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#19-4-3-Hash（哈希，类型golang中的Map）-介绍"><span class="nav-number">16.4.3.</span> <span class="nav-text">19.4.3 Hash（哈希，类型golang中的Map）-介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#19-4-4-List（列表）-介绍"><span class="nav-number">16.4.4.</span> <span class="nav-text">19.4.4 List（列表）-介绍</span></a></li></ol></li></ol></li></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">B1aK2</span>

  

  
</div>


  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v3.9.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.1.2</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>














  
    
    
  
  <script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script>













  
  <script src="/lib/jquery/index.js?v=3.4.1"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/utils.js?v=7.1.2"></script>

  <script src="/js/motion.js?v=7.1.2"></script>



  
  


  <script src="/js/affix.js?v=7.1.2"></script>

  <script src="/js/schemes/pisces.js?v=7.1.2"></script>




  
  <script src="/js/scrollspy.js?v=7.1.2"></script>
<script src="/js/post-details.js?v=7.1.2"></script>



  


  <script src="/js/next-boot.js?v=7.1.2"></script>


  

  

  

  


  


  




  

  

  

  

  

  

  

  

  

  

  

  

  

  

</body>
</html>
